{"version":3,"sources":["../../src/index.ts","../../src/lookups.graphql.ts","../../src/types.ts","../../src/pubTypes.ts","../../src/schema.graphql.ts","../../src/pubSchema.graphql.ts","../../src/api.ts","../../src/util.ts","data/selectors/sites.ts","../../../src/hooks/useHostedAuth.ts","components/QuickNavigateField/QuickNavigateField.tsx","lib/environment.ts","data/api/MockApi.ts","data/api/Api.ts","data/api/GraphApi.ts","data/api/util.ts","components/AppNotifications/useNotifications.tsx","data/calls/addProjectSamples.ts","data/calls/createMetric.ts","data/calls/createModel.ts","data/calls/createOrganization.ts","data/calls/createOrganizationWithUser.ts","data/calls/createPredictor.ts","data/calls/createProject.ts","data/calls/createSampleSubmission.ts","data/calls/createSite.ts","data/calls/createTaxon.ts","data/calls/createTranslationGroup.ts","data/calls/deleteMetric.ts","data/calls/deleteModel.ts","data/calls/deleteOrganism.ts","data/calls/deleteOrganization.ts","data/calls/deletePredictor.ts","data/calls/deleteProject.ts","data/calls/deleteSample.ts","data/calls/deleteSite.ts","data/calls/deleteTranslationGroup.ts","data/calls/fetchBoxes.ts","data/calls/fetchActiveBoxes.ts","data/calls/fetchAttributes.ts","data/calls/fetchBoxDetailById.ts","data/calls/fetchBoxSamplesByBoxId.ts","data/calls/fetchBoxTaxaByBoxId.ts","data/calls/fetchCustomerBoxReportByBoxId.ts","data/calls/fetchLatestSubmissionByBoxId.ts","data/calls/fetchLookups.ts","data/calls/fetchMetrics.ts","data/calls/fetchMinimalSamplesByIds.ts","data/calls/fetchMinimalSamplesByOrganizationId.ts","data/calls/fetchMinimalSamplesByPolygon.ts","data/calls/fetchMinimalSamplesBySiteId.ts","data/calls/fetchMinimalSamplesByTaxonId.ts","data/calls/fetchMinimalSamplesByUsStateId.ts","data/calls/fetchModelById.ts","data/calls/fetchModelResultsBySampleId.ts","data/calls/fetchModels.ts","data/calls/fetchMyUser.ts","data/calls/fetchOrganismsBySampleId.ts","data/calls/fetchOrganizationById.ts","data/calls/fetchOrganizations.ts","data/calls/fetchPredictors.ts","data/calls/fetchProjects.ts","data/calls/fetchProjectSamplesByProjectId.ts","data/calls/fetchReportDataByReportIdQuery.ts","data/calls/fetchReports.ts","data/calls/fetchSampleById.ts","data/calls/fetchSamplePredictorValuesBySampleId.ts","data/calls/fetchSites.ts","data/calls/fetchSiteDetailById.ts","data/calls/fetchSitesByBoxId.ts","data/calls/fetchSitesByProjectId.ts","data/calls/fetchSitesPage.ts","data/calls/fetchSorterUsers.ts","data/calls/fetchTaxa.ts","data/calls/fetchTranslationGroupsByTranslationId.ts","data/calls/fetchTranslations.ts","data/calls/fetchUserBoxes.ts","data/calls/fetchUserById.ts","data/calls/fetchUsers.ts","data/calls/fetchUsStateAtCoordinates.ts","data/calls/finalizePendingBox.ts","data/calls/mergeBoxes.ts","data/calls/reconcileBoxTaxonomy.ts","data/calls/removeProjectSamples.ts","data/calls/splitBox.ts","data/calls/startSort.ts","data/calls/startTaxonomyIdentification.ts","data/calls/stopSort.ts","data/calls/stopTaxonomyIdentification.ts","data/calls/updateBox.ts","data/calls/updateLabSort.ts","data/calls/updateMetric.ts","data/calls/updateModel.ts","data/calls/updateOrganization.ts","data/calls/updatePredictor.ts","data/calls/updateProject.ts","data/calls/updateSample.ts","data/calls/updateSampleSubmission.ts","data/calls/updateSite.ts","data/calls/updateTaxon.ts","data/calls/updateTranslationGroup.ts","data/calls/updateUser.ts","data/calls/updateUserRoles.ts","data/calls/upsertOrganism.ts","data/selectors/lookups.ts","data/selectors/invalidate.ts","data/selectors/samples.ts","data/selectors/selectors.ts","data/selectors/taxonomy.ts","data/selectors/users.ts","components/SideNavBar/UserName.tsx","components/withSuspense/withSuspense.tsx","components/SideNavBar/SideNavBar.tsx","components/SideNavBar/SideNavBar.connect.tsx","components/AppHeader/AppHeader.tsx","components/ErrorBoundary/ErrorBoundary.tsx","components/FullScreenWait/FullScreenWait.tsx","components/ReadOnlyField/ReadOnlyField.tsx","components/CheckboxField/CheckboxField.tsx","components/TextField/TextField.tsx","components/AutocompleteField/AutocompleteField.tsx","components/DataGrid/DataGrid.tsx","lib/formats/formats.ts","components/Filters/FilterChips.tsx","lib/formats/pluralize.ts","components/DataGrid/columnDef.tsx","components/withTooltip/withTooltip.tsx","components/DataGrid/renderers.tsx","components/LinearProgress/LinearProgress.tsx","components/DataGrid/accessories.tsx","components/SamplesDataGrid/columnDefs.ts","components/Chip/Chip.tsx","components/SitesMap/calculateFit.ts","components/SitesMap/useSitesMapController.tsx","components/SitesMap/styles/index.ts","components/SitesMap/styles/basicThumb.png","components/SitesMap/styles/satThumb.jpg","components/SitesMap/styles/topoThumb.png","components/SitesMap/StyleControl.tsx","components/SitesMap/SitesMap.tsx","components/SitesMap/SitesMapPreview.tsx","components/SitesMap/SitesMapSidePanel.tsx","lib/useUpdatableState.ts","components/SitesMap/PinMarker.tsx","components/UsStateAtPointField/UsStateAtPointField.tsx","components/SiteDetailPanel/SiteDetailPanel.tsx","components/TextFilterField/TextFilterField.tsx","lib/useDebounce.ts","components/TextFilterField/useTextFilterField.ts","components/SitesListing/Fallback.tsx","components/Menu/Menu.tsx","components/NumberField/NumberField.tsx","components/EditSiteDialog/EditSiteDialog.tsx","components/ConfirmationDialog/ConfirmationDialog.tsx","components/SitesListing/SitesListing.tsx","components/SamplesDataGrid/SamplesDataGrid.tsx","components/BoxDetail/BoxSamples.tsx","components/AccordionPanel/AccordionPanel.tsx","components/Title/Title.tsx","components/ProgressField/ProgressField.tsx","components/BoxDetail/SortingProgressField.tsx","components/BoxDetail/IdentificationProgressField.tsx","components/AutocompleteArrayField/AutocompleteArrayField.tsx","components/ModelsField/ModelsField.tsx","components/BoxDetail/BoxSitesMapPreview.tsx","components/DateField/DateField.tsx","components/Badge/Badge.tsx","components/Badge/TargetEffortBadge.tsx","components/TaxonomyField/util.tsx","components/TaxonomyField/TaxonomyField.tsx","components/TaxonomyField/TaxonomySelectField.tsx","components/CriterionAutocomplete/CriterionAutocomplete.tsx","components/SelectSamples/CriterionFields.tsx","lib/map/parseGeoJson.ts","lib/map/distance.ts","components/SelectSamples/SelectSamples.tsx","components/BoxDetail/SplitBoxDialog.tsx","components/BoxDetail/MergeBoxDialog.tsx","lib/excel/downloadWorkbook.ts","lib/excel/singleTableUtil.ts","lib/reports/downloadCustomerBoxReport.ts","components/BoxDetail/BoxDetail.tsx","components/BoxDetail/BoxDetail.connect.tsx","components/BoxDetail/Fallback.tsx","components/BoxesListing/columnDefs.ts","components/SelectField/SelectField.tsx","components/BoxesListing/Fallback.tsx","components/BoxesListing/PrivilegedBoxesListing.tsx","components/BoxesListing/CustomerBoxesListing.tsx","components/BoxesListing/BoxesListing.connect.tsx","lib/reports/downloadBoxTaxaReport.ts","components/BoxTaxonomy/BoxTaxonomySelectField.tsx","components/BoxTaxonomy/BoxTaxonomy.tsx","components/BoxTaxonomy/columnDefs.ts","components/BoxTaxonomy/BoxTaxonomy.connect.tsx","components/BoxTaxonomy/Fallback.tsx","lib/submissions/processing/cellProcessors.ts","lib/submissions/processing/sampleProcessors.ts","lib/submissions/schema/templateSchema.ts","components/CustomerSubmission/CustomerSubmission.tsx","lib/submissions/processing/processParsedSample.ts","lib/submissions/processing/excel.ts","lib/submissions/components/PreparationPage.tsx","lib/submissions/components/FinishedPage.tsx","lib/submissions/components/helpers.tsx","lib/submissions/components/ChainOfCustodyForm.tsx","components/ChainOfCustody/ChainOfCustody.tsx","components/ChainOfCustody/ChainOfCustody.connect.tsx","components/ChainOfCustody/Fallback.tsx","components/CustomerSubmission/columnDefs.ts","components/CustomerSubmission/UploadFileBox.tsx","components/CustomerSubmission/Fallback.tsx","components/CustomerSubmission/StepPage.tsx","lib/trimAllStrings.ts","components/MetricDetail/AddTaxonDialog.tsx","components/MetricDetail/MetricDetail.tsx","components/MetricDetail/MetricDetail.connect.tsx","components/MetricDetail/Fallback.tsx","components/MetricsListing/columnDefs.ts","components/MetricsListing/Fallback.tsx","components/MetricsListing/MetricsListing.tsx","components/PredictorsField/PredictorsField.tsx","components/MetricsField/MetricsField.tsx","components/ModelDetail/ModelDetail.tsx","components/ModelDetail/ModelDetail.connect.tsx","components/ModelDetail/Fallback.tsx","components/ModelsListing/columnDefs.ts","components/ModelsListing/Fallback.tsx","components/ModelsListing/ModelsListing.tsx","components/OrganizationsListing/columnDefs.ts","components/OrganizationsListing/Fallback.tsx","components/OrganizationsListing/OrganizationsListing.tsx","components/PendingBoxReview/columnDefs.ts","components/PendingBoxReview/SampleDetailPanel.tsx","components/PendingBoxReview/MatchedSiteLine.tsx","components/PendingBoxReview/renderers.tsx","components/PendingBoxReview/util.ts","components/PendingBoxReview/PendingBoxReview.tsx","components/PendingBoxReview/Fallback.tsx","components/PendingBoxReview/PendingBoxReview.connect.tsx","components/PredictorDetail/PredictorDetail.tsx","components/PredictorDetail/PredictorDetail.connect.tsx","components/PredictorDetail/Fallback.tsx","components/PredictorsListing/columnDefs.ts","components/PredictorsListing/Fallback.tsx","components/PredictorsListing/PredictorsListing.tsx","components/ProjectDetail/ProjectSamples.tsx","components/ProjectDetail/ProjectSitesMapPreview.tsx","components/ProjectDetail/ProjectDetail.tsx","components/ProjectDetail/ProjectDetail.connect.tsx","components/ProjectDetail/Fallback.tsx","components/ProjectsListing/columnDefs.ts","components/ProjectsListing/ProjectsListing.tsx","components/PublicMap/calls/fetchPublicProjects.ts","components/PublicMap/calls/fetchPublicTaxa.ts","components/PublicMap/calls/fetchPublicTaxaSiteIdsByTaxonId.ts","config.ts","components/PublicMap/publicApi.ts","components/PublicMap/selectors.ts","components/PublicMap/CriterionFields.tsx","components/PublicMap/calls/fetchPublicSites.ts","components/PublicMap/calls/fetchPublicCsvDownload.ts","components/PublicMap/PublicMap.tsx","components/ReportsListing/columnDefs.ts","components/ReportsListing/ReportsListing.tsx","components/SampleDetail/columnDefs.ts","components/SampleDetail/SamplePredictorValues.tsx","components/SampleDetail/SampleModelResults.tsx","components/SampleDetail/WaterbodyNameField.tsx","components/SampleDetail/SiteSelectField.tsx","components/SampleDetail/SampleDetail.tsx","components/SampleDetail/SampleDetail.connect.tsx","components/SampleDetail/Fallback.tsx","components/SampleInfoPanel/SampleInfoPanel.tsx","components/SampleSorting/ToggleEditModeButton.tsx","components/SampleSorting/componentController.ts","components/SampleSorting/SampleSorting.tsx","components/SampleSorting/SampleSorting.connect.tsx","components/SampleSorting/Fallback.tsx","components/SampleTaxonomyIdentification/componentController.ts","components/SampleTaxonomyIdentification/columnDefs.ts","components/SampleTaxonomyIdentification/TimeEntryDialog.tsx","components/SampleTaxonomyIdentification/ToggleEditModeButton.tsx","components/SampleTaxonomyIdentification/renderers.tsx","components/SampleTaxonomyIdentification/Fallback.tsx","components/SampleTaxonomyIdentification/SampleTaxonomyIdentification.tsx","components/SampleTaxonomyIdentification/SampleTaxonomyIdentification.connect.tsx","components/TaxonDetail/columnDefs.ts","components/TaxonDetail/renderers.tsx","components/TaxonDetail/Fallback.tsx","components/TaxonDetail/TaxonDetail.tsx","components/TranslationDetail/columnDefs.ts","components/TranslationDetail/renderers.tsx","components/TranslationDetail/EditTranslationGroupDialog.tsx","components/TranslationDetail/Fallback.tsx","data/calls/createTranslation.ts","data/calls/updateTranslation.ts","data/calls/deleteTranslation.ts","components/TranslationDetail/TranslationDetail.tsx","components/TranslationDetail/TranslationDetail.connect.tsx","components/TranslationsListing/columnDefs.ts","components/TranslationsListing/TranslationsListing.tsx","components/UserDetail/RolesField.tsx","components/UserDetail/UserDetail.tsx","components/UserDetail/Fallback.tsx","components/UserDetail/UserDetail.connect.tsx","components/UsersListing/columnDefs.ts","components/UsersListing/UsersListing.tsx","components/UsersListing/Fallback.tsx","components/AppRouter/AppRouter.tsx","components/AppRouter/ConfirmNavigateAway.tsx","App.tsx","App.connect.tsx","reportWebVitals.ts","index.tsx"],"names":["__exportStar","exports","typeDefs","queryLimits","pubSchema_graphql_1","graphql_tag_1","templateObject_1","GrantAction","NAMCResource","CSVRowHeadings","samples","sites","boxes","projects","taxonomy","predictors","models","organizations","sitePredictorValues","modelResults","translations","metrics","reports","mapSites","entityFields","lookups_graphql_1","taxonomies","organisms","pubTypeDefs","url","jwt","query","variables","timeout","start","Date","now","method","headers","Authorization","data","then","_a","axiosData","time","loglevel_1","warn","toFixed","concat","replace","slice","JSON","stringify","catch","err","response","status","Error","code","error","limit","offset","templateObject_2","inobj","keys","reduce","acc","key","FETCH_ALL_SITES_STATUS","useHostedAuth","config","forceSignin","verbose","useState","isAuthenticated","isAuthComplete","user","loginState","setLoginState","stateRef","useRef","current","signIn","useCallback","Auth","federatedSignIn","refreshState","currentSession","newState","_","isEqual","log","debug","getCurrentToken","currSession","accessToken","jwtToken","length","signOut","useLayoutEffect","Amplify","configure","Logger","LOG_LEVEL","handler","payload","event","Hub","listen","remove","QuickNavigateField","className","navigate","useNavigate","inputRef","value","setValue","useHotkeys","e","preventDefault","stopPropagation","focus","size","onChange","newValue","target","InputProps","onKeyDown","trimmedValue","trim","match","targetId","Number","boxDetail","boxId","sampleDetail","sampleId","blur","placeholder","isStagingApi","process","includes","isLocalhost","location","hostname","appVersion","nextRequestNumber","requestNumber","String","MockApi","responders","responseDelay","Map","setResponders","clear","addResponders","forEach","queryOrMutation","responder","set","setResponseDelay","ms","wait","a","Promise","resolve","window","setTimeout","loc","source","body","get","queryAllPages","dataProperty","mutation","level","message","context","this","ApiError","apiState","atom","default","dangerouslyAllowMutability","useApi","useRecoilValue","GraphApi","auth","send","api","apiCall","TIMEOUT_SECONDS","errors","errorMessagesString","map","join","onRecords","firstOffset","lastOffset","Infinity","allRecords","lastData","records","undefined","nextOffset","push","deNull","defaults","copy","Object","entries","useNotifications","useSnackbar","enqueueSnackbar","closeSnackbar","useMemo","closeAction","color","onClick","fontSize","info","deferMs","autoHideDuration","action","clearTimeout","persist","variant","addProjectSamplesMutation","gql","addProjectSamples","invalidate","params","createMetricMutation","createMetric","metric","metricName","name","metricGroupId","groupId","restMetric","id","createModelMutation","createModel","model","modelName","modelTypeId","typeId","taxonomicEffort","restModel","createOrganizationMutation","createOrganization","organization","organizationName","organizationTypeId","restOrganization","createOrganizationWithUserMutation","createOrganizationWithUser","createUser","createPredictorMutation","createPredictor","predictor","predictorName","predictorTypeId","restPredictor","createProjectMutation","createProject","project","projectName","restProject","createSampleSubmissionMutation","createSampleSubmission","submission","createSiteMutation","createSite","site","siteName","restSite","createTaxonMutation","createTaxon","taxon","scientificName","restTaxon","createTaxonomy","createTranslationGroupMutation","createTranslationGroup","translationInput","translationId","translationGroup","deleteMetricMutation","deleteMetric","metricId","deleteModelMutation","deleteModel","modelId","deleteOrganismMutation","deleteOrganism","organism","organismId","deleteOrganizationMutation","deleteOrganization","organizationId","deletePredictorMutation","deletePredictor","predictorId","deleteProjectMutation","deleteProject","projectId","deleteSampleMutation","deleteSample","sample","deleteSiteMutation","deleteSite","siteId","deleteTranslationGroupMutation","deleteTranslationGroup","fetchBoxesQuery","transformBox","receivedDate","boxReceivedDate","submittedByName","submittedBy","identificationComplete","idComplete","rest","fetchBoxes","sortBy","reverse","fetchActiveBoxesQuery","fetchActiveBoxes","boxStateId","BOX_STATE_ID","active","fetchAttributesQuery","transformAttribute","attributeId","attributeName","fetchAttributes","attributes","fetchBoxDetailByIdQuery","fetchBoxDetailById","boxInfo","customerName","customer","submissions","restBoxInfo","description","modelIds","fetchBoxSamplesByBoxIdQuery","transformSourceSample","type","sampleType","sampleMethod","identifierName","idErName","identificationStartDate","idStartDate","identificationEndDate","idEndDate","restSample","fetchBoxSamplesByBoxId","fetchBoxTaxaByBoxIdQuery","fetchBoxTaxaByBoxId","boxTaxa","taxonomyId","taxonomistCounts","fetchCustomerBoxReportByBoxIdQuery1","fetchCustomerBoxReportByBoxIdQuery2","fetchCustomerBoxReportByBoxIdQuery3","fetchCustomerBoxReportByBoxIdQuery4","fetchCustomerBoxReportByBoxId","all","axios","responseType","sampleTaxa","reportMetrics","template","fetchLatestSubmissionByBoxIdQuery1","fetchLatestSubmissionByBoxIdQuery2","fetchLatestSubmissionByBoxId","data1","organizationPhone","phone","latestSubmission","version","versionId","submissionId","submitterId","submitter","firstName","lastName","submitterEmail","email","submitterPhone","createdDate","updatedDate","data2","submissionData","submitterName","templateVersion","newSites","Array","isArray","fetchLookupsQuery","fetchLookups","lookups","fetchMetricsQuery","fetchMetrics","groupName","metricGroupName","abbreviation","displayText","reportIds","taxonomyIds","fetchMinimalSamplesByIdsQuery","transformMinimalSample","fetchMinimalSamplesByOrganizationIdQuery","fetchMinimalSamplesByOrganizationId","fetchMinimalSamplesByPolygonQuery","fetchMinimalSamplesByPolygon","coordinates","stringifiedGeoJson","polygon","fetchMinimalSamplesBySiteIdQuery","fetchMinimalSamplesBySiteId","fetchMinimalSamplesByTaxonIdQuery","fetchMinimalSamplesByTaxonId","taxonId","fetchMinimalSamplesByUsStateIdQuery","fetchMinimalSamplesByUsStateId","usStateId","fetchModelByIdQuery","fetchModelById","modelInfo","typeName","modelTypeName","codeFunction","codeFunction2","predictorIds","metricIds","fetchModelResultsBySampleIdQuery","fetchModelResultsBySampleId","record","fetchModelsQuery","fetchModels","fetchMyUserQuery","fetchMyUser","myProfile","permissions","fullName","fetchOrganismsBySampleIdQuery","fetchOrganismsBySampleId","noteTypeIds","filter","noteTypeId","fetchOrganizationByIdQuery","fetchOrganizationById","organizationsById","transformOrganization","address1","address2","city","usState","country","zipCode","userCount","fetchOrganizationsQuery","entityId","parentId","parentEntityId","organizationType","fetchOrganizations","fetchPredictorsQuery","fetchPredictors","predictorType","calculation","calculationScript","cellRepresents","cellSize","geometryFilePath","inputType","isGee","isText","notes","smallShedException","transformation","fetchProjectsQuery","fetchProjects","contactName","fetchProjectSamplesByProjectIdQuery","fetchProjectSamplesByProjectId","fetchReportDataByReportIdQuery","fetchReportDataByReportId","reportId","reportData","jsonData","fetchReportsQuery","fetchReports","isActive","reportName","fetchSampleByIdQuery","fetchSampleById","identifierId","idErId","sampleTypeName","customerSiteCode","fieldNotes","labNotes","visitId","fetchSamplePredictorValuesBySampleIdQuery","fetchSamplePredictorValuesBySampleId","samplePredictorValues","predictorValueUpdatedDate","transformSite","fetchSiteDetailByIdQuery","fetchSiteDetailById","siteInfo","waterbodyName","waterbodyCode","isReference","fetchSitesByBoxIdQuery","fetchSitesByBoxId","fetchSitesByProjectIdQuery","fetchSitesByProjectId","fetchSitesPageQuery","fetchSitesPage","fetchSorterUsersQuery","fetchSorterUsers","sorters","fetchTaxaQuery","fetchTaxa","parentTaxonomyId","synonymsJson","synonyms","levelRankOrder","parse","fetchTranslationGroupsByTranslationIdQuery","transformTranslationGroup","translationGroupId","fetchTranslationGroupsByTranslationId","translationGroups","fetchTranslationsQuery","fetchTranslations","translationName","fetchUserBoxesQuery","fetchUserBoxes","userBoxes","fetchUserByIdQuery","fetchUserById","userId","roleIds","fetchUsersQuery","fetchUsers","users","fetchUsStateAtCoordinatesQuery","fetchUsStateAtCoordinates","getUSState","finalizePendingBoxMutation","finalizePendingBox","success","mergeBoxesMutation","mergeBoxes","reconcileBoxTaxonomyMutation","reconcileBoxTaxonomy","taxReconciliation","removeProjectSamplesMutation","removeProjectSamples","splitBoxMutation","splitBox","startSortMutation","startSort","labStartSort","startTaxonomyIdentificationMutation","startTaxonomyIdentification","taxIdentificationStart","stopSortMutation","stopSort","labStopSort","stopTaxonomyIdentificationMutation","stopTaxonomyIdentification","taxIdentificationStop","updateBoxMutation","updateBox","boxUpdate","setBoxInfo","updateLabSortMutation","updateLabSort","sortTime","count","sorterCount","labSort","updateMetricMutation","updateMetric","updateModelMutation","updateModel","updateOrganizationMutation","updateOrganization","updatePredictorMutation","updatePredictor","updateProjectMutation","updateProject","updateSampleMutation","updateSample","updateSampleSubmissionMutation","updateSampleSubmission","updateSiteMutation","updateSite","updateTaxonMutation","updateTaxon","setTaxonomy","updateTranslationGroupMutation","updateTranslationGroup","restGroup","updateUserMutation","updateUser","isSelf","restUser","updateUserRolesMutation","updateUserRoles","upsertOrganismMutation","upsertOrganism","lifeStageId","createSampleTaxaInfo","TAXA_LEVEL_ID","allSitesStatusAtom","unfetched","allSitesAtom","sparseSitesDetailAtom","selectSitesBySingleSiteId","selectorFamily","refreshOn","useFetchAllSitesOptimized","setState","useRecoilState","allSitesStatus","setAllSitesStatus","setAllSites","useSetRecoilState","accumulateAllSites","fetchCall","pageSize","onPage","accumulateItems","from","to","Math","min","useAccumulateApiItems","incoming","existing","uniqBy","fetching","fetched","useFetchSiteDetailBySiteIdOptimized","notifications","sparseSitesDetail","setSparseSitesDetail","find","siteDetail","selectSitesByBoxId","selectSitesByProjectId","refreshOnState","atomFamily","family","useInvalidate","useRecoilCallback","v","useManualInvalidate","calls","call","shift","useDeferredInvalidate","queueInvalidate","performInvalidate","useEffect","lookupListToOptions","lookup","label","lookupListToNames","selectLookups","selector","selectTaxaLevels","taxa","taxaLevels","selectLifeStages","lifeStages","selectNoteTypes","noteTypes","selectBoxStates","boxStates","selectSampleMethods","sampleMethods","selectSampleTypes","sampleTypes","selectTowTypeNames","towTypes","selectEffortTypes","effortTypes","selectDesignTypes","designTypes","selectHabitats","geo","habitats","selectEcosystems","ecosystems","selectWaterbodyTypes","waterbodyTypes","selectUsStates","states","selectUsCountryId","countries","usCountryId","selectRoles","entity","roles","selectSystemAdminRoleLevel","constSelector","selectDefaultOrganizationTypeId","organizationTypes","defaultOrganizationTypeId","selectFishDietSpecies","fishDietSpecies","selectModelTypes","systems","modelTypes","selectCalculations","calculations","selectMetricGroups","metricGroups","selectMetricReports","metricReports","selectPredictorTypes","predictorTypes","selectRarefactionTypes","rarefactionTypes","selectBoxSamplesByBoxId","selectMinimalSamplesByOrganizationId","selectMinimalSamplesByPolygon","selectMinimalSamplesBySiteId","selectMinimalSamplesByTaxonId","selectMinimalSamplesByUsStateId","selectModelResultsBySampleId","selectOrganismsBySampleId","selectProjectSamplesByProjectId","selectSampleById","selectSamplePredictorValuesBySampleId","selectBoxes","selectActiveBoxes","selectUserBoxes","selectBoxById","selectPredictors","selectOrganizations","nameCount","countBy","selectOrganizationById","selectModels","selectProjects","selectTranslations","selectTranslationById","translation","groups","selectUsStateAtCoordinates","latitude","longitude","selectLatestSubmissionByBoxId","selectProjectById","selectNull","selectReports","selectMetrics","selectMetricById","selectModelById","selectPredictorById","selectAttributes","withDescendantIds","highestLevelRankOrder","highest","max","result","currentLevel","childTaxons","childIds","descendantIds","selectTaxa","levelId","rankOrder","selectBoxTaxaByBoxId","selectHasUser","selectMyUser","virtual","myUser","affiliationId","hasPermission","resource","grantAction","explicitPermission","implicitPermission","selectSorterUsers","selectUserById","selectUsers","Connector","Fallback","width","UserName","css","display","alignItems","justifyContent","height","fallback","withSuspense","Component","WrappedComponent","props","displayName","CenteredDiv","flexDirection","Links","onClose","links","visible","readOwn","readAny","noop","disabled","billing","individuals","sqlReports","opacity","times","i","SideNavBar","isOpen","hasUser","anchor","open","minWidth","gap","profile","marginTop","padding","href","rel","isNavigationOpenState","setIsOpen","AppHeader","setIsNavigationOpen","document","title","conditionalVisibility","background","sx","fill","fontWeight","letterSpacing","margin","visibility","ErrorBoundary","state","hasError","children","toString","React","FullScreenWait","position","zIndex","backgroundColor","ReadOnlyField","gridArea","displayValue","shrink","lineHeight","CheckboxField","readOnly","valueLabels","control","checked","TextField","maxLength","inputProps","restProps","combinedInputProps","EditableAutocompleteField","isClearable","options","foundValue","option","getOptionLabel","getOptionDisabled","renderInput","selected","disableClearable","SuspensedEditableAutocompleteField","optionsSelector","valueLabel","mismatchedPropsErrorMessage","AutocompleteField","isFixedType","isSelectorType","foundValueLabel","DataGrid","rows","columnDefs","onSelectedRowsChanged","onGridApisReady","gridOptions","rowIdProperty","grid","setGrid","refreshCells","refreshHeader","memoizedGridOptions","merge","suppressCellSelection","defaultColDef","sortable","resizable","suppressMovable","rowData","immutableData","onSelectionChanged","getSelectedRows","animateRows","containerStyle","getRowNodeId","onGridReady","columnApi","dayjs","extend","utc","timezone","CHIP_COLOR","formatNumber","toLocaleString","formatUtcDateTimeToAppDate","utcDateTime","substring","tz","format","plurals","is","box","child","pluralize","qty","word","plural","comparator","labelComparator","valueA","valueB","labelA","labelB","columnDef","colDef","cellRenderer","valueFormatter","filterTooltip","restColDef","cellRendererParams","withTooltip","content","tooltip","renderers","LinkRenderer","ProgressRenderer","percent","floor","top","textAlign","CheckRenderer","FilterableTextRenderer","onFilter","right","ActionableTextRenderer","onAction","Icon","LinearProgress","delayMs","timeoutRef","setIsActive","DataGridSummaryArea","DataGridRecordCount","descriptor","isLoading","total","bottom","DataGridHeading","marginLeft","samplesColumnDefs","headerName","field","flex","samplesDownloadColumns","header","Chip","chipColor","textColor","onDelete","NoneChip","FilterChips","filters","joinLabel","noneNode","flexWrap","index","Fragment","fontStyle","calculateFit","points","maxZoom","MAX_ZOOM","updatedViewport","WebMercatorViewport","allPointsLngLat","updatedBounds","LngLatBounds","pointLngLat","sw","getSouthWest","ne","getNorthEast","fitBounds","lng","lat","zoom","DEFAULT_VIEWPORT","SITES_LAYER_ID","useSitesMapController","initialViewport","onSiteClick","showSingleSiteHoverDetail","viewport","setViewport","hoverInfo","setHoverInfo","siteChoicesNode","setSiteChoicesNode","sitesData","features","geometry","properties","fitSites","targetPoints","calculatedViewport","transition","transitionInterpolator","FlyToInterpolator","transitionDuration","vp","centerSite","point","suppressZoomOut","isViewportReady","handleClick","targetSites","feature","layer","whiteSpace","cursor","handleHover","mouseEvent","srcEvent","x","offsetX","y","offsetY","node","border","borderRadius","gridTemplateColumns","columnGap","smartFitAll","cancelSiteChoices","mapStyles","basic","createNewStyle","basicStylesJson","sat","satStylesJson","topo","topoStylesJson","mapStylesThumbs","rawStyle","sources","layers","rawSources","rawLayers","glyphs","sprite","sourceLookup","sKey","newId","rawLayer","newLyr","sitesLayerJson","styleKeys","tooltips","StyleThumb","styleKey","src","StyleControl","ariaLabel","hidden","FabProps","icon","direction","onOpen","minHeight","tooltipTitle","REACT_APP_MAPBOX_TOKEN","mapStyleKeyAtom","SitesMap","controller","minimal","mapStyleKey","setMapStyleKey","mapStyle","onViewportChange","mapboxApiAccessToken","onHover","interactiveLayerIds","style","showCompass","left","pointerEvents","transform","paddingTop","SitesMapPreview","sitesSelector","sitesListingSource","setSitesListingSource","useSetSitesListingSource","SitesMapSidePanel","transitionMs","maxWidth","overflow","boxSizing","useUpdatableState","initialState","deps","instance","isFirstRender","updateState","updater","produce","SITE_PIN_COLOR","PinSvg","largeDot","xmlns","xmlnsXlink","viewBox","xmlSpace","d","cx","cy","r","PinMarker","onDragEnd","svgProps","updatePoint","draggable","onDrag","draft","lngLat","UsStateAtPointField","SiteDetailPanel","addSampleCount","usStates","sampleCount","waterbodyTypeId","waterbodyTypeName","isNewSite","isFetching","formatDate","dateString","paddingLeft","marginRight","wordWrap","gridTemplateRows","gridTemplateAreas","TextFilterField","hotkeys","ownRef","effectiveRef","useDebounce","input","debounceTimerRef","debounced","setDebounced","setDebouncedImmediately","useTextFilterField","text","setText","rawFilterText","setRawFilterText","filterText","Divider","Menu","items","anchorEl","setAnchorEl","handleMenuClose","currentTarget","startIcon","item","NumberField","precision","step","textValue","numberValue","EditSiteDialog","allSitesNormalized","onCancel","onSave","waterbodyTypeOptions","editMode","isDirty","values","getInitialState","checkName","toLowerCase","some","makeFieldChangeHandler","fieldName","assign","setFieldValue","handleSave","isSaving","handleCancel","fullWidth","multiline","minRows","ConfirmationDialog","cancelLabel","confirmLabel","onConfirm","ANY_US_STATE","selectUsStateOptions","sitesListingSourceAtom","usStateFilterIdAtom","textFilterAtom","setUsStateFilter","setTextFilter","SitesListing","siteIdUnsanitized","deferredInvalidate","usStateOptions","usStateIdFilter","setUsStateIdFilter","textFilter","textFilterDebounced","resetTextFilter","isEditOpen","setIsEditOpen","editTargetSite","setEditTargetSite","setIsSaving","isMoving","setIsMoving","movingTargetPoint","setMovingTargetPoint","isConfirmDeleteOpen","setIsConfirmDeleteOpen","isDeleting","setIsDeleting","isUiLocked","allSites","sourceSites","setSourceSites","detailPanelSite","setDetailPanelSite","getBoxSitesByBoxId","snapshot","getPromise","getProjectSitesByProjectId","fetchAllSitesOptimized","fetchSiteDetailBySiteIdOptimized","selectedSite","filterFn","identity","usStateAbbreviation","filteredSites","isInitialFitted","setIsInitalFitted","isDetailSiteRetrieved","handleSaveMovedSite","handleSaveSite","siteInput","newSiteId","targetSite","handleDeleteSite","targetSiteIndex","findIndex","splice","createAny","siteCreate","newPoint","updateAny","deleteAny","SamplesDataGrid","sortEndDate","sortStartDate","sorterName","sortState","identificationState","frameworkComponents","BoxSamples","boxSamples","AccordionPanel","locked","summary","actions","expanded","marginBottom","expandIcon","Title","Subtitle","ProgressField","doneCount","totalCount","roValue","SortingProgressField","boxSample","IdentificationProgressField","SelectedOptionChip","AutocompleteArrayField","valueArray","selectedOptions","multiple","disablePortal","InputLabelProps","renderTags","renderedOptions","getTagProps","ModelsField","BoxSitesMapPreview","DateField","Badge","badgeColor","TargetEffortBadge","HighlightedText","highlightText","part","highlight","Group","group","labels","borderBottom","Option","inputValue","levelName","synonymArea","synonym","isTargetEffort","filterOptions","nameMatches","remainder","synonymMatches","TaxonomyFieldActionButton","isDefault","TaxonomyField","ungrouped","isOptionsPresented","onChoose","renderOption","optionProps","onInputChange","clearOnEscape","autoHighlight","noOptionsText","groupBy","renderGroup","TaxonomySelectField","isOptionEqualToValue","CriterionAutocomplete","optionLabel","selectBoxOptions","alias","boxState","chipLabel","selectOrganizationOptions","selectProjectOptions","selectTypeOptions","selectMethodOptions","BoxCriterionField","UsStateCriterionField","OrganizationCriterionField","ProjectCriterionField","thisProjectId","allProjectOptions","TaxonomyCriterionField","t","SampleIdsCriterionField","isFocused","setIsFocused","setValueFromText","split","onFocus","onBlur","maxRows","TypeCriterionField","MethodCriterionField","SiteCriterionField","setOptions","getFilterSiteOptions","GeoJsonCriterionField","debouncedText","setDebouncedTextImmediately","parseGeoJsonPolygon","json","object","extracted","ring","lastPointIndex","isValidGeoJsonPolygonCoordinates","getDistance","turf","getSortedSitesDistances","maxCoordinateDiff","prefilteredSites","abs","distance","passAllFilterFn","rejectAllFilterFn","minimalSamplesByIdAtom","SelectSamples","thisBoxId","initialMode","onOperatingChange","thisProjectName","initialSamples","onNewBoxSamplesChange","sampleIds","fromDate","toDate","geoJson","fromArea","toArea","criteria","updateCriteria","makeSetFieldValue","resetField","dateError","areaError","thisSourceSamples","setThisSourceSamples","candidateSamples","setCandidateSamples","newBoxSamples","setNewBoxSamples","resultsMessage","setResultsMessage","displayFilters","setDisplayFilters","isOperating","setIsOperating","mode","setMode","isBoxSplitMode","isProjectAddMode","isProjectRemoveMode","isProjectMode","minimalSamplesById","setMinimalSamplesById","getSamplesByBoxId","getSamplesByProjectId","getSamplesByUsStateId","getSamplesBySiteId","getSamplesByTaxonId","getSamplesByOrganizationId","getSamplesByPolygon","handleAddToProject","targetIds","handleRemoveFromProject","handleAssignToNewBox","updatedNewBoxSamples","criteriaFilters","thisSourceFilters","sourcePromises","errorMessages","cancelled","setupIdBasedCriterion","sampleGetter","criterion","polygonCoordinates","usefulPromises","fetchIds","needId","fetchPromise","fetchMinimalSamplesByIds","newOrderedSamplePromises","fetchId","resolvedSamplesOrUndefineds","isAddModeWithoutSource","common","sampleDate","area","thisSourceSampleIds","filteredSamples","operableCount","firstSource","intersectionBy","matchedCount","newMode","exclusive","SplitBoxDialog","handleClose","handleSplit","newBoxId","SelectOtherBoxField","MergeBoxDialog","targetBoxId","setTargetBoxId","canOperate","setCanOperate","timer","handleMerge","sourceBoxId","downloadWorkbook","workbook","filename","xlsx","writeBuffer","buffer","blob","Blob","saveAs","downloadWorkbookAsCsv","csv","createSingleTableWorkbook","wb","Excel","Workbook","addSingleTableWorksheet","wsName","columns","ws","addWorksheet","addRows","column","columnValues","lengths","views","xSplit","ySplit","activeCell","samplesColumnConfig","taxaColumnConfig","downloadCustomerBoxReport","reader","FileReader","onload","ArrayBuffer","load","readAsArrayBuffer","summaryWs","worksheets","findRangeByName","found","definedNames","range","ranges","getCell","sampleRowData","fieldSplit","labSplit","sampleLatitude","sampleLongitude","siteLatitude","siteLongitude","siteIdentifier","metricNames","uniq","metricsColumnConfig","metricRowData","thisRow","reportMetric","metricValue","valueAsNumber","isNaN","selectBoxStateOptions","isExpandedState","measurements","midges","customerId","isSplitDialogOpen","isMergeDialogOpen","BoxDetail","isPanelExpanded","setIsPanelExpanded","isoReceivedDate","isStopped","isEditing","actionsMenuItems","boxTaxonomy","cancelNotification1","cancelNotification2","complete","pending","boxReview","processingCompleteDate","taxaQa","sorterQa","sortComplete","privilegedColumnDefs","customerColumnDefs","SelectField","ANY_BOX_STATE","boxStateNameFilterState","textFilterState","addedFiltersState","PrivilegedBoxesListing","boxStateNameFilter","setBoxStateNameFilter","clearTextFilter","addedFilters","setAddedFilters","filterId","boxStateOptions","boxSubmission","CustomerBoxesListing","canDownloadCustomerReport","handleDownloadCustomerReport","forms","submissionCount","chainOfCustodyForm","CustomerConnector","PrivilegedConnector","waitForAny","activeBoxesLoadable","boxesLoadable","contents","BoxesListing","TAXONOMIST_COLUMNS","columnConfig","downloadBoxTaxaReport","getRow","taxonomistNames","updatedColumnConfig","col","tableHeaderRowNumber","fields","addTable","ref","headerRow","theme","showRowStripes","filterButton","BoxTaxonomySelectField","skeleton","BoxTaxonomy","taxaLoadable","useRecoilValueLoadable","fromTaxonomyId","setFromTaxonomyId","toTaxonomyId","setToTaxonomyId","isWorking","setIsWorking","isConfirmOpen","setIsConfirmOpen","setTaxa","hasTaxa","toPromise","isSameIdError","boxTaxonIds","addedTaxonOptions","availableTaxonOptions","fromBoxTaxon","toTaxon","toBoxTaxon","handleReconcile","makeBoxTaxonomyColumnDefs","canReconcileTaxa","cancelNotification","isRequired","cell","KnownError","isNumber","isWholeNumber","trunc","isNumberBetween","isPositiveNumber","isInList","listName","lists","list","isAcceptableDate","MIN_DATE","isBefore","toShortDateString","divideBy100","setLiteralValue","processor","isSamplePostProcessor","separator","fieldName1","fieldName2","fieldValue","part1","part2","isAcceptableLatitudeAndLongitude","rowNumber","problems","setRowNumber","setSampleNumber","sampleNumber","setTemplateVersion","STEP","acceptedTemplateVersions","lookupsWsName","everyCellProcessors","schemasByWsName","ALL","sampleIndex","Benthic","jarCount","ecosystemHabitat","sampleDesign","sampleEffortStandardization","areaTime","callback","columnNumber","isRequiredIf","samplerType","meshSize","nhdType","nhdId","ecosystem","fishSpecies","fishLength","fishMass","Zooplankton","netArea","towLength","towType","Drift","duration","velocity","selectLists","ecosystemNames","habitatNames","samplerTypes","ecosystemHabitats","ecosystemName","habitatName","nhdTypes","processParsedSample","sourceSample","schema","columnKeys","allPromises","columnKey","problem","isCellProcessor","processFile","promises","lookupsWs","getNamedCellValues","firstDataRowNumber","FirstDataRow","TemplateVersion","eachSheet","sheetSchema","universalSchema","eachRow","row","sampleProblems","eachCell","includeEmpty","processors","processorFn","processedResult","finalProblems","styles","PreparationPage","onDownloadTemplate","FinishedPage","onGoToBoxes","onGoToChainOfCustody","Document","EmptyCell","Table","borders","borderCollapse","PageBreak","pageBreakAfter","Line","longDate","date","shortDate","ChainOfCustodyForm","ChainOfCustody","autoPrint","print","problemsColumnDefs","colId","valueGetter","letters","columnNumberToLetters","UploadFileBox","processingToken","processingStatus","useDropzone","onDrop","acceptedFiles","handleError","processResult","emptyProcessResult","errorMessage","file","thisProcessingToken","lastProcessingStatus","onerror","lastFilename","accept","getRootProps","getInputProps","isDragActive","isPerforming","borderRight","paddingRight","StepPage","TEMPLATE_URL","stepTitles","getProblemRowId","idDict","nextId","selectUserOptions","expandJsonState","MessageBlock","CustomerSubmission","expandJson","setExpandJson","countryId","downloadTemplateLinkRef","existingOrganizationId","organizationMode","prepare","activeStep","setActiveStep","handleSubmit","newOrganizationId","createdOrganizationId","finished","canSubmit","hasFatalProblem","hasOnlyRowProblems","hasNoSamples","uploadAttentionMessage","canChangeUser","canChangeOrganization","stepTitle","s","review","upload","download","click","component","th","td","onGoToBoxDetail","trimAllStrings","AddTaxonDialog","onAdd","setTaxonId","MetricDetail","isNewMetric","metricGroupOptions","calculationOptions","metricReportOptions","rarefactionTypeOptions","attributeOptions","calculationId","rarefactionTypeId","attributeValuesText","attributeValues","isAddTaxonOpen","setIsAddTaxonOpen","attributeValue","restInput","restMetricInput","metricDetail","handleDelete","availableTaxa","lastValues","addTaxonId","metricsColumnDefs","MetricsListing","metricCreate","PredictorsField","MetricsField","selectTranslationOptions","ModelDetail","isNewModel","modelTypeOptions","extentDescription","platform","referenceSites","groupCount","minimumCount","oeMean","oeStdev","fixedCount","modelInput","modelDetail","modelsColumnDefs","ModelsListing","modelCreate","organizationsColumnDefs","OrganizationsListing","textFilterDebouncedLowercase","parentName","unfilteredRows","filterableUsState","pendingBoxColumnDefs","pinned","SampleDetailPanel","SAMPLE_PIN_COLOR","habitat","waterbodyType","MatchedSiteLine","layout","paint","SampleIndexRenderer","isSelected","ActionsRenderer","onEdit","getAutoMatchStatus","reviewableSamples","suppressed","suppressAutoMatch","databaseSiteId","siteWithMatchingName","suitableNamedSiteId","closeSiteIds","makeSiteFromSample","fromSample","candidateName","copyNumber","candidateNameLowercase","SUGGESTED_FILTER_ID","sampleStatusOptions","PendingBoxReview","submissionProp","allExistingSites","allExistingSitesStatus","updateSubmission","selectedSampleIndex","setSelectedSampleIndex","suggestedSitesFilter","setSuggestedSitesFilter","selectedSiteId","setSelectedSiteId","sampleStatusFilter","setSampleStatusFilter","isEditingSite","setIsEditingSite","finalizing","setFinalizing","canDragMarker","setCanDragMarker","isConfirmAutoCreateOpen","setIsConfirmAutoCreateOpen","fetchAllExistingSitesOptimized","sampleFilters","setSuggestedSitesFilterToSample","filterAllFn","customerSiteCodeLowercase","exactNameSite","closeSitesDistances","closest","relativelyCloseDistance","submissionSample","matchedSite","selectedSample","eligibleAutoMatches","newMatchCount","draftSample","siteFilters","filtered","combinedPoints","handleFinalize","handleUnmatch","handleNewSiteCreate","getNextNewSiteId","newSite","handleNewSiteSave","updatedSite","handleNewSiteDragged","matchLabel","distanceLabel","selectedSiteAddedSamplesCount","canFinalize","every","updatedAllSitesNormalized","createdCount","autoMatchStatus","sampleAutoMatchStatus","handleAllRemainingSitesCreate","PredictorDetail","isNewPredictor","predictorTypeOptions","isTemporal","maxValue","minValue","units","restPredictorInput","predictorDetail","predictorsColumnDefs","PredictorsListing","predictorCreate","ProjectSamples","canModify","modifyMode","setModifyMode","handleCloseModify","ProjectSitesMapPreview","userOptions","labelCount","ProjectDetail","isNewProject","contactId","isPrivate","projectInput","projectDetail","projectsColumnDefs","ProjectsListing","owner","projectCreate","fetchPublicProjectsQuery","fetchPublicProjects","fetchPublicTaxaQuery","fetchPublicTaxa","fetchPublicTaxaSiteIdsByTaxonIdQuery","fetchPublicTaxaSiteIdsByTaxonId","taxaSites","domain","REACT_APP_DOMAIN","endpoints","graphql","public_graphql","REACT_APP_PUBLIC_GRAPHQL","appDefaults","redirectUrl","URL","endsWith","origin","publicUrl","publicApiAtom","publicSitesAtom","selectPublicLookups","publicApi","selectPublicProjectOptions","selectPublicUsStateOptions","selectPublicTypeOptions","selectPublicMethodOptions","selectPublicTaxa","selectPublicTaxaSiteIdsByTaxonId","fetchPublicSitesQuery","transformPublicSite","fetchPublicSites","fetchPublicCsvDownloadQuery","fetchPublicCsvDownload","csvDownload","PublicMap","setFiltered","isFetchingTaxonSites","setIsFetchingTaxonSites","cancelDownload","setCancelDownload","isSidebarOpen","setIsSidebarOpen","setSites","isFetchingSites","setIsFetchingSites","accumulateSites","getSiteIdsByTaxonId","minYear","maxYear","shortcutYears","yearOptions","yearState","setYearState","year","years","fromYear","toYear","fetchIdsPromises","projectIds","typeIds","methodIds","filterYears","intersection","cancel","fetchIdsResults","filterIds","initialFiltered","handleDownload","includeYearCriteria","csvRows","currentOffset","methodId","columnNames","reportRow","columnName","isFiltered","isDownloadingCsv","makeSetYear","newYear","reportsColumnDefs","ReportsListing","createWorkbook","downloadXlsx","downloadCsv","samplePredictorValuesColumnDefs","sampleModelResultsColumnDefs","SamplePredictorValues","SampleModelResults","WaterbodyNameField","SiteSelectField","foundOption","SampleDetail","sampleMethodOptions","habitatOptions","ecosystemOptions","effortTypeOptions","designTypeOptions","designTypeId","ecosystemId","effortTypeId","habitatId","mesh","sampleMethodId","fieldSplitPercent","round","sampleInput","canUpdate","canDelete","sampleSorting","sampleTaxonomyIdentification","SampleInfoPanel","isExpanded","setIsExpanded","ToggleEditModeButton","canStopOwn","canStopOther","isStartedByOther","sorterId","labSplitPercent","sortDate","elutriation","persistence","getFieldErrors","LAB_SPLIT_PERCENT_PRECISION","SampleSorting","sorterUsersProp","sorterUsers","resultSorterUsers","sorterUser","reset","saveSort","updatedSample","todayDate","toISOString","useComponentController","sorterOptions","canSort","sorting","updateOwn","isLabManager","canSave","generateRowId","uniqueId","organismFilters","scrollToRowId","reducer","rowId","existingFilter","organismFilter","singleValueSetter","updateOrganism","organismsColumnDefs","hide","nodeA","nodeB","editable","cellEditor","valueSetter","cellClassRules","lifeStageRankOrder","cellEditorParams","precisionAllowed","comments","TimeEntryDialog","disableEscapeKeyDown","DialogBody","setTime","hasErrors","handleConfirm","canLeave","NumberEditor","forwardRef","oldValue","canEdit","negativeAllowed","useImperativeHandle","getValue","isCancelBeforeStart","isCancelAfterEnd","isPopup","newNumber","LifeStageEditor","allowedLifeStages","done","setDone","unshift","LifeStageRenderer","NumberRenderer","TaxonRenderer","NotesAndCommentsRenderer","noteType","NotesAndCommentsEditor","oldNoteTypeIds","oldComments","setNoteTypeIds","setComments","fontFamily","organismRow","setDeletionCandidateOrganism","splitCount","bigRareCount","canDuplicate","canFilter","duplicateOrganism","createFilter","PersistenceRenderer","path","stopEditingWhenCellsLoseFocus","SampleTaxonomyIdentification","sampleOrganisms","upsertOrganismIfSavable","dispatch","useReducer","createOrganism","newOrganism","deleteFilter","finishTaxonomyIdentification","setScrollToRowId","deletionCanddateOrganism","gridApis","setGridApis","setColumnVisible","ensureNodeVisible","getTaxonById","organismFilterTaxons","filterTaxonIds","filteredOrganisms","activeLifeStages","taxonName","usedLifeStageIds","taxonOptions","organismTaxonIds","added","available","onAddOrganism","onAddFilter","taxonOption","optionActions","gridGap","canIdentify","filteredOrganismSum","sumBy","filteredTaxonCount","filteredRowCount","taxonColumnDefs","TaxonNameRenderer","hierarchy","indent","relationship","isNew","synonymsText","rowClassRules","showAllDescendantsAtom","TaxonDetail","taxonIdProp","showAllDescendants","setShowAllDescendants","disallowNamesLowercase","animalia","taxonInput","newTaxonId","taxonDetail","isDirectParent","ancestorTaxon","descendingIndent","descendingIds","childId","childTaxon","eligibleParentTaxa","selectedLevelRankOrder","taxaLevelOptions","selectedParentLevelRankOrder","lowestChildLevelRankOrder","readOnlyParentName","totalAncestorCount","totalDescendantCount","taxonCreate","kingdom","spellCheck","translationDetailColumnDefs","b","TaxaRenderer","EditTranslationGroupDialog","onUpdate","targetGroupId","translationScientificName","isFinal","selectedTaxa","taxaOptions","allGroupsTaxonomyIds","canAdd","addId","removeId","createTranslationMutation","createTranslation","restTranslation","insertTranslation","updateTranslationMutation","updateTranslation","deleteTranslationMutation","deleteTranslation","TranslationDetail","allTaxa","isNewTranslation","updateGroups","isConfirmDeleteTranslationOpen","setIsConfirmDeleteTranslationOpen","isConfirmDeleteGroupOpen","setIsConfirmDeleteGroupOpen","setTargetGroupId","handleSaveTranslation","translationDetail","handleDeleteTranslation","handleDeleteGroup","updatedGroup","translationsColumnDefs","TranslationsListing","translationCreate","RolesField","hideRoleLevel","hiddenIds","hiddenValue","UserDetail","userPhone","deleteOldOrganization","operatorUser","systemAdminRoleLevel","canUpdateOwnUser","canUpdateAnyUser","isNewUser","isOtherSystemAdmin","roleId","isEditable","isEditingUserFields","isEditingOrganizationFields","isShowingAdminOnlyControls","isShowingDeleteOldOrganization","isAffiliationChanged","MyUserDetail","NewUserDetail","usersColumnDefs","UsersListing","userDetail","role","makeNavigateFn","history","openNewWindowTo","home","navigateState","isFormPath","pathname","AppRouter","setNavigate","useHistory","formLayout","setFormLayout","exact","render","ConfirmNavigateAway","listener","returnValue","addEventListener","removeEventListener","when","setApi","apiInstance","App","AppAuthConnect","authInfo","setAuthInfo","isAppPreLoading","setIsAppPreLoading","authCheck","authResp","authVals","region","userPoolId","userPool","userPoolWebClientId","clientId","mandatorySignIn","oauth","scope","redirectSignIn","redirectSignOut","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","mapboxgl","workerClass","require","requestedLogLevel","REACT_APP_LOGLEVEL","setLevel","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.ac7293c0.chunk.js","sourcesContent":[null,null,null,null,null,null,null,null,"import { atom, selectorFamily, useRecoilState, useSetRecoilState } from 'recoil'\n\nimport { useNotifications } from '../../components/AppNotifications'\nimport { Site } from '../../types'\nimport { useApi, makeOnPageHandler, useAccumulateApiItems, apiState } from '../api'\nimport { fetchSitesByProjectId, fetchSitesByBoxId, fetchSiteDetailById, fetchSitesPage } from '../calls'\nimport { refreshOn } from './invalidate'\n\nexport enum FETCH_ALL_SITES_STATUS {\n  unfetched = 0,\n  fetching = 1,\n  fetched = 2,\n}\n\nexport const allSitesStatusAtom = atom<FETCH_ALL_SITES_STATUS>({\n  key: 'sites/allSitesStatusAtom',\n  default: FETCH_ALL_SITES_STATUS.unfetched,\n})\n\nexport const allSitesAtom = atom<Site[]>({\n  key: 'sites/allSitesAtom',\n  default: [],\n})\n\nexport const sparseSitesDetailAtom = atom<Site[]>({\n  key: 'SitesListing/sparseSitesDetailAtom',\n  default: [],\n})\n\nexport const selectSitesBySingleSiteId = selectorFamily<Site[], number>({\n  key: 'selectors/selectSitesBySiteId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('sites'))\n\n      const api = get(apiState)\n      const site = await fetchSiteDetailById(api)(id)\n      return site ? [site] : []\n    },\n})\n\nexport const useFetchAllSitesOptimized = (): (() => void) => {\n  const [allSitesStatus, setAllSitesStatus] = useRecoilState(allSitesStatusAtom)\n\n  const setAllSites = useSetRecoilState(allSitesAtom)\n  const accumulateAllSites = useAccumulateApiItems(fetchSitesPage, 5000, makeOnPageHandler(setAllSites))\n\n  return () => {\n    if (allSitesStatus === FETCH_ALL_SITES_STATUS.unfetched) {\n      setAllSitesStatus(FETCH_ALL_SITES_STATUS.fetching)\n      Promise.all([\n        accumulateAllSites(0, 10000),\n        accumulateAllSites(10000, 20000),\n        accumulateAllSites(20000, 30000),\n        accumulateAllSites(30000, Infinity),\n      ]).then(() => {\n        setAllSitesStatus(FETCH_ALL_SITES_STATUS.fetched)\n      })\n    }\n  }\n}\n\nexport const useFetchSiteDetailBySiteIdOptimized = (): ((siteId: number | null | undefined) => void) => {\n  const api = useApi()\n  const notifications = useNotifications()\n  const [sparseSitesDetail, setSparseSitesDetail] = useRecoilState(sparseSitesDetailAtom)\n\n  return async (siteId: number | null | undefined) => {\n    if (!siteId || sparseSitesDetail.find((siteDetail) => siteDetail.id === siteId)) return\n\n    try {\n      const siteDetail = await fetchSiteDetailById(api)(siteId)\n      if (!siteDetail) return\n      setSparseSitesDetail((existing) => {\n        return [...existing, siteDetail] // TODO: handle replacement in case\n      })\n    } catch (err) {\n      notifications.error(`Failed to retrieve site: ${err}`)\n    }\n  }\n}\n\nexport const selectSitesByBoxId = selectorFamily<Site[], number>({\n  key: 'selectSitesByBoxId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('sites'))\n      get(refreshOn('boxSamples'))\n\n      const api = get(apiState)\n      return fetchSitesByBoxId(api)(id)\n    },\n})\n\nexport const selectSitesByProjectId = selectorFamily<Site[], number>({\n  key: 'selectSitesByProjectId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('sites'))\n      get(refreshOn('projectSamples'))\n\n      const api = get(apiState)\n      return fetchSitesByProjectId(api)(id)\n    },\n})\n",null,"/** @jsxImportSource @emotion/react */\nimport React, { useState, useRef } from 'react'\nimport MuiTextField from '@mui/material/TextField'\nimport { useHotkeys } from 'react-hotkeys-hook'\n\nimport { useNavigate } from '../AppRouter'\n\nexport interface QuickNavigateFieldProps {\n  className?: string\n}\n\nexport const QuickNavigateField = ({ className }: QuickNavigateFieldProps): JSX.Element => {\n  const navigate = useNavigate()\n\n  const inputRef = useRef<HTMLInputElement | null>(null)\n  const [value, setValue] = useState('')\n\n  const handleKeyDown = ({ key }: React.KeyboardEvent<HTMLInputElement>): void => {\n    switch (key) {\n      case 'Enter': {\n        const trimmedValue = value.trim()\n        if (!trimmedValue.match(/^\\d+$/)) return // accept numeric only\n        setValue('')\n        const targetId = Number(trimmedValue)\n        if (targetId <= 9999) {\n          navigate.boxDetail({ boxId: targetId })\n        } else {\n          navigate.sampleDetail({ sampleId: targetId })\n        }\n        break\n      }\n      case 'Escape': {\n        setValue('')\n        inputRef.current?.blur()\n      }\n    }\n  }\n\n  useHotkeys('cmd+o, ctrl+o', (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    inputRef.current?.focus()\n  })\n\n  return (\n    <MuiTextField\n      className={className}\n      size=\"small\"\n      value={value}\n      onChange={({ target: { value: newValue } }) => setValue(newValue)}\n      InputProps={{\n        onKeyDown: handleKeyDown,\n      }}\n      inputRef={inputRef}\n      placeholder=\"Box or Sample ID\"\n    />\n  )\n}\n","export const isStagingApi = process.env.REACT_APP_GRAPHQL && process.env.REACT_APP_GRAPHQL.includes('/staging/api')\n\nexport const isLocalhost = location.hostname === 'localhost'\n\nexport const isDev = process.env.NODE_ENV && process.env.NODE_ENV === 'development'\n\nexport const appVersion = process.env.REACT_APP_VERSION || '?'\n","import { ASTNode } from 'graphql'\nimport log from 'loglevel'\n\nimport { Api, LogLevel } from './Api'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type MockResponderTuples = [ASTNode, (...args: any[]) => unknown][]\n\nconst nextRequestNumber = (() => {\n  let requestNumber = 1\n  return () => String(requestNumber++)\n})()\n\nexport class MockApi implements Api {\n  responseDelay = 0\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  responders = new Map<ASTNode, (...args: any[]) => unknown>()\n\n  constructor(responders?: MockResponderTuples) {\n    if (responders) this.setResponders(responders)\n  }\n\n  setResponders = (responders: MockResponderTuples): void => {\n    this.responders.clear()\n    this.addResponders(responders)\n  }\n\n  addResponders = (responders: MockResponderTuples): void => {\n    responders.forEach(([queryOrMutation, responder]) => {\n      this.responders.set(queryOrMutation, responder)\n    })\n  }\n\n  setResponseDelay = (ms: number): void => {\n    this.responseDelay = ms\n  }\n\n  wait = async (): Promise<void> => {\n    return new Promise((resolve) => {\n      window.setTimeout(resolve, this.responseDelay)\n    })\n  }\n\n  signOut = (): void => {\n    log.debug('MockApi signOut')\n  }\n\n  query = async <T>(query: ASTNode, variables?: { [key: string]: unknown }): Promise<T> => {\n    const requestNumber = nextRequestNumber()\n    log.debug(\n      `%cMockApi query #${requestNumber}`,\n      'color: black; background: lightgreen',\n      query.loc?.source.body,\n      variables\n    )\n    const responder = this.responders.get(query)\n    await this.wait()\n    if (responder) {\n      const response = responder(variables)\n      log.debug(`%cMockApi responded to query #${requestNumber}`, 'color: black; background: #0cb700', response)\n      return response as T\n    }\n    return new Promise(() => {\n      log.debug(`%cMockApi not responding to query #${requestNumber}`, 'color: black; background: lightgray')\n    })\n  }\n\n  queryAllPages = async <T>(\n    query: ASTNode,\n    variables: { [key: string]: unknown },\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    { dataProperty }: { dataProperty: string }\n  ): Promise<T> => {\n    const requestNumber = nextRequestNumber()\n    log.debug(\n      `%cMockApi queryAllPages #${requestNumber}`,\n      'color: black; background: lightgreen',\n      query.loc?.source.body,\n      variables\n    )\n    const responder = this.responders.get(query)\n    await this.wait()\n    if (responder) {\n      const response = responder(variables)\n      log.debug(`%cMockApi responded to queryAllPages #${requestNumber}`, 'color: black; background: #0cb700', response)\n      return response as T\n    }\n    return new Promise(() => {\n      log.debug(`%cMockApi not responding to queryAllPages #${requestNumber}`, 'color: black; background: lightgray')\n    })\n  }\n\n  mutation = async <T>(query: ASTNode, variables?: { [key: string]: unknown }): Promise<T> => {\n    const requestNumber = nextRequestNumber()\n    log.debug(\n      `%cMockApi mutation #${requestNumber}`,\n      'color: black; background: #ffd17a',\n      query.loc?.source.body,\n      variables\n    )\n    const responder = this.responders.get(query)\n    await this.wait()\n    if (responder) {\n      const response = responder(variables)\n      log.debug(`%cMockApi responded to mutation #${requestNumber}`, 'color: black; background: orange', response)\n      return response as T\n    }\n    return new Promise(() => {\n      log.debug(`%cMockApi not responding to mutation #${requestNumber}`, 'color: black; background: lightgray')\n    })\n  }\n\n  log = async (level: LogLevel, message: string, context: Record<string, unknown>): Promise<void> => {\n    log.debug(`%cMockApi log ${level}`, 'color: black; background: #ff70ee', message, context)\n  }\n}\n","import { ASTNode } from 'graphql'\nimport { atom, useRecoilValue } from 'recoil'\n// import log from 'loglevel'\n\nimport { MockApi } from './MockApi'\n\nexport type LogLevel = 'DEBUG' | 'ERROR' | 'INFO' | 'WARN'\n\nexport class ApiError extends Error {\n  constructor(message: string) {\n    super()\n    this.message = message\n  }\n\n  toString(): string {\n    return this.message\n  }\n}\n\nexport interface Api {\n  signOut: () => void\n  query: <T>(query: ASTNode, variables?: Record<string, unknown>) => Promise<T>\n  queryAllPages: <T>(\n    query: ASTNode,\n    variables: Record<string, unknown>,\n    options: { dataProperty: string; onRecords?: (qty: number) => void; firstOffset?: number; lastOffset?: number }\n  ) => Promise<T>\n  mutation: <T>(query: ASTNode, variables?: Record<string, unknown>) => Promise<T>\n  log: (level: LogLevel, message: string, context: Record<string, unknown>) => void\n}\n\nexport const apiState = atom({\n  key: 'apiState',\n  default: new MockApi() as Api,\n  dangerouslyAllowMutability: true,\n})\n\nexport const useApi = (): Api => useRecoilValue(apiState)\n","import { api } from '@namcbugdb/common'\nimport { ASTNode } from 'graphql'\nimport { UseHostedReturn } from '@namcbugdb/react-common'\nimport log from 'loglevel'\n\nimport { Api, ApiError, LogLevel } from './Api'\n\nconst TIMEOUT_SECONDS = 30\n\nconst nextRequestNumber = (() => {\n  let requestNumber = 1\n  return () => String(requestNumber++)\n})()\n\nexport class GraphApi implements Api {\n  url: string\n  auth: UseHostedReturn | null\n  signOut: () => void\n\n  constructor(url: string, auth: UseHostedReturn | null, signOut: () => void) {\n    this.url = url\n    this.auth = auth\n    this.signOut = signOut\n  }\n\n  send = async <T>(query: ASTNode, variables?: { [key: string]: unknown }): Promise<T> => {\n    const jwt = this.auth ? await this.auth?.getCurrentToken() : null\n    const response = await api.apiCall<T>(this.url, jwt, query, variables, TIMEOUT_SECONDS * 1000)\n    const { data, errors } = response\n    if (errors || !data) {\n      const errorMessagesString = errors?.map((error) => error.message).join(';') ?? 'unknown error or missing data'\n      log.error(errorMessagesString, errors)\n      // this.log('ERROR', `api`, {}) // TODO: enable with data once logging service implemented\n      if (errors && errors[0]?.message === 'Authentication Error') this.signOut()\n      throw new ApiError(errorMessagesString)\n    }\n    return data\n  }\n\n  queryAllPages = async <QueryT>(\n    query: ASTNode,\n    variables: { [key: string]: unknown },\n    {\n      dataProperty,\n      onRecords,\n      firstOffset = 0,\n      lastOffset = Infinity,\n    }: { dataProperty: string; onRecords?: (qty: number) => void; firstOffset?: number; lastOffset?: number }\n  ): Promise<QueryT> => {\n    let offset: number | null | undefined = firstOffset\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const allRecords: any = [] // type is the type of record\n\n    while (offset !== null) {\n      const lastData = await this.query<QueryT>(query, { ...variables, offset })\n      const { records, nextOffset } = lastData[dataProperty]\n      if (nextOffset === undefined)\n        throw new ApiError('queryAllPages was called without the query returning nextOffset.')\n      allRecords.push(...records)\n      offset = nextOffset\n      if (onRecords) onRecords(records.length)\n      if (!offset || offset >= lastOffset) return { ...lastData, [dataProperty]: { records: allRecords } }\n    }\n\n    throw new Error('queryAllPages finished without returning data') // unreachable code; this is just to satisfy TS\n  }\n\n  query = async <T>(query: ASTNode, variables?: { [key: string]: unknown }): Promise<T> => {\n    const requestNumber = nextRequestNumber()\n    log.debug(\n      `%cGraphApi query #${requestNumber}`,\n      'color: black; background: lightgreen',\n      query.loc?.source.body,\n      variables\n    )\n    try {\n      const response = await this.send<T>(query, variables)\n      log.debug(`%cGraphApi response #${requestNumber}`, 'color: black; background: #0cb700', response)\n      return response\n    } catch (err) {\n      log.debug(\n        `%cGraphApi response #${requestNumber}%c %cERROR`,\n        'color: black; background: lightgreen',\n        'background: transparent',\n        'color: white; background: red'\n      )\n      throw err\n    }\n  }\n\n  mutation = async <T>(query: ASTNode, variables?: { [key: string]: unknown }): Promise<T> => {\n    const requestNumber = nextRequestNumber()\n    log.debug(\n      `%cGraphApi mutation #${requestNumber}`,\n      'color: black; background: #ffd17a',\n      query.loc?.source.body,\n      variables\n    )\n\n    try {\n      const response = await this.send<T>(query, variables)\n      log.debug(`%cGraphApi response #${requestNumber}`, 'color: black; background: orange', response)\n      return response\n    } catch (err) {\n      log.debug(\n        `%cGraphApi response #${requestNumber}%c %cERROR`,\n        'color: black; background: orange',\n        'background: transparent',\n        'color: white; background: red'\n      )\n      throw err\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  log = async (level: LogLevel, message: string, context: Record<string, unknown>): Promise<void> => {\n    // not implemented (logging service TBD)\n  }\n}\n","import { uniqBy } from 'lodash'\nimport { Api, useApi } from './Api'\n\nexport const useAccumulateApiItems = <T>(\n  fetchCall: (api: Api) => (offset: number, limit: number) => Promise<{ records: T[]; nextOffset: number }>,\n  pageSize: number,\n  onPage: (page: T[]) => void\n): ((from: number, to: number) => void) => {\n  const api = useApi()\n\n  const accumulateItems = (from: number, to: number) =>\n    fetchCall(api)(from, Math.min(pageSize, to - from)).then(({ records, nextOffset }) => {\n      onPage(records)\n      if (nextOffset && nextOffset < to) return accumulateItems(nextOffset, to)\n    })\n\n  return accumulateItems\n}\n\nexport const makeOnPageHandler =\n  <T>(setState: (updater: (existing: T[]) => T[]) => void) =>\n  (incoming: T[]): void => {\n    setState((existing: T[]) => uniqBy([...incoming, ...existing], 'id'))\n  }\n\nexport const deNull = <T>(source: T, defaults: Partial<T>): T => {\n  const copy = { ...source }\n  Object.entries(copy).forEach(([key, value]) => {\n    if (value !== null || typeof defaults[key] === 'undefined') return\n    copy[key] = defaults[key]\n  })\n  return copy\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { useSnackbar } from 'notistack'\nimport MuiIconButton from '@mui/material/IconButton'\nimport CloseIcon from '@mui/icons-material/Close'\n\nimport { useApi } from '../../data/api'\n\ninterface Notifications {\n  info: (message: string, deferMs?: number) => () => void\n  error: (message: string) => void\n}\n\nexport const useNotifications = (): Notifications => {\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\n\n  const api = useApi()\n\n  return useMemo(() => {\n    const closeAction = (key) => (\n      <MuiIconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={() => closeSnackbar(key)}>\n        <CloseIcon fontSize=\"small\" />\n      </MuiIconButton>\n    )\n\n    return {\n      info: (message: string, deferMs = 0) => {\n        const timeout = window.setTimeout(() => {\n          enqueueSnackbar(message, {\n            autoHideDuration: 4000,\n            action: closeAction,\n          })\n        }, deferMs)\n        return () => {\n          clearTimeout(timeout)\n        }\n      },\n      error: (message: string) => {\n        enqueueSnackbar(message, { persist: true, variant: 'error', action: closeAction })\n        api.log('WARN', `notification/error: \"${message}\"`, {})\n      },\n    }\n  }, [enqueueSnackbar, closeSnackbar, api])\n}\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface AddProjectSamplesInput {\n  projectId: number\n  sampleIds: number[]\n}\n\nexport const addProjectSamplesMutation = gql`\n  mutation ($projectId: Int!, $sampleIds: [Int]) {\n    addProjectSamples(projectId: $projectId, sampleIds: $sampleIds)\n  }\n`\n\nexport const addProjectSamples =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (params: AddProjectSamplesInput): Promise<true> => {\n    const data = await api.mutation<{\n      addProjectSamples: number // NOTE: return type is number of samples after operation (0 is not indication of failure)\n    }>(addProjectSamplesMutation, { ...params })\n\n    if (!data.addProjectSamples) throw new ApiError('project samples did not update') // not possible to know if no records were added due to return type above\n\n    invalidate('projectSamples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface MetricInput {\n  name: string // -> metricName\n  abbreviation: string\n  groupId: number | null // -> metricGroupId\n  displayText: string\n  isActive: boolean\n  description: string\n  calculationId: number\n  reportIds: number[]\n  rarefactionTypeId: number\n  taxonomyIds: number[]\n  attributeId: number | null\n  attributeValues: string[]\n}\n\nexport const createMetricMutation = gql`\n  mutation ($metric: MetricInput!) {\n    createMetric(metric: $metric)\n  }\n`\n\nexport const createMetric =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (metric: MetricInput): Promise<number> => {\n    const { name: metricName, groupId: metricGroupId, ...restMetric } = metric\n    const data = await api.mutation<{\n      createMetric: number | null // NOTE: new metric ID\n    }>(createMetricMutation, { metric: { metricName, metricGroupId, ...restMetric } })\n\n    const id = data.createMetric\n    if (!id) throw new ApiError('metric did not create')\n\n    invalidate('metrics')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface ModelInput {\n  name: string // -> modelName\n  abbreviation: string\n  typeId: number | null // -> modelTypeId\n  translationId: number | null\n  extentDescription: string\n  codeFunction: string\n  codeFunction2: string\n  platform: string\n  referenceSites: number | null\n  groupCount: number | null\n  minimumCount: number | null\n  oeMean: number | null\n  oeStdev: number | null\n  taxonomicEffort: string\n  fixedCount: number | null\n  description: string\n  predictorIds: number[]\n  metricIds: number[]\n  isActive: boolean\n}\n\nexport const createModelMutation = gql`\n  mutation ($model: ModelInput!) {\n    createModel(model: $model)\n  }\n`\n\nexport const createModel =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (model: ModelInput): Promise<number> => {\n    const { name: modelName, typeId: modelTypeId, taxonomicEffort, ...restModel } = model\n    const data = await api.mutation<{\n      createModel: number | null // NOTE: new model ID\n    }>(createModelMutation, {\n      model: { modelName, modelTypeId, taxonomicEffort: taxonomicEffort || null, ...restModel },\n    })\n\n    const id = data.createModel\n    if (!id) throw new ApiError('model did not create')\n\n    invalidate('models')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface OrganizationInput {\n  name: string // -> organizationName\n  typeId: number // -> organizationTypeId\n  address1: string\n  address2: string\n  city: string\n  usStateId: number | null\n  countryId: number\n  zipCode: string\n  phone: string\n}\n\nexport const createOrganizationMutation = gql`\n  mutation ($organization: OrganizationInput!) {\n    createOrganization(organization: $organization)\n  }\n`\n\nexport const createOrganization =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (organization: OrganizationInput): Promise<number> => {\n    const { name: organizationName, typeId: organizationTypeId, ...restOrganization } = organization\n    const data = await api.mutation<{\n      createOrganization: number | null // NOTE: new organization ID\n    }>(createOrganizationMutation, { organization: { organizationName, organizationTypeId, ...restOrganization } })\n\n    const id = data.createOrganization\n    if (!id) throw new ApiError('organization did not create')\n\n    invalidate('organizations')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\nimport { OrganizationInput } from './createOrganization'\n\nexport interface UserInput {\n  firstName: string\n  lastName: string\n  phone: string\n  affiliationId?: number | null\n  roleIds?: number[] // only for updateUser\n}\n\nexport const createOrganizationWithUserMutation = gql`\n  mutation ($organization: OrganizationInput!, $user: IndividualInput!) {\n    createUser(organization: $organization, user: $user)\n  }\n`\n\ninterface createOrganizationWithUserParams {\n  organization: OrganizationInput\n  user: UserInput\n}\n\nexport const createOrganizationWithUser =\n  (api: Api, invalidate: InvalidateFn) =>\n  async ({ organization, user }: createOrganizationWithUserParams): Promise<number> => {\n    const { name: organizationName, typeId: organizationTypeId, ...restOrganization } = organization\n    const data = await api.mutation<{\n      createUser: number | null // NOTE: new user ID\n    }>(createOrganizationWithUserMutation, {\n      organization: { organizationName, organizationTypeId, ...restOrganization },\n      user,\n    })\n\n    const id = data.createUser\n    if (!id) throw new ApiError('user/organization did not create')\n\n    invalidate('organizations')\n    invalidate('users')\n    invalidate('myUser')\n\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface PredictorInput {\n  abbreviation: string\n  calculation: string\n  calculationScript: string\n  cellRepresents: string\n  cellSize: string\n  description: string\n  geometryFilePath: string\n  inputType: string\n  isGee: string\n  isTemporal: boolean\n  isText: string\n  maxValue: number | null\n  minValue: number | null\n  name: string // # -> predictorName\n  notes: string\n  smallShedException: string\n  source: string\n  transformation: string\n  typeId: number // # -> predictorTypeId\n  units: string\n}\n\nexport const createPredictorMutation = gql`\n  mutation ($predictor: PredictorInput!) {\n    createPredictor(predictor: $predictor)\n  }\n`\n\nexport const createPredictor =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (predictor: PredictorInput): Promise<number> => {\n    const { name: predictorName, typeId: predictorTypeId, ...restPredictor } = predictor\n    const data = await api.mutation<{\n      createPredictor: number | null // NOTE: new predictor ID\n    }>(createPredictorMutation, { predictor: { predictorName, predictorTypeId, ...restPredictor } })\n\n    const id = data.createPredictor\n    if (!id) throw new ApiError('predictor did not create')\n\n    invalidate('predictors')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface ProjectInput {\n  name: string // -> projectName\n  isPrivate: boolean\n  description: string\n  contactId: number\n  modelIds: number[]\n}\n\nexport const createProjectMutation = gql`\n  mutation ($project: ProjectInput!) {\n    createProject(project: $project)\n  }\n`\n\nexport const createProject =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (project: ProjectInput): Promise<number> => {\n    const { name: projectName, ...restProject } = project\n    const data = await api.mutation<{\n      createProject: number | null // NOTE: new project ID\n    }>(createProjectMutation, { project: { projectName, ...restProject } })\n\n    const id = data.createProject\n    if (!id) throw new ApiError('project did not create')\n\n    invalidate('projects')\n    return id\n  }\n","import gql from 'graphql-tag'\nimport { Submission } from '../../types'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface NewSampleSubmission {\n  submitterId: number\n  customerId: number | null\n  data: Pick<Submission, 'templateVersion' | 'appVersion' | 'samples' | 'newSites'>\n}\n\nexport const createSampleSubmissionMutation = gql`\n  mutation ($submitterId: Int!, $customerId: Int!, $data: JSONObject!) {\n    createSampleSubmission(submitterId: $submitterId, customerId: $customerId, data: $data)\n  }\n`\n\nexport const createSampleSubmission =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (submission: NewSampleSubmission): Promise<number> => {\n    const data = await api.mutation<{\n      createSampleSubmission: number | null // NOTE: new box ID\n    }>(createSampleSubmissionMutation, { ...submission, data: JSON.stringify(submission.data) })\n\n    const id = data.createSampleSubmission\n    if (!id) throw new ApiError('submission did not create')\n\n    invalidate('boxes')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface SiteInput {\n  name: string // -> siteName\n  latitude: number\n  longitude: number\n  waterbodyName: string | null\n  waterbodyTypeId: number | null\n  waterbodyCode: string | null\n  description: string | null\n  isReference: boolean\n}\n\nexport const createSiteMutation = gql`\n  mutation ($site: SiteInput!) {\n    createSite(site: $site)\n  }\n`\n\nexport const createSite =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (site: SiteInput): Promise<number> => {\n    const { name: siteName, ...restSite } = site\n    const data = await api.mutation<{\n      createSite: number | null // NOTE: new site ID\n    }>(createSiteMutation, { site: { siteName, ...restSite } })\n\n    const id = data.createSite\n    if (!id) throw new ApiError('site did not create')\n\n    invalidate('sites')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface TaxonInput {\n  name: string // -> scientificName\n  levelId: number\n  parentId: number\n  isTargetEffort: boolean\n  synonyms: string[]\n  notes: string\n}\n\nexport const createTaxonMutation = gql`\n  mutation ($taxon: TaxonomyInput!) {\n    createTaxonomy(taxonomy: $taxon)\n  }\n`\n\nexport const createTaxon =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (taxon: TaxonInput): Promise<number> => {\n    const { name: scientificName, ...restTaxon } = taxon\n    const data = await api.mutation<{\n      createTaxonomy: number // NOTE: count of records changed\n    }>(createTaxonMutation, {\n      taxon: {\n        scientificName,\n        ...restTaxon,\n      },\n    })\n\n    const id = data.createTaxonomy\n    if (!id) throw new ApiError('taxon did not create')\n\n    invalidate('taxa')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface TranslationGroupInput {\n  translationId: number\n  translationScientificName: string\n  isFinal: boolean\n  taxonomyIds: number[]\n}\n\nexport const createTranslationGroupMutation = gql`\n  mutation ($translationId: Int!, $translationGroup: TranslationGroupInput!) {\n    createTranslationGroup(translationId: $translationId, translationGroup: $translationGroup)\n  }\n`\n\nexport const createTranslationGroup =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (translationInput: TranslationGroupInput): Promise<number> => {\n    const { translationId, ...translationGroup } = translationInput\n    const data = await api.mutation<{\n      createTranslationGroup: number | null // NOTE: new translationGroup ID\n    }>(createTranslationGroupMutation, { translationId, translationGroup })\n\n    const id = data.createTranslationGroup\n    if (!id) throw new ApiError('translation group did not create')\n\n    invalidate('translations')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Metric } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteMetricMutation = gql`\n  mutation ($metricId: Int!) {\n    deleteMetric(id: $metricId)\n  }\n`\n\nexport const deleteMetric =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (metric: Metric): Promise<true> => {\n    const data = await api.mutation<{ deleteMetric: number }>(deleteMetricMutation, {\n      metricId: metric.id,\n    })\n\n    if (!data.deleteMetric) throw new ApiError('metric did not delete')\n\n    invalidate('metrics')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Model } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteModelMutation = gql`\n  mutation ($modelId: Int!) {\n    deleteModel(id: $modelId)\n  }\n`\n\nexport const deleteModel =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (model: Model): Promise<true> => {\n    const data = await api.mutation<{ deleteModel: number }>(deleteModelMutation, {\n      modelId: model.id,\n    })\n\n    if (!data.deleteModel) throw new ApiError('model did not delete')\n\n    invalidate('models')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Organism } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteOrganismMutation = gql`\n  mutation ($organismId: Int!) {\n    deleteOrganism(organismId: $organismId)\n  }\n`\n\nexport const deleteOrganism =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (organism: Organism): Promise<true> => {\n    const data = await api.mutation<{ deleteOrganism: number }>(deleteOrganismMutation, {\n      organismId: organism.id,\n    })\n\n    if (!data.deleteOrganism) throw new ApiError('organism record did not delete')\n\n    invalidate('samples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Organization } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteOrganizationMutation = gql`\n  mutation ($organizationId: Int!) {\n    deleteOrganization(id: $organizationId)\n  }\n`\n\nexport const deleteOrganization =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (organization: Organization): Promise<true> => {\n    const data = await api.mutation<{ deleteOrganization: number }>(deleteOrganizationMutation, {\n      organizationId: organization.id,\n    })\n\n    if (!data.deleteOrganization) throw new ApiError('organization did not delete')\n\n    invalidate('organizations')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Predictor } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deletePredictorMutation = gql`\n  mutation ($predictorId: Int!) {\n    deletePredictor(id: $predictorId)\n  }\n`\n\nexport const deletePredictor =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (predictor: Predictor): Promise<true> => {\n    const data = await api.mutation<{ deletePredictor: number }>(deletePredictorMutation, {\n      predictorId: predictor.id,\n    })\n\n    if (!data.deletePredictor) throw new ApiError('predictor did not delete')\n\n    invalidate('predictors')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Project } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteProjectMutation = gql`\n  mutation ($projectId: Int!) {\n    deleteProject(projectId: $projectId)\n  }\n`\n\nexport const deleteProject =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (project: Project): Promise<true> => {\n    const data = await api.mutation<{ deleteProject: number }>(deleteProjectMutation, {\n      projectId: project.id,\n    })\n\n    if (!data.deleteProject) throw new ApiError('project did not delete')\n\n    invalidate('projects')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Sample } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteSampleMutation = gql`\n  mutation ($sampleId: Int!) {\n    deleteSample(sampleId: $sampleId)\n  }\n`\n\nexport const deleteSample =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (sample: Sample): Promise<true> => {\n    const data = await api.mutation<{ deleteSample: number }>(deleteSampleMutation, {\n      sampleId: sample.id,\n    })\n\n    if (!data.deleteSample) throw new ApiError('sample did not delete')\n\n    invalidate('samples')\n    invalidate('boxSamples')\n    invalidate('projectSamples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Site } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteSiteMutation = gql`\n  mutation ($siteId: Int!) {\n    deleteSite(id: $siteId)\n  }\n`\n\nexport const deleteSite =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (site: Site): Promise<true> => {\n    const data = await api.mutation<{ deleteSite: number }>(deleteSiteMutation, {\n      siteId: site.id,\n    })\n\n    if (!data.deleteSite) throw new ApiError('site did not delete')\n\n    invalidate('sites')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteTranslationGroupMutation = gql`\n  mutation ($id: Int!) {\n    deleteTranslationGroup(id: $id)\n  }\n`\n\nexport const deleteTranslationGroup =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (translationGroup: { id: number }): Promise<true> => {\n    const data = await api.mutation<{ deleteTranslationGroup: number }>(deleteTranslationGroupMutation, {\n      id: translationGroup.id,\n    })\n\n    if (!data.deleteTranslationGroup) throw new ApiError('translation group did not delete')\n\n    invalidate('translations')\n    return true\n  }\n","import gql from 'graphql-tag'\nimport { Box as GraphBox } from '@namcbugdb/common'\nimport { sortBy } from 'lodash'\n\nimport { Api } from '../api'\nimport { Box } from '../../types'\n\nexport const fetchBoxesQuery = gql`\n  query ($offset: Int) {\n    boxes(limit: 1000, offset: $offset) {\n      records {\n        boxId\n        customerName\n        customerId\n        createdDate\n        boxReceivedDate\n        submittedBy\n        boxState\n        sampleCount\n        midges\n        measurements\n        sortComplete\n        idComplete\n        alias\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const transformBox = ({\n  boxId: id,\n  boxReceivedDate: receivedDate,\n  submittedBy: submittedByName,\n  idComplete: identificationComplete,\n  ...rest\n}: GraphBox): Box => ({\n  id,\n  receivedDate,\n  submittedByName,\n  identificationComplete,\n  ...rest,\n})\n\nexport const fetchBoxes = (api: Api) => async (): Promise<Box[]> => {\n  const data = await api.queryAllPages<{ boxes: { records: GraphBox[] } }>(\n    fetchBoxesQuery,\n    {},\n    { dataProperty: 'boxes' }\n  )\n\n  const boxes = (data.boxes.records ?? []).map(transformBox)\n\n  return sortBy(boxes, ({ receivedDate }) => receivedDate).reverse()\n}\n","import gql from 'graphql-tag'\nimport { Box as GraphBox } from '@namcbugdb/common'\nimport { sortBy } from 'lodash'\n\nimport { Api } from '../api'\nimport { Box } from '../../types'\nimport { transformBox } from './fetchBoxes'\nimport { BOX_STATE_ID } from '../selectors'\n\nexport const fetchActiveBoxesQuery = gql`\n  query ($offset: Int, $boxStateId: Int) {\n    boxes(limit: 1000, offset: $offset, boxStateId: $boxStateId) {\n      records {\n        boxId\n        customerName\n        customerId\n        createdDate\n        boxReceivedDate\n        submittedBy\n        boxState\n        sampleCount\n        midges\n        measurements\n        sortComplete\n        idComplete\n        alias\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchActiveBoxes = (api: Api) => async (): Promise<Box[]> => {\n  const data = await api.queryAllPages<{ boxes: { records: GraphBox[] } }>(\n    fetchActiveBoxesQuery,\n    { boxStateId: BOX_STATE_ID.active },\n    { dataProperty: 'boxes' }\n  )\n\n  const boxes = (data.boxes.records ?? []).map(transformBox)\n\n  return sortBy(boxes, ({ receivedDate }) => receivedDate).reverse()\n}\n","import gql from 'graphql-tag'\nimport { Attribute as GraphAttribute, PaginatedRecords } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { Attribute } from '../../types'\n\nexport const fetchAttributesQuery = gql`\n  query ($offset: Int) {\n    attributes(limit: 1000, offset: $offset) {\n      records {\n        attributeId\n        attributeName\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const transformAttribute = ({ attributeId: id, attributeName: name, ...rest }: GraphAttribute): Attribute => ({\n  id,\n  name,\n  ...rest,\n})\n\nexport const fetchAttributes = (api: Api) => async (): Promise<Attribute[]> => {\n  const data = await api.queryAllPages<{ attributes: PaginatedRecords<GraphAttribute> }>(\n    fetchAttributesQuery,\n    {},\n    { dataProperty: 'attributes' }\n  )\n\n  return data.attributes.records.map(transformAttribute)\n}\n","import gql from 'graphql-tag'\nimport { BoxInfo as GraphBoxInfo } from '@namcbugdb/common'\n\nimport { Api, ApiError, deNull } from '../api'\nimport { Box } from '../../types'\nimport { transformBox } from './fetchBoxes'\n\nexport const fetchBoxDetailByIdQuery = gql`\n  query ($boxId: Int!) {\n    boxInfo(boxId: $boxId) {\n      boxId\n      boxState\n      boxStateId\n      customerId\n      customer {\n        organizationName\n      }\n      submittedBy\n      createdDate\n      boxReceivedDate\n      processingCompleteDate\n      measurements\n      midges\n      taxaQa\n      sorterQa\n      description\n      sampleCount\n      sortComplete\n      idComplete\n      alias\n      modelIds\n      submissionCount\n    }\n  }\n`\n\nexport const fetchBoxDetailById =\n  (api: Api) =>\n  async (boxId: number): Promise<Box | null> => {\n    try {\n      const data = await api.query<{ boxInfo: GraphBoxInfo }>(fetchBoxDetailByIdQuery, { boxId })\n\n      if (!data.boxInfo) return null\n      const {\n        customer: { organizationName: customerName },\n\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        submissions, // not queried, discard for typing incompatibility\n\n        ...restBoxInfo\n      } = data.boxInfo\n      return deNull(transformBox({ ...restBoxInfo, customerName }), {\n        description: '',\n        modelIds: [],\n      })\n    } catch (err) {\n      if (err instanceof ApiError && err.message === 'Record not found') return null\n      throw err\n    }\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { SourceSample } from '../../types'\n\nexport const fetchBoxSamplesByBoxIdQuery = gql`\n  query ($boxId: Int!, $offset: Int) {\n    samples(limit: 1000, offset: $offset, boxId: $boxId) {\n      records {\n        sampleId\n        sampleDate\n        usState\n        sampleType\n        sampleMethod\n        sorterName\n        sortStartDate\n        sortEndDate\n        idErName\n        idStartDate\n        idEndDate\n        customerSiteCode\n        visitId\n        siteName\n        siteId\n        area\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const transformSourceSample = (sample: GraphSample): SourceSample => {\n  // Note: SourceSamples are also returned by project samples; code does not have a better home\n\n  const {\n    sampleId: id,\n    sampleType: type,\n    sampleMethod: method,\n    idErName: identifierName,\n    idStartDate: identificationStartDate,\n    idEndDate: identificationEndDate,\n    ...restSample\n  } = sample\n\n  return {\n    ...restSample,\n    id,\n    type,\n    method,\n    identifierName,\n    identificationStartDate,\n    identificationEndDate,\n  }\n}\n\nexport const fetchBoxSamplesByBoxId =\n  (api: Api) =>\n  async (boxId: number): Promise<SourceSample[]> => {\n    const data = await api.queryAllPages<{\n      samples: PaginatedRecords<GraphSample>\n    }>(fetchBoxSamplesByBoxIdQuery, { boxId }, { dataProperty: 'samples' })\n\n    return data.samples.records.map(transformSourceSample)\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, BoxTaxa as GraphBoxTaxa } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { BoxTaxon } from '../../types'\n\nexport const fetchBoxTaxaByBoxIdQuery = gql`\n  query ($offset: Int, $boxId: Int!) {\n    boxTaxa(boxId: $boxId, limit: 1000, offset: $offset) {\n      records {\n        order\n        family\n        taxonomyId\n        scientificName\n        taxonomistCounts\n        sampleCount\n        totalCount\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchBoxTaxaByBoxId =\n  (api: Api) =>\n  async (boxId: number): Promise<BoxTaxon[]> => {\n    const data = await api.queryAllPages<{\n      boxTaxa: PaginatedRecords<GraphBoxTaxa>\n    }>(fetchBoxTaxaByBoxIdQuery, { boxId }, { dataProperty: 'boxTaxa' })\n\n    return data.boxTaxa.records.map(({ taxonomyId: id, scientificName: name, taxonomistCounts, ...rest }) => ({\n      ...rest,\n      id,\n      name,\n      taxonomistCounts: taxonomistCounts || {},\n    }))\n  }\n","import gql from 'graphql-tag'\nimport axios from 'axios'\nimport {\n  BoxInfo as GraphBoxInfo,\n  Sample as GraphSample,\n  SampleTaxa as GraphSampleTaxa,\n  MetricResult as GraphMetricResult,\n} from '@namcbugdb/common'\n\nimport { Api } from '../api'\n\nexport const fetchCustomerBoxReportByBoxIdQuery1 = gql`\n  query ($boxId: Int!) {\n    boxInfo(boxId: $boxId) {\n      submittedBy\n      submitterEmail\n      customer {\n        organizationName\n        address1\n        address2\n        city\n        usState\n        zipCode\n        phone\n      }\n    }\n  }\n`\n\nexport const fetchCustomerBoxReportByBoxIdQuery2 = gql`\n  query ($boxId: Int!, $offset: Int!) {\n    samples(boxId: $boxId, offset: $offset, limit: 1000) {\n      records {\n        sampleId\n        usState\n        visitId\n        customerSiteCode\n        sampleDate\n        sampleLatitude\n        sampleLongitude\n        siteName\n        siteLatitude\n        siteLongitude\n        waterbodyName\n        sampleType\n        sampleMethod\n        habitatName\n        area\n        fieldSplit\n        labSplit\n        jarCount\n        qualitative\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchCustomerBoxReportByBoxIdQuery3 = gql`\n  query ($boxId: Int!, $offset: Int!) {\n    sampleTaxa(boxId: $boxId, offset: $offset, limit: 1000) {\n      records {\n        sampleId\n        class\n        order\n        family\n        genus\n        species\n        scientificName\n        splitCount\n        bigRareCount\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchCustomerBoxReportByBoxIdQuery4 = gql`\n  query ($boxId: Int!, $offset: Int!) {\n    reportMetrics(reportId: 1, boxId: $boxId, limit: 1000, offset: $offset) {\n      records {\n        sampleId\n        metricName\n        metricValue\n        metricGroupId\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchCustomerBoxReportByBoxId =\n  (api: Api) =>\n  async (\n    boxId: number\n  ): Promise<{\n    boxInfo: GraphBoxInfo\n    samples: GraphSample[]\n    sampleTaxa: GraphSampleTaxa[]\n    reportMetrics: GraphMetricResult[]\n    template: Blob\n  }> => {\n    const [\n      { boxInfo },\n      {\n        samples: { records: samples },\n      },\n      {\n        sampleTaxa: { records: sampleTaxa },\n      },\n      {\n        reportMetrics: { records: reportMetrics },\n      },\n      template,\n    ] = await Promise.all([\n      // query 1: boxInfo\n      api.query<{\n        boxInfo: GraphBoxInfo\n      }>(fetchCustomerBoxReportByBoxIdQuery1, { boxId }),\n\n      // query 2: samples\n      api.queryAllPages<{ samples: { records: GraphSample[] } }>(\n        fetchCustomerBoxReportByBoxIdQuery2,\n        { boxId },\n        { dataProperty: 'samples' }\n      ),\n\n      // query 3: sampleTaxa\n      api.queryAllPages<{ sampleTaxa: { records: GraphSampleTaxa[] } }>(\n        fetchCustomerBoxReportByBoxIdQuery3,\n        { boxId },\n        { dataProperty: 'sampleTaxa' }\n      ),\n\n      // query 4: reportMetrics\n      api.queryAllPages<{ reportMetrics: { records: GraphMetricResult[] } }>(\n        fetchCustomerBoxReportByBoxIdQuery4,\n        { boxId },\n        { dataProperty: 'reportMetrics' }\n      ),\n\n      // fetch: Excel file\n      axios\n        .get(`${process.env.PUBLIC_URL}/namc_customer_report.xlsx`, { responseType: 'blob' })\n        .then(({ data }) => data),\n    ])\n\n    return {\n      boxInfo,\n      samples,\n      sampleTaxa,\n      reportMetrics,\n      template,\n    }\n  }\n","import gql from 'graphql-tag'\nimport { BoxInfo as GraphBoxInfo } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { Submission } from '../../types'\n\nexport const fetchLatestSubmissionByBoxIdQuery1 = gql`\n  query ($boxId: Int!) {\n    boxInfo(boxId: $boxId) {\n      boxStateId\n      customer {\n        organizationName\n        phone\n      }\n      latestSubmission {\n        versionId\n        submissionId\n        submitter {\n          firstName\n          lastName\n          email\n          phone\n        }\n        createdDate\n        updatedDate\n      }\n    }\n  }\n`\n\nexport const fetchLatestSubmissionByBoxIdQuery2 = gql`\n  query ($submissionId: Int!) {\n    submissionData(submissionId: $submissionId)\n  }\n`\n\nexport const fetchLatestSubmissionByBoxId =\n  (api: Api) =>\n  async (boxId: number): Promise<Submission | null> => {\n    const data1 = await api.query<{ boxInfo: GraphBoxInfo }>(fetchLatestSubmissionByBoxIdQuery1, { boxId })\n\n    const {\n      boxStateId,\n      customer: { organizationName, phone: organizationPhone },\n      latestSubmission,\n    } = data1.boxInfo\n    if (!latestSubmission) return null\n    const {\n      versionId: version,\n      submissionId,\n      submitterId,\n      submitter: { firstName, lastName, email: submitterEmail, phone: submitterPhone },\n      createdDate,\n      updatedDate,\n    } = latestSubmission\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const data2 = await api.query<{ submissionData: any }>(fetchLatestSubmissionByBoxIdQuery2, {\n      submissionId,\n    })\n\n    try {\n      const { submissionData } = data2\n      const submitterName = `${firstName} ${lastName}`\n\n      if (typeof submissionData !== 'object') throw new Error()\n      const { templateVersion, appVersion, samples, newSites } = submissionData\n      if (typeof templateVersion !== 'number') throw new Error()\n      if (typeof appVersion !== 'string') throw new Error()\n      if (!Array.isArray(samples)) throw new Error()\n\n      return {\n        id: submissionId,\n        boxId,\n        boxStateId,\n        organizationName,\n        organizationPhone,\n        submitterName,\n        submitterEmail,\n        submitterPhone,\n        version,\n        submitterId,\n        createdDate,\n        updatedDate,\n        templateVersion,\n        appVersion,\n        samples,\n        newSites,\n      }\n    } catch (err) {\n      throw new Error('Could not parse submissionData')\n    }\n  }\n","import gql from 'graphql-tag'\nimport { Lookups } from '@namcbugdb/common'\n\nimport { Api } from '../api'\n\nexport const fetchLookupsQuery = gql`\n  query {\n    lookups {\n      taxa {\n        taxaLevels\n        lifeStages\n        fishDietSpecies\n      }\n      sample {\n        noteTypes\n        boxStates\n        sampleMethods\n        sampleTypes\n        towTypes\n        effortTypes\n        designTypes\n      }\n      geo {\n        systems\n        habitats\n        ecosystems\n        waterbodyTypes\n        states\n        countries\n        modelTypes\n        predictorTypes\n      }\n      entity {\n        organizationTypes\n        roles\n      }\n      metric {\n        metricGroups\n        calculations\n        metricReports\n        rarefactionTypes\n      }\n    }\n  }\n`\n\nexport const fetchLookups = (api: Api) => async (): Promise<Lookups> => {\n  const data = await api.query<{\n    lookups: Lookups\n  }>(fetchLookupsQuery)\n  return data.lookups\n}\n","import gql from 'graphql-tag'\nimport { Metric as GraphMetric } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Metric } from '../../types'\n\nexport const fetchMetricsQuery = gql`\n  query ($offset: Int!) {\n    metrics(offset: $offset, limit: 1000) {\n      records {\n        metricId\n        metricName\n        abbreviation\n        metricGroupId\n        metricGroupName\n        codeFunction\n        isActive\n        reportIds\n        displayText\n        description\n        calculationId\n        taxonomyIds\n        attributeId\n        attributeValues\n        rarefactionTypeId\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchMetrics = (api: Api) => async (): Promise<Metric[]> => {\n  const data = await api.queryAllPages<{ metrics: { records: GraphMetric[] } }>(\n    fetchMetricsQuery,\n    {},\n    { dataProperty: 'metrics' }\n  )\n\n  return data.metrics.records.map(\n    ({ metricId: id, metricName: name, metricGroupName: groupName, metricGroupId: groupId, ...rest }) =>\n      deNull(\n        {\n          id,\n          name,\n          groupName,\n          groupId,\n          ...rest,\n        },\n        {\n          abbreviation: '',\n          description: '',\n          displayText: '',\n          reportIds: [],\n          taxonomyIds: [],\n        }\n      )\n  )\n}\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { MinimalSample } from '../../types'\n\nexport const fetchMinimalSamplesByIdsQuery = gql`\n  query ($sampleIds: [Int], $offset: Int) {\n    samples(limit: 1000, offset: $offset, sampleIds: $sampleIds) {\n      records {\n        sampleId\n        sampleDate\n        sampleType\n        sampleMethod\n        area\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const transformMinimalSample = ({\n  sampleId: id,\n  sampleType: type,\n  sampleMethod: method,\n  ...restSample\n}: GraphSample): MinimalSample => ({\n  id,\n  type,\n  method,\n  ...restSample,\n})\n\nexport const fetchMinimalSamplesByIds =\n  (api: Api) =>\n  async (sampleIds: number[]): Promise<MinimalSample[]> => {\n    const data = await api.queryAllPages<{\n      samples: PaginatedRecords<GraphSample>\n    }>(fetchMinimalSamplesByIdsQuery, { sampleIds }, { dataProperty: 'samples' })\n\n    return data.samples.records.map(transformMinimalSample)\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { MinimalSample } from '../../types'\nimport { transformMinimalSample } from './fetchMinimalSamplesByIds'\n\nexport const fetchMinimalSamplesByOrganizationIdQuery = gql`\n  query ($organizationId: Int, $offset: Int) {\n    samples(limit: 1000, offset: $offset, entityId: $organizationId) {\n      records {\n        sampleId\n        sampleDate\n        sampleType\n        sampleMethod\n        area\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchMinimalSamplesByOrganizationId =\n  (api: Api) =>\n  async (organizationId: number): Promise<MinimalSample[]> => {\n    const data = await api.queryAllPages<{\n      samples: PaginatedRecords<GraphSample>\n    }>(fetchMinimalSamplesByOrganizationIdQuery, { organizationId }, { dataProperty: 'samples' })\n\n    return data.samples.records.map(transformMinimalSample)\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { GeoJsonPolygonCoordinates, MinimalSample } from '../../types'\nimport { transformMinimalSample } from './fetchMinimalSamplesByIds'\n\nexport const fetchMinimalSamplesByPolygonQuery = gql`\n  query ($polygon: String, $offset: Int) {\n    samples(limit: 1000, offset: $offset, polygon: $polygon) {\n      records {\n        sampleId\n        sampleDate\n        sampleType\n        sampleMethod\n        area\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchMinimalSamplesByPolygon =\n  (api: Api) =>\n  async (coordinates: GeoJsonPolygonCoordinates): Promise<MinimalSample[]> => {\n    const stringifiedGeoJson = JSON.stringify({\n      type: 'Polygon',\n      coordinates,\n    })\n\n    const data = await api.queryAllPages<{ samples: PaginatedRecords<GraphSample> }>(\n      fetchMinimalSamplesByPolygonQuery,\n      { polygon: stringifiedGeoJson },\n      { dataProperty: 'samples' }\n    )\n    return data.samples.records.map(transformMinimalSample)\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { MinimalSample } from '../../types'\nimport { transformMinimalSample } from './fetchMinimalSamplesByIds'\n\nexport const fetchMinimalSamplesBySiteIdQuery = gql`\n  query ($siteId: Int, $offset: Int) {\n    samples(limit: 1000, offset: $offset, siteId: $siteId) {\n      records {\n        sampleId\n        sampleDate\n        sampleType\n        sampleMethod\n        area\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchMinimalSamplesBySiteId =\n  (api: Api) =>\n  async (siteId: number): Promise<MinimalSample[]> => {\n    const data = await api.queryAllPages<{\n      samples: PaginatedRecords<GraphSample>\n    }>(fetchMinimalSamplesBySiteIdQuery, { siteId }, { dataProperty: 'samples' })\n\n    return data.samples.records.map(transformMinimalSample)\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { MinimalSample } from '../../types'\nimport { transformMinimalSample } from './fetchMinimalSamplesByIds'\n\nexport const fetchMinimalSamplesByTaxonIdQuery = gql`\n  query ($taxonId: Int, $offset: Int) {\n    samples(limit: 1000, offset: $offset, taxonomyId: $taxonId) {\n      records {\n        sampleId\n        sampleDate\n        sampleType\n        sampleMethod\n        area\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchMinimalSamplesByTaxonId =\n  (api: Api) =>\n  async (taxonId: number): Promise<MinimalSample[]> => {\n    const data = await api.queryAllPages<{\n      samples: PaginatedRecords<GraphSample>\n    }>(fetchMinimalSamplesByTaxonIdQuery, { taxonId }, { dataProperty: 'samples' })\n\n    return data.samples.records.map(transformMinimalSample)\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { MinimalSample } from '../../types'\nimport { transformMinimalSample } from './fetchMinimalSamplesByIds'\n\nexport const fetchMinimalSamplesByUsStateIdQuery = gql`\n  query ($usStateId: Int, $offset: Int) {\n    samples(limit: 1000, offset: $offset, usStateId: $usStateId) {\n      records {\n        sampleId\n        sampleDate\n        sampleType\n        sampleMethod\n        area\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchMinimalSamplesByUsStateId =\n  (api: Api) =>\n  async (usStateId: number): Promise<MinimalSample[]> => {\n    const data = await api.queryAllPages<{\n      samples: PaginatedRecords<GraphSample>\n    }>(fetchMinimalSamplesByUsStateIdQuery, { usStateId }, { dataProperty: 'samples' })\n\n    return data.samples.records.map(transformMinimalSample)\n  }\n","import gql from 'graphql-tag'\nimport { ModelInfo as GraphModelInfo } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Model } from '../../types'\n\nexport const fetchModelByIdQuery = gql`\n  query ($modelId: Int!) {\n    modelInfo(modelId: $modelId) {\n      modelId\n      modelName\n      modelTypeName\n      abbreviation\n      isActive\n      fixedCount\n      predictorCount\n\n      modelTypeId\n      translationId\n      translationName\n      extentDescription\n      codeFunction\n      codeFunction2\n      platform\n      referenceSites\n      groupCount\n      minimumCount\n      oeMean\n      oeStdev\n      taxonomicEffort\n      description\n      predictorIds\n      metricIds\n    }\n  }\n`\n\nexport const fetchModelById =\n  (api: Api) =>\n  async (modelId: number): Promise<Model | null> => {\n    const data = await api.query<{\n      modelInfo: GraphModelInfo\n    }>(fetchModelByIdQuery, { modelId })\n\n    if (!data.modelInfo) return null\n\n    const { modelId: id, modelName: name, modelTypeName: typeName, modelTypeId: typeId, ...rest } = data.modelInfo\n\n    return deNull(\n      {\n        id,\n        name,\n        typeName,\n        typeId,\n        ...rest,\n      },\n      {\n        codeFunction: '',\n        codeFunction2: '',\n        description: '',\n        predictorIds: [],\n        metricIds: [],\n      }\n    )\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, ModelResult as GraphModelResult } from '@namcbugdb/common'\nimport { sortBy } from 'lodash'\n\nimport { Api } from '../api'\nimport { ModelResult } from '../../types'\n\nexport const fetchModelResultsBySampleIdQuery = gql`\n  query ($sampleId: Int!, $offset: Int) {\n    modelResults(sampleIds: [$sampleId], limit: 1000, offset: $offset) {\n      records {\n        modelId\n        modelName\n        modelResult\n        fixedCount\n        condition\n        notes\n        updatedDate\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchModelResultsBySampleId =\n  (api: Api) =>\n  async (sampleId: number): Promise<ModelResult[]> => {\n    const data = await api.queryAllPages<{\n      modelResults: PaginatedRecords<GraphModelResult>\n    }>(fetchModelResultsBySampleIdQuery, { sampleId }, { dataProperty: 'modelResults' })\n\n    return sortBy(\n      data.modelResults.records,\n      (record) => record.updatedDate || '0' // after reverse, final sort is reverse-chronological with blanks at bottom\n    ).reverse()\n  }\n","import gql from 'graphql-tag'\nimport { Model as GraphModel } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { Model } from '../../types'\n\nexport const fetchModelsQuery = gql`\n  query ($offset: Int!) {\n    models(limit: 500, offset: $offset) {\n      records {\n        modelId\n        modelName\n        modelTypeName\n        abbreviation\n        translationName\n        isActive\n        fixedCount\n        predictorCount\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchModels = (api: Api) => async (): Promise<Model[]> => {\n  const data = await api.queryAllPages<{ models: { records: GraphModel[] } }>(\n    fetchModelsQuery,\n    {},\n    { dataProperty: 'models' }\n  )\n\n  return data.models.records.map(({ modelId: id, modelName: name, modelTypeName: typeName, ...rest }) => ({\n    id,\n    name,\n    typeName,\n    ...rest,\n  }))\n}\n","import gql from 'graphql-tag'\nimport { Profile as GraphProfile } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { User, UserPermissions } from '../../types'\n\nexport const fetchMyUserQuery = gql`\n  query {\n    myProfile {\n      id\n      firstName\n      lastName\n      email\n      phone\n      permissions\n      affiliationId\n      organizationName\n      roleIds\n    }\n  }\n`\n\nexport const fetchMyUser = (api: Api) => async (): Promise<(User & { permissions: UserPermissions }) | null> => {\n  const data = await api.query<{\n    myProfile: GraphProfile | null\n  }>(fetchMyUserQuery)\n  const { myProfile } = data\n\n  if (!myProfile) return null\n\n  return {\n    ...myProfile,\n    permissions: myProfile.permissions || {},\n    fullName: `${myProfile.firstName} ${myProfile.lastName}`,\n  }\n}\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, SampleTaxaInfo as GraphSampleTaxaInfo } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { Organism } from '../../types'\n\nexport const fetchOrganismsBySampleIdQuery = gql`\n  query ($sampleId: Int!, $offset: Int) {\n    sampleTaxa(sampleIds: [$sampleId], limit: 1000, offset: $offset) {\n      records {\n        sampleId\n        organismId\n        lifeStageId\n        taxonomyId\n        levelId\n        levelName\n        splitCount\n        bigRareCount\n        noteTypeIds\n        comments\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchOrganismsBySampleId =\n  (api: Api) =>\n  async (sampleId: number): Promise<Organism[]> => {\n    const data = await api.queryAllPages<{\n      sampleTaxa: PaginatedRecords<GraphSampleTaxaInfo>\n    }>(fetchOrganismsBySampleIdQuery, { sampleId }, { dataProperty: 'sampleTaxa' })\n\n    return data.sampleTaxa.records.map((organism) => ({\n      ...organism,\n      id: organism.organismId,\n      taxonId: organism.taxonomyId,\n      noteTypeIds: organism.noteTypeIds.filter((noteTypeId) => noteTypeId !== null),\n    }))\n  }\n","import gql from 'graphql-tag'\nimport { Organization as GraphOrganization } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Organization } from '../../types'\nimport { transformOrganization } from '.'\n\nexport const fetchOrganizationByIdQuery = gql`\n  query ($organizationId: Int) {\n    organizationsById(ids: [$organizationId]) {\n      records {\n        entityId\n        parentEntityId\n        organizationName\n        organizationType\n        organizationTypeId\n        entityId\n        address1\n        address2\n        city\n        usState\n        usStateId\n        country\n        countryId\n        zipCode\n        phone\n        userCount\n      }\n    }\n  }\n`\n\nexport const fetchOrganizationById =\n  (api: Api) =>\n  async (organizationId: number): Promise<Organization | null> => {\n    const data = await api.query<{ organizationsById: { records: GraphOrganization[] } }>(fetchOrganizationByIdQuery, {\n      organizationId,\n    })\n    const organization = data.organizationsById.records[0]\n    if (!organization) return null\n    return deNull(transformOrganization(organization), {\n      name: '',\n      type: '',\n      // typeId,\n      // id,\n      address1: '',\n      address2: '',\n      city: '',\n      usState: '',\n      // usStateId,\n      country: '',\n      // countryId,\n      zipCode: '',\n      phone: '',\n      userCount: 0,\n    })\n  }\n","import gql from 'graphql-tag'\nimport { Organization as GraphOrganization } from '@namcbugdb/common'\nimport { sortBy } from 'lodash'\n\nimport { Api, deNull } from '../api'\nimport { Organization } from '../../types'\n\nexport const fetchOrganizationsQuery = gql`\n  query ($offset: Int!) {\n    organizations(limit: 500, offset: $offset) {\n      records {\n        entityId\n        organizationName\n        parentEntityId\n        city\n        usState\n        usStateId\n        organizationType\n        phone\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const transformOrganization = ({\n  entityId: id,\n  parentEntityId: parentId,\n  organizationName: name,\n  organizationType: type,\n  organizationTypeId: typeId,\n  city,\n  ...restOrganization\n}: GraphOrganization): Organization =>\n  deNull(\n    {\n      id,\n      parentId,\n      name,\n      type,\n      typeId,\n      city,\n      ...restOrganization,\n    },\n    { city: '' }\n  )\n\nexport const fetchOrganizations = (api: Api) => async (): Promise<Organization[]> => {\n  const data = await api.queryAllPages<{ organizations: { records: GraphOrganization[] } }>(\n    fetchOrganizationsQuery,\n    {},\n    { dataProperty: 'organizations' }\n  )\n\n  return sortBy(data.organizations.records.map(transformOrganization), (organization) => organization.name)\n}\n","import gql from 'graphql-tag'\nimport { Predictor as GraphPredictor } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Predictor } from '../../types'\n\nexport const fetchPredictorsQuery = gql`\n  query ($offset: Int!) {\n    predictors(limit: 500, offset: $offset) {\n      records {\n        abbreviation\n        calculation\n        calculationScript\n        cellRepresents\n        cellSize\n        description\n        geometryFilePath\n        inputType\n        isGee\n        isTemporal\n        isText\n        maxValue\n        minValue\n        modelCount\n        notes\n        predictorId # -> id\n        predictorName # -> name\n        predictorType # -> type\n        predictorTypeId # -> type\n        smallShedException\n        source\n        transformation\n        units\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchPredictors = (api: Api) => async (): Promise<Predictor[]> => {\n  const data = await api.queryAllPages<{ predictors: { records: GraphPredictor[] } }>(\n    fetchPredictorsQuery,\n    {},\n    { dataProperty: 'predictors' }\n  )\n\n  return data.predictors.records.map(\n    ({ predictorId: id, predictorName: name, predictorType: type, predictorTypeId: typeId, ...rest }) =>\n      deNull(\n        {\n          id,\n          name,\n          type,\n          typeId,\n          ...rest,\n        },\n        {\n          calculation: '',\n          calculationScript: '',\n          cellRepresents: '',\n          cellSize: '',\n          description: '',\n          geometryFilePath: '',\n          inputType: '',\n          isGee: '',\n          isText: '',\n          notes: '',\n          smallShedException: '',\n          source: '',\n          transformation: '',\n        }\n      )\n  )\n}\n","import gql from 'graphql-tag'\nimport { Project as GraphProject } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Project } from '../../types'\n\nexport const fetchProjectsQuery = gql`\n  query ($offset: Int!) {\n    projects(limit: 500, offset: $offset) {\n      records {\n        projectId\n        projectName\n        contactId\n        contactName\n        description\n        sampleCount\n        modelIds\n        createdDate\n        updatedDate\n        isPrivate\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchProjects = (api: Api) => async (): Promise<Project[]> => {\n  const data = await api.queryAllPages<{ projects: { records: GraphProject[] } }>(\n    fetchProjectsQuery,\n    {},\n    { dataProperty: 'projects' }\n  )\n\n  return data.projects.records.map(({ projectId: id, projectName: name, ...rest }) =>\n    deNull(\n      {\n        id,\n        name,\n        ...rest,\n      },\n      { contactName: '', description: '' }\n    )\n  )\n}\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { SourceSample } from '../../types'\nimport { transformSourceSample } from './fetchBoxSamplesByBoxId'\n\nexport const fetchProjectSamplesByProjectIdQuery = gql`\n  query ($projectId: Int!, $offset: Int) {\n    samples(limit: 1000, offset: $offset, projectId: $projectId) {\n      records {\n        sampleId\n        sampleDate\n        usState\n        sampleType\n        sampleMethod\n        sorterName\n        sortStartDate\n        sortEndDate\n        idErName\n        idStartDate\n        idEndDate\n        customerSiteCode\n        visitId\n        siteName\n        siteId\n        area\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchProjectSamplesByProjectId =\n  (api: Api) =>\n  async (projectId: number): Promise<SourceSample[]> => {\n    const data = await api.queryAllPages<{\n      samples: PaginatedRecords<GraphSample>\n    }>(fetchProjectSamplesByProjectIdQuery, { projectId }, { dataProperty: 'samples' })\n\n    return data.samples.records.map(transformSourceSample)\n  }\n","import gql from 'graphql-tag'\n\nimport { Api } from '../api'\nimport { ReportDataRow } from '../../types'\n\nexport const fetchReportDataByReportIdQuery = gql`\n  query ($reportId: Int!, $offset: Int!) {\n    reportData(reportId: $reportId, limit: 500, offset: $offset) {\n      records\n      nextOffset\n    }\n  }\n`\n\nexport const fetchReportDataByReportId =\n  (api: Api) =>\n  async (reportId: number): Promise<ReportDataRow[]> => {\n    const data = await api.queryAllPages<{ reportData: { records: { jsonData: ReportDataRow }[] } }>(\n      fetchReportDataByReportIdQuery,\n      { reportId },\n      { dataProperty: 'reportData' }\n    )\n\n    return data.reportData.records.map(({ jsonData }) => jsonData)\n  }\n","import gql from 'graphql-tag'\nimport { Report as GraphReport } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Report } from '../../types'\n\nexport const fetchReportsQuery = gql`\n  query ($offset: Int!) {\n    reports(limit: 500, offset: $offset) {\n      records {\n        reportId\n        reportName\n        description\n        isActive\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchReports = (api: Api) => async (): Promise<Report[]> => {\n  const data = await api.queryAllPages<{ reports: { records: GraphReport[] } }>(\n    fetchReportsQuery,\n    {},\n    { dataProperty: 'reports' }\n  )\n\n  return data.reports.records\n    .filter(({ isActive }) => isActive)\n    .map(({ reportId: id, reportName: name, ...rest }) =>\n      deNull(\n        { id, name, ...rest },\n        {\n          name: '',\n          description: '',\n        }\n      )\n    )\n}\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Sample as GraphSample } from '@namcbugdb/common'\n\nimport { Api, ApiError, deNull } from '../api'\nimport { Sample } from '../../types'\n\nexport const fetchSampleByIdQuery = gql`\n  query ($sampleId: Int!) {\n    samples(sampleIds: [$sampleId]) {\n      records {\n        area\n        boxId\n        boxState\n        customerName\n        customerSiteCode\n        designTypeId\n        ecosystemId\n        effortTypeId\n        elutriation\n        fieldNotes\n        fieldSplit\n        habitatId\n        idEndDate # -> identificationEndDate\n        idErId # -> identifierId\n        idErName # -> identifierName\n        idStartDate # -> identificationStartDate\n        jarCount\n        labNotes\n        labSplit\n        measurements\n        mesh\n        sampleDate\n        sampleId # -> id\n        sampleLatitude\n        sampleLongitude\n        sampleMethodId\n        sampleType # -> sampleTypeName\n        siteId\n        siteName\n        sortEndDate\n        sorterCount\n        sorterId\n        sorterName\n        sortStartDate\n        sortTime\n        submittedBy # -> submittedByName\n        usState\n        visitId\n      }\n    }\n  }\n`\n\nexport const fetchSampleById =\n  (api: Api) =>\n  async (sampleId: number): Promise<Sample | null> => {\n    try {\n      const data = await api.query<{\n        samples: PaginatedRecords<GraphSample>\n      }>(fetchSampleByIdQuery, { sampleId })\n\n      const sample = data.samples.records[0]\n      if (!sample) return null\n\n      const {\n        idEndDate: identificationEndDate,\n        idErId: identifierId,\n        idErName: identifierName,\n        idStartDate: identificationStartDate,\n        sampleId: id,\n        sampleType: sampleTypeName,\n        submittedBy: submittedByName,\n        ...restSample\n      } = sample\n\n      return deNull(\n        {\n          ...restSample,\n          identificationEndDate,\n          identifierId,\n          identifierName,\n          identificationStartDate,\n          id,\n          sampleTypeName,\n          submittedByName,\n        },\n        {\n          customerSiteCode: '',\n          fieldNotes: '',\n          labNotes: '',\n          visitId: '',\n        }\n      )\n    } catch (err) {\n      if (err instanceof ApiError && err.message === 'Record not found') return null\n      throw err\n    }\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, SamplePredictorValue as GraphSamplePredictorValue } from '@namcbugdb/common'\nimport { sortBy } from 'lodash'\n\nimport { Api } from '../api'\nimport { SamplePredictorValue } from '../../types'\n\nexport const fetchSamplePredictorValuesBySampleIdQuery = gql`\n  query ($sampleId: Int!, $offset: Int) {\n    samplePredictorValues(sampleIds: [$sampleId], limit: 1000, offset: $offset) {\n      records {\n        predictorName\n        predictorId\n        abbreviation\n        predictorValue\n        isTemporal\n        predictorValueUpdatedDate\n        status\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchSamplePredictorValuesBySampleId =\n  (api: Api) =>\n  async (sampleId: number): Promise<SamplePredictorValue[]> => {\n    const data = await api.queryAllPages<{\n      samplePredictorValues: PaginatedRecords<GraphSamplePredictorValue>\n    }>(fetchSamplePredictorValuesBySampleIdQuery, { sampleId }, { dataProperty: 'samplePredictorValues' })\n\n    return sortBy(\n      data.samplePredictorValues.records.map(({ predictorValueUpdatedDate: updatedDate, status, ...rest }) => ({\n        updatedDate,\n        status: status as SamplePredictorValue['status'],\n        ...rest,\n      })),\n      (record) => record.updatedDate || '0' // after reverse, final sort is reverse-chronological with blanks at bottom\n    ).reverse()\n  }\n","import gql from 'graphql-tag'\nimport { Site as GraphSite } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { Site } from '../../types'\n\nexport const fetchSitesQuery = gql`\n  query ($offset: Int) {\n    mapSites(limit: 10000, offset: $offset) {\n      records {\n        siteId\n        siteName\n        longitude\n        latitude\n        usStateId\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const transformSite = ({ siteId: id, siteName: name, ...rest }: GraphSite): Site => ({\n  id,\n  name,\n  ...rest,\n})\n\nexport const fetchSites = (api: Api) => async (): Promise<Site[]> => {\n  const data = await api.queryAllPages<{ mapSites: { records: GraphSite[] } }>(\n    fetchSitesQuery,\n    {},\n    {\n      dataProperty: 'mapSites',\n    }\n  )\n  const sites = data.mapSites.records\n\n  return sites.map(transformSite)\n}\n","import gql from 'graphql-tag'\nimport { Site as GraphSite } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Site } from '../../types'\nimport { transformSite } from './fetchSites'\n\nexport const fetchSiteDetailByIdQuery = gql`\n  query ($siteId: Int!) {\n    siteInfo(siteId: $siteId) {\n      siteId\n      siteName\n      latitude\n      longitude\n      usStateId\n      sampleCount\n      waterbodyName\n      waterbodyTypeId\n      waterbodyCode\n      description\n      isReference\n      createdDate\n      updatedDate\n    }\n  }\n`\n\nexport const fetchSiteDetailById =\n  (api: Api) =>\n  async (siteId: number): Promise<Site | null> => {\n    const data = await api.query<{ siteInfo: GraphSite }>(fetchSiteDetailByIdQuery, { siteId })\n    const { siteInfo } = data\n    if (!siteInfo) return null\n    return deNull(transformSite(siteInfo), {\n      waterbodyName: '',\n      waterbodyCode: '',\n      description: '',\n      isReference: false,\n    })\n  }\n","import gql from 'graphql-tag'\nimport { Site as GraphSite } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { Site } from '../../types'\nimport { transformSite } from './fetchSites'\n\nexport const fetchSitesByBoxIdQuery = gql`\n  query ($boxId: Int, $offset: Int) {\n    sites(boxIds: [$boxId], limit: 200, offset: $offset) {\n      records {\n        siteId\n        siteName\n        longitude\n        latitude\n        usStateId\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchSitesByBoxId =\n  (api: Api) =>\n  async (boxId: number): Promise<Site[]> => {\n    const data = await api.queryAllPages<{ sites: { records: GraphSite[] } }>(\n      fetchSitesByBoxIdQuery,\n      { boxId },\n      { dataProperty: 'sites' }\n    )\n    const sites = data.sites.records\n\n    return sites.map(transformSite)\n  }\n","import gql from 'graphql-tag'\nimport { Site as GraphSite } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { Site } from '../../types'\nimport { transformSite } from './fetchSites'\n\nexport const fetchSitesByProjectIdQuery = gql`\n  query ($projectId: Int, $offset: Int) {\n    sites(projectIds: [$projectId], limit: 200, offset: $offset) {\n      records {\n        siteId\n        siteName\n        longitude\n        latitude\n        usStateId\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchSitesByProjectId =\n  (api: Api) =>\n  async (projectId: number): Promise<Site[]> => {\n    const data = await api.queryAllPages<{ sites: { records: GraphSite[] } }>(\n      fetchSitesByProjectIdQuery,\n      { projectId },\n      { dataProperty: 'sites' }\n    )\n    const sites = data.sites.records\n\n    return sites.map(transformSite)\n  }\n","import gql from 'graphql-tag'\nimport { Site as GraphSite } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { Site } from '../../types'\nimport { transformSite } from '.'\n\nexport const fetchSitesPageQuery = gql`\n  query ($offset: Int, $limit: Int) {\n    mapSites(offset: $offset, limit: $limit) {\n      records {\n        siteId\n        siteName\n        longitude\n        latitude\n        usStateId\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchSitesPage =\n  (api: Api) =>\n  async (offset: number, limit: number): Promise<{ records: Site[]; nextOffset: number }> => {\n    const data = await api.query<{ mapSites: { records: GraphSite[]; nextOffset: number } }>(fetchSitesPageQuery, {\n      offset,\n      limit,\n    })\n    const records = data.mapSites.records.map(transformSite)\n    const { nextOffset } = data.mapSites\n\n    return { records, nextOffset }\n  }\n","import gql from 'graphql-tag'\nimport { Individual as GraphIndividual } from '@namcbugdb/common'\nimport { sortBy } from 'lodash'\n\nimport { Api } from '../api'\nimport { User } from '../../types'\n\nexport const fetchSorterUsersQuery = gql`\n  query {\n    sorters {\n      id\n      firstName\n      lastName\n    }\n  }\n`\n\nexport const fetchSorterUsers = (api: Api) => async (): Promise<User[]> => {\n  const data = await api.query<{\n    sorters: GraphIndividual[]\n  }>(fetchSorterUsersQuery)\n  const { sorters } = data\n\n  return sortBy(\n    sorters.map((user) => ({ ...user, fullName: `${user.firstName} ${user.lastName}` })),\n    ({ fullName }) => fullName\n  )\n}\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Taxonomy as GraphTaxonomy } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Taxon } from '../../types'\n\nexport const fetchTaxaQuery = gql`\n  query ($offset: Int) {\n    taxonomy(limit: 1000, offset: $offset, searchTerm: \"%\") {\n      records {\n        taxonomyId\n        scientificName\n        levelId\n        levelName\n        synonyms\n        parentTaxonomyId\n        notes\n        isTargetEffort\n        notes\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchTaxa = (api: Api) => async (): Promise<Taxon[]> => {\n  const data = await api.queryAllPages<{\n    taxonomy: PaginatedRecords<GraphTaxonomy>\n  }>(fetchTaxaQuery, {}, { dataProperty: 'taxonomy' })\n  const { records } = data.taxonomy\n\n  return records.map(\n    ({ taxonomyId: id, scientificName: name, parentTaxonomyId: parentId, synonyms: synonymsJson, ...rest }) =>\n      deNull(\n        {\n          id,\n          name,\n          levelRankOrder: 0, // reassigned in selector\n          parentId,\n          synonyms: synonymsJson ? JSON.parse(synonymsJson) : [],\n          ...rest,\n        },\n        { notes: '' }\n      )\n  )\n}\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, TranslationGroup as GraphTranslationGroup } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { TranslationGroup } from '../../types'\n\nexport const fetchTranslationGroupsByTranslationIdQuery = gql`\n  query ($translationId: Int!, $offset: Int!) {\n    translationGroups(translationId: $translationId, offset: $offset, limit: 500) {\n      records {\n        translationGroupId\n        translationScientificName\n        isFinal\n        taxonomyIds\n      }\n      nextOffset\n    }\n  }\n`\n\nconst transformTranslationGroup = ({ translationGroupId: id, ...rest }: GraphTranslationGroup): TranslationGroup => ({\n  id,\n  ...rest,\n})\n\nexport const fetchTranslationGroupsByTranslationId =\n  (api: Api) =>\n  async (translationId: number): Promise<TranslationGroup[]> => {\n    const data = await api.queryAllPages<{\n      translationGroups: PaginatedRecords<GraphTranslationGroup>\n    }>(fetchTranslationGroupsByTranslationIdQuery, { translationId }, { dataProperty: 'translationGroups' })\n\n    return data.translationGroups.records.map((translationGroup) =>\n      deNull(transformTranslationGroup(translationGroup), { taxonomyIds: [] })\n    )\n  }\n","import gql from 'graphql-tag'\nimport { Translation as GraphTranslation } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { Translation } from '../../types'\n\nexport const fetchTranslationsQuery = gql`\n  query ($offset: Int!) {\n    translations(limit: 500, offset: $offset) {\n      records {\n        translationId\n        translationName\n        isActive\n        description\n        taxaCount\n        createdDate\n        updatedDate\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchTranslations = (api: Api) => async (): Promise<Translation[]> => {\n  const data = await api.queryAllPages<{ translations: { records: GraphTranslation[] } }>(\n    fetchTranslationsQuery,\n    {},\n    { dataProperty: 'translations' }\n  )\n\n  return data.translations.records.map(({ translationId: id, translationName: name, ...rest }) =>\n    deNull(\n      {\n        id,\n        name,\n        ...rest,\n      },\n      { description: '' }\n    )\n  )\n}\n","import gql from 'graphql-tag'\nimport { Box as GraphBox } from '@namcbugdb/common'\nimport { sortBy } from 'lodash'\n\nimport { Api } from '../api'\nimport { Box } from '../../types'\nimport { transformBox } from './fetchBoxes'\n\nexport const fetchUserBoxesQuery = gql`\n  query ($offset: Int) {\n    userBoxes(limit: 1000, offset: $offset) {\n      records {\n        boxId\n        customerName\n        customerId\n        createdDate\n        boxReceivedDate\n        submittedBy\n        boxState\n        boxStateId\n        sampleCount\n        midges\n        measurements\n        sortComplete\n        idComplete\n        alias\n        submissionCount\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchUserBoxes = (api: Api) => async (): Promise<Box[]> => {\n  const data = await api.queryAllPages<{ userBoxes: { records: GraphBox[] } }>(\n    fetchUserBoxesQuery,\n    {},\n    { dataProperty: 'userBoxes' }\n  )\n\n  const boxes = (data.userBoxes.records ?? []).map(transformBox)\n\n  return sortBy(boxes, ({ id }) => id).reverse()\n}\n","import gql from 'graphql-tag'\nimport { Individual as GraphIndividual } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../api'\nimport { User } from '../../types'\n\nexport const fetchUserByIdQuery = gql`\n  query ($userId: Int!) {\n    user(id: $userId) {\n      id\n      firstName\n      lastName\n      email\n      phone\n      affiliationId\n      organizationName\n      roleIds\n    }\n  }\n`\n\nexport const fetchUserById =\n  (api: Api) =>\n  async (userId: number): Promise<User | null> => {\n    const data = await api.query<{ user: GraphIndividual }>(fetchUserByIdQuery, { userId })\n    const { user } = data\n    if (!user) return null\n    const fullName = `${user.firstName} ${user.lastName}`\n    return deNull(\n      { fullName, ...data.user },\n      {\n        // id,\n        fullName: '',\n        firstName: '',\n        lastName: '',\n        email: '',\n        phone: '',\n        // affiliationId,\n        organizationName: '',\n        roleIds: [],\n      }\n    )\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, Individual as GraphIndividual } from '@namcbugdb/common'\n\nimport { Api } from '../api'\nimport { User } from '../../types'\n\nexport const fetchUsersQuery = gql`\n  query ($offset: Int) {\n    users(limit: 1000, offset: $offset) {\n      records {\n        id\n        firstName\n        lastName\n        email\n        phone\n        organizationName\n        affiliationId\n        roleIds\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchUsers = (api: Api) => async (): Promise<User[]> => {\n  const data = await api.queryAllPages<{ users: PaginatedRecords<GraphIndividual> }>(\n    fetchUsersQuery,\n    {},\n    { dataProperty: 'users' }\n  )\n  const { records } = data.users\n\n  return records.map((user) => ({\n    fullName: `${user.firstName} ${user.lastName}`,\n    ...user,\n    roleIds: user.roleIds || [],\n    organizationName: user.organizationName || '',\n  }))\n}\n","import gql from 'graphql-tag'\nimport { USState as GraphUSState } from '@namcbugdb/common' // TODO: no type available yet\n\nimport { Api } from '../api'\n\nexport interface fetchUsStateAtCoordinatesParams {\n  latitude: number\n  longitude: number\n}\n\nexport const fetchUsStateAtCoordinatesQuery = gql`\n  query ($latitude: Float!, $longitude: Float!) {\n    getUSState(latitude: $latitude, longitude: $longitude) {\n      id\n      name\n      abbreviation\n    }\n  }\n`\n\nexport const fetchUsStateAtCoordinates =\n  (api: Api) =>\n  async (params: fetchUsStateAtCoordinatesParams): Promise<GraphUSState | null> => {\n    const data = await api.query<{ getUSState: GraphUSState }>(fetchUsStateAtCoordinatesQuery, { ...params })\n    return data.getUSState\n  }\n","import gql from 'graphql-tag'\nimport log from 'loglevel'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport const finalizePendingBoxMutation = gql`\n  mutation ($boxId: Int!) {\n    finalizePendingBox(boxId: $boxId) {\n      success\n      stats\n      errors\n      warnings\n    }\n  }\n`\n\nexport const finalizePendingBox =\n  (api: Api, invalidate: InvalidateFn) =>\n  async ({ boxId }: { boxId: number }): Promise<true> => {\n    const data = await api.mutation<{\n      finalizePendingBox: { success: boolean; errors: string[] }\n    }>(finalizePendingBoxMutation, { boxId })\n\n    const { success, errors } = data.finalizePendingBox\n\n    if (!success) {\n      if (!errors || errors.length === 0) throw new ApiError('unknown error')\n      log.warn(data.finalizePendingBox)\n      throw new ApiError('submission data contained errors')\n    }\n\n    invalidate('boxes')\n    invalidate('boxSamples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface MergeBoxesParams {\n  sourceBoxId: number\n  targetBoxId: number\n}\n\nexport const mergeBoxesMutation = gql`\n  mutation ($sourceBoxId: Int!, $targetBoxId: Int!) {\n    mergeBoxes(sourceBoxId: $sourceBoxId, targetBoxId: $targetBoxId)\n  }\n`\n\nexport const mergeBoxes =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (params: MergeBoxesParams): Promise<true> => {\n    const data = await api.mutation<{\n      mergeBoxes: number // NOTE: TODO what is return?\n    }>(mergeBoxesMutation, { ...params })\n\n    if (!data.mergeBoxes) throw new ApiError('boxes did not merge')\n\n    invalidate('boxes')\n    invalidate('samples')\n    invalidate('boxSamples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface ReconcileParams {\n  boxId: number\n  fromTaxonomyId: number\n  toTaxonomyId: number\n}\n\nexport const reconcileBoxTaxonomyMutation = gql`\n  mutation ($boxId: Int!, $fromTaxonomyId: Int!, $toTaxonomyId: Int!) {\n    taxReconciliation(boxId: $boxId, fromTaxonomyId: $fromTaxonomyId, toTaxonomyId: $toTaxonomyId)\n  }\n`\n\nexport const reconcileBoxTaxonomy =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (params: ReconcileParams): Promise<true> => {\n    const data = await api.mutation<{\n      taxReconciliation: number\n    }>(reconcileBoxTaxonomyMutation, { ...params })\n\n    if (!data.taxReconciliation) throw new ApiError('taxonomy did not reconcile')\n\n    invalidate('boxTaxa')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface RemoveProjectSamplesInput {\n  projectId: number\n  sampleIds: number[]\n}\n\nexport const removeProjectSamplesMutation = gql`\n  mutation ($projectId: Int!, $sampleIds: [Int]) {\n    removeProjectSamples(projectId: $projectId, sampleIds: $sampleIds)\n  }\n`\n\nexport const removeProjectSamples =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (params: RemoveProjectSamplesInput): Promise<true> => {\n    const data = await api.mutation<{\n      removeProjectSamples: number // NOTE: return type is number of samples after operation (0 is not indication of failure)\n    }>(removeProjectSamplesMutation, { ...params })\n\n    if (data.removeProjectSamples === null) throw new ApiError('project samples did not update') // cannot check for falsey due to return type noted above\n\n    invalidate('projectSamples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface SplitBoxParams {\n  boxId: number\n  sampleIds: number[]\n}\n\nexport const splitBoxMutation = gql`\n  mutation ($boxId: Int!, $sampleIds: [Int]!) {\n    splitBox(boxId: $boxId, sampleIds: $sampleIds)\n  }\n`\n\nexport const splitBox =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (params: SplitBoxParams): Promise<number> => {\n    const data = await api.mutation<{\n      splitBox: number // NOTE: new box ID\n    }>(splitBoxMutation, { ...params })\n\n    if (!data.splitBox) throw new ApiError('box did not split')\n\n    invalidate('boxes')\n    invalidate('samples')\n    invalidate('boxSamples')\n    return data.splitBox\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport const startSortMutation = gql`\n  mutation ($sampleId: Int!) {\n    labStartSort(sampleId: $sampleId)\n  }\n`\n\nexport const startSort =\n  (api: Api, invalidate: InvalidateFn) =>\n  async ({ sampleId }: { sampleId: number }): Promise<true> => {\n    const data = await api.mutation<{\n      labStartSort: number // NOTE this is records affected, 1 = success, 0 = failure\n    }>(startSortMutation, { sampleId })\n\n    if (!data.labStartSort) throw new ApiError('sample sorting did not start')\n\n    invalidate('boxes')\n    invalidate('samples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport const startTaxonomyIdentificationMutation = gql`\n  mutation ($sampleId: Int!) {\n    taxIdentificationStart(sampleId: $sampleId)\n  }\n`\n\nexport const startTaxonomyIdentification =\n  (api: Api, invalidate: InvalidateFn) =>\n  async ({ sampleId }: { sampleId: number }): Promise<true> => {\n    const data = await api.mutation<{\n      taxIdentificationStart: number // NOTE this is records affected, 1 = success, 0 = failure\n    }>(startTaxonomyIdentificationMutation, { sampleId })\n\n    if (!data.taxIdentificationStart) throw new ApiError('taxonomy identification did not start')\n\n    invalidate('boxes')\n    invalidate('samples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport const stopSortMutation = gql`\n  mutation ($sampleId: Int!) {\n    labStopSort(sampleId: $sampleId)\n  }\n`\n\nexport const stopSort =\n  (api: Api, invalidate: InvalidateFn) =>\n  async ({ sampleId }: { sampleId: number }): Promise<true> => {\n    const data = await api.mutation<{\n      labStopSort: number // NOTE this is records affected, 1 = success, 0 = failure\n    }>(stopSortMutation, { sampleId })\n\n    if (!data.labStopSort) throw new ApiError('sample sorting did not stop')\n\n    invalidate('boxes')\n    invalidate('samples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport const stopTaxonomyIdentificationMutation = gql`\n  mutation ($sampleId: Int!, $time: Float!) {\n    taxIdentificationStop(sampleId: $sampleId, time: $time)\n  }\n`\n\nexport const stopTaxonomyIdentification =\n  (api: Api, invalidate: InvalidateFn) =>\n  async ({ sampleId, time }: { sampleId: number; time: number }): Promise<true> => {\n    const data = await api.mutation<{\n      taxIdentificationStop: number // NOTE this is records affected, 1 = success, 0 = failure\n    }>(stopTaxonomyIdentificationMutation, { sampleId, time })\n\n    if (!data.taxIdentificationStop) throw new ApiError('taxonomy identification did not stop')\n\n    invalidate('boxes')\n    invalidate('samples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface BoxUpdate {\n  boxId: number\n  boxStateId: number\n  measurements: boolean\n  midges: boolean\n  description: string\n  modelIds: number[]\n  receivedDate: string | null\n}\n\nexport const updateBoxMutation = gql`\n  mutation (\n    $boxId: Int!\n    $boxStateId: Int!\n    $customerId: Int!\n    $alias: String\n    $description: String\n    $measurements: Boolean!\n    $midges: Boolean!\n    $modelIds: [Int]\n    $receivedDate: String\n  ) {\n    setBoxInfo(\n      boxId: $boxId\n      boxStateId: $boxStateId\n      customerId: $customerId\n      alias: $alias\n      description: $description\n      measurements: $measurements\n      midges: $midges\n      models: $modelIds\n      boxReceivedDate: $receivedDate\n    )\n  }\n`\n\nexport const updateBox =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (boxUpdate: BoxUpdate): Promise<true> => {\n    const data = await api.mutation<{\n      setBoxInfo: number // NOTE: count of records changed\n    }>(updateBoxMutation, { ...boxUpdate })\n\n    if (!data.setBoxInfo) throw new ApiError('box did not update')\n\n    invalidate('boxes')\n    invalidate('samples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface LabSortSubmission {\n  sampleId: number\n  sorterId: number\n  sortTime: number\n  sorterCount: number\n  elutriation: boolean\n  labSplit: number\n}\n\nexport const updateLabSortMutation = gql`\n  mutation ($sampleId: Int!, $sorterId: Int!, $count: Int!, $elutriation: Boolean!, $time: Float!, $labSplit: Float!) {\n    labSort(\n      sampleId: $sampleId\n      sorterId: $sorterId\n      count: $count\n      elutriation: $elutriation\n      time: $time\n      labSplit: $labSplit\n    )\n  }\n`\n\nexport const updateLabSort =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (submission: LabSortSubmission): Promise<true> => {\n    const { sortTime: time, sorterCount: count, ...rest } = submission\n    const variables = {\n      time,\n      count,\n      ...rest,\n    }\n    const data = await api.mutation<{\n      labSort: number // NOTE: count of records changed\n    }>(updateLabSortMutation, variables)\n\n    if (!data.labSort) throw new ApiError('sample sorting did not update')\n\n    invalidate('boxes')\n    invalidate('samples')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { MetricInput } from './createMetric'\n\ninterface ExistingMetricInput extends MetricInput {\n  id: number\n}\n\nexport const updateMetricMutation = gql`\n  mutation ($id: Int!, $metric: MetricInput!) {\n    updateMetric(id: $id, metric: $metric)\n  }\n`\n\nexport const updateMetric =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (metric: ExistingMetricInput): Promise<true> => {\n    const { id, name: metricName, groupId: metricGroupId, ...restMetric } = metric\n    const data = await api.mutation<{\n      updateMetric: number // NOTE: id of metric\n    }>(updateMetricMutation, {\n      id,\n      metric: {\n        metricName,\n        metricGroupId,\n        ...restMetric,\n      },\n    })\n\n    if (!data.updateMetric) throw new ApiError('metric did not update')\n\n    invalidate('metrics')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { ModelInput } from './createModel'\n\ninterface ExistingModelInput extends ModelInput {\n  id: number\n}\n\nexport const updateModelMutation = gql`\n  mutation ($id: Int!, $model: ModelInput!) {\n    updateModel(id: $id, model: $model)\n  }\n`\n\nexport const updateModel =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (model: ExistingModelInput): Promise<true> => {\n    const { id, name: modelName, typeId: modelTypeId, taxonomicEffort, ...restModel } = model\n    const data = await api.mutation<{\n      updateModel: number // NOTE: id of model\n    }>(updateModelMutation, {\n      id,\n      model: {\n        modelName,\n        modelTypeId,\n        taxonomicEffort: taxonomicEffort || null,\n        ...restModel,\n      },\n    })\n\n    if (!data.updateModel) throw new ApiError('model did not update')\n\n    invalidate('models')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { OrganizationInput } from './createOrganization'\n\ninterface ExistingOrganizationInput extends OrganizationInput {\n  id: number\n}\n\nexport const updateOrganizationMutation = gql`\n  mutation ($id: Int!, $organization: OrganizationInput!) {\n    updateOrganization(id: $id, organization: $organization)\n  }\n`\n\nexport const updateOrganization =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (organization: ExistingOrganizationInput): Promise<true> => {\n    const { id, name: organizationName, typeId: organizationTypeId, ...restOrganization } = organization\n    const data = await api.mutation<{\n      updateOrganization: number // NOTE: id of organization\n    }>(updateOrganizationMutation, {\n      id,\n      organization: {\n        organizationName,\n        organizationTypeId,\n        ...restOrganization,\n      },\n    })\n\n    if (!data.updateOrganization) throw new ApiError('organization did not update')\n\n    invalidate('organizations')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { PredictorInput } from './createPredictor'\n\ninterface ExistingPredictorInput extends PredictorInput {\n  id: number\n}\n\nexport const updatePredictorMutation = gql`\n  mutation ($id: Int!, $predictor: PredictorInput!) {\n    updatePredictor(id: $id, predictor: $predictor)\n  }\n`\n\nexport const updatePredictor =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (predictor: ExistingPredictorInput): Promise<true> => {\n    const { id, name: predictorName, typeId: predictorTypeId, ...restPredictor } = predictor\n    const data = await api.mutation<{\n      updatePredictor: number // NOTE: id of predictor\n    }>(updatePredictorMutation, {\n      id,\n      predictor: {\n        predictorName,\n        predictorTypeId,\n        ...restPredictor,\n      },\n    })\n\n    if (!data.updatePredictor) throw new ApiError('predictor did not update')\n\n    invalidate('predictors')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { ProjectInput } from './createProject'\n\ninterface ExistingProjectInput extends ProjectInput {\n  id: number\n}\n\nexport const updateProjectMutation = gql`\n  mutation ($id: Int!, $project: ProjectInput!) {\n    updateProject(id: $id, project: $project)\n  }\n`\n\nexport const updateProject =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (project: ExistingProjectInput): Promise<true> => {\n    const { id, name: projectName, ...restProject } = project\n    const data = await api.mutation<{\n      updateProject: number // NOTE: id of project\n    }>(updateProjectMutation, {\n      id,\n      project: {\n        projectName,\n        ...restProject,\n      },\n    })\n\n    if (!data.updateProject) throw new ApiError('project did not update')\n\n    invalidate('projects')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface SampleInput {\n  id: number\n\n  // updatable fields\n  area: number | null\n  customerSiteCode: string\n  designTypeId: number | null\n  ecosystemId: number | null\n  effortTypeId: number | null\n  fieldNotes: string\n  fieldSplit: number\n  habitatId: number\n  jarCount: number\n  labNotes: string\n  mesh: number | null\n  sampleDate: string\n  sampleLatitude: number | null\n  sampleLongitude: number | null\n  sampleMethodId: number\n  siteId: number\n  visitId: string\n}\n\nexport const updateSampleMutation = gql`\n  mutation ($id: Int!, $sample: SampleInput!) {\n    updateSample(id: $id, sample: $sample)\n  }\n`\n\nexport const updateSample =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (sample: SampleInput): Promise<true> => {\n    const { id, ...restSample } = sample\n    const data = await api.mutation<{\n      updateSample: number // NOTE: records changed\n    }>(updateSampleMutation, {\n      id,\n      sample: restSample,\n    })\n\n    if (!data.updateSample) throw new ApiError('sample did not update')\n\n    invalidate('samples')\n    invalidate('boxSamples')\n    invalidate('projectSamples')\n    return true\n  }\n","import gql from 'graphql-tag'\nimport { Submission } from '../../types'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\ninterface UpdatedSampleSubmission {\n  boxId: number\n  data: Pick<Submission, 'templateVersion' | 'appVersion' | 'samples' | 'newSites'>\n}\n\nexport const updateSampleSubmissionMutation = gql`\n  mutation ($boxId: Int!, $data: JSONObject!) {\n    updateSampleSubmission(boxId: $boxId, data: $data)\n  }\n`\n\nexport const updateSampleSubmission =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (submission: UpdatedSampleSubmission): Promise<true> => {\n    const data = await api.mutation<{\n      updateSampleSubmission: number | null // TODO: what?\n    }>(updateSampleSubmissionMutation, { ...submission, data: JSON.stringify(submission.data) })\n\n    if (!data.updateSampleSubmission) throw new ApiError('submission did not update')\n\n    invalidate('boxes')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { SiteInput } from './createSite'\n\ninterface ExistingSiteInput extends SiteInput {\n  id: number\n}\n\nexport const updateSiteMutation = gql`\n  mutation ($id: Int!, $site: SiteInput!) {\n    updateSite(id: $id, site: $site)\n  }\n`\n\nexport const updateSite =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (site: ExistingSiteInput): Promise<true> => {\n    const { id, name: siteName, ...restSite } = site\n    const data = await api.mutation<{\n      updateSite: number // NOTE: id of site\n    }>(updateSiteMutation, {\n      id,\n      site: {\n        siteName,\n        ...restSite,\n      },\n    })\n\n    if (!data.updateSite) throw new ApiError('site did not update')\n\n    invalidate('sites')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\nimport { TaxonInput } from './createTaxon'\n\ninterface ExistingTaxonInput extends TaxonInput {\n  id: number\n}\n\nexport const updateTaxonMutation = gql`\n  mutation ($id: Int!, $taxon: TaxonomyInput!) {\n    setTaxonomy(id: $id, taxonomy: $taxon)\n  }\n`\n\nexport const updateTaxon =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (taxon: ExistingTaxonInput): Promise<true> => {\n    const { id, name: scientificName, ...restTaxon } = taxon\n    const data = await api.mutation<{\n      setTaxonomy: number // NOTE: count of records changed\n    }>(updateTaxonMutation, {\n      id,\n      taxon: {\n        scientificName,\n        ...restTaxon,\n      },\n    })\n\n    if (!data.setTaxonomy) throw new ApiError('taxon did not update')\n\n    invalidate('taxa')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { TranslationGroupInput } from './createTranslationGroup'\n\ninterface ExistingTranslationGroupInput extends Omit<TranslationGroupInput, 'translationId'> {\n  id: number\n}\n\nexport const updateTranslationGroupMutation = gql`\n  mutation ($id: Int!, $translationGroup: TranslationGroupInput!) {\n    updateTranslationGroup(id: $id, translationGroup: $translationGroup)\n  }\n`\n\nexport const updateTranslationGroup =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (translationGroup: ExistingTranslationGroupInput): Promise<true> => {\n    const { id, ...restGroup } = translationGroup\n    const data = await api.mutation<{\n      updateTranslationGroup: number // NOTE: number of records changed\n    }>(updateTranslationGroupMutation, { id, translationGroup: restGroup })\n\n    if (!data.updateTranslationGroup) throw new ApiError('translation group did not update')\n\n    invalidate('translations')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { UserInput } from './createOrganizationWithUser'\n\ninterface ExistingUserInput extends UserInput {\n  id: number\n}\n\nexport const updateUserMutation = gql`\n  mutation ($id: Int!, $user: IndividualInput!) {\n    updateUser(id: $id, user: $user)\n  }\n`\n\nexport const updateUser =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (user: ExistingUserInput, isSelf: boolean): Promise<true> => {\n    const { id, ...restUser } = user\n    const data = await api.mutation<{\n      updateUser: number // NOTE: id of user\n    }>(updateUserMutation, { id, user: restUser })\n\n    if (!data.updateUser) throw new ApiError('user did not update')\n\n    invalidate(isSelf ? 'myUser' : 'users')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport const updateUserRolesMutation = gql`\n  mutation ($id: Int!, $roleIds: [Int]!) {\n    updateUserRoles(userId: $id, roleIds: $roleIds)\n  }\n`\n\nexport const updateUserRoles =\n  (api: Api, invalidate: InvalidateFn) =>\n  async ({ id, roleIds }: { id: number; roleIds: number[] }): Promise<true> => {\n    const data = await api.mutation<{\n      updateUserRoles: number // NOTE: id of user\n    }>(updateUserRolesMutation, { id, roleIds })\n\n    if (!data.updateUserRoles) throw new ApiError('user roles did not update')\n\n    invalidate('users')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { UnpersistedOrganism, Organism } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const upsertOrganismMutation = gql`\n  mutation (\n    $sampleId: Int!\n    $taxonId: Int!\n    $lifeStageId: Int!\n    $splitCount: Int!\n    $bigRareCount: Int\n    $comments: String\n    $noteTypeIds: [Int]\n  ) {\n    createSampleTaxaInfo(\n      sampleId: $sampleId\n      taxonomyId: $taxonId\n      lifeStageId: $lifeStageId\n      splitCount: $splitCount\n      comments: $comments\n      noteTypeIds: $noteTypeIds\n      bigRareCount: $bigRareCount\n    )\n  }\n`\n\nexport const upsertOrganism =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (organism: UnpersistedOrganism | Organism): Promise<number> => {\n    const data = await api.mutation<{\n      createSampleTaxaInfo: number\n    }>(upsertOrganismMutation, { lifeStageId: -1, ...organism })\n\n    const id = data.createSampleTaxaInfo\n    if (!id) throw new ApiError('organism record did not create or update')\n\n    invalidate('samples')\n    return id\n  }\n","import { sortBy } from 'lodash'\nimport { constSelector, selector } from 'recoil'\nimport { Lookups } from '@namcbugdb/common'\n\nimport { apiState } from '../api'\nimport { fetchLookups } from '../calls'\n\nexport const lookupListToOptions = (lookup: { id: number; name: string }[]): { value: number; label: string }[] =>\n  lookup.map(({ id: value, name: label }) => ({ value, label }))\n\nexport const lookupListToNames = (lookup: { name: string }[]): string[] => lookup.map(({ name }) => name)\n\nexport const selectLookups = selector<Lookups>({\n  key: 'selectors/selectLookups',\n  get: async ({ get }) => {\n    const api = get(apiState)\n    return fetchLookups(api)()\n  },\n})\n\nexport const selectTaxaLevels = selector({\n  key: 'selectors/selectTaxaLevels',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).taxa?.taxaLevels\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport enum TAXA_LEVEL_ID {\n  kingdom = 1,\n  phylum = 5,\n  class = 9,\n  subclass = 10,\n  order = 13,\n  family = 19,\n  genus = 23,\n  species = 25,\n}\n\nexport const selectLifeStages = selector({\n  key: 'selectors/selectLifeStages',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).taxa?.lifeStages\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectNoteTypes = selector({\n  key: 'selectors/selectNoteTypes',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).sample?.noteTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectBoxStates = selector({\n  key: 'selectors/selectBoxStates',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).sample?.boxStates\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport enum BOX_STATE_ID {\n  // acceptable hardcoding: https://github.com/namc-utah/namc-bug-db/issues/449#issuecomment-1007606364\n  pending = 1,\n  active = 5,\n  complete = 6,\n}\n\nexport const selectSampleMethods = selector({\n  key: 'selectors/selectSampleMethods',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).sample?.sampleMethods\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectSampleTypes = selector({\n  key: 'selectors/selectSampleTypes',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).sample?.sampleTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectTowTypeNames = selector({\n  key: 'selectors/selectTowTypeNames',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).sample?.towTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectEffortTypes = selector({\n  key: 'selectors/selectEffortTypes',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).sample?.effortTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectDesignTypes = selector({\n  key: 'selectors/selectDesignTypes',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).sample?.designTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectHabitats = selector({\n  key: 'selectors/selectHabitats',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).geo?.habitats\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectEcosystems = selector({\n  key: 'selectors/selectEcosystems',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).geo?.ecosystems\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectWaterbodyTypes = selector({\n  key: 'selectors/selectWaterbodyTypes',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).geo?.waterbodyTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectUsStates = selector({\n  key: 'selectors/selectUsStates',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).geo?.states\n    if (!lookup) throw new Error('Missing lookup in query')\n    return sortBy(lookup, ({ name }) => name)\n  },\n})\n\nexport const selectUsCountryId = selector<number>({\n  key: 'selectors/selectUsCountryId',\n  get: async ({ get }) => {\n    const countries = get(selectLookups).geo?.countries ?? []\n    const usCountryId = countries.find((country) => country.name === 'United States')?.id\n    if (!usCountryId) throw new Error('failed to determine United States country ID')\n    return usCountryId\n  },\n})\n\nexport const selectRoles = selector({\n  key: 'selectors/selectRoles',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).entity?.roles\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectSystemAdminRoleLevel = constSelector<number>(0)\n\nexport const selectDefaultOrganizationTypeId = selector<number>({\n  key: 'selectors/selectDefaultOrganizationTypeId',\n  get: async ({ get }) => {\n    const organizationTypes = get(selectLookups).entity?.organizationTypes ?? []\n    const defaultOrganizationTypeId = organizationTypes.find(\n      (organizationType) => organizationType.name === 'Other' // TODO: should this be \"unknown\"? Can I just hardcode this like Box State?\n    )?.id\n    if (!defaultOrganizationTypeId) throw new Error('failed to determine default organization type')\n    return defaultOrganizationTypeId\n  },\n})\n\nexport const selectFishDietSpecies = selector({\n  key: 'selectors/selectFishDietSpecies',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).taxa?.fishDietSpecies\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectSystems = selector({\n  key: 'selectors/selectSystems',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).geo?.systems\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectModelTypes = selector({\n  key: 'selectors/selectModelTypes',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).geo?.modelTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectCalculations = selector({\n  key: 'selectors/selectCalculations',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).metric?.calculations\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectMetricGroups = selector({\n  key: 'selectors/selectMetricGroups',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).metric?.metricGroups\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectMetricReports = selector({\n  key: 'selectors/selectMetricReports',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).metric?.metricReports\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectPredictorTypes = selector({\n  key: 'selectors/selectPredictorTypes',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).geo?.predictorTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n\nexport const selectRarefactionTypes = selector({\n  key: 'selectors/selectRarefactionTypes',\n  get: async ({ get }) => {\n    const lookup = get(selectLookups).metric?.rarefactionTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup\n  },\n})\n","import { useEffect, useRef, useCallback } from 'react'\nimport { atomFamily, RecoilState, useRecoilCallback } from 'recoil'\nimport { allSitesAtom, allSitesStatusAtom, FETCH_ALL_SITES_STATUS, sparseSitesDetailAtom } from './sites'\n\ntype refreshFamily =\n  | 'boxes'\n  | 'boxSamples'\n  | 'boxTaxa'\n  | 'metrics'\n  | 'models'\n  | 'myUser'\n  | 'organizations'\n  | 'predictors'\n  | 'projects'\n  | 'projectSamples'\n  | 'reports'\n  | 'samples'\n  | 'sites'\n  | 'taxa'\n  | 'translations'\n  | 'users'\n\nexport type InvalidateFn = (family: refreshFamily, id?: number) => void\n\nconst refreshOnState = atomFamily<number, string>({\n  key: 'refreshOnState',\n  default: 0,\n})\n\nexport const refreshOn = (family: refreshFamily, id?: number): RecoilState<number> => refreshOnState(`${family}:${id}`)\n\nexport const useInvalidate = (): InvalidateFn =>\n  useRecoilCallback(\n    ({ set }) =>\n      (family: refreshFamily, id?: number) => {\n        set(refreshOn(family, id), (v) => v + 1)\n        if (family === 'sites') {\n          set(allSitesStatusAtom, FETCH_ALL_SITES_STATUS.unfetched)\n          set(allSitesAtom, [])\n          set(sparseSitesDetailAtom, [])\n        }\n      },\n    []\n  )\n\nexport const useManualInvalidate = (): [InvalidateFn, () => void] => {\n  const calls = useRef<[family: refreshFamily, id?: number][]>([]).current\n  const invalidate = useInvalidate()\n\n  const queueInvalidate = useCallback((family: refreshFamily, id?: number) => {\n    calls.push([family, id])\n  }, [])\n\n  const performInvalidate = () => {\n    while (calls.length > 0) {\n      const call = calls.shift()\n      if (!call) return\n      invalidate(...call)\n    }\n  }\n\n  return [queueInvalidate, performInvalidate]\n}\n\nexport const useDeferredInvalidate = (): InvalidateFn => {\n  const [queueInvalidate, performInvalidate] = useManualInvalidate()\n\n  useEffect(\n    () => () => {\n      performInvalidate()\n    },\n    []\n  )\n\n  return queueInvalidate\n}\n","import { selectorFamily } from 'recoil'\n\nimport {\n  GeoJsonPolygonCoordinates,\n  MinimalSample,\n  ModelResult,\n  Organism,\n  Sample,\n  SamplePredictorValue,\n  SourceSample,\n} from '../../types'\nimport { apiState } from '../api'\nimport { refreshOn } from './invalidate'\nimport {\n  fetchBoxSamplesByBoxId,\n  fetchMinimalSamplesByOrganizationId,\n  fetchMinimalSamplesByPolygon,\n  fetchMinimalSamplesBySiteId,\n  fetchMinimalSamplesByTaxonId,\n  fetchMinimalSamplesByUsStateId,\n  fetchModelResultsBySampleId,\n  fetchOrganismsBySampleId,\n  fetchProjectSamplesByProjectId,\n  fetchSampleById,\n  fetchSamplePredictorValuesBySampleId,\n} from '../calls'\n\nexport const selectBoxSamplesByBoxId = selectorFamily<SourceSample[], number>({\n  key: 'selectors/boxSamplesByBoxId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n      get(refreshOn('boxSamples'))\n\n      const api = get(apiState)\n      return fetchBoxSamplesByBoxId(api)(id)\n    },\n})\n\nexport const selectMinimalSamplesByOrganizationId = selectorFamily<MinimalSample[], number>({\n  key: 'selectors/selectMinimalSamplesByOrganizationId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n\n      const api = get(apiState)\n      return fetchMinimalSamplesByOrganizationId(api)(id)\n    },\n})\n\nexport const selectMinimalSamplesByPolygon = selectorFamily<MinimalSample[], GeoJsonPolygonCoordinates>({\n  key: 'selectors/selectMinimalSamplesByPolygon',\n  get:\n    (coordinates) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n\n      const api = get(apiState)\n      return fetchMinimalSamplesByPolygon(api)(coordinates)\n    },\n})\n\nexport const selectMinimalSamplesBySiteId = selectorFamily<MinimalSample[], number>({\n  key: 'selectors/selectMinimalSamplesBySiteId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n\n      const api = get(apiState)\n      return fetchMinimalSamplesBySiteId(api)(id)\n    },\n})\n\nexport const selectMinimalSamplesByTaxonId = selectorFamily<MinimalSample[], number>({\n  key: 'selectors/selectMinimalSamplesByTaxonId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n\n      const api = get(apiState)\n      return fetchMinimalSamplesByTaxonId(api)(id)\n    },\n})\n\nexport const selectMinimalSamplesByUsStateId = selectorFamily<MinimalSample[], number>({\n  key: 'selectors/selectMinimalSamplesByUsStateId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n\n      const api = get(apiState)\n      return fetchMinimalSamplesByUsStateId(api)(id)\n    },\n})\n\nexport const selectModelResultsBySampleId = selectorFamily<ModelResult[], number>({\n  key: 'selectors/selectModelResultsBySampleId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n      get(refreshOn('models'))\n\n      const api = get(apiState)\n      return fetchModelResultsBySampleId(api)(id)\n    },\n})\n\nexport const selectOrganismsBySampleId = selectorFamily<Organism[], number>({\n  key: 'selectors/selectOrganismsBySampleId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n\n      const api = get(apiState)\n      return fetchOrganismsBySampleId(api)(id)\n    },\n})\n\nexport const selectProjectSamplesByProjectId = selectorFamily<SourceSample[], number>({\n  key: 'selectors/selectProjectSamplesByProjectId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n      get(refreshOn('projectSamples'))\n\n      const api = get(apiState)\n      return fetchProjectSamplesByProjectId(api)(id)\n    },\n})\n\nexport const selectSampleById = selectorFamily<Sample | null, number>({\n  key: 'selectors/selectSampleById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n\n      const api = get(apiState)\n      return fetchSampleById(api)(id)\n    },\n})\n\nexport const selectSamplePredictorValuesBySampleId = selectorFamily<SamplePredictorValue[], number>({\n  key: 'selectors/selectSamplePredictorValuesBySampleId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('samples'))\n      get(refreshOn('predictors'))\n\n      const api = get(apiState)\n      return fetchSamplePredictorValuesBySampleId(api)(id)\n    },\n})\n","import { countBy } from 'lodash'\nimport { selector, selectorFamily } from 'recoil'\nimport { USState as GraphUSState } from '@namcbugdb/common'\n// import log from 'loglevel'\n\nimport { apiState } from '../api'\nimport { refreshOn } from './invalidate'\nimport {\n  Attribute,\n  Box,\n  Metric,\n  Model,\n  Organization,\n  Predictor,\n  Project,\n  Report,\n  Submission,\n  Translation,\n} from '../../types'\nimport {\n  fetchActiveBoxes,\n  fetchAttributes,\n  fetchBoxDetailById,\n  fetchBoxes,\n  fetchLatestSubmissionByBoxId,\n  fetchMetrics,\n  fetchModelById,\n  fetchModels,\n  fetchOrganizationById,\n  fetchOrganizations,\n  fetchPredictors,\n  fetchProjects,\n  fetchReports,\n  fetchTranslationGroupsByTranslationId,\n  fetchTranslations,\n  fetchUserBoxes,\n  fetchUsStateAtCoordinates,\n} from '../calls'\n\nexport const selectBoxes = selector<Box[]>({\n  key: 'selectors/boxes',\n  get: async ({ get }) => {\n    get(refreshOn('boxes'))\n    get(refreshOn('boxSamples'))\n\n    const api = get(apiState)\n    return fetchBoxes(api)()\n  },\n})\n\nexport const selectActiveBoxes = selector<Box[]>({\n  key: 'selectors/selectActiveBoxes',\n  get: async ({ get }) => {\n    get(refreshOn('boxes'))\n    get(refreshOn('boxSamples'))\n\n    const api = get(apiState)\n    return fetchActiveBoxes(api)()\n  },\n})\n\nexport const selectUserBoxes = selector<Box[]>({\n  key: 'selectors/selectUserBoxes',\n  get: async ({ get }) => {\n    get(refreshOn('boxes'))\n\n    const api = get(apiState)\n    return fetchUserBoxes(api)()\n  },\n})\n\nexport const selectBoxById = selectorFamily<Box | null, number>({\n  key: 'selectors/boxById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('boxes'))\n\n      const api = get(apiState)\n      return fetchBoxDetailById(api)(id)\n    },\n})\n\nexport const selectPredictors = selector<Predictor[]>({\n  key: 'selectors/predictors',\n  get: async ({ get }) => {\n    get(refreshOn('predictors'))\n\n    const api = get(apiState)\n    return fetchPredictors(api)()\n  },\n})\n\nexport const selectOrganizations = selector<Organization[]>({\n  key: 'selectors/organizations',\n  get: async ({ get }) => {\n    get(refreshOn('organizations'))\n\n    const api = get(apiState)\n    const organizations = await fetchOrganizations(api)()\n    const nameCount = countBy(organizations, 'name')\n    return organizations.map(({ id, name, ...rest }) => ({\n      id,\n      name: nameCount[name] > 1 ? `${name} [${id}]` : name, // add ID where needed to disambiguate\n      ...rest,\n    }))\n  },\n})\n\nexport const selectOrganizationById = selectorFamily<Organization | null, number>({\n  key: 'selectors/selectOrganizationById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('organizations'))\n\n      const api = get(apiState)\n      return fetchOrganizationById(api)(id)\n    },\n})\n\nexport const selectModels = selector<Model[]>({\n  key: 'selectors/models',\n  get: async ({ get }) => {\n    get(refreshOn('models'))\n\n    const api = get(apiState)\n    return fetchModels(api)()\n  },\n})\n\nexport const selectProjects = selector<Project[]>({\n  key: 'selectors/projects',\n  get: async ({ get }) => {\n    get(refreshOn('projects'))\n    get(refreshOn('projectSamples'))\n\n    const api = get(apiState)\n    return fetchProjects(api)()\n  },\n})\n\nexport const selectTranslations = selector<Translation[]>({\n  key: 'selectors/translations',\n  get: async ({ get }) => {\n    get(refreshOn('translations'))\n\n    const api = get(apiState)\n    return fetchTranslations(api)()\n  },\n})\n\nexport const selectTranslationById = selectorFamily<Translation | null, number>({\n  key: 'selectors/selectTranslationById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('translations'))\n\n      const translations = get(selectTranslations)\n      const api = get(apiState)\n\n      const translation = translations.find(({ id: translationId }) => translationId === id)\n      if (!translation) return null\n\n      const groups = await fetchTranslationGroupsByTranslationId(api)(id)\n\n      return { ...translation, groups }\n    },\n})\n\nexport const selectUsStateAtCoordinates = selectorFamily<GraphUSState | null, { latitude: number; longitude: number }>({\n  key: 'selectors/selectUsStateAtCoordinates',\n  get:\n    ({ latitude, longitude }) =>\n    async ({ get }) => {\n      const api = get(apiState)\n      return fetchUsStateAtCoordinates(api)({ latitude, longitude })\n    },\n})\n\nexport const selectLatestSubmissionByBoxId = selectorFamily<Submission | null, number>({\n  key: 'selectors/selectLatestSubmissionByBoxId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('boxes'))\n\n      const api = get(apiState)\n      return fetchLatestSubmissionByBoxId(api)(id)\n    },\n})\n\nexport const selectProjectById = selectorFamily<Project | null, number>({\n  key: 'selectors/selectProjectById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      const projects = get(selectProjects)\n\n      return projects.find((project) => project.id === id) ?? null\n    },\n})\n\nexport const selectNull = selector<null>({\n  key: 'selectors/selectNull',\n  get: () => null,\n})\n\nexport const selectReports = selector<Report[]>({\n  key: 'selectors/selectReports',\n  get: async ({ get }) => {\n    get(refreshOn('reports'))\n\n    const api = get(apiState)\n    return fetchReports(api)()\n  },\n})\n\nexport const selectMetrics = selector<Metric[]>({\n  key: 'selectors/selectMetrics',\n  get: async ({ get }) => {\n    get(refreshOn('metrics'))\n\n    const api = get(apiState)\n    return fetchMetrics(api)()\n  },\n})\n\nexport const selectMetricById = selectorFamily<Metric | null, number>({\n  key: 'selectors/selectMetricById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      const metrics = get(selectMetrics)\n\n      return metrics.find((metric) => metric.id === id) ?? null\n    },\n})\n\nexport const selectModelById = selectorFamily<Model | null, number>({\n  key: 'selectors/selectModelById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('models'))\n\n      const api = get(apiState)\n      return fetchModelById(api)(id)\n    },\n})\n\nexport const selectPredictorById = selectorFamily<Predictor | null, number>({\n  key: 'selectors/selectPredictorById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      const predictors = get(selectPredictors)\n\n      return predictors.find((predictor) => predictor.id === id) ?? null\n    },\n})\n\nexport const selectAttributes = selector<Attribute[]>({\n  key: 'selectors/selectAttributes',\n  get: async ({ get }) => {\n    // get(refreshOn('attributes'))\n\n    const api = get(apiState)\n    return fetchAttributes(api)()\n  },\n})\n","import { sortBy } from 'lodash'\nimport { selector, selectorFamily } from 'recoil'\n\nimport { BoxTaxon, Taxon } from '../../types'\nimport { apiState } from '../api'\nimport { fetchBoxTaxaByBoxId, fetchTaxa } from '../calls'\nimport { refreshOn } from './invalidate'\nimport { selectTaxaLevels } from './lookups'\n\nexport const withDescendantIds = (taxa: Taxon[]): Taxon[] => {\n  const highestLevelRankOrder = taxa.reduce(\n    (highest: number, { levelRankOrder }) => Math.max(highest, levelRankOrder),\n    0\n  )\n\n  const result = taxa.map((taxon) => ({ ...taxon })) // copy array\n\n  let currentLevel = highestLevelRankOrder\n\n  while (currentLevel > 0) {\n    // eslint-disable-next-line no-loop-func\n    result.forEach((taxon) => {\n      if (taxon.levelRankOrder !== currentLevel) return\n\n      const childTaxons = result.filter(({ parentId }) => parentId === taxon.id)\n      taxon.childIds = childTaxons.map(({ id }) => id)\n      taxon.descendantIds = childTaxons.reduce(\n        (acc, { id, descendantIds }) => [...acc, id, ...(descendantIds || [])],\n        [] as number[]\n      )\n    })\n    currentLevel -= 1\n  }\n  return result\n}\n\nexport const selectTaxa = selector<Taxon[]>({\n  key: 'taxa',\n  get: async ({ get }) => {\n    get(refreshOn('taxa'))\n\n    const api = get(apiState)\n    const [taxaLevels, taxa] = await Promise.all([get(selectTaxaLevels), fetchTaxa(api)()])\n\n    return withDescendantIds(\n      sortBy(\n        taxa.map((taxon) => ({\n          ...taxon,\n          levelRankOrder: taxaLevels.find(({ id }) => id === taxon.levelId)?.rankOrder ?? -1,\n        })),\n        (taxon) => taxon.name\n      )\n    )\n  },\n})\n\nexport const selectBoxTaxaByBoxId = selectorFamily<BoxTaxon[], number>({\n  key: 'selectors/selectBoxTaxaByBoxId',\n  get:\n    (boxId) =>\n    async ({ get }) => {\n      get(refreshOn('taxa'))\n      get(refreshOn('boxTaxa'))\n\n      const api = get(apiState)\n      return fetchBoxTaxaByBoxId(api)(boxId)\n    },\n})\n","import { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport { selector, selectorFamily } from 'recoil'\nimport { MyUser, User } from '../../types'\nimport { apiState } from '../api'\nimport { fetchMyUser, fetchSorterUsers, fetchUserById, fetchUsers } from '../calls'\nimport { refreshOn } from './invalidate'\n\nexport const selectHasUser = selector<boolean>({\n  key: 'selectors/selectHasUser',\n  get: async ({ get }) => {\n    const user = get(selectMyUser)\n    return !user.virtual\n  },\n})\n\nexport const selectMyUser = selector<MyUser>({\n  key: 'selectors/selectMyUser',\n  get: async ({ get }) => {\n    get(refreshOn('myUser'))\n\n    const api = get(apiState)\n    const myUser = await fetchMyUser(api)()\n\n    if (!myUser)\n      return {\n        id: -1,\n        affiliationId: -1,\n        email: '',\n        phone: '',\n        firstName: '',\n        lastName: '',\n        fullName: 'New User',\n        hasPermission: () => false,\n        organizationName: '',\n        virtual: true,\n        roleIds: [],\n      }\n\n    const hasPermission = (resource: NAMCResource, grantAction: GrantAction) => {\n      const explicitPermission = !!myUser.permissions[grantAction]?.includes(resource)\n      const implicitPermission = !!myUser.permissions[grantAction.replace('Own', 'Any')]?.includes(resource) // if I have Any, implicitly have Own\n      return explicitPermission || implicitPermission\n    }\n    return { ...myUser, hasPermission }\n  },\n})\n\nexport const selectSorterUsers = selector<User[]>({\n  key: 'selectors/sorterUsers',\n  get: async ({ get }) => {\n    get(refreshOn('users'))\n\n    const api = get(apiState)\n    return fetchSorterUsers(api)()\n  },\n})\n\nexport const selectUserById = selectorFamily<User | null, number>({\n  key: 'selectors/selectUserById',\n  get:\n    (id) =>\n    async ({ get }) => {\n      get(refreshOn('users'))\n\n      const api = get(apiState)\n      return fetchUserById(api)(id)\n    },\n})\n\nexport const selectUsers = selector<User[]>({\n  key: 'selectors/selectUsers',\n  get: async ({ get }) => {\n    get(refreshOn('users'))\n\n    const api = get(apiState)\n    return fetchUsers(api)()\n  },\n})\n","/** @jsxImportSource @emotion/react */\nimport React, { Suspense } from 'react'\nimport { useRecoilValue } from 'recoil'\nimport AccountCircleIcon from '@mui/icons-material/AccountCircle'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { selectMyUser } from '../../data/selectors'\n\nconst Connector = (): JSX.Element => {\n  const user = useRecoilValue(selectMyUser)\n\n  return (\n    <>\n      <AccountCircleIcon /> {user.fullName}\n    </>\n  )\n}\n\nconst Fallback = (): JSX.Element => (\n  <>\n    <MuiSkeleton variant=\"circular\" width={25} />\n    <MuiSkeleton variant=\"text\" width={120} />\n  </>\n)\n\nexport const UserName = (): JSX.Element => (\n  <div css={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '3em' }}>\n    <Suspense fallback={<Fallback />}>\n      <Connector />\n    </Suspense>\n  </div>\n)\n","import React, { Suspense } from 'react'\n\nexport const withSuspense = <T,>(Component: React.FC<T>, Fallback: React.FC<T>): React.FC<T> => {\n  const WrappedComponent: React.FC<T> = (props: T): JSX.Element => (\n    <Suspense fallback={<Fallback {...props} />}>\n      <Component {...props} />\n    </Suspense>\n  )\n  WrappedComponent.displayName = Component.displayName\n  return WrappedComponent\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport { noop, times } from 'lodash'\nimport MuiDrawer from '@mui/material/Drawer'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\n\nimport { UserName } from './UserName'\nimport { useApi } from '../../data/api'\nimport { useNavigate } from '../AppRouter'\nimport { withSuspense } from '../withSuspense'\nimport { selectHasUser, selectMyUser } from '../../data/selectors'\nimport { appVersion } from '../../lib/environment'\n\nexport interface SideNavBarProps {\n  className?: string\n  isOpen: boolean\n  onClose: () => void\n}\n\nconst CenteredDiv = (props) => (\n  <div css={{ display: 'flex', alignItems: 'center', flexDirection: 'column' }} {...props} />\n)\n\nconst Links = withSuspense<{ onClose: () => void }>(\n  ({ onClose }) => {\n    const navigate = useNavigate()\n    const user = useRecoilValue(selectMyUser)\n\n    const links = [\n      {\n        label: 'Boxes',\n        onClick: () => navigate.boxes(),\n        visible: user.hasPermission(NAMCResource.boxes, GrantAction.readOwn),\n      },\n      {\n        label: 'Sites',\n        onClick: () => navigate.sites(),\n        visible: user.hasPermission(NAMCResource.sites, GrantAction.readAny),\n      },\n      {\n        label: 'Customers',\n        onClick: () => navigate.organizations(),\n        visible: user.hasPermission(NAMCResource.organizations, GrantAction.readAny),\n      },\n      {\n        label: 'Projects',\n        onClick: () => navigate.projects(),\n        visible: user.hasPermission(NAMCResource.projects, GrantAction.readAny),\n      },\n      {\n        label: 'Taxonomy',\n        onClick: () => navigate.taxa(),\n        visible: user.hasPermission(NAMCResource.taxonomy, GrantAction.readAny),\n      },\n      {\n        label: 'Models',\n        onClick: () => navigate.models(),\n        visible: user.hasPermission(NAMCResource.models, GrantAction.readAny),\n      },\n      {\n        label: 'Predictors',\n        onClick: () => navigate.predictors(),\n        visible: user.hasPermission(NAMCResource.models, GrantAction.readAny),\n      },\n      {\n        label: 'Translations',\n        onClick: () => navigate.translations(),\n        visible: user.hasPermission(NAMCResource.translations, GrantAction.readAny),\n      },\n      {\n        label: 'Metrics',\n        onClick: () => navigate.metrics(),\n        visible: user.hasPermission(NAMCResource.metrics, GrantAction.readAny),\n      },\n      {\n        label: 'Billing',\n        onClick: noop,\n        disabled: true,\n        visible: user.hasPermission(NAMCResource.billing, GrantAction.readAny),\n      },\n      {\n        label: 'Users',\n        onClick: () => navigate.users(),\n        visible: user.hasPermission(NAMCResource.individuals, GrantAction.readAny),\n      },\n      {\n        label: 'Reports',\n        onClick: () => navigate.reports(),\n        visible: user.hasPermission(NAMCResource.sqlReports, GrantAction.readAny),\n      },\n    ]\n\n    return (\n      <>\n        {links\n          .filter(({ visible }) => visible)\n          .map(({ label, onClick, disabled }) =>\n            disabled ? (\n              <span key={label} css={{ opacity: 0.5 }}>\n                {label}\n              </span>\n            ) : (\n              <a\n                key={label}\n                onClick={() => {\n                  onClick()\n                  onClose()\n                }}\n              >\n                {label}\n              </a>\n            )\n          )}\n      </>\n    )\n  },\n  () => (\n    <>\n      {times(10).map((i) => (\n        <MuiSkeleton key={i} width=\"8em\" />\n      ))}\n    </>\n  )\n)\n\nexport const SideNavBar = withSuspense(\n  ({ className, isOpen, onClose }: SideNavBarProps): JSX.Element => {\n    const api = useApi()\n    const navigate = useNavigate()\n    const hasUser = useRecoilValue(selectHasUser)\n\n    return (\n      <MuiDrawer anchor=\"left\" open={isOpen} onClose={() => onClose()} className={className}>\n        <CenteredDiv css={{ minWidth: '20em', height: '100%' }}>\n          <UserName />\n          <div css={{ display: 'flex', gap: '1em' }}>\n            {hasUser && (\n              <a\n                onClick={() => {\n                  navigate.profile()\n                  onClose()\n                }}\n              >\n                Profile\n              </a>\n            )}\n            <a\n              onClick={() => {\n                api.signOut()\n              }}\n            >\n              Sign Out\n            </a>\n          </div>\n          <div css={{ marginTop: '2em', fontSize: '125%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n            <Links onClose={onClose} />\n          </div>\n          <CenteredDiv\n            css={{\n              marginTop: 'auto',\n              padding: '1em 0',\n              gap: '0.25em',\n            }}\n          >\n            <span>v{appVersion}</span>\n            <a href=\"https://github.com/namc-utah/namc-bug-db/issues/new\" target=\"_blank\" rel=\"noreferrer\">\n              Report Issue\n            </a>\n          </CenteredDiv>\n        </CenteredDiv>\n      </MuiDrawer>\n    )\n  },\n  () => null\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { atom, useRecoilState } from 'recoil'\n\nimport { SideNavBar as Component } from './SideNavBar'\n\nexport const isNavigationOpenState = atom<boolean>({\n  key: 'isNavigationOpen',\n  default: false,\n})\n\nexport const SideNavBar = (): JSX.Element => {\n  const [isOpen, setIsOpen] = useRecoilState(isNavigationOpenState)\n\n  return (\n    <Component\n      isOpen={isOpen}\n      onClose={() => {\n        setIsOpen(false)\n      }}\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect } from 'react'\nimport { useRecoilValue, useSetRecoilState } from 'recoil'\nimport MuiIconButton from '@mui/material/IconButton'\nimport MenuIcon from '@mui/icons-material/Menu'\n\nimport { QuickNavigateField } from '../QuickNavigateField'\nimport { isLocalhost, isStagingApi } from '../../lib/environment'\nimport { selectHasUser } from '../../data/selectors'\nimport { isNavigationOpenState } from '../SideNavBar'\nimport { withSuspense } from '../withSuspense'\n\nexport const AppHeader = withSuspense(\n  (): JSX.Element => {\n    const hasUser = useRecoilValue(selectHasUser)\n    const setIsNavigationOpen = useSetRecoilState(isNavigationOpenState)\n\n    useEffect(() => {\n      if (isLocalhost) {\n        document.title = `${document.title} (local)`\n      } else if (isStagingApi) {\n        document.title = `${document.title} (staging)`\n      }\n    }, [])\n\n    const conditionalVisibility = hasUser ? 'visible' : 'hidden'\n\n    return (\n      <header\n        css={{\n          height: '3em',\n          background: '#064270',\n          color: 'white',\n          display: 'flex',\n          alignItems: 'center',\n          padding: '0 0.5em',\n        }}\n      >\n        <MuiIconButton onClick={() => setIsNavigationOpen(true)}>\n          <MenuIcon sx={{ fill: 'white' }} />\n        </MuiIconButton>\n        <h1 css={{ fontWeight: 500, letterSpacing: '0.05em', fontSize: '200%' }}>\n          INSTAR\n          {isStagingApi && <span css={{ color: 'yellow' }}> STAGING</span>}\n        </h1>\n\n        <div css={{ margin: '0 0.25em 0 auto', visibility: conditionalVisibility }}>\n          <QuickNavigateField css={{ '.MuiInputBase-root': { background: 'white' } }} />\n        </div>\n      </header>\n    )\n  },\n  () => null\n)\n","/* eslint-disable react/prop-types */\nimport React from 'react'\n\ninterface ErrorBoundaryProps {\n  children: React.ReactNode\n}\n\ninterface ErrorState {\n  hasError: boolean\n  message: string\n}\n\nexport class ErrorBoundary extends React.Component {\n  state: ErrorState\n\n  constructor(props: ErrorBoundaryProps) {\n    super(props)\n    this.state = { hasError: false, message: '' }\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorState {\n    return { hasError: true, message: error.toString() }\n  }\n\n  // componentDidCatch(error, errorInfo) {\n  // You can also log the error to an error reporting service\n  // logErrorToMyService(error, errorInfo)\n  // }\n\n  render(): React.ReactNode {\n    if (this.state.hasError) {\n      // You can render any custom fallback UI\n      return (\n        <div>\n          <h1>An error has occurred.</h1>\n          <div>{this.state.message}</div>\n        </div>\n      )\n    }\n\n    return this.props.children\n  }\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiCircularProgress from '@mui/material/CircularProgress'\n\nexport interface FullScreenWaitProps {\n  children: React.ReactNode\n}\n\nexport const FullScreenWait = ({ children }: FullScreenWaitProps): JSX.Element => (\n  <div\n    css={{\n      height: '100vh',\n      width: '100%',\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      justifyContent: 'center',\n      position: 'fixed',\n      zIndex: 1000,\n      backgroundColor: 'ffffff88',\n    }}\n  >\n    <MuiCircularProgress />\n    {children}\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiFormControl from '@mui/material/FormControl'\nimport MuiInputLabel from '@mui/material/InputLabel'\n\nexport interface ReadOnlyFieldProps {\n  className?: string\n  gridArea?: string\n  label?: React.ReactNode\n  minWidth?: string | number\n  value: React.ReactNode\n}\n\nexport const ReadOnlyField = ({\n  className,\n  gridArea,\n  label,\n  minWidth = 195, // match fields, prevent label collapse\n  value,\n}: ReadOnlyFieldProps): JSX.Element => {\n  const displayValue = (() => {\n    if (typeof value === 'boolean') return value ? 'Yes' : 'No'\n    if (!value && value !== 0) return '—'\n    return value\n  })()\n  return (\n    <MuiFormControl className={className} css={{ gridArea }}>\n      <MuiInputLabel shrink>{label}</MuiInputLabel>\n      <div\n        css={{\n          // below to match Material UI; there may be class/es which correctly apply the below with manual CSS\n          minWidth,\n          padding: '8.5px 14px',\n          lineHeight: '1.4375em',\n          letterSpacing: '0.00938em',\n        }}\n      >\n        {displayValue}\n      </div>\n    </MuiFormControl>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiFormControlLabel from '@mui/material/FormControlLabel'\nimport MuiCheckbox from '@mui/material/Checkbox'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CommonFieldProps } from '../../types'\n\ninterface CheckboxFieldProps extends Omit<CommonFieldProps<boolean>, 'error' | 'label'> {\n  label: string\n  valueLabels?: [string, string]\n}\n\nexport const CheckboxField = ({\n  // CommonFieldProps\n  className,\n  disabled,\n  gridArea,\n  onChange,\n  readOnly,\n  value,\n\n  // CheckboxField\n  label,\n  valueLabels = ['No', 'Yes'],\n}: CheckboxFieldProps): JSX.Element => {\n  if (readOnly)\n    return (\n      <ReadOnlyField\n        className={className}\n        gridArea={gridArea}\n        label={label}\n        value={value ? valueLabels[1] : valueLabels[0]}\n      />\n    )\n\n  const handleChange = ({ target: { checked: newValue } }) => {\n    onChange(newValue)\n  }\n\n  return (\n    <MuiFormControlLabel\n      className={className}\n      disabled={disabled}\n      label={label}\n      control={<MuiCheckbox onChange={handleChange} checked={value} />}\n      css={{ gridArea }}\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiTextField, { StandardTextFieldProps } from '@mui/material/TextField'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CommonFieldProps } from '../../types'\n\nexport interface TextFieldProps extends CommonFieldProps<string>, Omit<StandardTextFieldProps, 'value' | 'onChange'> {\n  inputRef?: React.RefObject<HTMLInputElement>\n  maxLength?: number\n}\n\nexport const TextField = ({\n  // CommonFieldProps\n  className,\n  disabled,\n  error,\n  gridArea,\n  label,\n  onChange,\n  readOnly,\n  value,\n\n  // TextField\n  inputRef,\n  maxLength,\n\n  // StandardTextFieldProps\n  inputProps = {},\n  ...restProps\n}: TextFieldProps): JSX.Element => {\n  if (readOnly) return <ReadOnlyField className={className} gridArea={gridArea} label={label} value={value} />\n\n  const handleChange = ({ target: { value: newValue } }) => {\n    onChange(newValue)\n  }\n\n  const combinedInputProps = { ...inputProps, maxLength }\n\n  return (\n    <MuiTextField\n      className={className}\n      disabled={disabled}\n      error={error}\n      label={label}\n      onChange={handleChange}\n      value={value}\n      size=\"small\"\n      inputRef={inputRef}\n      css={{ gridArea }}\n      inputProps={combinedInputProps}\n      {...restProps}\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { Suspense } from 'react'\nimport MuiTextField from '@mui/material/TextField'\nimport MuiAutocomplete from '@mui/material/Autocomplete'\nimport { RecoilValue, useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CommonFieldProps } from '../../types'\n\nexport interface Option<T> {\n  value: T\n  label: string\n  disabled?: boolean\n}\n\ninterface EditableAutocompleteFieldProps<T> extends CommonFieldProps<T | null> {\n  isClearable?: boolean\n  options: Option<T>[]\n  optionsSelector?: never\n  valueLabel?: never\n}\n\ninterface SuspensedEditableAutocompleteFieldProps<T> extends CommonFieldProps<T | null> {\n  options?: never\n  optionsSelector: RecoilValue<Option<T>[]>\n  valueLabel: string | null\n}\n\nexport type AutocompleteFieldProps<T> = CommonFieldProps<T | null> & {\n  isClearable?: boolean\n  label?: string\n} & (EditableAutocompleteFieldProps<T> | SuspensedEditableAutocompleteFieldProps<T>)\n\nconst EditableAutocompleteField = <T,>({\n  // CommonFieldProps\n  className,\n  disabled,\n  error,\n  gridArea,\n  label,\n  onChange,\n  value,\n\n  // EditableAutocompleteFieldProps\n  isClearable,\n  options,\n}: EditableAutocompleteFieldProps<T>): JSX.Element => {\n  const foundValue = options.find((option) => option.value === value) || null\n\n  return (\n    <MuiAutocomplete\n      className={className}\n      // disablePortal\n      options={options}\n      disabled={disabled}\n      getOptionLabel={(option) => option.label}\n      getOptionDisabled={(option) => !!option.disabled}\n      renderInput={(params) => <MuiTextField {...params} label={label} error={error} />}\n      onChange={(event, selected) => {\n        onChange(selected && selected.value)\n      }}\n      size=\"small\"\n      value={foundValue}\n      css={{ gridArea }}\n      disableClearable={!isClearable}\n    />\n  )\n}\n\nconst SuspensedEditableAutocompleteField = <T,>({\n  optionsSelector,\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  valueLabel, // deliberately discarded\n  ...rest\n}: SuspensedEditableAutocompleteFieldProps<T>) => {\n  const options = useRecoilValue(optionsSelector)\n  return <EditableAutocompleteField options={options} {...rest} />\n}\n\nconst mismatchedPropsErrorMessage =\n  'AutocompleteField requires either `options`, or `optionsSelector` with `valueLabel`.'\n\nexport const AutocompleteField = <T,>({\n  options,\n  optionsSelector,\n  readOnly,\n  valueLabel,\n  ...restProps\n}: AutocompleteFieldProps<T>): JSX.Element => {\n  const isFixedType = !!options\n  const isSelectorType = optionsSelector && typeof valueLabel !== 'undefined'\n  if (isFixedType && isSelectorType) throw new Error(mismatchedPropsErrorMessage) // should never be reached\n\n  if (readOnly) {\n    if (isFixedType) {\n      const foundValueLabel = options.find((option) => option.value === restProps.value)?.label ?? ''\n      return <ReadOnlyField {...restProps} value={foundValueLabel} />\n    } else if (isSelectorType) {\n      return <ReadOnlyField {...restProps} value={valueLabel} />\n    }\n  } else {\n    if (isFixedType) {\n      return <EditableAutocompleteField options={options} {...restProps} />\n    } else if (isSelectorType) {\n      return (\n        <Suspense fallback={<ReadOnlyField {...restProps} value={<MuiSkeleton />} />}>\n          <SuspensedEditableAutocompleteField\n            optionsSelector={optionsSelector}\n            valueLabel={valueLabel}\n            {...restProps}\n          />\n        </Suspense>\n      )\n    }\n  }\n\n  throw new Error(mismatchedPropsErrorMessage) // should never be reached\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo, useState, useEffect } from 'react'\nimport { AgGridReact, AgGridReactProps } from 'ag-grid-react'\nimport { ColDef, ColGroupDef, SelectionChangedEvent, GridApi, ColumnApi, GridReadyEvent } from 'ag-grid-community'\n\nimport 'ag-grid-community/dist/styles/ag-grid.css'\n// import 'ag-grid-community/dist/styles/ag-theme-balham.css'\n// import 'ag-grid-community/dist/styles/ag-theme-balham-dark.css'\nimport 'ag-grid-community/dist/styles/ag-theme-material.css'\nimport './DataGrid.css'\nimport { merge } from 'lodash'\n\nexport interface DataGridApis {\n  api: GridApi\n  columnApi: ColumnApi\n}\n\nexport interface DataGridProps<T> extends AgGridReactProps {\n  rows: T[]\n  columnDefs: (ColDef | ColGroupDef)[]\n  onSelectedRowsChanged?: (rows: T[]) => void\n  onGridApisReady?: (params: DataGridApis) => void\n  rowIdProperty?: keyof T | 'id'\n}\n\nexport const DataGrid = <T,>({\n  rows,\n  columnDefs,\n  onSelectedRowsChanged,\n  onGridApisReady,\n  context,\n  gridOptions,\n  rowIdProperty = 'id',\n  ...restProps\n}: DataGridProps<T>): JSX.Element => {\n  // GRID APIS\n  const [grid, setGrid] = useState<DataGridApis>()\n\n  // EVENT HANDLERS\n\n  const handleOnSelectionChanged = ({ api }: SelectionChangedEvent): void => {\n    if (!onSelectedRowsChanged) return\n    onSelectedRowsChanged(api.getSelectedRows())\n  }\n\n  const handleGridReady = ({ api, columnApi }: GridReadyEvent) => {\n    setGrid({ api, columnApi })\n    if (onGridApisReady) onGridApisReady({ api, columnApi })\n  }\n\n  // CONTEXT AND REFRESH\n\n  useEffect(() => {\n    if (!grid?.api) return\n\n    // must force a refresh when context changes\n    grid.api.refreshCells()\n    grid.api.refreshHeader()\n  }, [context, grid])\n\n  // OTHER OPTIONS\n\n  const memoizedGridOptions = useMemo(\n    // need stable, per instance grid options\n    () =>\n      merge(\n        {\n          suppressCellSelection: true,\n          defaultColDef: {\n            sortable: true,\n            resizable: true,\n            suppressMovable: true,\n          },\n        },\n        gridOptions\n      ),\n    [gridOptions]\n  )\n\n  // RENDER\n\n  return (\n    <div className=\"ag-theme-material\" css={{ width: '100%', height: '100%' }}>\n      <AgGridReact\n        rowData={rows}\n        immutableData\n        gridOptions={memoizedGridOptions}\n        columnDefs={columnDefs}\n        onSelectionChanged={handleOnSelectionChanged}\n        animateRows\n        containerStyle={{ width: '100%', height: '100%' }}\n        getRowNodeId={(data) => data[rowIdProperty]}\n        context={context}\n        // frameworkComponents={frameworkComponents}\n        // isRowSelectable={isRowSelectable}\n        onGridReady={handleGridReady}\n        {...restProps}\n      />\n    </div>\n  )\n}\n","import dayjs from 'dayjs'\nimport utc from 'dayjs/plugin/utc'\nimport timezone from 'dayjs/plugin/timezone' // depends on utc\n\ndayjs.extend(utc)\ndayjs.extend(timezone)\n\nconst APP_TIME_ZONE = 'US/Mountain'\n\nexport const formatNumber = (value: number): string => value.toLocaleString()\n\nexport const formatUtcDateTimeToAppDate = (utcDateTime: string | null): string | null => {\n  if (!utcDateTime) return null\n  if (utcDateTime.match(/T00:00:00(\\+00:00|Z)/)) return utcDateTime.substring(0, 'YYYY-MM-DD'.length)\n  return dayjs(utcDateTime).tz(APP_TIME_ZONE).format('YYYY-MM-DD')\n}\n\nexport const getCurrentDateTime = (): string => {\n  return dayjs().toISOString()\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\nimport { Chip } from '../Chip'\nimport { Filter } from './types'\n\nconst NoneChip = () => <Chip label=\"No filters\" />\n\nexport interface FilterChipsProps<T> {\n  className?: string\n  filters: Filter<T>[]\n  joinLabel?: 'and' | 'or'\n  noneNode?: React.ReactNode\n}\n\nenum CHIP_COLOR {\n  default = 'lightblue',\n  warn = '#ffcc00',\n  error = '#ff4400',\n}\n\nexport const FilterChips = <T,>({\n  className,\n  filters,\n  joinLabel,\n  noneNode = <NoneChip />,\n}: FilterChipsProps<T>): JSX.Element => {\n  return (\n    <div\n      className={className}\n      css={{ flex: 1, display: 'flex', flexWrap: 'wrap', gap: '0.5em', alignItems: 'center', fontSize: '0.8125rem' }}\n    >\n      {filters.length > 0\n        ? filters.map(({ id, label, textColor, chipColor = CHIP_COLOR.default, onDelete }, index) => (\n            <React.Fragment key={id}>\n              {joinLabel && !!index && <span css={{ fontStyle: 'italic', opacity: 0.6 }}> {joinLabel} </span>}\n              <Chip\n                label={label}\n                textColor={textColor}\n                chipColor={CHIP_COLOR[chipColor] || chipColor}\n                onDelete={onDelete}\n              />\n            </React.Fragment>\n          ))\n        : noneNode}\n    </div>\n  )\n}\n","const plurals = {\n  is: 'are',\n  box: 'boxes',\n  taxon: 'taxa',\n  child: 'children',\n  taxa: false,\n  'individuals counted': false,\n}\n\nexport const pluralize = (qty: number | null | undefined, word: string): string => {\n  if (typeof qty === 'number' && qty === 1) return word\n  const plural = plurals[word]\n  if (plural === false) return word\n  return plural ?? `${word}s`\n}\n","import { ColDef, ValueFormatterParams } from 'ag-grid-community'\n\nimport { formatNumber, formatUtcDateTimeToAppDate } from '../../lib/formats'\n\nexport const comparator = {\n  labelComparator: (valueA: { label: string | number }, valueB: { label: string | number }): number => {\n    const labelA = valueA.label\n    const labelB = valueB.label\n    if (labelA == labelB) return 0\n    return labelA > labelB ? 1 : -1\n  },\n}\n\nexport const columnDef = {\n  linkColumn: (colDef: ColDef): ColDef => ({\n    // value is expected to be { label: string, onClick: () => void }\n    cellRenderer: 'LinkRenderer',\n    comparator: comparator.labelComparator,\n    ...colDef,\n  }),\n  textColumn: (colDef: ColDef): ColDef => colDef,\n  textListColumn: (colDef: ColDef): ColDef => ({ valueFormatter: ({ value }) => value.join(', '), ...colDef }),\n  filterableTextColumn: ({ filterTooltip, ...restColDef }: ColDef & { filterTooltip: string }): ColDef => ({\n    // value is expected to be { label: string, onFilter: () => void, disabled?: boolean }\n    cellRenderer: 'FilterableTextRenderer',\n    cellRendererParams: { filterTooltip },\n    comparator: comparator.labelComparator,\n    ...restColDef,\n  }),\n  dateColumn: (colDef: ColDef): ColDef => ({\n    valueFormatter: ({ value }) => formatUtcDateTimeToAppDate(value) ?? '',\n    width: 120,\n    ...colDef,\n  }),\n  progressColumn: (colDef: ColDef): ColDef => ({ cellRenderer: 'ProgressRenderer', ...colDef }),\n  checkColumn: (colDef: ColDef): ColDef => ({ cellRenderer: 'CheckRenderer', ...colDef }),\n  booleanColumn: ({ valueLabels, ...restColDef }: ColDef & { valueLabels: [string, string] }): ColDef => ({\n    valueFormatter: ({ value }) => (value ? valueLabels[1] : valueLabels[0]),\n    ...restColDef,\n  }),\n  numberColumn: (colDef: ColDef): ColDef => ({\n    type: 'numericColumn',\n    valueFormatter: ({ value }: ValueFormatterParams): string => value && formatNumber(value),\n    ...colDef,\n  }),\n}\n","import React from 'react'\nimport MuiTooltip from '@mui/material/Tooltip'\n\nexport const withTooltip = (content: JSX.Element, tooltip: string | undefined, disabled?: boolean): JSX.Element => {\n  if (!tooltip) return content\n  if (disabled)\n    return (\n      <MuiTooltip title={tooltip}>\n        <span>{content}</span>\n      </MuiTooltip>\n    )\n  return <MuiTooltip title={tooltip}>{content}</MuiTooltip>\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { ICellRendererParams } from 'ag-grid-community'\nimport CheckBoxOutlinedIcon from '@mui/icons-material/CheckBoxOutlined'\nimport CheckBoxOutlineBlankOutlinedIcon from '@mui/icons-material/CheckBoxOutlineBlankOutlined'\nimport MuiIconButton from '@mui/material/IconButton'\nimport FilterAltIcon from '@mui/icons-material/FilterAlt'\n\nimport { withTooltip } from '../withTooltip'\nimport { noop } from 'lodash'\n\ninterface CellRendererParams<T> extends ICellRendererParams {\n  value: T\n}\n\nconst LinkRenderer = ({\n  value: { label, onClick, disabled },\n}: CellRendererParams<{\n  label: string | number\n  onClick: () => void\n  disabled?: boolean\n}>): React.ReactNode => (\n  <span onClick={disabled ? noop : onClick} className={disabled ? undefined : 'link'}>\n    {label}\n  </span>\n)\n\nconst ProgressRenderer = ({ value }: CellRendererParams<number>): React.ReactNode => {\n  const percent = `${Math.floor(value * 100)}%`\n  return (\n    <div css={{ height: '100%', width: '100%', position: 'relative' }}>\n      <div css={{ position: 'absolute', background: 'lightgrey', width: '100%', height: '50%', top: '25%' }} />\n      <div css={{ position: 'absolute', background: '#42d64c', width: percent, height: '50%', top: '25%' }} />\n      <div css={{ position: 'absolute', width: '100%', textAlign: 'center' }}>{percent}</div>\n    </div>\n  )\n}\n\nconst CheckRenderer = ({ value }: CellRendererParams<boolean>): React.ReactNode => (\n  <div css={{ display: 'flex', alignItems: 'center', height: '100%' }}>\n    {value ? <CheckBoxOutlinedIcon /> : <CheckBoxOutlineBlankOutlinedIcon />}\n  </div>\n)\n\nconst FilterableTextRenderer = ({\n  value: { label, onFilter, disabled },\n  filterTooltip,\n}: CellRendererParams<{\n  label: string | number\n  onFilter: () => void\n  disabled?: boolean\n}> & { filterTooltip: string }): React.ReactNode => {\n  return (\n    <div>\n      <div css={{ position: 'absolute', right: 0 }}>\n        <MuiIconButton\n          onClick={() => {\n            onFilter()\n          }}\n          disabled={disabled}\n        >\n          {withTooltip(<FilterAltIcon />, filterTooltip, disabled)}\n        </MuiIconButton>\n      </div>\n      {label}\n    </div>\n  )\n}\n\nconst ActionableTextRenderer = ({\n  value: { label, onAction, disabled },\n  tooltip,\n  Icon,\n}: CellRendererParams<{\n  label: string | number\n  onAction: () => void\n  disabled?: boolean\n}> & { tooltip?: string; Icon: React.FC }): React.ReactNode => {\n  return (\n    <div>\n      <div css={{ position: 'absolute', right: 0 }}>\n        <MuiIconButton\n          onClick={() => {\n            onAction()\n          }}\n          disabled={disabled}\n        >\n          {withTooltip(<Icon />, tooltip, disabled)}\n        </MuiIconButton>\n      </div>\n      {label}\n    </div>\n  )\n}\n\nexport const renderers = {\n  LinkRenderer,\n  ProgressRenderer,\n  CheckRenderer,\n  FilterableTextRenderer,\n  ActionableTextRenderer,\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useRef, useState } from 'react'\nimport MuiLinearProgress, { LinearProgressProps as MuiLinearProgressProps } from '@mui/material/LinearProgress'\n\nexport interface LinearProgressProps extends MuiLinearProgressProps {\n  delayMs?: number\n}\n\nexport const LinearProgress = ({ delayMs = 0, ...rest }: LinearProgressProps): JSX.Element | null => {\n  const timeoutRef = useRef<number | undefined>(undefined)\n  const [isActive, setIsActive] = useState(false)\n\n  useEffect(() => {\n    timeoutRef.current = window.setTimeout(() => {\n      setIsActive(true)\n    }, delayMs)\n    return () => {\n      window.clearTimeout(timeoutRef.current)\n    }\n  }, [])\n\n  return isActive ? <MuiLinearProgress {...rest} /> : null\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\nimport { formatNumber, pluralize } from '../../lib/formats'\nimport { LinearProgress } from '../LinearProgress'\n\nexport const DataGridSummaryArea = ({\n  children,\n  className,\n}: {\n  children: React.ReactNode\n  className?: string\n}): JSX.Element => (\n  <div\n    className={className}\n    css={{\n      fontSize: '0.8125rem' /* match chip */,\n      display: 'flex',\n      alignItems: 'center',\n      position: 'relative',\n    }}\n  >\n    {children}\n  </div>\n)\n\ninterface DataGridRecordCountProps {\n  className?: string\n  descriptor: string\n  isLoading?: boolean\n  total: number\n  visible: number\n}\n\nexport const DataGridRecordCount = ({\n  className,\n  descriptor,\n  isLoading,\n  total,\n  visible,\n}: DataGridRecordCountProps): JSX.Element => (\n  <DataGridSummaryArea className={className}>\n    {isLoading && <LinearProgress css={{ position: 'absolute', width: '100%', bottom: 5 }} />}\n    {total === visible\n      ? `${formatNumber(total)} ${pluralize(total, descriptor)}`\n      : `${formatNumber(visible)} of ${formatNumber(total)} ${pluralize(total, descriptor)} shown`}\n  </DataGridSummaryArea>\n)\n\ninterface DataGridHeadingProps {\n  children?: React.ReactNode\n}\n\nexport const DataGridHeading = ({ children }: DataGridHeadingProps): JSX.Element => (\n  <div css={{ fontWeight: '500', marginLeft: '1em' }}>{children}</div>\n)\n","import { columnDef } from '../DataGrid'\n\nexport const samplesColumnDefs = [\n  columnDef.linkColumn({\n    headerName: 'Sample ID',\n    field: 'sampleId',\n    width: 120,\n  }),\n  columnDef.dateColumn({\n    field: 'sampleDate',\n  }),\n  columnDef.textColumn({\n    headerName: 'Sample Type',\n    field: 'type',\n    width: 120,\n  }),\n  columnDef.textColumn({\n    headerName: 'Sample Method',\n    field: 'method',\n    width: 140,\n  }),\n  columnDef.linkColumn({\n    headerName: 'Site Name',\n    field: 'site',\n    width: 160,\n  }),\n  columnDef.textColumn({\n    headerName: 'US State',\n    field: 'usState',\n    width: 120,\n  }),\n  columnDef.textColumn({\n    headerName: 'Visit ID',\n    field: 'visitId',\n    width: 100,\n  }),\n  columnDef.textColumn({\n    field: 'customerSiteCode',\n    width: 220,\n  }),\n  columnDef.textColumn({\n    headerName: 'Sort',\n    field: 'sortState',\n    minWidth: 120,\n    flex: 1,\n  }),\n  columnDef.textColumn({\n    headerName: 'Identification',\n    field: 'identificationState',\n    minWidth: 120,\n    flex: 1,\n  }),\n]\n\nexport const samplesDownloadColumns = [\n  { header: 'Sample ID', key: 'id' },\n  { header: 'Sample Date', key: 'sampleDate' },\n  { header: 'Sample Type', key: 'type' },\n  { header: 'Sample Method', key: 'method' },\n  { header: 'Site Name', key: 'siteName' },\n  { header: 'US State', key: 'usState' },\n  { header: 'Visit ID', key: 'visitId' },\n  { header: 'Customer Site Code', key: 'customerSiteCode' },\n  // { header: 'Sort', key: 'sortState' },\n  // { header: 'Identification', key: 'identificationState' },\n]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiChip from '@mui/material/Chip'\n\ninterface ChipProps {\n  // variant?: 'standard' | 'reference'\n  className?: string\n  label: string\n  textColor?: string\n  chipColor?: string\n  onDelete?: () => void\n}\n\nexport const Chip = ({ className, label, chipColor, textColor, onDelete }: ChipProps): JSX.Element => (\n  <MuiChip\n    className={className}\n    sx={{ backgroundColor: chipColor, color: textColor }}\n    label={label}\n    variant={chipColor ? 'filled' : 'outlined'}\n    onDelete={onDelete}\n  />\n)\n","import { WebMercatorViewport } from 'react-map-gl'\nimport { LngLatBounds, LngLatLike } from 'mapbox-gl'\n\nimport { MAX_ZOOM } from './useSitesMapController'\nimport { Point } from '../../types'\n\nexport const calculateFit = (\n  points: Point[],\n  {\n    height,\n    width,\n    padding = 50,\n    maxZoom = MAX_ZOOM,\n  }: { height: number; width: number; padding?: number; maxZoom?: number }\n): { longitude: number; latitude: number; zoom: number } | undefined => {\n  if (points.length === 0) return undefined // guard against no points\n\n  const updatedViewport = new WebMercatorViewport({ width, height })\n  const allPointsLngLat = points.map(({ longitude, latitude }) => [longitude, latitude]) as LngLatLike[]\n  const updatedBounds = new LngLatBounds([allPointsLngLat[0], allPointsLngLat[0]])\n  allPointsLngLat.forEach((pointLngLat) => updatedBounds.extend(pointLngLat))\n  const sw = updatedBounds.getSouthWest()\n  const ne = updatedBounds.getNorthEast()\n\n  const { longitude, latitude, zoom } = updatedViewport.fitBounds(\n    [\n      [sw.lng, sw.lat],\n      [ne.lng, ne.lat],\n    ],\n    { padding, maxZoom }\n  )\n\n  return { longitude, latitude, zoom }\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo, useState } from 'react'\nimport { FlyToInterpolator, MapEvent, ViewportProps } from 'react-map-gl'\nimport { FeatureCollection } from 'geojson'\nimport log from 'loglevel'\n\nimport { Point, Site } from '../../types'\nimport { calculateFit } from './calculateFit'\n\nexport interface SitesMapController {\n  viewport: ViewportProps\n  setViewport: React.Dispatch<React.SetStateAction<ViewportProps>>\n  fitSites: (targetPoints: Point[], options?: { padding?: number }) => void\n  centerSite: (targetPoint: Point, options?: { zoom?: number; suppressZoomOut?: boolean }) => void\n  sitesData: FeatureCollection\n  handleClick: (event: MapEvent) => void\n  smartFitAll: () => void\n  handleHover: (event: MapEvent) => void\n  hoverInfo: HoverInfo | null\n  siteChoicesNode: React.ReactNode\n  cancelSiteChoices: () => void\n  isViewportReady: boolean\n}\n\ninterface HoverInfo {\n  node: React.ReactNode\n  x: number\n  y: number\n}\n\ninterface UseSitesMapControllerParams {\n  initialViewport?: ViewportProps\n  onSiteClick?: (site: Site) => void\n  sites: Site[]\n  showSingleSiteHoverDetail?: boolean\n}\n\nexport const DEFAULT_VIEWPORT = {\n  longitude: -97.6701409,\n  latitude: 38.7250438,\n  zoom: 3, // crude approximation as what you see depends on window size; this fits Lower 48 @ 600px\n}\n\nexport const MAX_ZOOM = 22 // closest we ever want to be\nexport const IDEAL_CLOSE_ZOOM = 9 // good zoom for single point, and closest we ever want to be on map loading\n\nexport const SITES_LAYER_ID = 'namc-sites'\n\nexport const useSitesMapController = ({\n  initialViewport,\n  onSiteClick,\n  sites,\n  showSingleSiteHoverDetail,\n}: UseSitesMapControllerParams): SitesMapController => {\n  const [viewport, setViewport] = useState<ViewportProps>({ ...DEFAULT_VIEWPORT, ...initialViewport })\n  const [hoverInfo, setHoverInfo] = useState<HoverInfo | null>(null)\n  const [siteChoicesNode, setSiteChoicesNode] = useState<React.ReactNode>(null)\n  const cancelSiteChoices = () => setSiteChoicesNode(null)\n\n  const sitesData = useMemo<FeatureCollection>(\n    () => ({\n      type: 'FeatureCollection',\n      features: sites.map((site) => ({\n        type: 'Feature',\n        geometry: { type: 'Point', coordinates: [site.longitude, site.latitude] },\n        properties: site,\n      })),\n    }),\n    [sites]\n  )\n\n  const fitSites = (targetPoints: Point[], options: { padding?: number } = {}) => {\n    const { width, height } = viewport\n    if (!width || !height) {\n      log.debug('fitSites skipped: no viewport yet')\n      return\n    }\n\n    const calculatedViewport = calculateFit(targetPoints, { height, width, ...options })\n\n    const transition = { transitionInterpolator: new FlyToInterpolator(), transitionDuration: 1000 }\n\n    setViewport((vp) => ({\n      ...vp,\n      ...transition,\n      ...calculatedViewport,\n    }))\n  }\n\n  const centerSite = (point: Point, options: { zoom?: number; suppressZoomOut?: boolean } = {}) => {\n    const { latitude, longitude } = point\n    let { zoom = IDEAL_CLOSE_ZOOM } = options\n    const { suppressZoomOut } = options\n    if (suppressZoomOut && viewport?.zoom && viewport.zoom > zoom) zoom = viewport.zoom\n\n    setViewport({\n      ...viewport,\n      longitude,\n      latitude,\n      zoom,\n      transitionDuration: 750,\n    })\n  }\n\n  const smartFitAll = () => {\n    if (sites.length === 0) return\n\n    if (sites.length === 1) {\n      centerSite(sites[0])\n      return\n    }\n\n    fitSites(sites)\n  }\n\n  const handleClick = (event: MapEvent) => {\n    setHoverInfo(null)\n    setSiteChoicesNode(null)\n    const targetSites =\n      event.features &&\n      event.features.filter((feature) => feature.layer?.source === SITES_LAYER_ID).map((feature) => feature.properties)\n    if (!targetSites?.length) return\n    if (targetSites.length === 1) {\n      if (onSiteClick) onSiteClick(targetSites[0])\n    } else if (viewport.zoom === MAX_ZOOM) {\n      setSiteChoicesNode(\n        targetSites.map((site) => (\n          <div key={site.id} css={{ display: 'flex', justifyContent: 'center', marginTop: '0.1em' }}>\n            <span\n              css={{ whiteSpace: 'nowrap', background: '#cccccc', padding: '0.1em', cursor: 'pointer' }}\n              onClick={() => {\n                setHoverInfo(null)\n                setSiteChoicesNode(null)\n                if (onSiteClick) onSiteClick(site)\n              }}\n            >\n              {site.name}\n            </span>\n          </div>\n        ))\n      )\n    } else {\n      if (!viewport.width || !viewport.height) throw new Error('No viewport.')\n      fitSites(targetSites, { padding: Math.min(viewport.width, viewport.height) / 4 })\n    }\n  }\n\n  const handleHover = (event: MapEvent) => {\n    const mouseEvent = event.srcEvent as MouseEvent\n    const { features = [] } = event\n    const { offsetX: x, offsetY: y } = mouseEvent\n\n    const targetSites = features ? (features.map((feature) => feature.properties) as Site[]) : [] // features is null when loading\n\n    if (targetSites.length === 0) {\n      setHoverInfo(null)\n      return\n    }\n\n    const node = (() => {\n      if (targetSites.length === 1 && showSingleSiteHoverDetail) {\n        const { name, latitude, longitude } = targetSites[0]\n        return (\n          <div css={{ border: '1px solid grey', background: '#ffffffaa', borderRadius: 3, padding: '3px' }}>\n            <div css={{ fontWeight: 'bold', fontSize: '120%', textAlign: 'center' }}>{name}</div>\n            <div\n              css={{ marginTop: '0.5em', display: 'grid', gridTemplateColumns: 'repeat(2, auto)', columnGap: '0.5em' }}\n            >\n              <div>Latitude</div>\n              <div>{latitude}</div>\n              <div>Longitude</div>\n              <div>{longitude}</div>\n            </div>\n          </div>\n        )\n      }\n      if (targetSites.length < 6)\n        return (\n          <div>\n            {targetSites.map(({ id, name }) => (\n              <div key={id} css={{ display: 'flex', justifyContent: 'center', marginTop: '0.1em' }}>\n                <span css={{ whiteSpace: 'nowrap', background: '#ffffffaa', padding: '0.1em' }}>{name}</span>\n              </div>\n            ))}\n          </div>\n        )\n      return <div>{targetSites.length} sites</div>\n    })()\n\n    setHoverInfo({ node, x, y })\n  }\n\n  const isViewportReady = !!(viewport.width && viewport.height)\n\n  return {\n    viewport,\n    setViewport,\n    fitSites,\n    centerSite,\n    sitesData,\n    handleClick,\n    handleHover,\n    smartFitAll,\n    hoverInfo,\n    siteChoicesNode,\n    cancelSiteChoices,\n    isViewportReady,\n  }\n}\n","import MapboxGL from 'mapbox-gl'\nimport { FeatureCollection } from 'geojson'\nimport { SITES_LAYER_ID } from '../useSitesMapController'\nexport const SOURCE_PREFIX = 'BGS_'\nexport const LAYER_PREFIX = 'BGL_'\n\nimport basicStylesJson from './basicStyles.json'\nimport satStylesJson from './satStyles.json'\nimport topoStylesJson from './topoStyles.json'\nimport sitesLayerJson from './sites.json'\n\nimport basicThumb from './basicThumb.png'\nimport satThumb from './satThumb.jpg'\nimport topoThumb from './topoThumb.png'\n\nexport const sitesLayer = sitesLayerJson as MapboxGL.CircleLayer\n\nexport type MapStyleKey = keyof typeof mapStyles\n\nexport const mapStyles = {\n  basic: (data: FeatureCollection): MapboxGL.Style => createNewStyle(basicStylesJson as MapboxGL.Style, data),\n  sat: (data: FeatureCollection): MapboxGL.Style => createNewStyle(satStylesJson as MapboxGL.Style, data),\n  topo: (data: FeatureCollection): MapboxGL.Style => createNewStyle(topoStylesJson as MapboxGL.Style, data),\n}\n\nexport const mapStylesThumbs = {\n  basic: basicThumb,\n  sat: satThumb,\n  topo: topoThumb,\n}\n\n/**\n * This is just stripping out all the useful information from a direct export from Mapbox\n * We prefix the IDs too so that we can find them easier for map shuffling\n * @param sourcePrefix\n * @param rawStyle\n * @returns\n */\nexport function createNewStyle(rawStyle: MapboxGL.Style, sitesData: FeatureCollection): MapboxGL.Style {\n  if (!rawStyle.sources) return { sources: {}, layers: [], version: 8 }\n  const rawSources = rawStyle.sources || {}\n  const rawLayers = rawStyle.layers || []\n  const glyphs = rawStyle.glyphs\n  const sprite = rawStyle.sprite\n  const sourceLookup: Record<string, string> = {}\n  const sources = Object.keys(rawStyle.sources).reduce<MapboxGL.Sources>(\n    (acc, sKey) => {\n      const newId = `${SOURCE_PREFIX}_${sKey}`\n      const source = rawSources[sKey]\n      // Add to the lookup so we can find this in the layers later\n      sourceLookup[sKey] = newId\n      return {\n        ...acc,\n        [newId]: source,\n      }\n    },\n    {\n      [SITES_LAYER_ID]: {\n        type: 'geojson',\n        data: sitesData,\n      },\n    }\n  )\n  const layers = [\n    ...rawLayers.map<MapboxGL.AnyLayer>((rawLayer) => {\n      const newLyr = {\n        ...rawLayer,\n        id: `${LAYER_PREFIX}_${rawLayer.id}`,\n      }\n      // IF the source is specified (and it is not a complex type) then go get it from the lookup\n      if (\n        newLyr.type !== 'background' &&\n        newLyr.type !== 'circle' &&\n        newLyr.type !== 'custom' &&\n        newLyr.source &&\n        typeof newLyr.type === 'string'\n      )\n        newLyr.source = sourceLookup[newLyr.source.toString()]\n      return newLyr\n    }),\n    {\n      ...sitesLayerJson,\n      id: SITES_LAYER_ID,\n      source: SITES_LAYER_ID,\n    } as MapboxGL.CircleLayer,\n  ]\n  return { sources, layers, glyphs, sprite, version: 8 }\n}\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4BAMAAADLSivhAAAAJ1BMVEXs4cvv5dLw59Xx6Nfz69z17uL28eX48uf38un59Ov69vD7+fX////S7BO1AAAEmUlEQVRYhe1YzW8bRRSf2Q8ngYtp3bQGDkYUKveUSGmFRQ9u0zbawiFRTdEKDk6bAKv20BaC5BtBoiWIQ9J41x6JA9x7ABVO5IBUQArZP4qZNx87+5ndBAmB/DusZ968N+9j3nuza4QAU336mA7D8As2m15GAnjQlcNZH+HHdST4wvCvoVyxdhknJf0Gsx1Jn/lSjkxCt2kzHdYeyLqP5BIK2ONpGP4O+tSmqC4H7irbwaeL34HibnOgmJwWfVyiG8LsI5TEOb6f00UfguwmsklLLjaZmy9SKqhy5hKy1ohzWsPzIPsztYCocNjMTZuS+xCc3bgs9mQIPwDZP8GRvlr22ZPSf+TMcdUduZnJgwWr7W217jJ774Xhc5jVhrqsHci4fQuKuRm1J4qhzTx4NQz3xV7dSNZQh/0OyP4g4xDtzoyYoUtiGqnGzkMxaoIsnCY6eZ0QxWIyblPZhNwrwlTT9QWLBbL7lI4XXBLcVDmA0MfssSciSTkJWWfyja2hYMJPmexBFxnXBmTjsh4U1GEhfFemN0InrnlkvHaR3JQMPDv6dNtxr4XigNpgabKvSFR+pDS8DbLP6DHq9kqPWORrjOF7jar4YCX8g2bfbkqUgsUFQw5kLIpSqqM3/bReZLhOXTgd/pRalaWErHEy7SkaAx9q4wZENLU57Bnu0HxZ0ck8ed4gd6A2bB/YnidkX5al5Hwao7O0xUtkBVoA9roGOBe3zZaldM6P0VFnSN0NQL8L1fNKlIICvJQO5pA9SjiM3Z7n8zNvXwUz9nhoItwTpWQOllECFlkToxqBxRdAz23FoErJfZiUpXmkzBM1xo/lFxHyaVlKbw3TshqcVY09PPgVIEvpVJBM6DjMEdfG+4UGWkom6RbK0tBvwg++mxDu07jePkQWGVvCtBsx2WdwoofitCyZWU2WltJhDnODPekZLyMopRY9ziyHbyUJUeMzviFfP1p/r3e1Sx1ezdJUS1HcDB1OCYe5aj9Fmg0y6j8bzkqCkO1wNmiuxxRhL7lbERpeoFUeLu2w4F+KmnXDy2p4CTzRJ7ZPeIkbS+SzEtnh6fs3l02Xdnt8gQSXcyU0nHmgTdhdfXEbzUTWF8MItDEcdR1ZJSzm6ET9yd4p4MuEFZ1Iu3xSSDhKxKssi2z1xlMtK4RCEZ/a/SMIn+YNjL8iVAUWp/V5eRHtBuGnZWXe/NnQomNCcsz081jTcLU0gtNySucVfQnS0omdFk63oXzoSY3cOdSplJsdLRmndkp19wi2Fl08rtDsAFofwF7VgmpGZ1Ox2SF5vAynSnX3k1d0LvktU6a7s3dhQjZ685IgOkfOdZaQHK/Nn1h4n5DR+iIYgB9zA4odxgufiPd3NnmdWQDDNquIQocxU7axGON4aQF+WP8qcvjsLUK+Wszb221hr8BhEvRey1+d2ix0eL5gjVbHuMR1locq93cS1e7vBKqndITZf8fhUe8YDl8nFfp0CvjoDk8wwQQT/AM4VhMq9/GTg6XEp2M1nB0ER7/l6Kfj9uFM+Zh07gkm+H/gOC0Mlf0LJxONLb/Sd2schnusFvYfxN9OtcK2vfmpIAAAAABJRU5ErkJggg==\"","export default \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAB4AHgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDk7LUtXvbt/DXhrSrZdWtGDjUzd7UkiT7u3H3gePqKnOial4dvptU1zVLHUNQ1IM9ybdI8KAPmGBnOMg8+lcvNokV1q0kXiPWSsltF5KRxoWOIxwhKDBwOPfpXZeHNP0C0063hs9BvopjJl7mWMKqxEFWjO4ggnIYYHpXnq6loKLlOm3KJy2v+H76Hw1L4pnvLKxW3dXjy/wC8uHBwOM+/QDGO9epeZb+KvhwLizO9xEJ4eORgElfyLD8KxJbbw/b2T6hryfbbjTlkj8lmMhGPusF5C8fLnFVfhlrslhqy2DRRRadeQG6tSrZWEM3Kk9gDyP8Aep02+ZxkOUIxSklo1+JVsLHRZdItbrXLzUtQeKQRRWQlYqjH+MKoyMAZyePrVQafpD6gYtWSZ4IgFvIYJCJWiPKSKCBwAeeASOOK6HV4NV8P69dR6YIoLC/XKS3CEwruzzgfxLzj1B9647W9AuNIukFvdyajew5uZbm1BLqCMjzCxxg5wB6DkdK02MGrFq+06TxV4qtdN8M2KLpdoA6XEsG2PyRwqhOMtkHk9e/aq+iw6oJj4f057sWsEztJCjlwcnBbJGFIA7bjycd6pab4ghtma6EVxZSKxDzW/KK2GP8AwAkKeh+ldRZeNNR0PQkj0jUozuAQMbAGSEY+XD88ZI7jqKE2noZ3u0zS0kQaClvc+IbG2it54pBDlUkdR7AEcMMjJztJrFv9b1fUrGGzv7sW2j2zsbaNABLg/KMsB0GcZ4/HOazraZ547m/nRzb2y7p3utpLtkEKig4DZPQnPHSujsfCNjdPbahrD36Wd25UyMVJjz82CRyE6fdPpnihNJ67mqi5aIyNE0a917SL+xtoY9+4CyW3cqse1/mMj/xHGDn8jXX+Gbq6n1GTRLQzWWsQM0lvfFQ8UGeDH6spz0P3c/la0ttR1KGXQbK3khtYJ98N+CY+M8EleXYjgj8a6OxtdL8N6dNK8ijapE9zK3c9iRn/AL5XJNS/eepUY6WRzel+D7qG8SXxNfedOsmfJQFgG9Se/wCH5it/Vtes9Nie009Ea6A2+VGeh/2iOn+6Oa5fxH4ku7u2U2U09hbDCNIFBu5lz0UcCNDzzndXIz6rp2ma+bPTrJvtl2yRqWc5ccAHpjoT0pSTWwS0Vo7mnod5qms6b4gtryczy2ziaJ5IhCjEMWKYPUAgc+hNFM1m9kTUhY+RMlhPbtsulkX91KFG4KM8qScHIB5opWvuyEpJJPc2NZh0zSNItf7OjsU1CzuIhIly4WW3hGNxzj58jp9av63q661d3Nvp9iNad1WSBI8pGCrHY2Acg/X8jXD+K9I8L6ToNxrl5ql4Lu8ums9jElUwSP3ig8cJ19x1qv8A8JFDpd5ZW3hextFSCfab+GVyJyyc/KcbQM/Tms7Wd7WZ0vEysoylo+iNiW81bTPP07XL+387USyKqlTGnzY2ZAHKngg1zmuaJcQ65LPpzXE+s2mJ7pkT9xapwFLAcN3IHuSaX+z9FvpE8NaRHqjahqKSTuFkRtsgfI3lj8oHJwOoHHWu2stdtNKvLrSob4R6mPLsDdXEO1d5G5lcDll64btV3bW+pCS6/Dci+H/jKHxMlzoGvWbNKkeZJDykhHBK+gHBHpmp9Z0e7srDU4tFn+2QXSgSmNQ0iL9BznH8XPSsKDwvqt9Jb6XpVzPHqKu15v8ALET2qjPVx94HPTnNS6J4inge+stQkjnureRozPC4SU+vyg84bjg9q0jUUnZ7mfJKyv8AeVby08PX82kabFPqGk2sO/7af75IVVJxkMMA9QD8x9asaP4c8Pahd6rfz6g0UELMtvbjK4Cj5SvGcnHrXUaVrGlaherpd/YgzLHuZrxArHnu74OfQDPSrs+laaZd8Fto8fzH5pJgcjBGPv49PyqmhJdSjoY8LaVa2sNvDe3813iR0mjaYszAk5U98+vAOauPYWs93G+qCWNtxCWVvJvbn++R06YwPUZxR/b2g6BYN5+tafgZ3JbIrsR2BWMnd+OK5y98Wx29vI1tb3GlW7KQGZC9/OMEnYi8Jx3P50lGxV+51ura8tg0dhDbebeqny6fbOFEQwTulbogwOR1/nXEaxqGoatfSIHkluFRZLdkGIETPz+Wv93nliCTgYqOz0e+8RXn9m2LR29jPEGaJ8s8hGSS7MR5jkf8BBx16V0mpLpnhtIhayXcWrocSvFPvC+uW5zldoKdvbis5SS3HdJXexWXQ7mfT5479vOnvLdRIgbYsQ+9kcckH+tcL4uvtCi8c6feaa8jpZRotwyA7RKnJjU9MD6CvTPD7w31rb+ITcSSKR9njh2fM0jyAEk5yRzxXm/xe8IS+HvFJ0XR4bk2KbTLcOu0GSTryOnUD3rOm23qXUilTTR1y+JtH1Hxbp8z3Ok6VpVuJIPOkjMkHn7VyH+YZJzwSetFczoWq6edO020u4LezfTbxJQ7RbYp1x8pJHRhxlsHO72orXlM1OL1bOK17wu9p4gl0hbgefLc7XuEcyKTk7gxGc9jnHGa7Hw7F4d07wvd6FeWVpqF1pswLXFtw0obf8jOR1LYGPYeta2uaTpmq6Ktr4cUxxi7BSVlJupAwwqAA5UZ6Hr1/GK+0jQ4fh62iwWt4mtSQCMwQFz553giZsHGRg8ngc/hEZXXvEyg6U3yu6IbDSrfxDK19ocE9vbsuMSKoCSqdxQ7DuU47/h0rp/Etto92iXMOqXCatc4hMc5EYWUjaXbHUKCQOck4Oa4vwd4a1GDWp7Gz1NkuZY1ivGgb5mGM5wf416E9COma1fEkeoeKzY2egWsN0mm2e03sKBTLGGPyMOPm47+9TOMbpmsJSUW4xu2dI91qHhS8tbTVbFpbS2Efl3BLEPLnacOo4U7hwcj9KwtW0zw1HcR2NvZ21lcgxCea7JWQO2XG2QfLz0GaXw1/ZN5oxvtLn1W4ltI8tbTyExSsowEIP3W3A9MjjNH2jQtf08y6zbXSma7Q6jIshKwqAdiqvc4XrwOfetG1bVChfmSbsS6npkNtrEWlvbxaxDHaRsrXNwp2b2fgY43ccY645NPh8G+HLXTJ4dVljs2CF1uJbjJjOCciNMlhkAEcY9aYNPSabULzw4BcaczRq11PGQ6hVxkBcBT2wQd316z6fpum6dcSR6nq5juLpGdykmAUBA5RDwMEcN7+tEeW25Eqac3dLX7jkbHTtPsriWDRS99M7o4upUUouCCcLyBjjk5PPQV1Ok6Jdpp1x4i1e3ubkOrNcRRvtlDAHnaT8xGDkucEEcdKgsfEMGhlotJWG9kjuGMN1NOqgqWyI8cjowHTI49K09G8R614i1JLm701reDBl4VhEZA4OcZy2RgdAMiiTNKUVsLe6rc2oj0yPS7mRNSjAsbeaNUlKBgW3OM7RnkY/Cl0jTpBc21ld+HvLilXF1dSy5QZ6gA8kEeuOa6W81mTXhb3UFuhDooimZCHiPIIXuK43xR4ltrXT4r/UdRMRil2oRz9oIyCAgJJAx047dKx5Wzf6vCMuaR6Pawafo4tvsaxCK3TftaLEfGCDn1GM1w/iTWbbxZqGuC5uALuC4jEjRMTGCpGzk9AdvpwTXB6743v/FunHS7DRZYtPa4WW6ZpNjuB8xJOTgcAY9vetzw7D/ZOlzRTRxQWVyhJkXDlScYBzg5PHX1q4wcRzqRm/dWhFd23g2IWujvd6vprSagJtQjnXaQgDfMpU5PBAHrgUVleJftGrLPq1hr9pFbRkxCC6QI0ahei7gSSe/bmitbM45Jt3sdz4W1HR9W1z+1baweZlZg5tg6iC4HIcJnlSB1Pcmq3jHUNTs76bVbi8gi1KRBDBBHHhplOQEA7IBnO4dcV0OifDrT/DXgi48XW+viBrlGZ7EzDMiMuAikc7++B69ayb/QNM1zTIbq21Rpp5SpE11yqx5IZOTncPz6fSs6iUbstKVSCgt9Sh4Q0qbxJeXF2txHZ+I7aIFYrdcxugHyszfXjtgjjGa2NHvL+ynvdNt0t2sVQi4VUAeKUtkvk+hJyv5VBZaLYaNCb+zaW0aAMX+z5jfBONzHPCnjrzUN2unag0FrKsq2FxGqPdCFxFY3BJYMSDl8jgk9z3pJb82w17itB69X3Ov8H+FbFLcxC5aGSN/NmVU2+ZuHQg8gEd/euW+I/g1Y7+SbwnbRWVyIzJcQsuIZxkdjxkgcHtk1u+D47hZXKxh7y3l8s3iq4huIs9cHA6Z6+1avjR5pdPea7mmSzij3Ao20ytjIUHsOPoc0KbZs6MOX3Twa8vLrQJrO7tF09RcKXjDqHaA/xKQRk9epB9qt6PYNrF+0d1dxxLJMHXySxeWNuSgUeh55qv4Mv9Am1e9m8Qn5wd8M0zYVB3U9/TGKy/EHxR0u1vLqHw/p0sasGEdxnbISRwc9R9K0jFyOOEYv3mdgZ/CGhajZw3OmyHybkKbi5uNmxn+6SvQg5PsKXxB8X9IttZextp4JLWFGSQQhiWfsqkcYxnn3rwmea98Taqlxrd6+91wZJDxtXjGT36V12lfC1pJkl1HUbS0hkyADMM/KOvGfY1r7KPU2VVrSJs6j45bV9abVNImurN7eyMf2WWT92ME4Zcnk4IOTzxWHo95Hr2vJpkcwjt4V/wBFSWQkcZ4DMcDPNdFa+CfCNqvmXniS4vY9obyrWEEsMkdcnPpnFS6PeeDdJhe70jwfPdx258om7udzsScA4HHPHHv3p8iWxDk3K8mQ+D5oNQXy3tLq+lin+VLWFpAjJx98cd/XBFQ+O7HU7a6sZFtL1Wv2dpI5JgAnChdwU5HQda6m08a6k2rTaHpWh2VnC0xVlSIkFePmKjGOOcke9aXg3VpdeijgvLH9/dIY2MTZhYFtoHJ6HjBqbtdi1KMvdjuedwfDvx94iu2hi8P3M0kMKl3iV8KqjjK4ySQe3XOaK+iI9Uu/hvafZZ7ieCC4nSZnaSObO3CgDO1sfdGCT0GKKV2PlS3Zjto0ejwQ3JeS/li+eG3vMqsIb7yDcMIFzkEfMcYqk32iKS4tbexMQuZfOW7kULGrsOBGTnbg55PJI71Fp/hO/wBX8IyWz6nPdy6e7Zc3DM0zK2cs2TxtIx611el6fbxaNdWWoR3txZTRb8zrvVZOxwTyMnJ9/WueUrfDudEbTS59EuhX8M2sWl6Ze2+vSW0+qW0YlghmXH2lWHDYzkkkcnGeK5268bve3tzoqWaiC4O4xxoFCY5Oc/d6devU9xTvCXhW4XXpribVN8duxRN5IZUcDCnuRgfmDXWaf4YtTK2qX8aJtO5E3E7yF2gt6nH+NJNmVp1elkivptvbwwQXLX5W/lhDyW4nztAz8xHHXoOleN/E34x27max062lvfKZoopGJWHGMZx1bkZ9OK9A+IfiXRdHjaTVoPPjkQxFYApkc4ICjnqM5xXlXhC3sr2zuRPYM0QAEMdxBtccd8fX9K2hFbtFTm7qETy61TWtbv42NqZvtEm0ELhR/QCtPW/C1zb6za6NZFtQnuyAjEY3P3APoPX3/GveNN0+xi0OG3S3hiAjO5UwOQR1x16j86f4f8DNqviq01PzntLSzlWPMYG5gwJdsN2GQOPXtitXVSMnQ6I8SHhfUPNuNIaa32W1ybcyrMpDux4CknpkYx64z2rsNO0HWNS0Kxd7m3jjaZXBH39xUqclc46kkkdhgGvaLjwBpkvxBv5F0/U9TjaKEx3IjIPmKuMPghf4VJ/DvS6Loem+EfD93aa59n0u5t52c/ZUSQlHb5C+VJBwcdalVlbUzlQak0tUcpYfDC28P3gkuJop9QmVkQtG/kK2zCKjYGTwckg8D15HbeAPhrYeJJdT0y50y3+x6c8kstyhEZnldVaMCMDAC7eo9SBV7xLrT6ppU1ro9nFdT6a6u5lkEG1x3JOSMgmsbwx4piVbu2XwzeQyyFnm/elo3dAcgnjJOc9O561j7Rqd+h0ezpqnbl97uaun+EriPwrYalb2mjSahq02DlHQW8JQDaxO5nICkdhk1N4E8G/2dqP2gyR+Qt1st4Y4SscQjLElWPXJB/OvMT4i1W0WO4u/Gt5YXs4JSG0jzDCp6Kdv3fTA6YrMtfix43sY4549XiJDGMTG1Q+Yckljle/0pNczuVHERpK1tj2vxfp1rqHiK4nvYTcw2EQjWNhmNMozySHHfayge5FFcb8O/EHivxVqs1lq01qkMoE11IEC+eAF2gY6Z4B6cUVamo6Mcb1FzIfDpOq3V9qT6PqNvb2kcBuJYiPs+CI/u7eeB05x29RWfH4g1vQtBS4ktL26sbhlDs0qMsbMM/IG+Y59O1b994y8QRpc2nhy2tp55lWGKdUSYMxHzPKSMqRjHbpXNeOtMHiuKzsjcu+nW7kTTou2FpwhAAyAexGfesZpQauYqnvKL1Op06RI4JZWLGfALbx3bkL6A/4Va1PVLey06K91C4KWkC7pmkOQFz1P41ztlLPp3hxYtW8ua7T7qK5Pm7VA4/MVwni+LUfH/i2fTbZmtfD1oAkkmPmmPU4z0BP8qqKTep1Snypd2YbJpnifxXf6rdzecbidjBB5gAhQnK4A5BwAa7JNJsIbeKfFwryDqxOemOc8ml0jwbouk3H2m1hAdMfMRk8V0GqrFLZrEvlxzOQFZzgY7kVpKXYmnTsncqeCba0m1N7W6kQQMMq7HawPfnsDx+Veu20/hTR7OO4a4s+Bw4AJz+Ga8fuLK0s9OLP5s8i8MwJVR+Heqqx6le2ClnMenRt80m0rGuf5txUP3jZKyPX/ABD8SLOy2pZ28k+5AwK4VXyOoP19q8q1PWJ9X1SW7v4If3h5XG7jJ4yc+tU7m4SS7gaNXSBIhEuWyRjufqTn8aht1D3qRru3M2SR3pKBLZ2uga1dwzXAZAYpAGbdEuZs8fe6k4HeoU1PybciONGufMlzKOAAxOQO/c1UUraWw8yYsyruyTg8+wrn9X1JLNZI3keeRo2kjEjAY9s9qfKKTUVqLqdjDPrqao1pCuRseGNAsI6ksV/iJNY1voGmTarcPPCQqyF403HZggcnjHft2qHTPELajaSQyAiXO3CZOOf8ATmrsM12ZAx3gqxGQ/Bq4o50oT1R1vhjVrbQb0yTW0AjkUJ5qgZiH+FFcleySyWgjXA2/eb1znrRSdNNnQtDo/8AhGtV0zw5Z6nfx/ZFa8W38sS5xG+/5tyDIILA89K5LxVplz4csNU0/UNdvXvXeP7GbY4EkkmPnJ5JOMgkY6d6jmsPE2lw21xf+ItQe2Z4p5PMklbDEfKMYO4gckDoB61tS+H73Wp9OurDU7adZXWQSfZXUSMjZ3ksd2c+vHHelqlfoefUUk+XlszrdBt7keGrJLtY3uIoBv3nAJx1J6jOBk1w/gPW7fUfEusxRxRRW3HkLHkfKCcE574rtfG2qnQ7KVGnikVrdjLFsO5sgDg9PXiuJ8CabpqzXUlmYreZ5t0jO/Qc4C+oxULU6nK1SMEdLe3KWVtLKzlUwW3ckgDnpitjwLHDqbySai8boyBYUdgC3c+/cVz+osHsrpw6tKgwhOcc9x61zenXN5ZXCywyHerZBIJ5q90b7M9ws9Psnhna6tbExRt5cWw7sqOua5XxLOHt1t7WREt0kwuTnJ2jLFeg6dBwPzqhZazqc2jxxXt0d8gLsUAB254z/n0qpe2txdWziNDmIibcM5K4wSfbpWdtTR7GTdW80CxtMikk9AadDElrKWO3LjjHbnk065UsobLORgZP+fpVMOCLuWaMiOIHawbg8dfatktDCTE1HWpbPeoeSXzcgHOQnpj0561w2v6hMU8qR5Hzk5PUA+5qK71Pb5kcJUq7cg9cegrN1G4eUAupLAYBLcU0eZUxHMW9J1mWCYxCOGVXZQRLjjB4we31rullHlh1bcQoy6nKN7g9/rXmAiXHyYfJAx1rvtJtZo9Nsx5pQDIMRXOQf8DTKwlR3aLkDM4MciMAH3cnk4+naipYQsTbG3EjIDg5IooPRTOs0XdaaPj7NepbxoZ1ZG8+KIldjFkwWUAsPpituwmniilvdUUfuAqo9on7vBzjGfwP40UVjKV7IzVJKbfY5Pxj4ov3trnRLPSlvY7pDHFM8mCGPJBGOw6HvXC+DfDEmo+KNVGqTStJpl1sjii6ZUkHHtkDmiinsjJLnrrmPdB4eifw8sBsz5jYLKjZK8dK43UdLFpcLDCsiupwQ8eP1oorNSZ6nKmSvFPBfSiQhkKjYGX5VG0bQQOSOP1rTguPtFukQlMcUkbRSMeisR0+mQKKKaZmc3rcEpEyROSI8DYc4PH3selctrHiCSa0OmR5SNNq+ZEo2sR1H5iiitYnHi5OEVbqchJYXmC6W0oiB+ZwM9eRk086PdxxkyR5bBZAXUjaBkjIPWiiqPOjSi9WUoftEToyMyHHTkH2zXV+H5LqOwJmnGzduZSfmVT07dzn9KKKC8NFKZtRXMaowMEkx2kxgEDHfn0/+tRRRTPQ3P/Z\"","export default \"data:image/png;base64,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\"","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport MuiSpeedDial from '@mui/material/SpeedDial'\nimport MuiSpeedDialAction from '@mui/material/SpeedDialAction'\nimport SatelliteIcon from '@mui/icons-material/Satellite'\n\nimport { MapStyleKey, mapStylesThumbs } from './styles'\n\ninterface StyleControlProps {\n  value: MapStyleKey\n  onChange: (updated: MapStyleKey) => void\n}\n\nconst styleKeys = Object.keys(mapStylesThumbs) as MapStyleKey[]\nconst tooltips: Record<MapStyleKey, string> = {\n  basic: 'Basic',\n  sat: 'Satellite',\n  topo: 'Topographic',\n}\n\nconst StyleThumb = ({ value, styleKey, onChange }: StyleControlProps & { styleKey: MapStyleKey }) => (\n  <img\n    src={mapStylesThumbs[styleKey]}\n    css={{\n      cursor: 'pointer',\n      height: 40,\n      width: 40,\n      border: value === styleKey ? '2px solid blue' : '2px solid white',\n      borderRadius: 10,\n      margin: 2,\n    }}\n    onClick={(e) => {\n      e.stopPropagation()\n      if (value !== styleKey) onChange(styleKey)\n    }}\n  />\n)\n\nexport const StyleControl = ({ value, onChange }: StyleControlProps): JSX.Element => {\n  const [isOpen, setIsOpen] = useState(false) // using controlled state to prevent large empty div blocking map hover when closed\n\n  return (\n    <div>\n      <MuiSpeedDial\n        ariaLabel=\"Style\"\n        hidden={false}\n        FabProps={{ size: 'small' }}\n        icon={<SatelliteIcon />}\n        direction=\"right\"\n        open={isOpen}\n        onOpen={() => setIsOpen(true)}\n        onClose={() => setIsOpen(false)}\n        css={{ minHeight: '56px' }} // hack to prevent collapse\n      >\n        {isOpen &&\n          styleKeys.map((styleKey) => (\n            <MuiSpeedDialAction\n              key={styleKey}\n              tooltipTitle={tooltips[styleKey]}\n              icon={<StyleThumb styleKey={styleKey} value={value} onChange={onChange} />}\n            />\n          ))}\n      </MuiSpeedDial>\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport ReactMapGL, { NavigationControl } from 'react-map-gl'\nimport ZoomOutMapIcon from '@mui/icons-material/ZoomOutMap'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogTitle from '@mui/material/DialogTitle'\nimport MuiDialogContent from '@mui/material/DialogContent'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiButton from '@mui/material/Button'\nimport 'mapbox-gl/dist/mapbox-gl.css'\n\nimport { mapStyles, MapStyleKey } from './styles'\n\nimport { SitesMapController, SITES_LAYER_ID, MAX_ZOOM } from './useSitesMapController'\nimport { atom, useRecoilState } from 'recoil'\nimport { StyleControl } from './StyleControl'\n\nexport interface SitesMapProps {\n  controller: SitesMapController\n  minimal?: boolean\n  children?: React.ReactNode\n}\n\nconst { REACT_APP_MAPBOX_TOKEN } = process.env\n\nexport const mapStyleKeyAtom = atom<MapStyleKey>({\n  key: 'SitesMap/mapStyleKeyAtom',\n  default: 'basic',\n})\n\nexport const SitesMap = ({ controller, children, minimal }: SitesMapProps): JSX.Element => {\n  const {\n    viewport,\n    setViewport,\n    sitesData,\n    handleClick,\n    handleHover,\n    hoverInfo,\n    siteChoicesNode,\n    cancelSiteChoices,\n    smartFitAll,\n  } = controller\n  const [mapStyleKey, setMapStyleKey] = useRecoilState(mapStyleKeyAtom)\n\n  const mapStyle = useMemo(() => mapStyles[mapStyleKey](sitesData), [sitesData, mapStyleKey])\n\n  // RENDER\n\n  if (!REACT_APP_MAPBOX_TOKEN)\n    return (\n      <div>\n        No Mapbox token found. Add <code>REACT_APP_MAPBOX_TOKEN</code> to relevant <code>.env</code> file.\n      </div>\n    )\n\n  return (\n    <>\n      <div css={{ height: '100%', width: '100%', position: 'relative' }}>\n        <ReactMapGL\n          onViewportChange={setViewport}\n          mapboxApiAccessToken={REACT_APP_MAPBOX_TOKEN}\n          onHover={handleHover}\n          interactiveLayerIds={[SITES_LAYER_ID]}\n          onClick={handleClick}\n          maxZoom={MAX_ZOOM}\n          mapStyle={mapStyle}\n          {...viewport} // must be before width and height\n          width=\"100%\"\n          height=\"100%\"\n        >\n          <NavigationControl\n            style={{\n              right: 10,\n              top: 10,\n            }}\n            showCompass={false}\n          />\n          {children}\n          {hoverInfo && (\n            <div\n              css={{\n                position: 'absolute',\n                left: hoverInfo.x,\n                top: hoverInfo.y - 10,\n                pointerEvents: 'none',\n                transform: 'translate(-50%,-100%)',\n              }}\n            >\n              <div>{hoverInfo.node}</div>\n            </div>\n          )}\n        </ReactMapGL>\n        <div css={{ position: 'absolute', top: 80, right: 10 }}>\n          <div className=\"mapboxgl-ctrl mapboxgl-ctrl-group\">\n            <button className=\"mapboxgl-ctrl-icon\" type=\"button\" title=\"Zoom to Fit\" onClick={() => smartFitAll()}>\n              <ZoomOutMapIcon sx={{ height: 18, width: 18, paddingTop: '4px' }} />\n            </button>\n          </div>\n        </div>\n        {!minimal && (\n          <div css={{ position: 'absolute', bottom: 30, left: 8 }}>\n            <StyleControl value={mapStyleKey} onChange={setMapStyleKey} />\n          </div>\n        )}\n      </div>\n      <MuiDialog open={!!siteChoicesNode} onClose={cancelSiteChoices}>\n        <MuiDialogTitle>Select Site</MuiDialogTitle>\n        <MuiDialogContent>{siteChoicesNode}</MuiDialogContent>\n        <MuiDialogActions>\n          <MuiButton onClick={cancelSiteChoices}>Cancel</MuiButton>\n        </MuiDialogActions>\n      </MuiDialog>\n    </>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useMemo } from 'react'\nimport { RecoilValue, useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiIconButton from '@mui/material/IconButton'\nimport OpenInNewIcon from '@mui/icons-material/OpenInNew'\n// import log from 'loglevel'\n\nimport { Site } from '../../types'\nimport { withSuspense } from '../withSuspense'\nimport { calculateFit } from './calculateFit'\nimport { SitesMap } from './SitesMap'\nimport { useSitesMapController, IDEAL_CLOSE_ZOOM, DEFAULT_VIEWPORT } from './useSitesMapController'\nimport { useNavigate } from '../AppRouter'\nimport { useSetSitesListingSource, SitesListingSource } from '../SitesListing'\n\ninterface SitesMapPreviewProps {\n  sitesSelector: RecoilValue<Site[]>\n  sitesListingSource: SitesListingSource\n}\n\nconst height = 300\nconst width = 300\n\nexport const SitesMapPreview = withSuspense(\n  ({ sitesSelector, sitesListingSource }: SitesMapPreviewProps): JSX.Element => {\n    const sites = useRecoilValue(sitesSelector)\n    const navigate = useNavigate()\n    const setSitesListingSource = useSetSitesListingSource()\n\n    const initialViewport = useMemo(() => {\n      if (sites.length === 0)\n        return {\n          ...DEFAULT_VIEWPORT,\n          zoom: 0.5,\n        }\n      return calculateFit(sites, { height, width, maxZoom: IDEAL_CLOSE_ZOOM })\n    }, [])\n\n    const onSiteClick = (site: Site) => {\n      setSitesListingSource(sitesListingSource)\n      window.setTimeout(() => navigate.siteDetail({ siteId: site.id }))\n    }\n\n    const handleExpandMapClick = () => {\n      setSitesListingSource(sitesListingSource)\n      window.setTimeout(() => {\n        if (sites.length === 1) {\n          navigate.siteDetail({ siteId: sites[0].id })\n        } else {\n          navigate.sites()\n        }\n      })\n    }\n\n    const controller = useSitesMapController({ sites, initialViewport, onSiteClick })\n\n    useEffect(() => {\n      // refocus when sites changes; has no effect when map first loaded with initialViewport (desired behaviour)\n      if (sites.length === 0) return\n      controller.smartFitAll()\n    }, [sites])\n\n    return (\n      <div css={{ height, width, position: 'relative' }}>\n        <div css={{ position: 'absolute', left: 0, right: 10, zIndex: 100 }}>\n          <MuiIconButton title=\"Expand Sites Map\" onClick={handleExpandMapClick}>\n            <OpenInNewIcon />\n          </MuiIconButton>\n        </div>\n        <SitesMap controller={controller} minimal></SitesMap>\n      </div>\n    )\n  },\n  () => (\n    <div css={{ height, width }}>\n      <MuiSkeleton width={width} height={height} variant=\"rectangular\" />\n    </div>\n  )\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\nexport interface SitesMapSidePanelProps {\n  children: React.ReactNode\n  className?: string\n  isOpen: boolean\n  transitionMs: number\n}\n\nexport const SitesMapSidePanel = ({\n  children,\n  className,\n  isOpen,\n  transitionMs,\n}: SitesMapSidePanelProps): JSX.Element => {\n  return (\n    <div\n      className={className}\n      css={{\n        width: isOpen ? '400px' : 0,\n        maxWidth: '50%',\n        transition: `width ${transitionMs}ms`,\n        position: 'relative',\n        overflow: 'hidden',\n        border: '1px solid lightgrey',\n        boxSizing: 'border-box',\n      }}\n    >\n      {children}\n    </div>\n  )\n}\n","import React, { useState, useCallback, useRef, useEffect } from 'react'\nimport produce, { Draft } from 'immer'\n\nexport type Updater<T> = (draft: Draft<T>) => void\n\nexport type UpdatableStateReturnTuple<T> = [\n  state: T,\n  setState: React.Dispatch<React.SetStateAction<T>>,\n  updateState: (updater: Updater<T>) => void\n]\n\nexport const useUpdatableState = <T>(initialState: T, deps: React.DependencyList): UpdatableStateReturnTuple<T> => {\n  const [state, setState] = useState<T>(initialState)\n  const instance = useRef<{ isFirstRender: boolean }>({ isFirstRender: true }).current\n  const updateState = useCallback((updater: Updater<T>) => setState((current) => produce(current, updater)), [setState])\n\n  useEffect(() => {\n    if (instance.isFirstRender) {\n      instance.isFirstRender = false\n      return\n    }\n    setState(initialState)\n  }, deps)\n\n  return [state, setState, updateState]\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { Marker } from 'react-map-gl'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\n\nimport { Point } from '../../types'\n\nexport interface PinSvgProps {\n  color?: string\n  largeDot?: boolean\n}\n\nexport interface PinMarkerProps extends PinSvgProps {\n  onDragEnd?: (newPoint: Point) => void\n  site: Point\n}\n\nexport const SITE_PIN_COLOR = '#aa00aa'\n\nexport const PinSvg = ({ color = SITE_PIN_COLOR, largeDot }: PinSvgProps): JSX.Element => (\n  <svg\n    version=\"1.1\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n    viewBox=\"50 0 195 295\"\n    xmlSpace=\"preserve\"\n  >\n    <path\n      style={{ fill: color }}\n      d=\"M146.667,0C94.903,0,52.946,41.957,52.946,93.721c0,22.322,7.849,42.789,20.891,58.878\nc4.204,5.178,11.237,13.331,14.903,18.906c21.109,32.069,48.19,78.643,56.082,116.864c1.354,6.527,2.986,6.641,4.743,0.212\nc5.629-20.609,20.228-65.639,50.377-112.757c3.595-5.619,10.884-13.483,15.409-18.379c6.554-7.098,12.009-15.224,16.154-24.084\nc5.651-12.086,8.882-25.466,8.882-39.629C240.387,41.962,198.43,0,146.667,0z M146.667,144.358\nc-28.892,0-52.313-23.421-52.313-52.313c0-28.887,23.421-52.307,52.313-52.307s52.313,23.421,52.313,52.307\nC198.98,120.938,175.559,144.358,146.667,144.358z\"\n    />\n    <circle style={{ fill: color }} cx=\"146.667\" cy=\"90.196\" r={largeDot ? '60' : '18'} />\n  </svg>\n)\n\nexport const PinMarker = ({ onDragEnd, site, ...svgProps }: PinMarkerProps): JSX.Element => {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [point, setPoint, updatePoint] = useUpdatableState<Point>(site, [site])\n\n  const handleDrag = (event: { lngLat: [number, number] }) => {\n    updatePoint((draft) => {\n      draft.longitude = event.lngLat[0]\n      draft.latitude = event.lngLat[1]\n    })\n  }\n\n  const handleDragEnd = (event: { lngLat: [number, number] }) => {\n    if (!onDragEnd) return\n    onDragEnd({ longitude: event.lngLat[0], latitude: event.lngLat[1] })\n  }\n\n  return (\n    <Marker\n      latitude={point.latitude}\n      longitude={point.longitude}\n      draggable={!!onDragEnd}\n      css={onDragEnd ? undefined : { pointerEvents: 'none' }}\n      onDrag={handleDrag}\n      onDragEnd={handleDragEnd}\n    >\n      <div\n        css={{\n          height: 40,\n          width: 40 / (216 / 145),\n          transform: `translate(-50%,-100%)`,\n        }}\n      >\n        <PinSvg {...svgProps} />\n      </div>\n    </Marker>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { withSuspense } from '../withSuspense'\nimport { Point } from '../../types'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { selectUsStateAtCoordinates } from '../../data/selectors'\nimport { useRecoilValue } from 'recoil'\nimport { ReadOnlyFieldProps } from '../ReadOnlyField'\n\nexport interface ReadOnlyUsStateFieldProps extends Omit<ReadOnlyFieldProps, 'value'> {\n  point: Point\n}\n\nexport const UsStateAtPointField = withSuspense(\n  ({\n    point: { latitude, longitude }, // ensure no addition properties are passed to Recoil selector serializer\n    ...restProps\n  }: ReadOnlyUsStateFieldProps): JSX.Element => {\n    const usState = useRecoilValue(selectUsStateAtCoordinates({ latitude, longitude }))\n    return <ReadOnlyField {...restProps} value={usState && usState.abbreviation} />\n  },\n  (props) => <ReadOnlyField {...props} value={<MuiSkeleton sx={{ width: '3em' }} />} />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiIconButton from '@mui/material/IconButton'\nimport CloseIcon from '@mui/icons-material/Close'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { Site } from '../../types'\nimport { selectUsStates, selectWaterbodyTypes } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { formatUtcDateTimeToAppDate } from '../../lib/formats'\nimport { PinSvg } from '../SitesMap'\nimport { UsStateAtPointField } from '../UsStateAtPointField'\n\nexport type SiteDetailPanelProps = {\n  addSampleCount?: number // for submission review\n  children?: React.ReactNode\n  onClose?: () => void\n  site: Site\n}\n\nexport const SITE_DETAIL_PANEL_TRANSITION_MS = 200\n\nexport const SiteDetailPanel = withSuspense(\n  ({ addSampleCount = 0, children, onClose, site }: SiteDetailPanelProps): JSX.Element => {\n    const usStates = useRecoilValue(selectUsStates)\n    const waterbodyTypes = useRecoilValue(selectWaterbodyTypes)\n\n    const {\n      id,\n      name,\n      usStateId,\n      sampleCount = 0,\n      latitude,\n      longitude,\n      waterbodyName,\n      waterbodyTypeId,\n      waterbodyCode,\n      description,\n      isReference,\n      createdDate = '',\n      updatedDate = '',\n    } = site\n\n    const waterbodyTypeName = waterbodyTypeId && (waterbodyTypes.find(({ id }) => id === waterbodyTypeId)?.name || '')\n\n    const isNewSite = id < 0\n    const isFetching = !isNewSite && typeof description === 'undefined' // heuristic: description is only fetched on site detail\n\n    const formatDate = (dateString: string) => {\n      if (isNewSite) return 'N/A'\n      return formatUtcDateTimeToAppDate(dateString)\n    }\n\n    return (\n      <div css={{ padding: '0.5em' }}>\n        <div css={{ display: 'flex', alignItems: 'center', paddingLeft: '10px' }}>\n          <div\n            css={{\n              width: 20,\n              marginRight: '0.5em',\n            }}\n          >\n            <PinSvg />\n          </div>\n          <div css={{ fontWeight: 'bold', fontSize: '120%', flex: 1, wordWrap: 'break-word', overflow: 'hidden' }}>\n            {name}\n          </div>\n\n          <div css={{ marginLeft: 'auto', height: 40, width: 40 }}>\n            {onClose && (\n              <MuiIconButton onClick={onClose}>\n                <CloseIcon />\n              </MuiIconButton>\n            )}\n          </div>\n        </div>\n        <div\n          css={{\n            marginTop: '1em',\n            display: 'grid',\n            gridTemplateColumns: '1fr 1fr',\n            gridTemplateRows: `\n                  auto\n                  auto\n                  1em\n                  auto\n                  auto\n                  auto\n                  1em\n                  auto\n                  1em\n                  auto\n                  auto\n                `,\n            gap: '0.5em',\n            gridTemplateAreas: `\n                  \"usState id\"\n                  \"latitude longitude\"\n                  \". .\"\n                  \"waterbodyName waterbodyType\"\n                  \"waterbodyCode isReference\"\n                  \"description   description\"\n                  \". .\"\n                  \"sampleCount .\"\n                  \". .\"\n                  \"createdDate updatedDate\"\n                  \". .\"\n                `,\n          }}\n        >\n          {usStateId ? (\n            <ReadOnlyField\n              gridArea=\"usState\"\n              label=\"State\"\n              value={usStates.find(({ id }) => id === usStateId)?.abbreviation}\n            />\n          ) : (\n            <UsStateAtPointField gridArea=\"usState\" label=\"State\" point={site} />\n          )}\n          <ReadOnlyField gridArea=\"id\" label=\"ID\" value={isNewSite ? 'TBD' : id} />\n          <ReadOnlyField gridArea=\"latitude\" label=\"Latitude\" value={latitude} />\n          <ReadOnlyField gridArea=\"longitude\" label=\"Longitude\" value={longitude} />\n          <ReadOnlyField\n            gridArea=\"sampleCount\"\n            label=\"# Samples\"\n            value={isFetching ? <MuiSkeleton sx={{ width: '3em' }} /> : sampleCount + addSampleCount}\n          />\n          <ReadOnlyField\n            gridArea=\"waterbodyName\"\n            label=\"Waterbody\"\n            value={isFetching ? <MuiSkeleton sx={{ width: '10em' }} /> : waterbodyName}\n          />\n          <ReadOnlyField\n            gridArea=\"waterbodyType\"\n            label=\"Waterbody Type\"\n            value={isFetching ? <MuiSkeleton sx={{ width: '10em' }} /> : waterbodyTypeName}\n          />\n          <ReadOnlyField\n            gridArea=\"waterbodyCode\"\n            label=\"Waterbody Code\"\n            value={isFetching ? <MuiSkeleton sx={{ width: '10em' }} /> : waterbodyCode}\n          />\n          <ReadOnlyField\n            gridArea=\"isReference\"\n            label=\"Reference\"\n            value={isFetching ? <MuiSkeleton sx={{ width: '10em' }} /> : isReference}\n          />\n          <ReadOnlyField\n            gridArea=\"description\"\n            label=\"Description\"\n            value={isFetching ? <MuiSkeleton sx={{ width: '20em' }} /> : description}\n          />\n          <ReadOnlyField\n            gridArea=\"createdDate\"\n            label=\"Created\"\n            value={isFetching ? <MuiSkeleton sx={{ width: '7em' }} /> : formatDate(createdDate)}\n          />\n          <ReadOnlyField\n            gridArea=\"updatedDate\"\n            label=\"Updated\"\n            value={isFetching ? <MuiSkeleton sx={{ width: '7em' }} /> : formatDate(updatedDate)}\n          />\n        </div>\n        {children}\n      </div>\n    )\n  },\n  () => null\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useRef } from 'react'\nimport { useHotkeys } from 'react-hotkeys-hook'\n\nimport { TextField, TextFieldProps } from '../TextField'\n\nexport interface TextFilterFieldProps extends TextFieldProps {\n  hotkeys?: string | false\n}\n\nexport const TextFilterField = ({\n  hotkeys = 'cmd+f, ctrl+f',\n  inputRef,\n  onChange,\n  value,\n  ...restProps\n}: TextFilterFieldProps): JSX.Element => {\n  const ownRef = useRef<HTMLInputElement>(null)\n  const effectiveRef = inputRef || ownRef\n\n  useHotkeys(hotkeys || '', (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    effectiveRef.current?.focus()\n  })\n\n  return <TextField css={{ width: '30em' }} value={value} onChange={onChange} inputRef={effectiveRef} {...restProps} />\n}\n","import { useState, useRef, useEffect, useCallback } from 'react'\n\nexport const useDebounce = <T>(input: T, delayMs: number): [T, (setValue) => void] => {\n  const debounceTimerRef = useRef<NodeJS.Timeout>()\n  const [debounced, setDebounced] = useState<T>(input)\n\n  const setDebouncedImmediately = useCallback((value: T) => {\n    if (debounceTimerRef.current) clearTimeout(debounceTimerRef.current)\n    setDebounced(value)\n  }, [])\n\n  useEffect(() => {\n    if (debounceTimerRef.current) clearTimeout(debounceTimerRef.current)\n    debounceTimerRef.current = setTimeout(() => {\n      setDebounced(input)\n    }, delayMs)\n  }, [input])\n\n  return [debounced, setDebouncedImmediately]\n}\n","import { useCallback } from 'react'\n\nimport { useDebounce } from '../../lib/useDebounce'\n\ntype UseTextFilterFieldReturnTuple = [\n  text: string,\n  setText: (newValue: string) => void,\n  filterText: string,\n  clear: () => void\n]\n\nexport const useTextFilterField = (\n  state: [text: string, setText: (newValue: string) => void]\n): UseTextFilterFieldReturnTuple => {\n  const [text, setText] = state\n\n  const [rawFilterText, setRawFilterText] = useDebounce(text, 500)\n\n  const filterText = rawFilterText.trim()\n\n  const clear = useCallback(() => {\n    setText('')\n    setRawFilterText('')\n  }, [])\n\n  return [text, setText, filterText, clear]\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '30em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"30em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiButton, { ButtonProps as MuiButtonProps } from '@mui/material/Button'\nimport MuiMenu from '@mui/material/Menu'\nimport MuiMenuItem from '@mui/material/MenuItem'\nimport ArrowDropDownIcon from '@mui/icons-material/ArrowDropDown'\nimport MuiDivider from '@mui/material/Divider'\n\nexport type MenuItem =\n  | {\n      key: string | number\n      label: React.ReactNode\n      onClick: () => void\n      disabled?: boolean\n    }\n  | typeof Divider\n\nexport interface MenuProps {\n  label: React.ReactNode\n  disabled?: boolean\n  icon?: React.ReactNode\n  items: MenuItem[]\n  variant?: MuiButtonProps['variant']\n}\n\nexport const Divider = 'DIVIDER'\n\nexport const Menu = ({\n  label,\n  disabled,\n  icon = <ArrowDropDownIcon />,\n  items,\n  variant = 'outlined',\n}: MenuProps): JSX.Element => {\n  const [anchorEl, setAnchorEl] = React.useState<HTMLElement | null>(null)\n  const isOpen = !!anchorEl\n\n  const handleMenuClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleMenuClose = () => {\n    setAnchorEl(null)\n  }\n\n  return (\n    <div>\n      <MuiButton onClick={handleMenuClick} variant={variant} disabled={disabled} startIcon={icon}>\n        {label}\n      </MuiButton>\n      <MuiMenu anchorEl={anchorEl} open={isOpen} onClose={handleMenuClose}>\n        {items.map((item, index) => {\n          if (item === Divider) return <MuiDivider key={`divider-${index}`} />\n          return (\n            <MuiMenuItem\n              key={item.key}\n              disabled={item.disabled}\n              onClick={() => {\n                item.onClick()\n                handleMenuClose()\n              }}\n            >\n              {item.label}\n            </MuiMenuItem>\n          )\n        })}\n      </MuiMenu>\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiTextField, { StandardTextFieldProps as MuiStandardTextFieldProps } from '@mui/material/TextField'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CommonFieldProps } from '../../types'\n\ninterface NumberFieldProps\n  extends CommonFieldProps<number | null>,\n    Omit<MuiStandardTextFieldProps, 'value' | 'onChange'> {\n  inputRef?: React.Ref<HTMLInputElement>\n  max?: number\n  min?: number\n  precision?: number\n  step?: number\n}\n\nexport const NumberField = ({\n  // CommonFieldProps\n  className,\n  disabled,\n  error,\n  gridArea,\n  label,\n  onChange,\n  readOnly,\n  value,\n\n  // NumberField\n  inputRef,\n  max,\n  min,\n  precision,\n  step,\n\n  // StandardTextFieldProps\n  inputProps = {},\n  ...restProps\n}: NumberFieldProps): JSX.Element => {\n  if (readOnly) return <ReadOnlyField className={className} gridArea={gridArea} label={label} value={value} />\n\n  const handleChange = ({ target: { value: textValue } }) => {\n    if (!textValue.trim()) {\n      onChange(null)\n      return\n    }\n    const numberValue = Number(textValue)\n    if (precision !== undefined && Number(numberValue.toFixed(precision)) !== numberValue) return\n    if (min !== undefined && numberValue < min) return\n    if (max !== undefined && numberValue > max) return\n    onChange(numberValue)\n  }\n\n  const combinedInputProps = { ...inputProps, step }\n\n  return (\n    <MuiTextField\n      size=\"small\"\n      className={className}\n      disabled={disabled || readOnly}\n      error={error}\n      inputRef={inputRef}\n      label={label}\n      onChange={handleChange}\n      value={value ?? ''}\n      type=\"number\"\n      css={{ gridArea }}\n      inputProps={combinedInputProps}\n      {...restProps}\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\n\nimport { Site } from '../../types'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { withSuspense } from '../withSuspense'\nimport { NumberField } from '../NumberField'\nimport { PinSvg } from '../SitesMap'\nimport { TextField } from '../TextField'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { lookupListToOptions, selectWaterbodyTypes } from '../../data/selectors'\nimport { useNotifications } from '../AppNotifications'\nimport { CheckboxField } from '../CheckboxField'\n\nexport interface EditSiteDialogProps {\n  allSitesNormalized: Site[]\n  isOpen: boolean\n  onCancel: () => void\n  onSave: (updatedSite: Site) => Promise<void>\n  site: Site | null\n}\n\ninterface Fields {\n  name: string\n  latitude: number | null\n  longitude: number | null\n  waterbodyName: string\n  waterbodyTypeId: number | null\n  waterbodyCode: string\n  description: string\n  isReference: boolean\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'started' | 'stopping'\n  isDirty: boolean\n  values: Fields\n}\n\nconst getInitialState = ({ site }: Pick<EditSiteDialogProps, 'site'>): State => {\n  const {\n    name = '',\n    latitude = null,\n    longitude = null,\n    waterbodyName = '',\n    waterbodyTypeId = null,\n    waterbodyCode = '',\n    description = '',\n    isReference = false,\n  } = site || {}\n  return {\n    editMode: 'started',\n    isDirty: false,\n    values: { name, latitude, longitude, waterbodyName, waterbodyTypeId, waterbodyCode, description, isReference },\n  }\n}\n\nexport const EditSiteDialog = withSuspense(\n  ({ allSitesNormalized, isOpen, onCancel, onSave, site }: EditSiteDialogProps): JSX.Element => {\n    const notifications = useNotifications()\n\n    // OPTIONS\n\n    const waterbodyTypeOptions = lookupListToOptions(useRecoilValue(selectWaterbodyTypes))\n\n    // STATE\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ site }), [site])\n\n    const {\n      values: { name, latitude, longitude, waterbodyName, waterbodyTypeId, waterbodyCode, description, isReference },\n      isDirty,\n      editMode,\n    } = state\n\n    const errors: FieldErrors = (() => {\n      const checkName = name.trim().toLowerCase()\n      const result = {\n        name:\n          checkName !== site?.name.toLowerCase() &&\n          (!checkName || !!allSitesNormalized.find(({ name }) => name === checkName)),\n        latitude: !latitude,\n        longitude: !longitude,\n      }\n      if (!Object.values(result).some((value) => value)) return undefined\n      return result\n    })()\n\n    // HANLDERS\n\n    const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n      updateState((draft) => {\n        Object.assign(draft.values, { [fieldName]: value })\n        draft.isDirty = true\n      })\n    }\n    const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n    const handleSave = async () => {\n      try {\n        updateState((draft) => {\n          draft.editMode = 'stopping'\n        })\n        await onSave({\n          id: site?.id ?? 0,\n          name: name.trim(),\n          latitude: latitude ?? 0,\n          longitude: longitude ?? 0,\n          waterbodyName: waterbodyName.trim(),\n          waterbodyTypeId,\n          waterbodyCode: waterbodyCode.trim(),\n          description: description.trim(),\n          isReference,\n        })\n      } catch (err) {\n        notifications.error(`Failed to save: ${err}`)\n      }\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n\n    const isSaving = editMode === 'stopping'\n\n    const handleCancel = () => {\n      if (isSaving) return // deny close\n      onCancel()\n    }\n\n    return (\n      <MuiDialog open={isOpen || isSaving} onClose={handleCancel} fullWidth maxWidth=\"sm\">\n        <MuiDialogContent>\n          <div\n            css={{\n              marginTop: '1em',\n              display: 'grid',\n              gridTemplateColumns: '1fr 1fr',\n              gridTemplateRows: `\n              auto\n              1em\n              auto\n              auto\n              1em\n              auto\n              auto\n              auto\n              `,\n              gap: '0.5em',\n              gridTemplateAreas: `\n              \"name          name\"\n              \".             .\"\n              \"usState       id\"\n              \"latitude      longitude\"\n              \".             .\"\n              \"waterbodyName waterbodyType\"\n              \"waterbodyCode isReference\"\n              \"description   description\"\n            `,\n            }}\n          >\n            <div css={{ gridArea: 'name', display: 'flex', alignItems: 'center' }}>\n              <div\n                css={{\n                  width: 20,\n                  marginRight: '0.5em',\n                }}\n              >\n                <PinSvg />\n              </div>\n              <TextField\n                label=\"Site Name\"\n                InputProps={{ sx: { fontWeight: 'bold', fontSize: '120%' } }}\n                value={name}\n                onChange={makeFieldChangeHandler('name')}\n                error={errors?.name}\n                fullWidth\n                maxLength={50}\n              />\n            </div>\n            <ReadOnlyField gridArea=\"id\" label=\"ID\" value={site && site.id > 0 ? site.id : 'TBD'} />\n            <NumberField\n              gridArea=\"latitude\"\n              label=\"Latitude\"\n              value={latitude}\n              onChange={makeFieldChangeHandler('latitude')}\n              step={0.0001}\n              error={errors?.latitude}\n              min={-90}\n              max={90}\n            />\n            <NumberField\n              gridArea=\"longitude\"\n              label=\"Longitude\"\n              value={longitude}\n              onChange={makeFieldChangeHandler('longitude')}\n              step={0.0001}\n              error={errors?.longitude}\n              min={-180}\n              max={180}\n            />\n            <TextField\n              gridArea=\"waterbodyName\"\n              label=\"Waterbody\"\n              value={waterbodyName}\n              onChange={makeFieldChangeHandler('waterbodyName')}\n              maxLength={255}\n            />\n            <AutocompleteField<number>\n              gridArea=\"waterbodyType\"\n              label=\"Waterbody Type\"\n              value={waterbodyTypeId}\n              onChange={makeFieldChangeHandler('waterbodyTypeId')}\n              options={waterbodyTypeOptions}\n              isClearable\n            />\n            <TextField\n              gridArea=\"waterbodyCode\"\n              label=\"Waterbody Code\"\n              value={waterbodyCode}\n              onChange={makeFieldChangeHandler('waterbodyCode')}\n              maxLength={100}\n            />\n            <CheckboxField\n              gridArea=\"isReference\"\n              label=\"Reference\"\n              value={isReference}\n              onChange={makeFieldChangeHandler('isReference')}\n            />\n            <TextField\n              gridArea=\"description\"\n              label=\"Description\"\n              value={description}\n              onChange={makeFieldChangeHandler('description')}\n              multiline\n              minRows={2}\n            />\n          </div>\n        </MuiDialogContent>\n        <MuiDialogActions>\n          <MuiButton onClick={handleCancel} disabled={isSaving}>\n            Cancel\n          </MuiButton>\n          <MuiButton onClick={handleSave} disabled={!isDirty || !!errors || isSaving}>\n            Save\n          </MuiButton>\n        </MuiDialogActions>\n      </MuiDialog>\n    )\n  },\n  () => null\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiButton from '@mui/material/Button'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\nimport MuiDialogTitle from '@mui/material/DialogTitle'\n\nexport interface ConfirmationDialogProps {\n  children?: React.ReactNode\n  cancelLabel?: React.ReactNode\n  confirmLabel?: React.ReactNode\n  isOpen: boolean\n  onClose: () => void\n  onConfirm: () => void\n  title: React.ReactNode\n}\n\nexport const ConfirmationDialog = ({\n  children,\n  cancelLabel = 'Cancel',\n  confirmLabel = 'Yes',\n  isOpen,\n  onClose,\n  onConfirm,\n  title,\n}: ConfirmationDialogProps): JSX.Element => {\n  const handleConfirm = () => {\n    onConfirm()\n    onClose()\n  }\n\n  return (\n    <MuiDialog open={isOpen} onClose={onClose}>\n      <MuiDialogTitle>{title}</MuiDialogTitle>\n      <MuiDialogContent>{children}</MuiDialogContent>\n      <MuiDialogActions>\n        <MuiButton onClick={onClose}>{cancelLabel}</MuiButton>\n        <MuiButton onClick={handleConfirm}>{confirmLabel}</MuiButton>\n      </MuiDialogActions>\n    </MuiDialog>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react'\nimport { atom, selector, useRecoilCallback, useRecoilState, useRecoilValue, useSetRecoilState } from 'recoil'\nimport { identity } from 'lodash'\nimport MuiButton from '@mui/material/Button'\nimport produce from 'immer'\n// import log from 'loglevel'\n\nimport { Point, Site } from '../../types'\nimport { Filter, FilterChips } from '../Filters'\nimport { SitesMap, SitesMapSidePanel, useSitesMapController } from '../SitesMap'\nimport { DataGridRecordCount } from '../DataGrid'\nimport {\n  allSitesAtom,\n  allSitesStatusAtom,\n  selectSitesByBoxId,\n  selectSitesByProjectId,\n  selectUsStates,\n  FETCH_ALL_SITES_STATUS,\n  useFetchAllSitesOptimized,\n  useFetchSiteDetailBySiteIdOptimized,\n  sparseSitesDetailAtom,\n  selectMyUser,\n  useDeferredInvalidate,\n} from '../../data/selectors'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { withSuspense } from '../withSuspense'\nimport { SiteDetailPanel, SITE_DETAIL_PANEL_TRANSITION_MS } from '../SiteDetailPanel'\nimport { TextField } from '../TextField'\nimport { useTextFilterField } from '../TextFilterField'\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport { PinMarker } from '../SitesMap'\nimport { LinearProgress } from '../LinearProgress'\nimport { Fallback } from './Fallback'\nimport { useNotifications } from '../AppNotifications'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport { Divider, Menu } from '../Menu'\nimport { EditSiteDialog } from '../EditSiteDialog'\nimport { createSite, deleteSite, updateSite } from '../../data/calls'\nimport { useApi } from '../../data/api'\n\nimport { ConfirmationDialog } from '../ConfirmationDialog'\n\nexport interface SitesListingProps {\n  siteId?: string | number\n}\n\nexport const ANY_US_STATE = 0\n\n// SELECTORS\n\nconst selectUsStateOptions = selector({\n  key: 'SitesListing/selectUsStateOptions',\n  get: async ({ get }) => {\n    const usStates = get(selectUsStates)\n    return [\n      { value: ANY_US_STATE, label: 'Any' },\n      ...usStates.map(({ id: value, abbreviation: label }) => ({ value, label })),\n    ]\n  },\n})\n\n// MODE & FILTER STATE\n\nexport type SitesListingSource = { type: 'box'; id: number } | { type: 'project'; id: number; name: string } | null\n\nconst sitesListingSourceAtom = atom<SitesListingSource>({\n  key: 'SitesListing/sitesListingSourceAtom',\n  default: null,\n})\n\nconst usStateFilterIdAtom = atom<number>({\n  key: 'SitesListing/usStateFilterIdAtom',\n  default: ANY_US_STATE,\n})\n\nconst textFilterAtom = atom<string>({\n  key: 'SitesListing/textFilterAtom',\n  default: '',\n})\n\nexport const useSetSitesListingSource = (): ((sitesListingSource: SitesListingSource) => void) => {\n  const setSitesListingSource = useSetRecoilState(sitesListingSourceAtom)\n  const setUsStateFilter = useSetRecoilState(usStateFilterIdAtom)\n  const setTextFilter = useSetRecoilState(textFilterAtom)\n  return useCallback((sitesListingSource: SitesListingSource) => {\n    setSitesListingSource(sitesListingSource)\n    setUsStateFilter(ANY_US_STATE)\n    setTextFilter('')\n  }, [])\n}\n\n// COMPONENT\n\nexport const SitesListing = withSuspense(\n  ({ siteId: siteIdUnsanitized }: SitesListingProps): JSX.Element => {\n    const siteId = siteIdUnsanitized ? Number(siteIdUnsanitized) : null\n    const isNewSite = siteIdUnsanitized === 'new'\n\n    const navigate = useNavigate()\n    const notifications = useNotifications()\n    const user = useRecoilValue(selectMyUser)\n    const api = useApi()\n    const deferredInvalidate = useDeferredInvalidate()\n\n    // CONTROLS STATE\n\n    const usStateOptions = useRecoilValue(selectUsStateOptions)\n    const [usStateIdFilter, setUsStateIdFilter] = useRecoilState(usStateFilterIdAtom)\n    const [textFilter, setTextFilter, textFilterDebounced, resetTextFilter] = useTextFilterField(\n      useRecoilState(textFilterAtom)\n    )\n\n    const [isEditOpen, setIsEditOpen] = useState(false)\n    const [editTargetSite, setEditTargetSite] = useState<Site | null>(null)\n    const [isSaving, setIsSaving] = useState(false)\n\n    const [isMoving, setIsMoving] = useState(false)\n    const [movingTargetPoint, setMovingTargetPoint] = useState<Point>({ latitude: 0, longitude: 0 })\n\n    const [isConfirmDeleteOpen, setIsConfirmDeleteOpen] = useState(false)\n    const [isDeleting, setIsDeleting] = useState(false)\n\n    const isUiLocked = isMoving || isDeleting\n\n    // DATA MANAGEMENT\n\n    const [sitesListingSource, setSitesListingSource] = useRecoilState(sitesListingSourceAtom)\n    const allSitesStatus = useRecoilValue(allSitesStatusAtom)\n    const [allSites, setAllSites] = useRecoilState(allSitesAtom)\n    const [sparseSitesDetail, setSparseSitesDetail] = useRecoilState(sparseSitesDetailAtom)\n\n    const [sourceSites, setSourceSites] = useState<Site[]>([])\n    const [detailPanelSite, setDetailPanelSite] = useState<Site | undefined>(undefined)\n\n    const allSitesNormalized = useMemo(\n      () => allSites.map((site) => ({ ...site, name: site.name.toLowerCase() })),\n      [allSites]\n    )\n\n    const getBoxSitesByBoxId = useRecoilCallback<[number], Promise<Site[]>>(({ snapshot }) => async (id: number) => {\n      return snapshot.getPromise(selectSitesByBoxId(id))\n    })\n\n    const getProjectSitesByProjectId = useRecoilCallback<[number], Promise<Site[]>>(\n      ({ snapshot }) =>\n        async (id: number) => {\n          return snapshot.getPromise(selectSitesByProjectId(id))\n        }\n    )\n\n    const fetchAllSitesOptimized = useFetchAllSitesOptimized()\n    const fetchSiteDetailBySiteIdOptimized = useFetchSiteDetailBySiteIdOptimized()\n\n    useEffect(() => {\n      switch (sitesListingSource?.type) {\n        case 'box': {\n          // box mode: use selector\n          getBoxSitesByBoxId(sitesListingSource.id).then(setSourceSites)\n          break\n        }\n        case 'project': {\n          // project mode: use selector\n          getProjectSitesByProjectId(sitesListingSource.id).then(setSourceSites)\n          break\n        }\n        default: {\n          fetchAllSitesOptimized() // sites are progressively updated in next effect\n        }\n      }\n    }, [sitesListingSource])\n\n    useEffect(() => {\n      if (!sitesListingSource) {\n        // \"all\" mode, and allSites have changed: use all sites\n        setSourceSites(allSites)\n      }\n    }, [sitesListingSource, allSites])\n\n    useEffect(() => {\n      fetchSiteDetailBySiteIdOptimized(siteId)\n    }, [siteId])\n\n    const isFetching = allSitesStatus === FETCH_ALL_SITES_STATUS.fetching\n\n    const selectedSite = useMemo(() => {\n      // get best selected site data\n      if (!siteId) return undefined\n      return (\n        sparseSitesDetail.find((siteDetail) => siteDetail.id === siteId) ||\n        sourceSites.find((site) => site.id === siteId)\n      )\n    }, [sourceSites, sparseSitesDetail, siteId])\n\n    // FILTERING\n\n    const filters = useMemo(() => {\n      const result: Filter<Site>[] = []\n\n      if (sitesListingSource) {\n        const id = 'sitesListingSource'\n        const filterFn = identity\n        const onDelete = isUiLocked ? undefined : () => setSitesListingSource(null)\n\n        switch (sitesListingSource.type) {\n          case 'box': {\n            result.push({ id, label: `Box ${sitesListingSource.id}`, filterFn, onDelete })\n            break\n          }\n          case 'project': {\n            result.push({ id, label: `Project ${sitesListingSource.name}`, filterFn, onDelete })\n            break\n          }\n        }\n      }\n\n      if (usStateIdFilter !== ANY_US_STATE) {\n        const usStateAbbreviation = usStateOptions.find(({ value }) => value === usStateIdFilter)?.label ?? '?'\n        result.push({\n          id: 'state',\n          label: `State: ${usStateAbbreviation}`,\n          filterFn: ({ usStateId }) => usStateId === usStateIdFilter,\n          onDelete: isUiLocked\n            ? undefined\n            : () => {\n                setUsStateIdFilter(ANY_US_STATE)\n              },\n        })\n      }\n\n      if (textFilterDebounced) {\n        result.push({\n          id: 'text',\n          label: `Name contains \"${textFilterDebounced}\"`,\n          filterFn: ({ name }) => name.toLowerCase().includes(textFilterDebounced.toLowerCase()),\n          onDelete: isUiLocked ? undefined : resetTextFilter,\n        })\n      }\n\n      return result\n    }, [sitesListingSource, usStateIdFilter, textFilterDebounced, isUiLocked])\n\n    const filteredSites = useMemo<Site[]>(() => {\n      return filters.reduce<Site[]>((acc, { filterFn }) => acc.filter(filterFn), sourceSites)\n    }, [sourceSites, filters])\n\n    // MAP EVENTS AND CONTROLLER\n\n    const onSiteClick = (site: Site) => {\n      if (isUiLocked) {\n        notifications.info('Cannot select another site while editing a site.')\n        return\n      }\n      navigate.siteDetail({ siteId: site.id }, true)\n    }\n\n    const controller = useSitesMapController({ sites: filteredSites, onSiteClick })\n\n    // SELECTION & FITTING\n\n    useEffect(() => {\n      // synchronize site detail panel with current selected site\n      setDetailPanelSite(selectedSite)\n    }, [selectedSite])\n\n    useEffect(() => {\n      // target site has changed\n      if (!selectedSite) return // site isn't in data yet, must wait (not accounting for unusual case where ID doesn't exist)\n\n      const { viewport, centerSite } = controller\n      window.setTimeout(\n        () => {\n          centerSite(selectedSite, { zoom: Math.max(9, viewport.zoom || 0) }) // center selected, and zoom in (unless already zoomed closer)\n        },\n        detailPanelSite ? 0 : SITE_DETAIL_PANEL_TRANSITION_MS // if detail panel open, center immediately, if detail panel closed, wait for open to avoid map jank\n      )\n    }, [siteId, !!selectedSite])\n\n    useEffect(() => {\n      // filters changed, attempt to fit\n      if (selectedSite) return // site selected, do not perform fit\n      if (!controller.isViewportReady) return // viewport not ready, don't fit yet (desired behaviour for all-sites initial load)\n      controller.smartFitAll() // fit filtered sites; if no sites, smartFitAll does nothing\n    }, [filters])\n\n    const [isInitialFitted, setIsInitalFitted] = useState(false)\n\n    useEffect(() => {\n      // if sitesListingSource in use, perform initial fit once\n      if (!sitesListingSource || isInitialFitted) return // not doing or already done\n      if (!controller.isViewportReady) return // viewport not ready so smartFitAll can't be run yet\n      controller.smartFitAll() // fit sites\n      setIsInitalFitted(true) // ensure runs only once\n    }, [sitesListingSource, controller.isViewportReady])\n\n    // SITE CRUD\n\n    useEffect(() => {\n      if (!isNewSite) return\n      setEditTargetSite({\n        id: -1,\n        name: '',\n        latitude: controller.viewport.latitude ?? 0,\n        longitude: controller.viewport.longitude ?? 0,\n        waterbodyCode: '',\n        waterbodyTypeId: null,\n        waterbodyName: '',\n        description: '',\n        isReference: false,\n      })\n      setIsEditOpen(true)\n    }, [isNewSite])\n\n    const isDetailSiteRetrieved = detailPanelSite && !!detailPanelSite.createdDate // heuristic\n\n    const handleStartMoveSite = () => {\n      if (!detailPanelSite) throw new Error('No site selected.')\n      setIsMoving(true)\n      setMovingTargetPoint(detailPanelSite)\n    }\n\n    const handleSiteMoved = (newPoint: Point) => {\n      setMovingTargetPoint(newPoint)\n    }\n\n    const handleCancelMoveSite = () => {\n      setIsMoving(false)\n    }\n\n    const handleSaveMovedSite = async () => {\n      if (!detailPanelSite) throw new Error('No site selected.')\n      await handleSaveSite({ ...detailPanelSite, ...movingTargetPoint })\n      setIsMoving(false)\n    }\n\n    const handleSaveSite = async (values: Site) => {\n      setIsSaving(true)\n      try {\n        const siteInput = {\n          name: values.name.trim(),\n          latitude: values.latitude,\n          longitude: values.longitude,\n          waterbodyName: values.waterbodyName?.trim() || null,\n          waterbodyTypeId: values.waterbodyTypeId ?? null,\n          waterbodyCode: values.waterbodyCode?.trim() || null,\n          description: values.description?.trim() || null,\n          isReference: values.isReference ?? false,\n        }\n        if (isNewSite) {\n          const newSiteId = await createSite(api, deferredInvalidate)(siteInput)\n          setAllSites(\n            produce((draft) => {\n              draft.push({\n                id: newSiteId,\n                name: siteInput.name,\n                latitude: siteInput.latitude,\n                longitude: siteInput.longitude,\n              })\n            })\n          )\n          navigate.siteDetail({ siteId: newSiteId }, true)\n          notifications.info(`Created site ${siteInput.name}`)\n          setIsEditOpen(false)\n        } else {\n          await updateSite(api, deferredInvalidate)({ ...siteInput, id: values.id })\n          setAllSites(\n            produce((draft) => {\n              const targetSite = draft.find(({ id }) => id === values.id)\n              if (!targetSite) throw new Error('Site not found.')\n              Object.assign(targetSite, values)\n              targetSite.usStateId = undefined\n            })\n          )\n          setSparseSitesDetail(\n            produce((draft) => {\n              const targetSite = draft.find(({ id }) => id === values.id)\n              if (!targetSite) throw new Error('Site not found.')\n              Object.assign(targetSite, values)\n              targetSite.usStateId = undefined\n            })\n          )\n          notifications.info(`Saved site ${siteInput.name}`)\n          setIsEditOpen(false)\n        }\n      } catch (err) {\n        notifications.error(`Failed to save site: ${err}`)\n      }\n      setIsSaving(false)\n    }\n\n    const handleDeleteSite = async () => {\n      if (!detailPanelSite) throw new Error('No site.')\n      setIsDeleting(true)\n      try {\n        await deleteSite(api, deferredInvalidate)(detailPanelSite)\n        setAllSites(\n          produce((draft) => {\n            const targetSiteIndex = draft.findIndex(({ id }) => id === detailPanelSite.id)\n            if (targetSiteIndex === -1) return\n            draft.splice(targetSiteIndex, 1)\n          })\n        )\n        setSparseSitesDetail(\n          produce((draft) => {\n            const targetSiteIndex = draft.findIndex(({ id }) => id === detailPanelSite.id)\n            if (targetSiteIndex === -1) return\n            draft.splice(targetSiteIndex, 1)\n          })\n        )\n        notifications.info(`Deleted site ${detailPanelSite.name}`)\n        navigate.sites(undefined, true)\n      } catch (err) {\n        notifications.error(`Failed to delete site: ${err}`)\n      }\n      setIsDeleting(false)\n    }\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', gap: '0.5em' }}>\n          <AutocompleteField\n            value={usStateIdFilter}\n            onChange={(value) => setUsStateIdFilter(Number(value))}\n            options={usStateOptions}\n            label=\"State\"\n            css={{ width: '10em' }}\n            disabled={isUiLocked}\n          />\n          <TextField\n            value={textFilter}\n            onChange={(value) => setTextFilter(value)}\n            label=\"Site Name\"\n            css={{ width: '20em' }}\n            disabled={isUiLocked}\n          />\n          <div css={{ marginLeft: 'auto' }}>\n            {user.hasPermission(NAMCResource.sites, GrantAction.createAny) && (\n              <MuiButton variant=\"outlined\" onClick={() => navigate.siteCreate()} disabled={isUiLocked}>\n                Create New Site\n              </MuiButton>\n            )}\n          </div>\n        </div>\n        <div css={{ minHeight: '2em', margin: '0.75em 0', display: 'flex' }}>\n          <FilterChips filters={filters} joinLabel=\"and\" />\n          <DataGridRecordCount\n            total={sourceSites.length}\n            visible={filteredSites.length}\n            descriptor=\"site\"\n            isLoading={isFetching}\n          />\n        </div>\n        <div css={{ flex: 1, display: 'flex' }}>\n          <div css={{ flex: 1, position: 'relative' }}>\n            {isFetching && (\n              <LinearProgress\n                delayMs={500}\n                css={{ position: 'absolute', width: '100%', height: '5px', opacity: 0.75, zIndex: 100 }}\n              />\n            )}\n            <SitesMap controller={controller}>\n              {selectedSite && (\n                <PinMarker\n                  site={isMoving ? { ...selectedSite, ...movingTargetPoint } : selectedSite}\n                  onDragEnd={isMoving ? handleSiteMoved : undefined}\n                />\n              )}\n            </SitesMap>\n          </div>\n          <SitesMapSidePanel isOpen={!!detailPanelSite} transitionMs={SITE_DETAIL_PANEL_TRANSITION_MS}>\n            {detailPanelSite && (\n              <SiteDetailPanel\n                site={detailPanelSite}\n                onClose={\n                  isUiLocked\n                    ? undefined\n                    : () => {\n                        navigate.sites(undefined, true)\n                      }\n                }\n              >\n                <div css={{ marginLeft: '0.8rem', display: 'flex', gap: '0.5rem' }}>\n                  {!isUiLocked && user.hasPermission(NAMCResource.sites, GrantAction.updateAny) && (\n                    <Menu\n                      label=\"Actions\"\n                      disabled={!isDetailSiteRetrieved}\n                      items={[\n                        {\n                          key: 'edit',\n                          label: 'Edit Site',\n                          onClick: () => {\n                            setEditTargetSite(detailPanelSite)\n                            setIsEditOpen(true)\n                          },\n                        },\n                        {\n                          key: 'drag',\n                          label: 'Drag Site',\n                          onClick: handleStartMoveSite,\n                        },\n                        Divider,\n                        {\n                          key: 'delete',\n                          label: 'Delete Site',\n                          onClick: () => {\n                            setIsConfirmDeleteOpen(true)\n                          },\n                          disabled:\n                            !user.hasPermission(NAMCResource.sites, GrantAction.deleteAny) ||\n                            typeof detailPanelSite.sampleCount === 'undefined' ||\n                            detailPanelSite.sampleCount > 0,\n                        },\n                      ]}\n                    />\n                  )}\n                  {isMoving && (\n                    <>\n                      <MuiButton onClick={handleCancelMoveSite} variant=\"outlined\" disabled={isSaving}>\n                        Cancel\n                      </MuiButton>\n                      <MuiButton onClick={handleSaveMovedSite} variant=\"contained\" disabled={isSaving}>\n                        Save\n                      </MuiButton>\n                    </>\n                  )}\n                </div>\n              </SiteDetailPanel>\n            )}\n          </SitesMapSidePanel>\n        </div>\n        <EditSiteDialog\n          isOpen={isEditOpen}\n          onCancel={() => {\n            if (isNewSite) navigate.sites(undefined, true) // onClose only called\n            setIsEditOpen(false)\n          }}\n          onSave={handleSaveSite}\n          site={editTargetSite}\n          allSitesNormalized={allSitesNormalized}\n        />\n        <ConfirmationDialog\n          isOpen={isConfirmDeleteOpen}\n          onClose={() => setIsConfirmDeleteOpen(false)}\n          onConfirm={handleDeleteSite}\n          title=\"Confirm Delete Site\"\n        >\n          Are you sure you want to delete site {detailPanelSite?.name}?\n        </ConfirmationDialog>\n        {isMoving && (\n          <ConfirmNavigateAway message=\"Site location has not been saved. Are you sure you want to leave?\" />\n        )}\n      </div>\n    )\n  },\n  () => <Fallback />\n)\n","import React, { useMemo } from 'react'\n\nimport { DataGrid } from '../DataGrid'\nimport { samplesColumnDefs } from './columnDefs'\nimport { SourceSample } from '../../types'\nimport { formatUtcDateTimeToAppDate } from '../../lib/formats'\nimport { useNavigate } from '../AppRouter'\nimport { renderers } from '../DataGrid'\nimport { SitesListingSource, useSetSitesListingSource } from '../SitesListing'\n\ninterface SamplesDataGridProps {\n  samples: SourceSample[]\n  sitesListingSource: SitesListingSource\n}\n\ninterface SampleRow extends SourceSample {\n  sampleId: {\n    label: number\n    onClick: () => void\n  }\n  site: {\n    label: string\n    onClick: () => void\n  }\n  sortState: string\n  identificationState: string\n}\n\nexport const SamplesDataGrid = ({ samples, sitesListingSource }: SamplesDataGridProps): JSX.Element => {\n  const navigate = useNavigate()\n  const setSitesListingSource = useSetSitesListingSource()\n\n  const rows = useMemo<SampleRow[]>(\n    () =>\n      samples.map((sample) => {\n        const { id } = sample\n        const sampleId = {\n          label: id,\n          onClick: () => navigate.sampleDetail({ sampleId: id }),\n        }\n\n        const { siteId, siteName } = sample\n\n        const { sortEndDate, sortStartDate, sorterName } = sample\n        const sortState = (() => {\n          if (sortEndDate) return `${sorterName} on ${formatUtcDateTimeToAppDate(sortEndDate)}`\n          if (!sortStartDate) return 'Not sorted'\n          return `Started by ${sorterName} on ${formatUtcDateTimeToAppDate(sortStartDate)}`\n        })()\n\n        const { identifierName, identificationEndDate, identificationStartDate } = sample\n        const identificationState = (() => {\n          if (identificationEndDate)\n            return `${identifierName ?? 'Unknown'} on ${formatUtcDateTimeToAppDate(identificationEndDate)}`\n          if (!identificationStartDate) return 'Not identified'\n          return `Started by ${identifierName} on ${formatUtcDateTimeToAppDate(identificationStartDate)}`\n        })()\n\n        const site = {\n          label: siteName,\n          onClick: () => {\n            setSitesListingSource(sitesListingSource)\n            navigate.siteDetail({ siteId })\n          },\n        }\n\n        return {\n          ...sample,\n          sampleId,\n          site,\n          sortState,\n          identificationState,\n        }\n      }),\n    [samples]\n  )\n\n  return <DataGrid<SampleRow> columnDefs={samplesColumnDefs} rows={rows} frameworkComponents={renderers} />\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { withSuspense } from '../withSuspense'\nimport { selectBoxSamplesByBoxId } from '../../data/selectors'\nimport { SamplesDataGrid } from '../SamplesDataGrid'\n\ninterface BoxDetailProps {\n  boxId: number\n}\n\nexport const BoxSamples = withSuspense(\n  ({ boxId }: BoxDetailProps): JSX.Element => {\n    const boxSamples = useRecoilValue(selectBoxSamplesByBoxId(boxId))\n    return <SamplesDataGrid samples={boxSamples} sitesListingSource={{ type: 'box', id: boxId }} />\n  },\n  () => <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiAccordion from '@mui/material/Accordion'\nimport MuiAccordionSummary from '@mui/material/AccordionSummary'\nimport MuiAccordionDetails from '@mui/material/AccordionDetails'\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore'\n\nexport interface AccordionPanelProps {\n  value: boolean\n  onChange: (newValue: boolean) => void\n  locked?: boolean\n  summary: React.ReactNode\n  actions?: React.ReactNode\n  children: React.ReactNode\n}\n\nexport const AccordionPanel = ({\n  value,\n  onChange,\n  locked,\n  summary,\n  actions,\n  children,\n}: AccordionPanelProps): JSX.Element => (\n  <MuiAccordion\n    expanded={value}\n    onChange={(e, newValue) => {\n      if (locked) return\n      onChange(newValue)\n    }}\n    css={{ marginBottom: '1em' }}\n  >\n    <MuiAccordionSummary\n      expandIcon={<ExpandMoreIcon color={locked ? 'disabled' : undefined} />}\n      style={{ cursor: locked ? 'default' : undefined }} // deliberately using style here as override\n    >\n      <div css={{ display: 'flex', alignItems: 'center', width: '100%' }}>\n        <div>{summary}</div>\n        {actions && (\n          <div\n            css={{ margin: '0 0.5em 0 auto' }}\n            onClick={(e) => {\n              e.stopPropagation()\n            }}\n          >\n            {actions}\n          </div>\n        )}\n      </div>\n    </MuiAccordionSummary>\n    <MuiAccordionDetails>{children}</MuiAccordionDetails>\n  </MuiAccordion>\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\nexport interface TitleProps {\n  children: React.ReactNode\n  className?: string\n}\n\nexport const Title = ({ children, className }: TitleProps): JSX.Element => {\n  return (\n    <div className={className} css={{ fontWeight: '700', fontSize: '125%' }}>\n      {children}\n    </div>\n  )\n}\n\nconst Subtitle = ({ children }: TitleProps): JSX.Element => {\n  return <span css={{ fontWeight: '300' }}>{children}</span>\n}\n\nTitle.Subtitle = Subtitle\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\n\nexport interface ProgressFieldProps {\n  // CommonFieldProps\n  gridArea?: string\n  label: string\n  value: number\n\n  // ProgressField\n  doneCount: number\n  totalCount: number\n}\n\nexport const ProgressField = ({\n  doneCount,\n  gridArea, //\n  label,\n  totalCount,\n  value,\n}: ProgressFieldProps): JSX.Element => {\n  const percent = `${Math.floor(value * 100)}%`\n\n  const roValue = (\n    <div\n      css={{\n        height: '1em',\n        width: '100%',\n        position: 'relative',\n      }}\n    >\n      <div css={{ position: 'absolute', background: 'lightgrey', width: '100%', height: '110%', top: '16%' }} />\n      <div css={{ position: 'absolute', background: '#42d64c', width: percent, height: '110%', top: '16%' }} />\n      <div css={{ position: 'absolute', width: '100%', textAlign: 'center' }}>\n        {doneCount} of {totalCount} ({percent})\n      </div>\n    </div>\n  )\n\n  return <ReadOnlyField label={label} value={roValue} gridArea={gridArea} minWidth={120} />\n}\n","import React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport { useRecoilValue } from 'recoil'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { ProgressField } from '../ProgressField'\nimport { withSuspense } from '../withSuspense'\nimport { selectBoxSamplesByBoxId } from '../../data/selectors'\n\nexport const SortingProgressField = withSuspense<{\n  boxId: number\n  gridArea: string\n  value: number\n}>(\n  ({ boxId, value, ...restProps }) => {\n    const boxSamples = useRecoilValue(selectBoxSamplesByBoxId(boxId))\n    const doneCount = boxSamples.filter((boxSample) => boxSample.sortEndDate).length\n    const totalCount = boxSamples.length\n    return <ProgressField {...restProps} label=\"Sorting\" value={value} doneCount={doneCount} totalCount={totalCount} />\n  },\n  (props): JSX.Element => <ReadOnlyField {...props} label=\"Sorting\" value={<MuiSkeleton />} minWidth={120} />\n)\n","import React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport { useRecoilValue } from 'recoil'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { ProgressField } from '../ProgressField'\nimport { withSuspense } from '../withSuspense'\nimport { selectBoxSamplesByBoxId } from '../../data/selectors'\n\nexport const IdentificationProgressField = withSuspense<{\n  boxId: number\n  gridArea: string\n  value: number\n}>(\n  ({ boxId, value, ...restProps }) => {\n    const boxSamples = useRecoilValue(selectBoxSamplesByBoxId(boxId))\n    const doneCount = boxSamples.filter((boxSample) => boxSample.identificationEndDate).length\n    const totalCount = boxSamples.length\n    return (\n      <ProgressField\n        {...restProps}\n        label=\"Identification\"\n        value={value}\n        doneCount={doneCount}\n        totalCount={totalCount}\n      />\n    )\n  },\n  (props): JSX.Element => <ReadOnlyField {...props} label=\"Identification\" value={<MuiSkeleton />} minWidth={120} />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiTextField from '@mui/material/TextField'\nimport MuiAutocomplete from '@mui/material/Autocomplete'\nimport MuiChip, { ChipProps } from '@mui/material/Chip'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CommonFieldProps } from '../../types'\n\nexport interface Option {\n  value: string | number\n  label: string\n  disabled?: boolean\n}\n\nexport interface AutocompleteArrayFieldProps extends CommonFieldProps<(string | number)[]> {\n  options: Option[]\n}\n\nconst SelectedOptionChip = ({ label, value, onDelete }: Option & ChipProps) => (\n  <MuiChip label={label} key={value} onDelete={onDelete} css={{ margin: '2px' }} />\n)\n\nexport const AutocompleteArrayField = ({\n  // CommonFieldProps\n  className,\n  disabled,\n  error,\n  gridArea,\n  label,\n  onChange,\n  readOnly,\n  value: valueArray,\n\n  // AutocompleteArrayField\n  options,\n}: AutocompleteArrayFieldProps): JSX.Element => {\n  const selectedOptions = options.filter((option) => valueArray.includes(option.value))\n\n  if (readOnly)\n    return (\n      <ReadOnlyField\n        label={label}\n        gridArea={gridArea}\n        className={className}\n        value={\n          selectedOptions.length > 0\n            ? selectedOptions.map(({ value, label }) => <SelectedOptionChip key={value} value={value} label={label} />)\n            : null\n        }\n      />\n    )\n\n  return (\n    <MuiAutocomplete\n      multiple\n      className={className}\n      disablePortal\n      options={options}\n      disabled={disabled}\n      getOptionLabel={(option) => option.label}\n      getOptionDisabled={(option) => !!option.disabled}\n      renderInput={(params) => (\n        <MuiTextField\n          {...params}\n          label={label}\n          error={error}\n          InputLabelProps={{ shrink: selectedOptions.length > 0 }}\n        />\n      )}\n      renderTags={(renderedOptions: readonly Option[], getTagProps) =>\n        renderedOptions.map(({ value, label }, index) => (\n          <SelectedOptionChip value={value} label={label} {...getTagProps({ index })} key={value} />\n        ))\n      }\n      onChange={(event, selected) => {\n        onChange(selected.map(({ value }) => value))\n      }}\n      size=\"small\"\n      value={selectedOptions}\n      css={{ gridArea }}\n      disableClearable\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { selectModels } from '../../data/selectors'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { withSuspense } from '../withSuspense'\nimport { AutocompleteArrayField, AutocompleteArrayFieldProps } from '../AutocompleteArrayField'\n\nexport type ModelsFieldProps = Omit<AutocompleteArrayFieldProps, 'options'>\n\nexport const ModelsField = withSuspense<ModelsFieldProps>(\n  (props): JSX.Element => {\n    const models = useRecoilValue(selectModels)\n    const options = models.map(({ id: value, abbreviation: label }) => ({ value, label }))\n\n    return <AutocompleteArrayField {...props} options={options} />\n  },\n  (props) => <ReadOnlyField {...props} value={<MuiSkeleton />} />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { selectSitesByBoxId } from '../../data/selectors'\nimport { SitesMapPreview } from '../SitesMap'\n\nexport interface BoxSitesMapPreviewProps {\n  boxId: number\n}\n\nexport const BoxSitesMapPreview = ({ boxId }: BoxSitesMapPreviewProps): JSX.Element => {\n  const sitesSelector = selectSitesByBoxId(boxId)\n  return <SitesMapPreview sitesSelector={sitesSelector} sitesListingSource={{ type: 'box', id: boxId }} />\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiTextField, { StandardTextFieldProps as MuiStandardTextFieldProps } from '@mui/material/TextField'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CommonFieldProps } from '../../types'\n\ninterface DateFieldProps\n  extends CommonFieldProps<string | null>,\n    Omit<MuiStandardTextFieldProps, 'value' | 'onChange'> {\n  inputRef?: React.Ref<HTMLInputElement>\n  max?: string\n  min?: string\n}\n\nexport const DateField = ({\n  // CommonFieldProps\n  className,\n  disabled,\n  error,\n  gridArea,\n  label,\n  onChange,\n  readOnly,\n  value,\n\n  // DateField\n  inputRef,\n  max,\n  min,\n\n  // StandardTextFieldProps\n  ...restProps\n}: DateFieldProps): JSX.Element => {\n  if (readOnly) return <ReadOnlyField className={className} gridArea={gridArea} label={label} value={value} />\n\n  const handleChange = ({ target: { value: newValue } }) => {\n    if (min !== undefined && newValue < min) return\n    if (max !== undefined && newValue > max) return\n    onChange(newValue || null)\n  }\n\n  return (\n    <MuiTextField\n      size=\"small\"\n      className={className}\n      disabled={disabled}\n      error={error}\n      inputRef={inputRef}\n      label={label}\n      onChange={handleChange}\n      value={value ?? ''}\n      type=\"date\"\n      InputLabelProps={{ shrink: true }}\n      InputProps={{ sx: { color: value ? undefined : '#868686' } }}\n      css={{ gridArea }}\n      {...restProps}\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\nimport { withTooltip } from '../withTooltip'\n\ninterface FlagBadgeProps {\n  label: string\n  badgeColor: string\n  className?: string\n  tooltip?: string\n  textColor?: string\n  disabled?: boolean\n}\n\nexport const Badge = ({ className, label, tooltip, badgeColor, textColor }: FlagBadgeProps): JSX.Element =>\n  withTooltip(\n    <span\n      className={className}\n      css={{\n        background: badgeColor,\n        color: textColor,\n        height: '1.2em',\n        padding: '0.1em 0.2em',\n      }}\n    >\n      <span\n        css={{\n          width: '1em',\n          display: 'inline-block',\n          textAlign: 'center',\n        }}\n      >\n        {label}\n      </span>\n    </span>,\n    tooltip\n  )\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\nimport { Badge } from './Badge'\n\nexport const TargetEffortBadge = (): JSX.Element => (\n  <Badge\n    badgeColor=\"#bbb\"\n    tooltip=\"Taxon is at for below the SAFIT II required target effort\"\n    css={{ marginLeft: '0.5em', fontWeight: 'normal' }}\n    label=\"S\"\n  />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiListItem from '@mui/material/ListItem'\nimport parse from 'autosuggest-highlight/parse'\nimport match from 'autosuggest-highlight/match'\n\nimport { TargetEffortBadge } from '../Badge'\nimport { Taxon } from '../../types'\n\nexport const HighlightedText = ({ text, highlightText }: { text: string; highlightText: string }): JSX.Element => (\n  <>\n    {parse(text, match(text, highlightText)).map<JSX.Element>(\n      // TODO: match is not finding all occurrences, but this needs to be rewritten custom anyway because the algoritm isn't exactly what we need\n      (part: { text: string; highlight: boolean }, index: number) => (\n        <span\n          key={index}\n          css={{\n            fontWeight: part.highlight ? '700' : undefined,\n          }}\n        >\n          {part.text}\n        </span>\n      )\n    )}\n  </>\n)\n\nexport type TaxaOptionStatus = 'in' | 'notIn'\n\nexport const MAX_MATCHES = 100\nexport const MAX_DISPLAYED_SYNONYMS = 10\n\nexport const Group = ({\n  group,\n  children,\n  labels,\n}: {\n  group: TaxaOptionStatus\n  children?: React.ReactNode\n  labels: [string, string]\n}): JSX.Element => {\n  const color = group === 'in' ? 'green' : 'blue'\n  return (\n    <div>\n      <div\n        css={{\n          borderBottom: `3px solid ${color}`,\n          color,\n          height: '2em',\n          display: 'flex',\n          alignItems: 'center',\n          paddingLeft: '1em',\n        }}\n      >\n        {group === 'in' ? labels[0] : labels[1]}\n      </div>\n      {children}\n    </div>\n  )\n}\n\ninterface OptionProps extends React.HTMLAttributes<HTMLLIElement> {\n  taxon: Taxon\n  inputValue: string\n  actions?: React.ReactNode\n}\n\nexport const Option = ({ taxon, inputValue, actions, ...restProps }: OptionProps): JSX.Element => {\n  const { name, levelName, synonyms } = taxon\n\n  const synonymArea = [] as JSX.Element[]\n\n  if (synonyms.length <= MAX_DISPLAYED_SYNONYMS) {\n    synonymArea.push(<HighlightedText key=\"only\" text={synonyms.join(', ')} highlightText={inputValue} />)\n  } else {\n    const isSynonymsMatched = match(synonyms.join(' '), inputValue).length > 0\n\n    if (isSynonymsMatched) {\n      synonyms.forEach((synonym) => {\n        if (match(synonym, inputValue).length === 0) return\n        if (synonymArea.length > 0) synonymArea.push(<span key={`${synonym} separator`}>, </span>)\n        synonymArea.push(<HighlightedText key={synonym} text={synonym} highlightText={inputValue} />)\n      })\n      synonymArea.push(\n        <span key=\"remainder\" css={{ opacity: 0.75 }}>\n          {' '}\n          ({synonyms.length - synonymArea.length} unmatched not shown)\n        </span>\n      )\n    } else {\n      synonymArea.push(\n        <React.Fragment key=\"more\">\n          {synonyms.slice(0, MAX_DISPLAYED_SYNONYMS).join(', ')}\n          <span css={{ opacity: 0.75 }}> ({synonyms.length - MAX_DISPLAYED_SYNONYMS} more not shown)</span>\n        </React.Fragment>\n      )\n    }\n  }\n\n  return (\n    <MuiListItem\n      {...restProps}\n      css={{\n        borderBottom: '1px solid lightgrey',\n        display: 'flex',\n      }}\n    >\n      <span css={{ maxWidth: '15em', flex: 1 }}>\n        <HighlightedText text={name} highlightText={inputValue} />\n        {taxon.isTargetEffort && <TargetEffortBadge />}\n      </span>\n      <span css={{ maxWidth: '6em', flex: 1 }}>{levelName}</span>\n      <span css={{ fontStyle: 'italic', flex: 1 }}>{synonymArea}</span>\n      {actions}\n    </MuiListItem>\n  )\n}\n\ntype FilterableOption<T> = T & Taxon\n\nexport const filterOptions = <T,>(\n  options: FilterableOption<T>[],\n  { inputValue }: { inputValue: string }\n): FilterableOption<T>[] => {\n  const nameMatches: FilterableOption<T>[] = []\n  const remainder: FilterableOption<T>[] = []\n  try {\n    options.forEach((option) => {\n      const group = match(option.name, inputValue).length > 0 ? nameMatches : remainder\n      group.push(option)\n    })\n    const synonymMatches = remainder.filter(\n      ({ synonyms }) => match(synonyms.join(' '), inputValue).length > 0,\n      inputValue\n    )\n    return [...nameMatches, ...synonymMatches].slice(0, MAX_MATCHES)\n  } catch (err) {\n    return []\n  }\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport MuiTextField from '@mui/material/TextField'\nimport MuiAutocomplete from '@mui/material/Autocomplete'\n\nimport MuiButton, { ButtonProps as MuiButtonProps } from '@mui/material/Button'\nimport KeyboardReturnIcon from '@mui/icons-material/KeyboardReturn'\n\nimport { Taxon } from '../../types'\nimport { Option, TaxaOptionStatus, Group, filterOptions } from './util'\n\nexport interface TaxonomyFieldOption extends Taxon {\n  status: TaxaOptionStatus\n  actions: React.ReactNode\n  onChoose: () => void\n}\n\nexport interface TaxonomyFieldProps {\n  disabled?: boolean\n  options: TaxonomyFieldOption[]\n  inputRef?: React.RefObject<HTMLInputElement>\n  label?: string\n  ungrouped?: boolean\n}\n\nexport const TaxonomyFieldActionButton = ({\n  isDefault,\n  children,\n  onClick,\n  className,\n  disabled,\n  ...restProps\n}: MuiButtonProps & {\n  isDefault?: boolean\n}): JSX.Element => {\n  return (\n    <div css={{ position: 'relative' }} className={className}>\n      {disabled && (\n        <div\n          css={{ width: '100%', height: '100%', position: 'absolute', cursor: 'default' }}\n          onClick={(e) => {\n            // this element is a bit of a hack to use a disabled button but still\n            // catch the click to prevent autocomplete from choosing row\n            e.stopPropagation()\n          }}\n        />\n      )}\n      <MuiButton variant=\"outlined\" size=\"small\" onClick={onClick} disabled={disabled} data-skip-choose {...restProps}>\n        {children}\n        {isDefault && <KeyboardReturnIcon sx={{ marginLeft: '0.25em', fontSize: '100%' }} />}\n      </MuiButton>\n    </div>\n  )\n}\n\nexport const TaxonomyField = ({\n  disabled,\n  options,\n  inputRef,\n  label = 'Taxonomy',\n  ungrouped,\n}: TaxonomyFieldProps): JSX.Element => {\n  const [text, setText] = useState('')\n\n  const handleTextChange = (e: React.SyntheticEvent, newValue: string) => {\n    if (newValue === '/') return // for slicker keyboard shortcut behavior\n    setText(newValue)\n  }\n\n  const handleChoose = (\n    e: React.SyntheticEvent & { target: { attributes?: { 'data-skip-choose'?: string } } },\n    option?: TaxonomyFieldOption | null\n  ) => {\n    if (option && !e.target.attributes?.['data-skip-choose']) option.onChoose()\n    window.setTimeout(() => {\n      setText('')\n    }, 0)\n  }\n\n  const handleKeyDown = ({ key }: { key: string }) => {\n    if (key !== 'Escape' || !inputRef?.current) return\n    inputRef.current.blur()\n  }\n\n  const isOptionsPresented = text.length >= 3\n\n  return (\n    <MuiAutocomplete\n      options={isOptionsPresented ? options : []}\n      onChange={handleChoose}\n      renderInput={(params) => <MuiTextField {...params} inputRef={inputRef} label={label} disabled={disabled} />}\n      onKeyDown={handleKeyDown}\n      renderOption={(optionProps, option, { inputValue }) => (\n        <Option {...optionProps} key={option.id} taxon={option} inputValue={inputValue} actions={option.actions} />\n      )}\n      inputValue={text}\n      onInputChange={handleTextChange}\n      clearOnEscape\n      autoHighlight\n      noOptionsText={isOptionsPresented ? 'No taxa found' : '...'}\n      groupBy={ungrouped ? undefined : (taxon) => taxon.status}\n      value={null}\n      renderGroup={\n        ungrouped\n          ? undefined\n          : ({ group, ...rest }) => (\n              <Group group={group as TaxaOptionStatus} labels={['Already In Sample', 'Not In Sample']} {...rest} />\n            )\n      }\n      getOptionLabel={({ id }) => String(id)} // being used by Autocomplete for array key; not displayed due to renderOption\n      filterOptions={filterOptions}\n      size=\"small\"\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport MuiTextField from '@mui/material/TextField'\nimport MuiAutocomplete from '@mui/material/Autocomplete'\n\nimport { Taxon } from '../../types'\nimport { Option, TaxaOptionStatus, Group, filterOptions } from './util'\n\nexport interface SelectableTaxonOption extends Taxon {\n  status?: TaxaOptionStatus\n}\n\nexport interface TaxonomySelectFieldProps {\n  className?: string\n  disableClearable?: boolean\n  disabled?: boolean\n  disablePortal?: boolean\n  error?: boolean\n  gridArea?: string\n  label: React.ReactNode\n  onChange: (newId: number | null) => void\n  options: SelectableTaxonOption[]\n  ungrouped?: boolean\n  value: number | null\n}\n\nexport const TaxonomySelectField = ({\n  className,\n  disableClearable,\n  disabled,\n  disablePortal,\n  error,\n  gridArea,\n  label,\n  onChange,\n  options,\n  ungrouped,\n  value,\n}: TaxonomySelectFieldProps): JSX.Element => {\n  const [text, setText] = useState('')\n\n  const handleTextChange = (e: React.SyntheticEvent, newValue: string) => {\n    setText(newValue)\n  }\n\n  const handleChoose = (e, taxon?: SelectableTaxonOption | null) => {\n    if (taxon) {\n      onChange(taxon.id)\n    } else {\n      onChange(null)\n    }\n  }\n\n  const isOptionsPresented = text.length >= 3\n\n  const foundValue = options.find((option) => option.id === value) || null\n\n  return (\n    <MuiAutocomplete\n      className={className}\n      css={{ gridArea }}\n      disablePortal={disablePortal}\n      options={isOptionsPresented || foundValue ? options : []}\n      onChange={handleChoose}\n      renderInput={(params) => <MuiTextField {...params} error={error} label={label} />}\n      renderOption={(optionProps, taxon, { inputValue }) => (\n        <Option {...optionProps} key={taxon.id} taxon={taxon} inputValue={inputValue} />\n      )}\n      inputValue={text}\n      onInputChange={handleTextChange}\n      noOptionsText={\n        isOptionsPresented ? (foundValue ? 'Change value to continue taxon search' : 'No taxa found') : '...'\n      }\n      groupBy={ungrouped ? undefined : (taxon) => taxon.status || 'default'}\n      value={foundValue}\n      isOptionEqualToValue={(option, v) => option.id === v.id}\n      renderGroup={\n        ungrouped\n          ? undefined\n          : ({ group, ...rest }) => (\n              <Group group={group as TaxaOptionStatus} labels={['Currently In Box', 'Not In Box']} {...rest} />\n            )\n      }\n      getOptionLabel={({ name }) => String(name)} // display value; also used by Autocomplete for array key\n      filterOptions={filterOptions}\n      disabled={disabled}\n      size=\"small\"\n      disableClearable={disableClearable}\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiAutocomplete from '@mui/material/Autocomplete'\nimport MuiTextField from '@mui/material/TextField'\n\nexport type CriterionOption<T> = {\n  id: T\n  optionLabel: string\n  chipLabel: string\n  disabled?: boolean\n}\n\nexport interface CriterionFieldProps<T> {\n  value: CriterionOption<T> | null\n  onChange: (newValue: CriterionOption<T> | null) => void\n  gridArea: string\n  disabled?: boolean\n}\n\nexport const CriterionAutocomplete = <T,>({\n  value,\n  gridArea,\n  onChange,\n  label,\n  options,\n  disabled,\n}: CriterionFieldProps<T> & { label: string; options: CriterionOption<T>[] }): JSX.Element => (\n  <MuiAutocomplete\n    options={options}\n    getOptionLabel={(option) => option.optionLabel}\n    getOptionDisabled={(option) => !!option.disabled}\n    renderInput={(params) => <MuiTextField {...params} label={label} />}\n    onChange={(event, selected) => {\n      onChange(selected)\n    }}\n    size=\"small\"\n    value={value && options.find((option) => option.id === value.id)}\n    css={{ gridArea }}\n    disabled={disabled}\n  />\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react'\nimport { selector, useRecoilValue } from 'recoil'\nimport { identity, sortBy } from 'lodash'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiTextField from '@mui/material/TextField'\nimport MuiAutocomplete from '@mui/material/Autocomplete'\n// import log from 'loglevel'\n\nimport { TaxonomySelectField } from '../TaxonomyField'\nimport { withSuspense } from '../withSuspense'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport {\n  allSitesAtom,\n  allSitesStatusAtom,\n  FETCH_ALL_SITES_STATUS,\n  selectBoxes,\n  selectOrganizations,\n  selectProjects,\n  selectSampleMethods,\n  selectSampleTypes,\n  selectTaxa,\n  selectUsStates,\n  useFetchAllSitesOptimized,\n} from '../../data/selectors'\nimport { useDebounce } from '../../lib/useDebounce'\nimport { TextField } from '../TextField'\nimport { CriterionAutocomplete, CriterionFieldProps, CriterionOption } from '../CriterionAutocomplete'\n\nconst selectBoxOptions = selector<CriterionOption<number>[]>({\n  key: 'SelectSamples/selectBoxOptions',\n  get: ({ get }) => {\n    const boxes = get(selectBoxes)\n    return sortBy(boxes, ({ id }) => id)\n      .reverse()\n      .map(({ id, alias, sampleCount, boxState }) => ({\n        id,\n        optionLabel: `Box ${id}${alias ? `: ${alias}` : ''} (${boxState}, ${sampleCount} samples)`,\n        chipLabel: `from box ${id}`,\n        disabled: sampleCount === 0 || boxState === 'Pending',\n      }))\n  },\n})\n\nconst selectUsStateOptions = selector<CriterionOption<number>[]>({\n  key: 'SelectSamples/selectUsStateOptions',\n  get: async ({ get }) => {\n    const usStates = get(selectUsStates)\n    return usStates.map(({ id, name }) => ({ id, optionLabel: name, chipLabel: `in ${name}` }))\n  },\n})\n\nconst selectOrganizationOptions = selector<CriterionOption<number>[]>({\n  key: 'SelectSamples/selectOrganizationOptions',\n  get: async ({ get }) => {\n    const organizations = get(selectOrganizations)\n    return sortBy(organizations, ({ name }) => name).map(({ id, name }) => ({\n      id,\n      optionLabel: name,\n      chipLabel: `for ${name}`,\n    }))\n  },\n})\n\nconst selectProjectOptions = selector<CriterionOption<number>[]>({\n  key: 'SelectSamples/selectProjectOptions',\n  get: async ({ get }) => {\n    const projects = get(selectProjects)\n    return sortBy(projects, ({ name }) => name).map(({ id, name }) => ({\n      id,\n      optionLabel: name,\n      chipLabel: `in project ${name}`,\n    }))\n  },\n})\n\nconst selectTypeOptions = selector<CriterionOption<string>[]>({\n  key: 'SelectSamples/selectTypeOptions',\n  get: async ({ get }) => {\n    const sampleTypes = get(selectSampleTypes)\n    return sampleTypes.map(({ name }) => ({\n      id: name,\n      optionLabel: name,\n      chipLabel: `type is ${name}`,\n    }))\n  },\n})\n\nconst selectMethodOptions = selector<CriterionOption<string>[]>({\n  key: 'SelectSamples/selectMethodOptions',\n  get: async ({ get }) => {\n    const sampleMethods = get(selectSampleMethods)\n    return sampleMethods.map(({ name }) => ({\n      id: name,\n      optionLabel: name,\n      chipLabel: `method is ${name}`,\n    }))\n  },\n})\n\nexport const BoxCriterionField = withSuspense(\n  (props: CriterionFieldProps<number>): JSX.Element => {\n    const options = useRecoilValue(selectBoxOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"Box\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"Box\" />\n)\n\nexport const UsStateCriterionField = withSuspense(\n  (props: CriterionFieldProps<number>): JSX.Element => {\n    const options = useRecoilValue(selectUsStateOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"US State\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"US State\" />\n)\n\nexport const OrganizationCriterionField = withSuspense(\n  (props: CriterionFieldProps<number>): JSX.Element => {\n    const options = useRecoilValue(selectOrganizationOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"Customer\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"Customer\" />\n)\n\nexport const ProjectCriterionField = withSuspense(\n  ({ thisProjectId, ...restProps }: CriterionFieldProps<number> & { thisProjectId: number }): JSX.Element => {\n    const allProjectOptions = useRecoilValue(selectProjectOptions)\n    const options = useMemo(\n      () => allProjectOptions.map((option) => ({ ...option, disabled: option.id === thisProjectId })),\n      [allProjectOptions]\n    )\n    return <CriterionAutocomplete {...restProps} options={options} label=\"Project\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"Project\" />\n)\n\nexport const TaxonomyCriterionField = withSuspense(\n  ({ value, onChange, gridArea }: CriterionFieldProps<number>) => {\n    const taxa = useRecoilValue(selectTaxa)\n    const handleChange = (newId: number | null) => {\n      onChange(\n        newId === null\n          ? null\n          : {\n              id: newId,\n              optionLabel: '',\n              chipLabel: `contains ${taxa.find((t) => t.id === newId)?.name}`,\n            }\n      )\n    }\n    return (\n      <TaxonomySelectField\n        label=\"Taxonomy\"\n        options={taxa}\n        value={value && value.id}\n        onChange={handleChange}\n        gridArea={gridArea}\n      />\n    )\n  },\n  ({ gridArea }) => <ReadOnlyField gridArea={gridArea} label=\"Taxonomy\" value={<MuiSkeleton />} />\n)\n\ninterface SampleIdsFieldProps {\n  value: number[]\n  onChange: (sampleIds: number[]) => void\n  gridArea: string\n}\n\nexport const SampleIdsCriterionField = ({ value, onChange, gridArea }: SampleIdsFieldProps): JSX.Element => {\n  const debounceTimerRef = useRef<NodeJS.Timeout>()\n\n  const [text, setText] = useState('')\n  const [isFocused, setIsFocused] = useState(false)\n\n  const setValueFromText = () => {\n    onChange(\n      text\n        .split(/[,\\s]+/)\n        .filter(identity)\n        .map((v) => Number(v))\n    )\n  }\n\n  useEffect(() => {\n    if (debounceTimerRef.current) clearTimeout(debounceTimerRef.current)\n    debounceTimerRef.current = setTimeout(() => {\n      if (!isFocused) return\n      setValueFromText()\n    }, 1000)\n  }, [text, isFocused])\n\n  const handleFocus = () => {\n    setIsFocused(true)\n  }\n\n  const handleBlur = () => {\n    setIsFocused(false)\n    setValueFromText()\n  }\n\n  useEffect(() => {\n    if (isFocused) return\n    setText(value.join(', '))\n  }, [value])\n\n  return (\n    <TextField\n      gridArea={gridArea}\n      label=\"Sample IDs\"\n      value={text}\n      onChange={(newValue) => {\n        setText(newValue.replace(/[^0-9,\\s]/g, '')) // only allow: 0-9 <comma> <whitespace>\n      }}\n      onFocus={handleFocus}\n      onBlur={handleBlur}\n      multiline\n      minRows={2}\n      maxRows={2}\n    />\n  )\n}\n\nexport const TypeCriterionField = withSuspense(\n  (props: CriterionFieldProps<string>): JSX.Element => {\n    const options = useRecoilValue(selectTypeOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"Sample Type\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"Sample Type\" />\n)\n\nexport const MethodCriterionField = withSuspense(\n  (props: CriterionFieldProps<string>): JSX.Element => {\n    const options = useRecoilValue(selectMethodOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"Sample Method\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"Sample Method\" />\n)\n\nexport const SiteCriterionField = ({ value, onChange, gridArea }: CriterionFieldProps<number>): JSX.Element => {\n  const allSites = useRecoilValue(allSitesAtom)\n  const allSitesStatus = useRecoilValue(allSitesStatusAtom)\n  const fetchAllSitesOptimized = useFetchAllSitesOptimized()\n  const [text, setText] = useState('')\n  const [options, setOptions] = useState<CriterionOption<number>[]>([])\n\n  const getFilterSiteOptions = useCallback(\n    (value: CriterionOption<number> | null) => (options: CriterionOption<number>[], state) => {\n      if (state.inputValue.length < 3 && value) return [value]\n      return options\n        .filter(({ optionLabel }) => {\n          return optionLabel.toLowerCase().includes(state.inputValue.toLowerCase())\n        })\n        .slice(0, 100) // 100 = max options to display\n    },\n    []\n  )\n\n  const handleTextChange = (e: React.SyntheticEvent, newValue: string) => {\n    setText(newValue)\n  }\n\n  useEffect(() => {\n    switch (allSitesStatus) {\n      case FETCH_ALL_SITES_STATUS.unfetched: {\n        fetchAllSitesOptimized()\n        break\n      }\n      case FETCH_ALL_SITES_STATUS.fetched: {\n        setOptions(\n          allSites.map(({ id, name }) => ({ id, optionLabel: `${name} [${id}]`, chipLabel: `from site ${name}` }))\n        )\n      }\n    }\n  }, [allSitesStatus])\n\n  if (options.length === 0) return <ReadOnlyField css={{ gridArea }} label=\"Site\" value={<MuiSkeleton />} />\n\n  const isOptionsPresented = text.length >= 3\n\n  return (\n    <MuiAutocomplete\n      inputValue={text}\n      onInputChange={handleTextChange}\n      options={isOptionsPresented || value ? options : []}\n      filterOptions={getFilterSiteOptions(value)}\n      noOptionsText={isOptionsPresented ? 'No sites found' : '...'}\n      getOptionLabel={(option) => option.optionLabel}\n      getOptionDisabled={(option) => !!option.disabled}\n      renderInput={(params) => <MuiTextField {...params} label=\"Site\" />}\n      onChange={(event, selected) => {\n        onChange(selected)\n      }}\n      size=\"small\"\n      value={value}\n      css={{ gridArea }}\n    />\n  )\n}\n\ninterface GeoJsonCriterionFieldProps {\n  value: string\n  onChange: (newValue: string) => void\n  gridArea: string\n}\n\nexport const GeoJsonCriterionField = ({ gridArea, value, onChange }: GeoJsonCriterionFieldProps): JSX.Element => {\n  const [text, setText] = useState(value)\n  const [debouncedText, setDebouncedTextImmediately] = useDebounce(text, 1000)\n\n  useEffect(() => {\n    onChange(debouncedText)\n  }, [debouncedText])\n\n  useEffect(() => {\n    if (value === debouncedText) return\n    // synchronize to incoming value prop\n    setText(value)\n    setDebouncedTextImmediately(value)\n  }, [value])\n\n  return (\n    <TextField\n      gridArea={gridArea}\n      label=\"GeoJSON Polygon\"\n      value={text}\n      onChange={setText}\n      multiline\n      minRows={2}\n      maxRows={2}\n    />\n  )\n}\n","import { get } from 'lodash'\n\nimport { GeoJsonPolygonCoordinates } from '../../types'\n\nconst isValidGeoJsonPolygonCoordinates = (object: unknown): object is GeoJsonPolygonCoordinates => {\n  if (!Array.isArray(object) || object.length === 0) throw new Error('Polygon is not an array of rings')\n  object.forEach((ring) => {\n    if (!Array.isArray(ring) || ring.length < 4) throw new Error('Polygon ring does not contain not enough points')\n    ring.forEach((lngLat) => {\n      if (!Array.isArray(lngLat) || lngLat.length !== 2) throw new Error('Polygon has invalid coordinates')\n      if (typeof lngLat[0] !== 'number') throw new Error('Polygon has invalid coordinates')\n      if (typeof lngLat[1] !== 'number') throw new Error('Polygon has invalid coordinates')\n    })\n    const lastPointIndex = ring.length - 1\n    if (ring[0][0] !== ring[lastPointIndex][0] || ring[0][1] !== ring[lastPointIndex][1])\n      throw new Error('Polygon is not a closed ring')\n  })\n\n  return true\n}\n\nexport const parseGeoJsonPolygon = (json: string): GeoJsonPolygonCoordinates => {\n  let object: unknown\n  let extracted: unknown\n\n  try {\n    object = JSON.parse(json)\n  } catch {\n    throw new Error('not valid JSON')\n  }\n\n  if (Array.isArray(object)) {\n    extracted = object\n  } else {\n    const type = get(object, 'type')\n    switch (type) {\n      case 'FeatureCollection': {\n        const features = get(object, 'features')\n        if (!Array.isArray(features) || features.length !== 1)\n          throw new Error('FeatureCollection must have exactly one Feature')\n        if (get(features[0], 'geometry.type') !== 'Polygon') throw new Error('Feature must be a Polygon')\n        extracted = get(features[0], 'geometry.coordinates')\n        break\n      }\n      case 'Feature': {\n        if (get(object, 'geometry.type') !== 'Polygon') throw new Error('Feature must be a Polygon')\n        extracted = get(object, 'geometry.coordinates')\n        break\n      }\n      case 'Polygon': {\n        extracted = get(object, 'coordinates')\n        break\n      }\n      case undefined:\n        throw new Error('not valid GeoJSON, missing type')\n      default:\n        throw new Error('not valid GeoJSON, invalid type')\n    }\n  }\n\n  if (!extracted || !isValidGeoJsonPolygonCoordinates(extracted)) throw new Error('could not parse coordinates')\n\n  return extracted\n}\n","import * as turf from '@turf/turf'\nimport { sortBy } from 'lodash'\nimport { Point, Site } from '../../types'\n\nexport const getDistance = (from: Point, to: Point): number =>\n  turf.distance(turf.point([from.longitude, from.latitude]), turf.point([to.longitude, to.latitude]))\n\nexport const getSortedSitesDistances = (\n  sites: Site[],\n  target: Point,\n  maxCoordinateDiff?: number\n): { site: Site; distance: number }[] => {\n  const prefilteredSites = maxCoordinateDiff\n    ? sites.filter(\n        (site) =>\n          Math.abs(site.latitude - target.latitude) < maxCoordinateDiff &&\n          Math.abs(site.longitude - target.longitude) < maxCoordinateDiff\n      )\n    : sites\n  return sortBy(\n    prefilteredSites.map((site) => ({\n      site,\n      distance: getDistance(site, target),\n    })),\n    ({ distance }) => distance\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useState } from 'react'\nimport { atom, useRecoilCallback, useRecoilState } from 'recoil'\nimport { identity, intersectionBy, noop } from 'lodash'\nimport produce from 'immer'\nimport MuiButton from '@mui/material/Button'\nimport AddCircleIcon from '@mui/icons-material/AddCircle'\nimport RemoveCircleIcon from '@mui/icons-material/RemoveCircle'\nimport MuiToggleButton from '@mui/material/ToggleButton'\nimport MuiToggleButtonGroup from '@mui/material/ToggleButtonGroup'\n// import log from 'loglevel'\n\nimport {\n  selectBoxSamplesByBoxId,\n  selectMinimalSamplesByOrganizationId,\n  selectMinimalSamplesByPolygon,\n  selectMinimalSamplesBySiteId,\n  selectMinimalSamplesByTaxonId,\n  selectMinimalSamplesByUsStateId,\n  selectProjectSamplesByProjectId,\n  useDeferredInvalidate,\n} from '../../data/selectors'\nimport { MinimalSample, GeoJsonPolygonCoordinates } from '../../types'\nimport { Filter, FilterChips } from '../Filters'\nimport { Title } from '../Title'\nimport { Chip } from '../Chip'\nimport { LinearProgress } from '../LinearProgress'\nimport { pluralize } from '../../lib/formats'\nimport { addProjectSamples, fetchMinimalSamplesByIds, removeProjectSamples } from '../../data/calls'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { DateField } from '../DateField'\nimport {\n  BoxCriterionField,\n  GeoJsonCriterionField,\n  MethodCriterionField,\n  OrganizationCriterionField,\n  ProjectCriterionField,\n  SampleIdsCriterionField,\n  SiteCriterionField,\n  TaxonomyCriterionField,\n  TypeCriterionField,\n  UsStateCriterionField,\n} from './CriterionFields'\nimport { NumberField } from '../NumberField'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { TextField } from '../TextField'\nimport { parseGeoJsonPolygon } from '../../lib/map'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { CriterionOption } from '../CriterionAutocomplete'\n\nconst passAllFilterFn = () => true\nconst rejectAllFilterFn = () => false\n\nexport type SelectSamples = {\n  onOperatingChange?: (operating: boolean) => void\n  samples: MinimalSample[]\n} & (\n  | {\n      initialMode: 'add' | 'remove'\n      projectId: number\n      projectName: string\n      boxId?: never\n      onNewBoxSamplesChange?: never\n    }\n  | {\n      initialMode: 'split'\n      projectId?: never\n      projectName?: never\n      boxId: number\n      onNewBoxSamplesChange: (samples: MinimalSample[]) => void\n    }\n)\n\ninterface CriteriaFields {\n  box: CriterionOption<number> | null\n  taxon: CriterionOption<number> | null\n  organization: CriterionOption<number> | null\n  project: CriterionOption<number> | null\n  usState: CriterionOption<number> | null\n  site: CriterionOption<number> | null\n  sampleIds: number[]\n  fromDate: string | null\n  toDate: string | null\n  type: CriterionOption<string> | null\n  method: CriterionOption<string> | null\n  geoJson: string\n  fromArea: number | null\n  toArea: number | null\n}\n\nconst getInitialCriteriaFields = (): CriteriaFields => ({\n  box: null,\n  taxon: null,\n  organization: null,\n  project: null,\n  usState: null,\n  site: null,\n  sampleIds: [],\n  fromDate: null,\n  toDate: null,\n  type: null,\n  method: null,\n  geoJson: '',\n  fromArea: null,\n  toArea: null,\n})\n\ntype CriteriaFieldErrors = Partial<Record<keyof CriteriaFields, boolean>> | undefined\n\nconst minimalSamplesByIdAtom = atom<Record<number, MinimalSample | Promise<MinimalSample | undefined>>>({\n  key: '',\n  default: {},\n})\n\nexport const SelectSamples = ({\n  boxId: thisBoxId,\n  initialMode,\n  onOperatingChange,\n  projectId: thisProjectId,\n  projectName: thisProjectName,\n  samples: initialSamples,\n  onNewBoxSamplesChange,\n}: SelectSamples): JSX.Element => {\n  const api = useApi()\n  const deferredInvalidate = useDeferredInvalidate()\n  const notifications = useNotifications()\n\n  // CRITERIA STATE\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [criteria, setCriteria, updateCriteria] = useUpdatableState<CriteriaFields>(getInitialCriteriaFields(), [])\n  const makeSetFieldValue = (fieldName: keyof CriteriaFields) => (value: unknown) => {\n    updateCriteria((draft) => {\n      Object.assign(draft, { [fieldName]: value })\n    })\n  }\n  const resetField = (fieldName: keyof CriteriaFields) => {\n    updateCriteria((draft) => {\n      Object.assign(draft, { [fieldName]: getInitialCriteriaFields()[fieldName] })\n    })\n  }\n  const errors: CriteriaFieldErrors = (() => {\n    const dateError = !!(criteria.fromDate && criteria.toDate && criteria.fromDate > criteria.toDate)\n    const areaError = !!(criteria.fromArea && criteria.toArea && criteria.fromArea > criteria.toArea)\n    const result: CriteriaFieldErrors = {\n      fromDate: dateError,\n      toDate: dateError,\n      fromArea: areaError,\n      toArea: areaError,\n    }\n    if (!Object.values(result).some((value) => value)) return undefined\n    return result\n  })()\n\n  // OTHER STATE\n\n  const [thisSourceSamples, setThisSourceSamples] = useState(initialSamples)\n  const [candidateSamples, setCandidateSamples] = useState<MinimalSample[]>([])\n  const [newBoxSamples, setNewBoxSamples] = useState<MinimalSample[]>([])\n  const [resultsMessage, setResultsMessage] = useState<React.ReactNode>(null)\n  const [displayFilters, setDisplayFilters] = useState<Filter<MinimalSample>[]>([])\n  const [isOperating, setIsOperating] = useState(false)\n  const [mode, setMode] = useState(initialMode)\n\n  const isBoxSplitMode = mode === 'split'\n  const isProjectAddMode = mode === 'add'\n  const isProjectRemoveMode = mode === 'remove'\n  const isProjectMode = isProjectAddMode || isProjectRemoveMode\n\n  useEffect(() => {\n    if (onOperatingChange) onOperatingChange(isOperating)\n  }, [isOperating])\n\n  // RECOIL\n\n  const [minimalSamplesById, setMinimalSamplesById] = useRecoilState(minimalSamplesByIdAtom)\n\n  const getSamplesByBoxId = useRecoilCallback<[number], Promise<MinimalSample[]>>(\n    ({ snapshot }) =>\n      async (boxId: number) =>\n        snapshot.getPromise(selectBoxSamplesByBoxId(boxId)).catch((err) => {\n          notifications.error(`Failed to retrieve box samples: ${err}`)\n          return []\n        })\n  )\n\n  const getSamplesByProjectId = useRecoilCallback<[number], Promise<MinimalSample[]>>(\n    ({ snapshot }) =>\n      async (projectId: number) =>\n        snapshot.getPromise(selectProjectSamplesByProjectId(projectId)).catch((err) => {\n          notifications.error(`Failed to retrieve project samples: ${err}`)\n          return []\n        })\n  )\n\n  const getSamplesByUsStateId = useRecoilCallback<[number], Promise<MinimalSample[]>>(\n    ({ snapshot }) =>\n      async (usStateId: number) =>\n        snapshot.getPromise(selectMinimalSamplesByUsStateId(usStateId)).catch((err) => {\n          notifications.error(`Failed to retrieve US State samples: ${err}`)\n          return []\n        })\n  )\n\n  const getSamplesBySiteId = useRecoilCallback<[number], Promise<MinimalSample[]>>(\n    ({ snapshot }) =>\n      async (siteId: number) =>\n        snapshot.getPromise(selectMinimalSamplesBySiteId(siteId)).catch((err) => {\n          notifications.error(`Failed to retrieve site samples: ${err}`)\n          return []\n        })\n  )\n\n  const getSamplesByTaxonId = useRecoilCallback<[number], Promise<MinimalSample[]>>(\n    ({ snapshot }) =>\n      async (taxonId: number) =>\n        snapshot.getPromise(selectMinimalSamplesByTaxonId(taxonId)).catch((err) => {\n          notifications.error(`Failed to retrieve taxon samples: ${err}`)\n          return []\n        })\n  )\n\n  const getSamplesByOrganizationId = useRecoilCallback<[number], Promise<MinimalSample[]>>(\n    ({ snapshot }) =>\n      async (organizationId: number) =>\n        snapshot.getPromise(selectMinimalSamplesByOrganizationId(organizationId)).catch((err) => {\n          notifications.error(`Failed to retrieve organization samples: ${err}`)\n          return []\n        })\n  )\n\n  const getSamplesByPolygon = useRecoilCallback<[GeoJsonPolygonCoordinates], Promise<MinimalSample[]>>(\n    ({ snapshot }) =>\n      async (polygon: GeoJsonPolygonCoordinates) =>\n        snapshot.getPromise(selectMinimalSamplesByPolygon(polygon)).catch((err) => {\n          notifications.error(`Failed to retrieve polygon samples: ${err}`)\n          return []\n        })\n  )\n\n  useEffect(() => {\n    setMinimalSamplesById(\n      produce((draft) => {\n        initialSamples.forEach((sample) => {\n          draft[sample.id] = sample\n        })\n      })\n    )\n  }, [initialSamples])\n\n  // ADD/REMOVE HANDLERS\n\n  const handleAddToProject = async () => {\n    if (!thisProjectId || candidateSamples.length === 0) return\n    const targetIds = candidateSamples.map(({ id }) => id)\n    try {\n      setIsOperating(true)\n      while (targetIds.length > 0) {\n        const sampleIds = targetIds.splice(0, 500) // add 500 per batch\n        await addProjectSamples(api, deferredInvalidate)({ projectId: thisProjectId, sampleIds })\n        setThisSourceSamples((samples) => [...samples, ...candidateSamples.filter(({ id }) => sampleIds.includes(id))])\n      }\n      notifications.info(`Added ${candidateSamples.length} ${pluralize(candidateSamples.length, 'sample')} to project`)\n    } catch (err) {\n      notifications.error(`Failed to add samples to project: ${err}`)\n    } finally {\n      setIsOperating(false)\n    }\n  }\n\n  const handleRemoveFromProject = async () => {\n    if (!thisProjectId || candidateSamples.length === 0) return\n    const targetIds = candidateSamples.map(({ id }) => id)\n    try {\n      setIsOperating(true)\n      while (targetIds.length > 0) {\n        const sampleIds = targetIds.splice(0, 500) // remove 500 per batch\n        await removeProjectSamples(api, deferredInvalidate)({ projectId: thisProjectId, sampleIds })\n        setThisSourceSamples((samples) => samples.filter(({ id }) => !sampleIds.includes(id)))\n      }\n      notifications.info(\n        `Removed ${candidateSamples.length} ${pluralize(candidateSamples.length, 'sample')} from project`\n      )\n    } catch (err) {\n      notifications.error(`Failed to remove samples from project: ${err}`)\n    } finally {\n      setIsOperating(false)\n    }\n  }\n\n  const handleAssignToNewBox = async () => {\n    if (!thisBoxId || candidateSamples.length === 0 || !onNewBoxSamplesChange) return\n    const targetIds = candidateSamples.map(({ id }) => id)\n    setThisSourceSamples((samples) => samples.filter(({ id }) => !targetIds.includes(id)))\n    const updatedNewBoxSamples = [...newBoxSamples, ...candidateSamples]\n    setNewBoxSamples(updatedNewBoxSamples)\n    onNewBoxSamplesChange(updatedNewBoxSamples)\n  }\n\n  // FETCHING AND FILTERS\n\n  useEffect(() => {\n    // setup\n    const criteriaFilters: typeof displayFilters = []\n    const thisSourceFilters: typeof displayFilters = []\n    const sourcePromises: Promise<MinimalSample[]>[] = []\n    const errorMessages: React.ReactNode[] = []\n    let cancelled = false\n\n    const setupIdBasedCriterion = (\n      fieldName: keyof CriteriaFields,\n      sampleGetter: (id: number) => Promise<MinimalSample[]>\n    ) => {\n      const criterion = criteria[fieldName] as CriterionOption<number> | null\n      if (criterion) {\n        criteriaFilters.push({\n          id: fieldName,\n          label: criterion.chipLabel,\n          filterFn: passAllFilterFn,\n          onDelete: () => resetField(fieldName),\n        })\n        sourcePromises.push(sampleGetter(criterion.id))\n      }\n    }\n\n    // source: box\n    setupIdBasedCriterion('box', getSamplesByBoxId)\n\n    // source: project\n    setupIdBasedCriterion('project', getSamplesByProjectId)\n\n    // source: customer\n    setupIdBasedCriterion('organization', getSamplesByOrganizationId)\n\n    // source: site\n    setupIdBasedCriterion('site', getSamplesBySiteId)\n\n    // COMING: customer site code\n\n    // source: US State\n    setupIdBasedCriterion('usState', getSamplesByUsStateId)\n\n    // COMING: waterbody name\n\n    // source: GeoJSON polygon\n    if (criteria.geoJson) {\n      const { geoJson } = criteria\n      try {\n        const polygonCoordinates = parseGeoJsonPolygon(geoJson)\n        criteriaFilters.push({\n          id: 'geoJson',\n          label: 'within polygon',\n          filterFn: passAllFilterFn,\n          onDelete: () => resetField('geoJson'),\n        })\n        sourcePromises.push(getSamplesByPolygon(polygonCoordinates))\n      } catch (err) {\n        criteriaFilters.push({\n          id: 'geoJson',\n          label: 'within polygon',\n          filterFn: rejectAllFilterFn,\n          onDelete: () => resetField('geoJson'),\n          chipColor: 'error',\n        })\n        errorMessages.push(`GeoJSON Polygon error (${err})`)\n      }\n    }\n\n    // source: taxon\n    setupIdBasedCriterion('taxon', getSamplesByTaxonId)\n\n    // source: sample IDs\n    if (criteria.sampleIds.length > 0) {\n      const { sampleIds } = criteria\n      const onDelete = () => resetField('sampleIds')\n      if (sampleIds.length === 1)\n        criteriaFilters.push({\n          id: 'sampleIds',\n          label: `ID is ${sampleIds[0]}`,\n          filterFn: passAllFilterFn,\n          onDelete,\n        })\n      if (sampleIds.length > 1)\n        criteriaFilters.push({\n          id: 'sampleIds',\n          label: `ID is in list (${sampleIds.length} samples)`,\n          filterFn: passAllFilterFn,\n          onDelete,\n        })\n\n      const usefulPromises: (MinimalSample | Promise<MinimalSample | undefined>)[] = []\n      const fetchIds: number[] = []\n      sampleIds.forEach((needId) => {\n        if (minimalSamplesById[needId]) {\n          usefulPromises.push(minimalSamplesById[needId])\n        } else {\n          fetchIds.push(needId)\n        }\n      })\n      const fetchPromise = fetchIds.length > 0 ? fetchMinimalSamplesByIds(api)(fetchIds) : Promise.resolve([])\n      const newOrderedSamplePromises = fetchIds.map((fetchId) =>\n        fetchPromise.then((fetched) => fetched.find(({ id }) => id === fetchId))\n      )\n      setMinimalSamplesById(\n        produce((draft) => {\n          fetchIds.forEach((fetchId, index) => {\n            draft[fetchId] = newOrderedSamplePromises[index]\n          })\n        })\n      )\n      sourcePromises.push(\n        Promise.all([...usefulPromises, ...newOrderedSamplePromises])\n          .then((resolvedSamplesOrUndefineds) => resolvedSamplesOrUndefineds.filter(identity) as MinimalSample[])\n          .catch((err) => {\n            notifications.error(`Failed to retrieve samples by ID: ${err}`)\n            setMinimalSamplesById(\n              produce((draft) => {\n                fetchIds.forEach((fetchId) => {\n                  delete draft[fetchId] // clear promise so failure isn't permanent with the ID\n                })\n              })\n            )\n            return []\n          })\n      )\n    }\n\n    const isAddModeWithoutSource = isProjectAddMode && sourcePromises.length === 0\n\n    // post-sources filter: sample type\n    if (criteria.type) {\n      const { type } = criteria\n      criteriaFilters.push({\n        id: 'type',\n        label: type.chipLabel,\n        filterFn: (sample) => sample.type === type.id,\n        onDelete: () => resetField('type'),\n        chipColor: isAddModeWithoutSource ? 'warn' : 'default',\n      })\n    }\n\n    // post-sources filter: sample method\n    if (criteria.method) {\n      const { method } = criteria\n      criteriaFilters.push({\n        id: 'method',\n        label: method.chipLabel,\n        filterFn: (sample) => sample.method === method.id,\n        onDelete: () => resetField('method'),\n        chipColor: isAddModeWithoutSource ? 'warn' : 'default',\n      })\n    }\n\n    // post-sources filter: date range\n    if (criteria.fromDate || criteria.toDate) {\n      const { fromDate, toDate } = criteria\n      const common = {\n        id: 'dateCriteria',\n        onDelete: () => {\n          resetField('fromDate')\n          resetField('toDate')\n        },\n        chipColor: isAddModeWithoutSource ? 'warn' : 'default',\n      }\n      if (fromDate && !toDate) {\n        criteriaFilters.push({\n          ...common,\n          label: `sampled ${fromDate} or later`,\n          filterFn: ({ sampleDate }) => sampleDate >= fromDate,\n        })\n      } else if (!fromDate && toDate) {\n        criteriaFilters.push({\n          ...common,\n          label: `sampled ${toDate} or earlier`,\n          filterFn: ({ sampleDate }) => sampleDate <= toDate,\n        })\n      } else if (fromDate && fromDate === toDate) {\n        criteriaFilters.push({\n          ...common,\n          label: `sampled on ${fromDate}`,\n          filterFn: ({ sampleDate }) => sampleDate === fromDate,\n        })\n      } else if (fromDate && toDate) {\n        if (fromDate > toDate) {\n          criteriaFilters.push({\n            ...common,\n            label: `sampled between ${fromDate} and ${toDate}`,\n            filterFn: rejectAllFilterFn,\n            chipColor: 'error',\n          })\n          errorMessages.push('From Date cannot be after To Date')\n        } else {\n          criteriaFilters.push({\n            ...common,\n            label: `sampled between ${fromDate} and ${toDate}`,\n            filterFn: ({ sampleDate }) => sampleDate >= fromDate && sampleDate <= toDate,\n          })\n        }\n      }\n    }\n\n    // post-sources filter: area range\n    if (criteria.fromArea || criteria.toArea) {\n      const { fromArea, toArea } = criteria\n      const common = {\n        id: 'areaCriteria',\n        onDelete: () => {\n          resetField('fromArea')\n          resetField('toArea')\n        },\n        chipColor: isAddModeWithoutSource ? 'warn' : 'default',\n      }\n      if (fromArea && !toArea) {\n        criteriaFilters.push({\n          ...common,\n          label: `sampled area ${fromArea} m² or greater`,\n          filterFn: ({ area }) => area >= fromArea,\n        })\n      } else if (!fromArea && toArea) {\n        criteriaFilters.push({\n          ...common,\n          label: `sampled area ${toArea} m² or less`,\n          filterFn: ({ area }) => area <= toArea,\n        })\n      } else if (fromArea && toArea) {\n        if (fromArea > toArea) {\n          criteriaFilters.push({\n            ...common,\n            label: `sampled area between ${fromArea} m² and ${toArea} m²`,\n            filterFn: rejectAllFilterFn,\n            chipColor: 'error',\n          })\n          errorMessages.push('Min Area cannot be greater than Max Area')\n        } else {\n          criteriaFilters.push({\n            ...common,\n            label: `sampled area between ${fromArea} m² and ${toArea} m²`,\n            filterFn: ({ area }) => area >= fromArea && area <= toArea,\n          })\n        }\n      }\n    }\n\n    // this project/box filter\n    if (criteriaFilters.length > 0) {\n      const thisSourceSampleIds = thisSourceSamples.map(({ id }) => id)\n      if (isProjectAddMode) {\n        thisSourceFilters.push({\n          id: 'thisSource',\n          label: 'not already in this project',\n          filterFn: ({ id }) => !thisSourceSampleIds.includes(id),\n        })\n      } else if (isProjectRemoveMode) {\n        thisSourceFilters.push({\n          id: 'thisSource',\n          label: 'currently in this project',\n          filterFn: ({ id }) => thisSourceSampleIds.includes(id),\n        })\n      } else if (isBoxSplitMode) {\n        thisSourceFilters.push(\n          {\n            id: 'thisSource',\n            label: 'in this box',\n            filterFn: ({ id }) => thisSourceSampleIds.includes(id),\n          },\n          {\n            id: 'alreadySelected',\n            label: 'not already selected',\n            filterFn: passAllFilterFn,\n          }\n        )\n      }\n    }\n\n    // set display filters\n    setDisplayFilters([...criteriaFilters, ...thisSourceFilters])\n\n    // clear matched samples\n    setCandidateSamples([])\n\n    // retrieve and filter data or display error\n    if (errorMessages.length > 0) {\n      // criteria error\n      setResultsMessage(`Cannot match samples: ${errorMessages.join(', ')}.`)\n    } else if (sourcePromises.length === 0) {\n      // nothing to fetch\n      if (criteriaFilters.length === 0) {\n        // still waiting for any criterion\n        setResultsMessage(null)\n      } else if (isProjectAddMode) {\n        // add mode with post-source filter(s) only; need more criteria\n        setResultsMessage(\n          'Add more criteria to match samples. (Type, Method, Date, and Area may only be used as supplemental criteria when adding samples.)'\n        )\n      } else {\n        // remove mode with post-source filter(s) only; use current project/box samples as sole source\n        const filteredSamples = criteriaFilters.reduce<MinimalSample[]>(\n          (acc, { filterFn }) => acc.filter(filterFn),\n          thisSourceSamples\n        )\n        setCandidateSamples(filteredSamples)\n        const operableCount = filteredSamples.length\n        if (isProjectMode) {\n          setResultsMessage(\n            <span>\n              Matched <strong>{operableCount}</strong> {pluralize(operableCount, 'sample')}{' '}\n              {isProjectAddMode ? 'not already' : 'currently'} in this project.\n            </span>\n          )\n        } else {\n          setResultsMessage(\n            <span>\n              Matched <strong>{operableCount}</strong> {pluralize(operableCount, 'sample')}.\n              {operableCount === thisSourceSamples.length\n                ? ' Cannot select samples as box would be left with 0 samples.'\n                : ''}\n            </span>\n          )\n        }\n      }\n    } else {\n      // enter fetching mode\n      setResultsMessage(<LinearProgress css={{ width: '25rem' }} />)\n\n      // process sources and filters\n      Promise.all(sourcePromises).then((sources) => {\n        if (cancelled) return // do nothing if this effect has been superceded\n\n        // intersect sources\n        const [firstSource, ...restSources] = sources\n        let filteredSamples = restSources.reduce(\n          (acc, source) => intersectionBy(acc, source, ({ id }) => id),\n          firstSource\n        )\n\n        // apply filters\n        filteredSamples = criteriaFilters.reduce<MinimalSample[]>(\n          (acc, { filterFn }) => acc.filter(filterFn),\n          filteredSamples\n        )\n        const matchedCount = filteredSamples.length // get match count before source-based filter\n        filteredSamples = thisSourceFilters.reduce<MinimalSample[]>(\n          (acc, { filterFn }) => acc.filter(filterFn),\n          filteredSamples\n        )\n\n        // set candidate samples and messaging\n        setCandidateSamples(filteredSamples)\n        const operableCount = filteredSamples.length\n        if (isProjectMode) {\n          setResultsMessage(\n            <span>\n              Matched {matchedCount} {pluralize(matchedCount, 'sample')} of which <strong>{operableCount}</strong>{' '}\n              {pluralize(operableCount, 'is')} {isProjectAddMode ? 'not already' : 'currently'} in this project.\n            </span>\n          )\n        } else {\n          setResultsMessage(\n            <span>\n              Matched <strong>{operableCount}</strong> {pluralize(operableCount, 'sample')}.\n              {operableCount === thisSourceSamples.length\n                ? ' Cannot select samples as box would be left with 0 samples.'\n                : ''}\n            </span>\n          )\n        }\n      })\n    }\n\n    // return cleanup function\n    return () => {\n      cancelled = true\n    }\n  }, [thisSourceSamples, mode, criteria])\n\n  // RENDER\n\n  return (\n    <div>\n      <div css={{ display: 'flex', alignItems: 'center', minHeight: '2.5em' }}>\n        {isProjectMode && (\n          <Title>\n            Edit Samples in Project {thisProjectName}{' '}\n            <Title.Subtitle>\n              ({thisSourceSamples.length} {pluralize(thisSourceSamples.length, 'sample')})\n            </Title.Subtitle>\n          </Title>\n        )}\n        {isBoxSplitMode && newBoxSamples && (\n          <Title>\n            Split Box {thisBoxId}{' '}\n            <Title.Subtitle>\n              {`(${initialSamples.length} ${pluralize(initialSamples.length, 'sample')}`}\n              {newBoxSamples.length > 0\n                ? ` before split, ${initialSamples.length - newBoxSamples.length} ${pluralize(\n                    initialSamples.length - newBoxSamples.length,\n                    'sample'\n                  )} after split)`\n                : ')'}\n            </Title.Subtitle>\n          </Title>\n        )}\n        {isProjectMode && (\n          <MuiToggleButtonGroup\n            css={{ marginLeft: 'auto' }}\n            value={mode}\n            onChange={(_, newMode) => {\n              if (!newMode) return\n              setMode(newMode)\n            }}\n            exclusive\n          >\n            <MuiToggleButton size=\"small\" value={'add'} key=\"add\" css={{ width: '6em' }}>\n              Add\n            </MuiToggleButton>\n            <MuiToggleButton size=\"small\" value={'remove'} key=\"remove\" css={{ width: '6em' }}>\n              Remove\n            </MuiToggleButton>\n          </MuiToggleButtonGroup>\n        )}\n      </div>\n      <div\n        css={{\n          marginTop: '1rem',\n          display: 'grid',\n          gap: '1rem',\n          gridTemplateColumns: 'repeat(4, 1fr)',\n          gridTemplateAreas: `\n            \"box           box           project       project\"\n            \"organization  organization  organization  organization\"\n            \"site          site          siteCode      siteCode\"\n            \"usState       usState       waterbody     waterbody\"\n            \"geoJson       geoJson       geoJson       geoJson\"\n            \"taxon         taxon         taxon         taxon\"\n            \"sampleIds     sampleIds     sampleIds     sampleIds\"\n            \"type          type          method        method\"\n            \"fromDate      toDate        fromArea      toArea\"\n          `,\n        }}\n      >\n        {isProjectMode ? (\n          <BoxCriterionField gridArea=\"box\" value={criteria.box} onChange={makeSetFieldValue('box')} />\n        ) : (\n          <AutocompleteField gridArea=\"box\" label=\"Box\" value={null} onChange={noop} options={[]} disabled />\n        )}\n        <ProjectCriterionField\n          gridArea=\"project\"\n          value={criteria.project}\n          onChange={makeSetFieldValue('project')}\n          thisProjectId={thisProjectId ?? 0}\n        />\n        {isProjectMode ? (\n          <OrganizationCriterionField\n            gridArea=\"organization\"\n            value={criteria.organization}\n            onChange={makeSetFieldValue('organization')}\n          />\n        ) : (\n          <AutocompleteField\n            gridArea=\"organization\"\n            label=\"Customer\"\n            value={null}\n            onChange={noop}\n            options={[]}\n            disabled\n          />\n        )}\n        <SiteCriterionField gridArea=\"site\" value={criteria.site} onChange={makeSetFieldValue('site')} />\n        <TextField gridArea=\"siteCode\" label=\"Customer Site Code\" value=\"\" onChange={noop} disabled />\n        <UsStateCriterionField gridArea=\"usState\" value={criteria.usState} onChange={makeSetFieldValue('usState')} />\n        <TextField gridArea=\"waterbody\" label=\"Waterbody Name\" value=\"\" onChange={noop} disabled />\n        <GeoJsonCriterionField gridArea=\"geoJson\" value={criteria.geoJson} onChange={makeSetFieldValue('geoJson')} />\n        <TaxonomyCriterionField gridArea=\"taxon\" value={criteria.taxon} onChange={makeSetFieldValue('taxon')} />\n        <SampleIdsCriterionField\n          gridArea=\"sampleIds\"\n          value={criteria.sampleIds}\n          onChange={makeSetFieldValue('sampleIds')}\n        />\n        <TypeCriterionField gridArea=\"type\" value={criteria.type} onChange={makeSetFieldValue('type')} />\n        <MethodCriterionField gridArea=\"method\" value={criteria.method} onChange={makeSetFieldValue('method')} />\n        <DateField\n          gridArea=\"fromDate\"\n          value={criteria.fromDate}\n          onChange={makeSetFieldValue('fromDate')}\n          label=\"From Date\"\n          error={errors?.fromDate}\n        />\n        <DateField\n          gridArea=\"toDate\"\n          value={criteria.toDate}\n          onChange={makeSetFieldValue('toDate')}\n          label=\"To Date\"\n          error={errors?.toDate}\n        />\n        <NumberField\n          gridArea=\"fromArea\"\n          value={criteria.fromArea}\n          onChange={makeSetFieldValue('fromArea')}\n          label=\"Min Area\"\n          error={errors?.fromArea}\n          min={0}\n          max={5}\n        />\n        <NumberField\n          gridArea=\"toArea\"\n          value={criteria.toArea}\n          onChange={makeSetFieldValue('toArea')}\n          label=\"Max Area\"\n          error={errors?.toArea}\n          min={0}\n          max={5}\n        />\n      </div>\n      <div\n        css={{\n          marginTop: '1rem',\n          display: 'grid',\n          gap: '1rem',\n        }}\n      >\n        <FilterChips filters={displayFilters} joinLabel=\"and\" noneNode={<Chip label=\"No criteria\" />} />\n        <div css={{ minHeight: '1.2rem', display: 'flex', alignItems: 'center' }}>{resultsMessage}</div>\n        <div css={{ display: 'flex' }}></div>\n        {isProjectMode && (\n          <MuiButton\n            variant=\"contained\"\n            disabled={candidateSamples.length === 0 || isOperating}\n            onClick={isProjectAddMode ? handleAddToProject : handleRemoveFromProject}\n            startIcon={isProjectAddMode ? <AddCircleIcon /> : <RemoveCircleIcon />}\n          >\n            {(() => {\n              if (isProjectAddMode) {\n                if (isOperating) return 'Adding samples to project...'\n                if (candidateSamples.length === 0) return 'Add samples to project'\n                return `Add ${candidateSamples.length} ${pluralize(candidateSamples.length, 'sample')} to project`\n              } else {\n                if (isOperating) return 'Removing samples from project...'\n                if (candidateSamples.length === 0) return 'Remove samples from project'\n                return `Remove ${candidateSamples.length} ${pluralize(candidateSamples.length, 'sample')} from project`\n              }\n            })()}\n          </MuiButton>\n        )}\n        {isBoxSplitMode && (\n          <MuiButton\n            variant=\"contained\"\n            disabled={candidateSamples.length === 0 || candidateSamples.length === thisSourceSamples.length}\n            onClick={handleAssignToNewBox}\n          >\n            {(() => {\n              if (isOperating) return 'Creating box...'\n              if (candidateSamples.length === 0) return 'Select samples for new box'\n              return `Select ${candidateSamples.length} ${pluralize(candidateSamples.length, 'sample')} for new box`\n            })()}\n          </MuiButton>\n        )}\n      </div>\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiButton from '@mui/material/Button'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\nimport { SelectSamples } from '../SelectSamples'\nimport { selectBoxSamplesByBoxId, useInvalidate } from '../../data/selectors'\nimport { useRecoilValue } from 'recoil'\nimport { withSuspense } from '../withSuspense'\nimport { pluralize } from '../../lib/formats'\nimport { MinimalSample } from '../../types'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { splitBox } from '../../data/calls'\nimport { useNavigate } from '../AppRouter'\n\nexport interface SplitBoxDialogProps {\n  boxId: number\n  isOpen: boolean\n  onClose: () => void\n}\n\nexport const SplitBoxDialog = withSuspense(\n  ({ boxId, isOpen, onClose }: SplitBoxDialogProps): JSX.Element => {\n    const api = useApi()\n    const invalidate = useInvalidate()\n    const notifications = useNotifications()\n    const navigate = useNavigate()\n\n    const samples = useRecoilValue(selectBoxSamplesByBoxId(boxId))\n    const [isOperating, setIsOperating] = useState(false)\n    const [newBoxSamples, setNewBoxSamples] = useState<MinimalSample[]>([])\n\n    const handleClose = () => {\n      if (isOperating) return // do not close when operating (may have been invoked by escape key)\n      onClose()\n    }\n\n    const handleSplit = async () => {\n      try {\n        setIsOperating(true)\n        const newBoxId = await splitBox(api, invalidate)({ boxId, sampleIds: newBoxSamples.map(({ id }) => id) })\n        navigate.boxDetail({ boxId: newBoxId })\n        notifications.info(`Created Box ${newBoxId} with samples transferred from Box ${boxId}`)\n      } catch (err) {\n        notifications.error(`Failed to split box: ${err}`)\n        setIsOperating(false)\n      }\n    }\n\n    return (\n      <MuiDialog open={isOpen} fullWidth maxWidth=\"lg\" onClose={handleClose}>\n        <MuiDialogContent>\n          <SelectSamples\n            initialMode=\"split\"\n            boxId={boxId}\n            samples={samples}\n            onOperatingChange={setIsOperating}\n            onNewBoxSamplesChange={setNewBoxSamples}\n          />\n        </MuiDialogContent>\n        <MuiDialogActions>\n          <MuiButton onClick={handleClose} disabled={isOperating}>\n            Cancel\n          </MuiButton>\n          <MuiButton onClick={handleSplit} disabled={isOperating || newBoxSamples.length === 0}>\n            Create Box From {newBoxSamples.length} {pluralize(newBoxSamples.length, 'sample')}\n          </MuiButton>\n        </MuiDialogActions>\n      </MuiDialog>\n    )\n  },\n  ({ isOpen, onClose }) => (\n    <MuiDialog open={isOpen} fullWidth maxWidth=\"lg\" onClose={onClose}>\n      <MuiDialogContent>\n        <MuiSkeleton variant=\"rectangular\" height=\"20rem\" />\n      </MuiDialogContent>\n      <MuiDialogActions>\n        <MuiButton onClick={onClose}>Cancel</MuiButton>\n      </MuiDialogActions>\n    </MuiDialog>\n  )\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useState } from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiButton from '@mui/material/Button'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\nimport { selectBoxById, selectBoxes, useInvalidate } from '../../data/selectors'\nimport { useRecoilValue } from 'recoil'\nimport { withSuspense } from '../withSuspense'\nimport { pluralize } from '../../lib/formats'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { useNavigate } from '../AppRouter'\nimport { Title } from '../Title'\nimport { AutocompleteField, AutocompleteFieldProps, Option } from '../AutocompleteField'\nimport { sortBy } from 'lodash'\nimport { mergeBoxes } from '../../data/calls'\nimport { ReadOnlyField } from '../ReadOnlyField'\n\nexport interface MergeBoxDialogProps {\n  boxId: number\n  isOpen: boolean\n  onClose: () => void\n}\n\nconst SelectOtherBoxField = withSuspense(\n  ({\n    boxId,\n    ...restProps\n  }: Pick<AutocompleteFieldProps<number>, 'label' | 'value' | 'onChange'> & { boxId: number }): JSX.Element => {\n    const boxes = useRecoilValue(selectBoxes)\n    const options: Option<number>[] = sortBy(boxes, (box) => box.id)\n      .filter(({ id }) => id !== boxId)\n      .reverse()\n      .map(({ id, alias, sampleCount, boxState }) => ({\n        value: id,\n        label: `Box ${id}${alias ? `: ${alias}` : ''} (${boxState}, ${sampleCount} samples)`,\n      }))\n\n    return <AutocompleteField {...restProps} options={options} />\n  },\n  (props) => <ReadOnlyField {...props} value={<MuiSkeleton />} />\n)\n\nexport const MergeBoxDialog = withSuspense(\n  ({ boxId, isOpen, onClose }: MergeBoxDialogProps): JSX.Element => {\n    const api = useApi()\n    const invalidate = useInvalidate()\n    const notifications = useNotifications()\n    const navigate = useNavigate()\n\n    const box = useRecoilValue(selectBoxById(boxId))\n    const sampleCount = box?.sampleCount\n\n    const [targetBoxId, setTargetBoxId] = useState<number | null>(null)\n    const [canOperate, setCanOperate] = useState(false)\n    const [isOperating, setIsOperating] = useState(false)\n\n    useEffect(() => {\n      if (!isOpen) return\n      setTargetBoxId(null)\n      setCanOperate(false)\n    }, [isOpen])\n\n    useEffect(() => {\n      if (!targetBoxId) return\n      setCanOperate(false)\n      const timer = window.setTimeout(() => {\n        setCanOperate(true)\n      }, 3000)\n      return () => window.clearTimeout(timer)\n    }, [targetBoxId])\n\n    const handleClose = () => {\n      if (isOperating) return // do not close when operating (may have been invoked by escape key)\n      onClose()\n    }\n\n    const handleMerge = async () => {\n      if (!targetBoxId) throw new Error('No target box.')\n      try {\n        setIsOperating(true)\n        await mergeBoxes(api, invalidate)({ sourceBoxId: boxId, targetBoxId })\n        navigate.boxDetail({ boxId: targetBoxId }, true)\n        notifications.info(`Merged Box ${boxId} into Box ${targetBoxId}`)\n      } catch (err) {\n        notifications.error(`Failed to merge boxes: ${err}`)\n      } finally {\n        setIsOperating(false)\n      }\n    }\n\n    return (\n      <MuiDialog open={isOpen} fullWidth maxWidth=\"sm\" onClose={handleClose}>\n        <MuiDialogContent>\n          <Title>Merge Box {boxId} Into Another Box</Title>\n          <div css={{ marginTop: '1em' }}>\n            <SelectOtherBoxField boxId={boxId} label=\"Target Box\" value={targetBoxId} onChange={setTargetBoxId} />\n          </div>\n          {targetBoxId &&\n            (canOperate ? (\n              <ul>\n                <li>\n                  {sampleCount} {pluralize(sampleCount, 'sample')} will be transferred from Box {boxId} to Box{' '}\n                  {targetBoxId}\n                </li>\n                <li>Box {boxId} will be deleted</li>\n              </ul>\n            ) : (\n              <ul>\n                <li>\n                  <MuiSkeleton width=\"20em\" />\n                </li>\n                <li>\n                  <MuiSkeleton width=\"10em\" />\n                </li>\n              </ul>\n            ))}\n        </MuiDialogContent>\n        <MuiDialogActions>\n          <MuiButton onClick={handleClose} disabled={isOperating}>\n            Cancel\n          </MuiButton>\n          <MuiButton onClick={handleMerge} disabled={isOperating || !canOperate}>\n            Transfer {sampleCount} {pluralize(sampleCount, 'Sample')} And Delete Box\n          </MuiButton>\n        </MuiDialogActions>\n      </MuiDialog>\n    )\n  },\n  () => null\n)\n","import Excel from 'exceljs'\nimport saveAs from 'file-saver'\nimport { get } from 'lodash'\n\nexport const downloadWorkbook = async (workbook: Excel.Workbook, filename: string): Promise<void> => {\n  const buffer = await workbook.xlsx.writeBuffer()\n  const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })\n  saveAs(blob, filename)\n}\n\nexport const downloadWorkbookAsCsv = async (workbook: Excel.Workbook, filename: string): Promise<void> => {\n  const buffer = await workbook.csv.writeBuffer()\n  const blob = new Blob([buffer], { type: 'text/csv' })\n  saveAs(blob, filename)\n}\n\nexport const downloadDataAsCsv = async <T>(\n  { rows, columns }: { columns: Partial<Excel.Column>[]; rows: T[] },\n  filename: string\n): Promise<void> => {\n  const wb = new Excel.Workbook()\n  const ws = wb.addWorksheet('data')\n\n  const processedRows = rows.map((row) =>\n    columns.reduce<Record<string, string | number | boolean | null | undefined>>((acc, col) => {\n      const colKey = col.key\n      if (!colKey) throw new Error(`A column key is missing.`)\n      return { ...acc, [colKey]: get(row, colKey) }\n    }, {})\n  )\n\n  ws.columns = columns\n  ws.addRows(processedRows)\n\n  downloadWorkbookAsCsv(wb, filename)\n}\n","import Excel, { Workbook } from 'exceljs'\n\ninterface AddSingleTableWorksheetConfig<T> {\n  wsName: string\n  columns: Partial<Excel.Column>[]\n  rows: T[]\n}\n\nexport const createSingleTableWorkbook = <T>(params: AddSingleTableWorksheetConfig<T>): Workbook => {\n  const wb = new Excel.Workbook()\n  addSingleTableWorksheet(wb, params)\n  return wb\n}\n\nexport const addSingleTableWorksheet = <T>(\n  wb: Excel.Workbook,\n  { wsName, columns, rows }: AddSingleTableWorksheetConfig<T>\n): void => {\n  const ws = wb.addWorksheet(wsName)\n\n  // add data\n  ws.columns = columns as Partial<Excel.Column>[]\n  ws.addRows(rows)\n\n  // autofit columns\n  ws.columns.forEach((column) => {\n    const columnValues = column.values\n    if (!columnValues) return\n    const lengths = columnValues.slice(1).map((value) => (value || '').toString().length)\n    const maxLength = Math.max(...lengths.filter((v) => typeof v === 'number'))\n    column.width = maxLength + 2 // add some padding for filter button\n  })\n\n  // freeze rows\n  ws.views = [{ state: 'frozen', xSplit: undefined, ySplit: 1, activeCell: 'A1' }]\n}\n","import dayjs from 'dayjs'\nimport Excel from 'exceljs'\nimport { sortBy, uniq } from 'lodash'\n\nimport { downloadWorkbook } from '../excel/downloadWorkbook'\nimport { Api } from '../../data/api'\nimport { fetchCustomerBoxReportByBoxId } from '../../data/calls'\nimport { addSingleTableWorksheet } from '../excel/singleTableUtil'\n\nconst samplesColumnConfig: Partial<Excel.Column>[] = [\n  { header: 'Sample ID', key: 'sampleId' },\n  { header: 'State', key: 'usState' },\n  { header: 'Visit ID', key: 'visitId' },\n  { header: 'Site Code', key: 'siteIdentifier' },\n  { header: 'Sample Date', key: 'sampleDate' },\n  { header: 'Latitude', key: 'latitude' },\n  { header: 'Longitude', key: 'longitude' },\n  { header: 'Waterbody', key: 'waterbodyName' },\n  { header: 'Sample Type', key: 'sampleType' },\n  { header: 'Sampler Type', key: 'sampleMethod' },\n  { header: 'Habitat', key: 'habitatName' },\n  { header: 'Area', key: 'area' },\n  { header: 'Field Split', key: 'fieldSplit' },\n  { header: 'Lab Split', key: 'labSplit' },\n  { header: 'Jar Count', key: 'jarCount' },\n  { header: 'Qualitative', key: 'qualitative' },\n]\n\nconst taxaColumnConfig: Partial<Excel.Column>[] = [\n  { header: 'Sample ID', key: 'sampleId' },\n  { header: 'Class', key: 'class' },\n  { header: 'Order', key: 'order' },\n  { header: 'Family', key: 'family' },\n  { header: 'Genus', key: 'genus' },\n  { header: 'Species', key: 'species' },\n  { header: 'Scientific Name', key: 'scientificName' },\n  { header: 'Split Count', key: 'splitCount' },\n  { header: 'Big Rare Count', key: 'bigRareCount' },\n]\n\nexport const downloadCustomerBoxReport = async ({\n  boxId,\n  api,\n  filename,\n}: {\n  boxId: number\n  api: Api\n  filename: string\n}): Promise<boolean> => {\n  const {\n    boxInfo: {\n      submittedBy,\n      submitterEmail,\n      customer: { organizationName, address1, address2, city, usState, zipCode, phone },\n    },\n    samples,\n    sampleTaxa,\n    reportMetrics,\n    template,\n  } = await fetchCustomerBoxReportByBoxId(api)(boxId)\n\n  // create workbook from blank\n\n  const wb = new Excel.Workbook()\n\n  await new Promise<void>((resolve) => {\n    const reader = new FileReader()\n    reader.onload = async () => {\n      const buffer = reader.result\n      if (!(buffer instanceof ArrayBuffer)) throw new Error('not an arraybuffer')\n      await wb.xlsx.load(buffer)\n      resolve()\n    }\n    reader.readAsArrayBuffer(template)\n  })\n\n  // Sheet 1: Summary\n\n  const summaryWs = wb.worksheets[0]\n  const findRangeByName = (name: string): string => {\n    const found = wb.definedNames.model.find((range) => range.name === name)\n    if (!found) throw new Error(`Named range \"${name}\" not found in workbook.`)\n    return found.ranges[0].split('!')[1]\n  }\n  summaryWs.getCell(findRangeByName('ReportDate')).value = dayjs().format('YYYY-MM-DD')\n  summaryWs.getCell(findRangeByName('SubmitterName')).value = submittedBy\n  summaryWs.getCell(findRangeByName('CustomerName')).value = organizationName\n  summaryWs.getCell(findRangeByName('Address1')).value = address1\n  summaryWs.getCell(findRangeByName('Address2')).value = address2\n  summaryWs.getCell(findRangeByName('CityStateZip')).value = `${city}, ${usState}  ${zipCode}`\n  summaryWs.getCell(findRangeByName('Telephone')).value = phone\n  summaryWs.getCell(findRangeByName('Email')).value = submitterEmail\n\n  // Sheet 2: Samples\n\n  const sampleRowData = samples.map(\n    ({\n      fieldSplit,\n      labSplit,\n      customerSiteCode,\n      sampleLatitude,\n      sampleLongitude,\n      siteName,\n      siteLatitude,\n      siteLongitude,\n      ...restSample\n    }) => {\n      const [latitude, longitude] =\n        sampleLatitude && sampleLongitude ? [sampleLatitude, sampleLongitude] : [siteLatitude, siteLongitude]\n\n      const siteIdentifier = customerSiteCode || siteName\n\n      return {\n        fieldSplit: fieldSplit * 100,\n        labSplit: labSplit * 100,\n        siteIdentifier,\n        latitude,\n        longitude,\n        ...restSample,\n      }\n    }\n  )\n\n  addSingleTableWorksheet(wb, { wsName: 'Samples', columns: samplesColumnConfig, rows: sampleRowData })\n\n  // Sheet 3: Taxa\n\n  addSingleTableWorksheet(wb, { wsName: 'Taxa', columns: taxaColumnConfig, rows: sampleTaxa })\n\n  // Sheet 4: Metrics\n\n  const sampleIds = samples.map(({ sampleId }) => sampleId)\n  const metricNames = uniq(reportMetrics.map(({ metricName }) => metricName))\n\n  const metricsColumnConfig = [\n    {\n      header: 'Sample ID',\n      key: 'sampleId',\n    },\n    ...sortBy(reportMetrics, ({ metricGroupId }) => metricGroupId || 0).map(({ metricName }) => ({\n      header: metricName,\n      key: metricName,\n    })),\n  ]\n\n  const metricRowData = sampleIds.map((sampleId) => {\n    const thisRow = { sampleId }\n    metricNames.forEach((metricName) => {\n      const value = reportMetrics.find(\n        (reportMetric) => reportMetric.sampleId === sampleId && reportMetric.metricName === metricName\n      )?.metricValue\n      if (typeof value === 'undefined') return\n      const valueAsNumber = Number(value)\n      thisRow[metricName] = isNaN(valueAsNumber) ? value : valueAsNumber\n    })\n    return thisRow\n  })\n\n  addSingleTableWorksheet(wb, { wsName: 'Metrics', columns: metricsColumnConfig, rows: metricRowData })\n\n  // download file\n\n  downloadWorkbook(wb, filename)\n\n  return true\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport MuiButton from '@mui/material/Button'\nimport { selector, atom, useRecoilState } from 'recoil'\nimport { NAMCResource, GrantAction } from '@namcbugdb/common'\nimport dayjs from 'dayjs'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CheckboxField } from '../CheckboxField'\nimport { TextField } from '../TextField'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { Box, MyUser } from '../../types'\nimport { BoxSamples } from './BoxSamples'\nimport { selectBoxStates, BOX_STATE_ID, selectOrganizations, useInvalidate } from '../../data/selectors'\nimport { AccordionPanel } from '../AccordionPanel'\nimport { Title } from '../Title'\nimport { formatUtcDateTimeToAppDate, pluralize } from '../../lib/formats'\nimport { SortingProgressField } from './SortingProgressField'\nimport { IdentificationProgressField } from './IdentificationProgressField'\nimport { ModelsField } from '../ModelsField'\nimport { ConfirmNavigateAway } from '../AppRouter'\nimport { BoxSitesMapPreview } from './BoxSitesMapPreview'\nimport { useNavigate } from '../AppRouter'\nimport { Divider, Menu, MenuItem } from '../Menu'\nimport { DataGridHeading } from '../DataGrid'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { useApi } from '../../data/api'\nimport { updateBox } from '../../data/calls'\nimport { useNotifications } from '../AppNotifications'\nimport { SplitBoxDialog } from './SplitBoxDialog'\nimport { MergeBoxDialog } from './MergeBoxDialog'\nimport { DateField } from '../DateField'\nimport { downloadCustomerBoxReport } from '../../lib/reports/downloadCustomerBoxReport'\n\nexport interface BoxDetailProps {\n  box: Box\n  user: MyUser\n}\n\nconst selectOrganizationOptions = selector({\n  key: 'BoxDetail/selectOrganizationOptions',\n  get: async ({ get }) => {\n    const organizations = await get(selectOrganizations)\n    return organizations.map(({ id: value, name: label }) => ({ value, label }))\n  },\n})\n\nconst selectBoxStateOptions = selector({\n  key: 'BoxDetail/selectBoxStateOptions',\n  get: async ({ get }) => {\n    const boxStates = await get(selectBoxStates)\n    return boxStates.map(({ id, name }) => ({ value: id, label: name }))\n  },\n})\n\nconst isExpandedState = atom<boolean>({\n  key: 'BoxDetail/isExpandedState',\n  default: true,\n})\n\ninterface Fields {\n  boxStateId: number\n  measurements: boolean\n  midges: boolean\n  description: string\n  customerId: number\n  alias: string\n  modelIds: number[]\n  receivedDate: string | null\n}\n\ninterface State {\n  values: Fields\n  editMode: 'stopped' | 'started' | 'stopping'\n  isDirty: boolean\n  isSplitDialogOpen: boolean\n  isMergeDialogOpen: boolean\n}\n\nconst getInitialState = ({ box }: { box: Box }): State => {\n  const {\n    boxStateId = -1,\n    measurements,\n    midges,\n    description = '',\n    customerId,\n    alias,\n    modelIds = [],\n    receivedDate,\n  } = box\n  return {\n    values: {\n      boxStateId,\n      measurements,\n      midges,\n      description,\n      customerId,\n      alias,\n      modelIds,\n      receivedDate,\n    },\n    editMode: 'stopped',\n    isDirty: false,\n    isSplitDialogOpen: false,\n    isMergeDialogOpen: false,\n  }\n}\n\nexport const BoxDetail = ({ box, user }: BoxDetailProps): JSX.Element => {\n  const api = useApi()\n  const invalidate = useInvalidate()\n  const navigate = useNavigate()\n  const notifications = useNotifications()\n\n  const [state, setState, updateState] = useUpdatableState(getInitialState({ box }), [box])\n\n  const [isPanelExpanded, setIsPanelExpanded] = useRecoilState(isExpandedState)\n  const {\n    editMode,\n    values: {\n      boxStateId,\n      measurements,\n      midges,\n      description,\n      customerId,\n      alias,\n      modelIds,\n      receivedDate: isoReceivedDate,\n    },\n    isDirty,\n    isSplitDialogOpen,\n    isMergeDialogOpen,\n  } = state\n  const receivedDate = isoReceivedDate && formatUtcDateTimeToAppDate(isoReceivedDate)\n\n  const isStopped = editMode === 'stopped'\n  const isEditing = editMode === 'started'\n  const isSaving = editMode === 'stopping'\n\n  // HANDLERS\n\n  const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n    updateState((draft) => {\n      Object.assign(draft.values, { [fieldName]: value })\n      draft.isDirty = true\n    })\n  }\n  const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n  const handleEdit = () => {\n    setIsPanelExpanded(true)\n    updateState((draft) => {\n      draft.editMode = 'started'\n    })\n  }\n\n  const handleSave = async () => {\n    updateState((draft) => {\n      draft.editMode = 'stopping'\n    })\n    try {\n      await updateBox(api, invalidate)({ boxId: box.id, ...state.values })\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n        draft.isDirty = false\n      })\n    } catch (err) {\n      notifications.error(`Failed to save box: ${err}`)\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n  }\n\n  const handleCancel = () => {\n    setState(getInitialState({ box }))\n  }\n\n  // RENDER\n\n  const actionsMenuItems = useMemo(() => {\n    const items: MenuItem[] = [\n      {\n        key: 'taxonomy',\n        label: 'Taxonomy',\n        onClick: () => navigate.boxTaxonomy({ boxId: box.id }),\n      },\n      {\n        key: 'customerReport',\n        label: 'Download Customer Report',\n        onClick: async () => {\n          try {\n            const cancelNotification1 = notifications.info('Still creating report...', 2500)\n            const cancelNotification2 = notifications.info('Still creating report...', 30000)\n            await downloadCustomerBoxReport({ boxId: box.id, api, filename: `NAMC_report_${box.id}.xlsx` })\n            cancelNotification1()\n            cancelNotification2()\n          } catch (err) {\n            notifications.error(`Failed to create report: ${err}`)\n          }\n        },\n        disabled: box.boxStateId !== BOX_STATE_ID.complete,\n      },\n      Divider,\n    ]\n    if (user.hasPermission(NAMCResource.boxes, GrantAction.updateAny)) {\n      items.push({\n        key: 'edit',\n        label: 'Edit Box',\n        onClick: () => {\n          handleEdit()\n        },\n      })\n      if (box.boxStateId !== BOX_STATE_ID.pending) {\n        items.push(\n          {\n            key: 'split',\n            label: 'Split Box',\n            onClick: () => {\n              updateState((draft) => {\n                draft.isSplitDialogOpen = true\n              })\n            },\n          },\n          {\n            key: 'merge',\n            label: 'Merge Box',\n            onClick: () => {\n              updateState((draft) => {\n                draft.isMergeDialogOpen = true\n              })\n            },\n          }\n        )\n      }\n    }\n    if (\n      user.hasPermission(NAMCResource.submissions, GrantAction.updateAny) &&\n      box.boxStateId === BOX_STATE_ID.pending\n    ) {\n      items.push({\n        key: 'review',\n        label: 'Review Box',\n        onClick: () => {\n          navigate.boxReview({ boxId: box.id })\n        },\n      })\n    }\n\n    return items\n  }, [box.boxStateId])\n\n  return (\n    <>\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <AccordionPanel\n          value={isPanelExpanded}\n          onChange={setIsPanelExpanded}\n          locked={isEditing}\n          summary={\n            <Title>\n              Box {box.id}{' '}\n              <Title.Subtitle>\n                ({box.boxState}, {box.sampleCount} {pluralize(box.sampleCount, 'sample')})\n              </Title.Subtitle>\n            </Title>\n          }\n          actions={\n            <div css={{ display: 'flex', gap: '0.5em' }}>\n              {isStopped && actionsMenuItems.length > 0 && <Menu label=\"Actions\" items={actionsMenuItems} />}\n              {(isEditing || isSaving) && (\n                <>\n                  <MuiButton\n                    onClick={() => {\n                      handleCancel()\n                    }}\n                    variant=\"outlined\"\n                    disabled={isSaving}\n                  >\n                    Cancel\n                  </MuiButton>\n                  <MuiButton\n                    onClick={() => {\n                      handleSave()\n                    }}\n                    variant=\"contained\"\n                    disabled={!isDirty || isSaving}\n                  >\n                    Save\n                  </MuiButton>\n                </>\n              )}\n            </div>\n          }\n        >\n          <div\n            css={{\n              flex: 1,\n              display: 'grid',\n              gap: '0.75em',\n              gridTemplateColumns: 'auto auto auto auto auto',\n              gridTemplateAreas: `\n              \"boxState     customerId              sorting       identification     map\"\n              \"measurements submittedByName         modelIds      modelIds           map\"\n              \"midges       createdDate             modelIds      modelIds           map\"\n              \"taxaQa       receivedDate            alias         alias              map\"\n              \"sorterQa     processingCompleteDate  description   description        map\"\n              \".            .                       description   description        map\"\n            `,\n            }}\n          >\n            <AutocompleteField\n              label=\"Box State\"\n              optionsSelector={selectBoxStateOptions}\n              value={boxStateId}\n              valueLabel={box.boxState}\n              onChange={makeFieldChangeHandler('boxStateId')}\n              readOnly={!isEditing}\n              gridArea=\"boxState\"\n            />\n            <AutocompleteField\n              gridArea=\"customerId\"\n              optionsSelector={selectOrganizationOptions}\n              valueLabel={box.customerName}\n              value={customerId}\n              onChange={makeFieldChangeHandler('customerId')}\n              label=\"Customer\"\n              readOnly={!isEditing}\n              css={{ minWidth: '20em' }}\n            />\n            <ReadOnlyField gridArea=\"submittedByName\" value={box.submittedByName} label=\"Submitted By\" />\n            <ReadOnlyField\n              gridArea=\"createdDate\"\n              value={formatUtcDateTimeToAppDate(box.createdDate ?? null)}\n              label=\"Submitted On\"\n            />\n            <DateField\n              gridArea=\"receivedDate\"\n              value={receivedDate}\n              onChange={makeFieldChangeHandler('receivedDate')}\n              label=\"Received On\"\n              readOnly={!isEditing}\n              max={dayjs().format('YYYY-MM-DD')}\n            />\n            <ReadOnlyField\n              gridArea=\"processingCompleteDate\"\n              value={formatUtcDateTimeToAppDate(box.processingCompleteDate ?? null)}\n              label=\"Processing Completed On\"\n            />\n            <CheckboxField\n              label=\"Measurements\"\n              value={measurements}\n              onChange={makeFieldChangeHandler('measurements')}\n              readOnly={!isEditing}\n              gridArea=\"measurements\"\n            />\n            <CheckboxField\n              label=\"Midges\"\n              value={midges}\n              onChange={makeFieldChangeHandler('midges')}\n              readOnly={!isEditing}\n              gridArea=\"midges\"\n            />\n            <ReadOnlyField label=\"Taxonomic QA\" value={box.taxaQa} gridArea=\"taxaQa\" />\n            <ReadOnlyField label=\"Sorting QA\" value={box.sorterQa} gridArea=\"sorterQa\" />\n            <ModelsField\n              label=\"Models\"\n              value={modelIds}\n              onChange={makeFieldChangeHandler('modelIds')}\n              readOnly={!isEditing}\n              gridArea=\"modelIds\"\n            />\n            <TextField\n              label=\"Alias\"\n              value={alias}\n              onChange={makeFieldChangeHandler('alias')}\n              readOnly={!isEditing}\n              gridArea=\"alias\"\n            />\n            <TextField\n              label=\"Description\"\n              value={description}\n              onChange={makeFieldChangeHandler('description')}\n              readOnly={!isEditing}\n              multiline\n              minRows={3}\n              gridArea=\"description\"\n            />\n            <SortingProgressField boxId={box.id} value={box.sortComplete} gridArea=\"sorting\" />\n            <IdentificationProgressField boxId={box.id} value={box.identificationComplete} gridArea=\"identification\" />\n            {editMode !== 'started' && (\n              <div css={{ gridArea: 'map' }}>\n                <BoxSitesMapPreview boxId={box.id} />\n              </div>\n            )}\n          </div>\n        </AccordionPanel>\n        <DataGridHeading>Samples</DataGridHeading>\n        <div css={{ flex: 1, minHeight: '10em' }}>\n          <BoxSamples boxId={box.id} />\n        </div>\n      </div>\n      <SplitBoxDialog\n        boxId={box.id}\n        isOpen={isSplitDialogOpen}\n        onClose={() =>\n          updateState((draft) => {\n            draft.isSplitDialogOpen = false\n          })\n        }\n      />\n      <MergeBoxDialog\n        boxId={box.id}\n        isOpen={isMergeDialogOpen}\n        onClose={() =>\n          updateState((draft) => {\n            draft.isMergeDialogOpen = false\n          })\n        }\n      />\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n    </>\n  )\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectBoxById, selectMyUser } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { BoxDetail as Component } from './BoxDetail'\nimport { Fallback } from './Fallback'\n\nexport interface BoxDetailProps {\n  boxId: string | number\n}\n\nexport const BoxDetail = withSuspense(({ boxId }: BoxDetailProps): JSX.Element => {\n  const box = useRecoilValue(selectBoxById(Number(boxId)))\n  const user = useRecoilValue(selectMyUser)\n\n  if (box === null) return <h2>Box {boxId} not found.</h2>\n\n  return <Component box={box} user={user} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const privilegedColumnDefs = [\n  columnDef.linkColumn({\n    headerName: 'Box ID',\n    field: 'boxId',\n    width: 120,\n  }),\n  columnDef.filterableTextColumn({\n    field: 'customer',\n    flex: 3,\n    minWidth: 400,\n    filterTooltip: 'Filter by this customer',\n  }),\n  columnDef.textColumn({\n    field: 'alias',\n    flex: 1,\n    minWidth: 110,\n  }),\n  columnDef.numberColumn({\n    field: 'sampleCount',\n    width: 130,\n  }),\n  columnDef.textColumn({\n    field: 'boxState',\n    width: 110,\n  }),\n  columnDef.booleanColumn({\n    field: 'measurements',\n    valueLabels: ['No', 'Yes'],\n    width: 130,\n  }),\n  columnDef.booleanColumn({\n    field: 'midges',\n    valueLabels: ['No', 'Yes'],\n    width: 90,\n  }),\n  columnDef.dateColumn({\n    field: 'receivedDate',\n    width: 150,\n  }),\n  columnDef.progressColumn({\n    headerName: '% Complete Sort',\n    field: 'sortComplete',\n    width: 140,\n  }),\n  columnDef.progressColumn({\n    headerName: '% Complete ID',\n    field: 'identificationComplete',\n    width: 140,\n  }),\n] as ColDef[]\n\nexport const customerColumnDefs = [\n  columnDef.textColumn({\n    headerName: 'Submission ID',\n    field: 'id',\n    width: 150,\n  }),\n  columnDef.dateColumn({\n    headerName: 'Submitted On',\n    field: 'createdDate',\n    width: 150,\n  }),\n  columnDef.textColumn({\n    headerName: 'Submission State',\n    field: 'boxState',\n    width: 150,\n  }),\n  columnDef.numberColumn({\n    field: 'sampleCount',\n    width: 130,\n  }),\n  columnDef.linkColumn({\n    field: 'forms',\n    width: 160,\n  }),\n  columnDef.linkColumn({\n    field: 'reports',\n    flex: 1,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiInputLabel from '@mui/material/InputLabel'\nimport MuiMenuItem from '@mui/material/MenuItem'\nimport MuiFormControl from '@mui/material/FormControl'\nimport MuiSelect, { SelectChangeEvent as MuiSelectChangeEvent } from '@mui/material/Select'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CommonFieldProps } from '../../types'\n\nexport interface SelectFieldProps extends CommonFieldProps<string | number> {\n  options: {\n    value: string | number\n    label: React.ReactNode\n    disabled?: boolean\n  }[]\n}\n\nexport const SelectField = ({\n  // CommonFieldProps\n  className,\n  disabled,\n  error,\n  gridArea,\n  label,\n  onChange,\n  readOnly,\n  value,\n\n  // SelectFieldProps\n  options,\n}: SelectFieldProps): JSX.Element => {\n  if (readOnly) {\n    const valueLabel = options.find((option) => option.value === value)?.label ?? ''\n    return <ReadOnlyField className={className} gridArea={gridArea} label={label} value={valueLabel} />\n  }\n\n  const handleChange = ({ target: { value: newValue } }: MuiSelectChangeEvent<string | number>) => {\n    onChange(newValue)\n  }\n\n  return (\n    <MuiFormControl\n      sx={{ minWidth: '10em' }}\n      className={className}\n      disabled={disabled || readOnly}\n      css={{ '.MuiInputBase-root': { color: 'unset' }, gridArea }}\n    >\n      {label && (\n        <MuiInputLabel\n          // size=\"small\" // typing says this isn't a prop, but it works to correctly position label :-|\n          error={error}\n        >\n          {label}\n        </MuiInputLabel>\n      )}\n      <MuiSelect<string | number> error={error} label={label} onChange={handleChange} value={value} size=\"small\">\n        {options.map((option) => (\n          <MuiMenuItem key={option.value} value={option.value} disabled={option.disabled}>\n            {option.label || <span css={{ fontStyle: 'italic' }}>(clear)</span>}\n          </MuiMenuItem>\n        ))}\n      </MuiSelect>\n    </MuiFormControl>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { useRecoilState, atom, useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\nimport { BoxStates, GrantAction, NAMCResource } from '@namcbugdb/common'\n// import log from 'loglevel'\n\nimport { DataGrid, renderers, DataGridRecordCount } from '../DataGrid'\nimport { Box } from '../../types'\nimport { privilegedColumnDefs } from './columnDefs'\nimport { SelectField } from '../SelectField'\nimport { useNavigate } from '../AppRouter'\nimport { FilterChips, Filter } from '../Filters'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\nimport { selectMyUser } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { Fallback } from './Fallback'\n\nexport interface PrivilegedBoxesListingProps {\n  boxes: Box[]\n  boxStates: BoxStates[]\n  isLoading: boolean\n}\n\nexport interface BoxRow extends Box {\n  boxId: {\n    label: number\n    onClick: () => void\n  }\n  customer: {\n    label: string\n    onFilter: () => void\n    disabled: boolean\n  }\n}\n\nconst ANY_BOX_STATE = 'ANY'\nconst ACTIVE_BOX_STATE = 'Active'\n\nconst boxStateNameFilterState = atom({\n  key: 'PrivilegedBoxesListing/boxStateNameFilter',\n  default: ACTIVE_BOX_STATE,\n})\n\nconst textFilterState = atom({\n  key: 'PrivilegedBoxesListing/textFilter',\n  default: '',\n})\n\nconst addedFiltersState = atom<Filter<Box>[]>({\n  key: 'PrivilegedBoxesListing/addedFilters',\n  default: [],\n})\n\nexport const PrivilegedBoxesListing = withSuspense(\n  ({ boxes, boxStates, isLoading }: PrivilegedBoxesListingProps): JSX.Element => {\n    const navigate = useNavigate()\n    const user = useRecoilValue(selectMyUser)\n\n    // STATE AND REFS\n\n    const [boxStateNameFilter, setBoxStateNameFilter] = useRecoilState(boxStateNameFilterState)\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n      useRecoilState(textFilterState)\n    )\n    const [addedFilters, setAddedFilters] = useRecoilState(addedFiltersState)\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<Box>[] = []\n\n      if (boxStateNameFilter !== ANY_BOX_STATE) {\n        result.push({\n          id: 'state',\n          label: boxStateNameFilter,\n          filterFn: (box) => box.boxState === boxStateNameFilter,\n          onDelete: () => {\n            setBoxStateNameFilter(ANY_BOX_STATE)\n          },\n        })\n      }\n\n      if (textFilterDebounced) {\n        if (textFilterDebounced.match(/^\\d+$/)) {\n          const targetBoxId = Number(textFilterDebounced)\n          result.push({\n            id: 'text',\n            label: `Box ${textFilterDebounced}`,\n            filterFn: (box) => box.id === targetBoxId,\n            onDelete: clearTextFilter,\n          })\n        } else {\n          result.push({\n            id: 'text',\n            label: `Customer contains \"${textFilterDebounced}\"`,\n            filterFn: ({ customerName }) => customerName.toLowerCase().includes(textFilterDebounced.toLowerCase()),\n            onDelete: clearTextFilter,\n          })\n        }\n      }\n\n      result.push(...addedFilters)\n\n      return result\n    }, [boxStateNameFilter, textFilterDebounced, addedFilters])\n\n    const rows = useMemo<BoxRow[]>(() => {\n      const filtered = filters.reduce<Box[]>((acc, { filterFn }) => acc.filter(filterFn), boxes)\n      return filtered.map((box) => {\n        const filterId = `filter/${String(box.customerId)}`\n        return {\n          ...box,\n          boxId: {\n            label: box.id,\n            onClick: () => navigate.boxDetail({ boxId: box.id }),\n          },\n          customer: {\n            label: box.customerName,\n            onFilter: () => {\n              clearTextFilter()\n              setAddedFilters([\n                {\n                  id: filterId,\n                  label: box.customerName,\n                  filterFn: ({ customerId }) => customerId === box.customerId,\n                  onDelete: () => setAddedFilters((value) => value.filter(({ id }) => id !== filterId)),\n                },\n              ])\n            },\n            disabled: !!addedFilters.find(({ id }) => id === filterId),\n          },\n        }\n      })\n    }, [boxes, filters])\n\n    // RENDER\n\n    const boxStateOptions = useMemo(() => {\n      return [\n        { value: ANY_BOX_STATE, label: 'Any' },\n        ...boxStates.filter(({ isActive }) => isActive).map(({ name }) => ({ value: name, label: name })),\n      ]\n    }, [boxStates])\n\n    return (\n      <>\n        <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n          <div css={{ display: 'flex', gap: '0.5em' }}>\n            <SelectField\n              value={boxStateNameFilter}\n              onChange={(value) => setBoxStateNameFilter(String(value))}\n              options={boxStateOptions}\n              label=\"Box State\"\n            />\n            <TextFilterField value={textFilter} onChange={setTextFilter} label=\"Box ID or Customer\" />\n            {user.hasPermission(NAMCResource.submissions, GrantAction.createAny) && (\n              <div css={{ marginLeft: 'auto' }}>\n                <MuiButton\n                  variant=\"outlined\"\n                  onClick={() => {\n                    navigate.boxSubmission()\n                  }}\n                >\n                  Create New Submission\n                </MuiButton>\n              </div>\n            )}\n          </div>\n          <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n            <FilterChips filters={filters} joinLabel=\"and\" />\n            <DataGridRecordCount total={boxes.length} visible={rows.length} descriptor=\"box\" isLoading={isLoading} />\n          </div>\n          <div css={{ flex: 1 }}>\n            <DataGrid<BoxRow> rows={rows} columnDefs={privilegedColumnDefs} frameworkComponents={renderers} />\n          </div>\n        </div>\n      </>\n    )\n  },\n  Fallback\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport MuiButton from '@mui/material/Button'\n// import log from 'loglevel'\n\nimport { DataGrid, renderers, DataGridRecordCount } from '../DataGrid'\nimport { Box } from '../../types'\nimport { customerColumnDefs } from './columnDefs'\nimport { useNavigate } from '../AppRouter'\nimport { BOX_STATE_ID } from '../../data/selectors'\nimport { downloadCustomerBoxReport } from '../../lib/reports/downloadCustomerBoxReport'\nimport { useNotifications } from '../AppNotifications'\nimport { useApi } from '../../data/api'\n\nexport interface CustomerBoxesListingProps {\n  boxes: Box[]\n}\n\nexport interface BoxRow extends Box {\n  forms: {\n    label: string\n    onClick: () => void\n  }\n  reports: {\n    label: string\n    onClick: () => void\n    disabled: boolean\n  }\n}\n\nexport const CustomerBoxesListing = ({ boxes }: CustomerBoxesListingProps): JSX.Element => {\n  const api = useApi()\n  const notifications = useNotifications()\n  const navigate = useNavigate()\n\n  // STATE AND REFS\n\n  const rows = useMemo<BoxRow[]>(() => {\n    return boxes.map((box) => {\n      const canDownloadCustomerReport = box.boxStateId === BOX_STATE_ID.complete\n\n      const handleDownloadCustomerReport = async () => {\n        try {\n          const cancelNotification1 = notifications.info('Still creating report...', 2500)\n          const cancelNotification2 = notifications.info('Still creating report...', 30000)\n          await downloadCustomerBoxReport({ boxId: box.id, api, filename: `NAMC_report_${box.id}.xlsx` })\n          cancelNotification1()\n          cancelNotification2()\n        } catch (err) {\n          notifications.error(`Failed to create report: ${err}`)\n        }\n      }\n\n      return {\n        ...box,\n        forms: {\n          label: box.submissionCount ? 'Chain of Custody' : '',\n          onClick: () => {\n            navigate.chainOfCustodyForm({ boxId: box.id })\n          },\n        },\n        reports: {\n          label: canDownloadCustomerReport ? 'Download NAMC Report' : 'In Progress',\n          onClick: handleDownloadCustomerReport,\n          disabled: !canDownloadCustomerReport,\n        },\n      }\n    })\n  }, [boxes])\n\n  // RENDER\n\n  return (\n    <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n      <div css={{ minHeight: '2em', gap: '0.5em', display: 'flex' }}>\n        <MuiButton\n          variant=\"outlined\"\n          onClick={() => {\n            navigate.boxSubmission()\n          }}\n        >\n          Create New Submission\n        </MuiButton>\n        <DataGridRecordCount\n          total={boxes.length}\n          visible={rows.length}\n          descriptor=\"submission\"\n          css={{ marginLeft: 'auto' }}\n        />\n      </div>\n      <div css={{ flex: 1 }}>\n        <DataGrid<BoxRow> rows={rows} columnDefs={customerColumnDefs} frameworkComponents={renderers} />\n      </div>\n    </div>\n  )\n}\n","import React from 'react'\nimport { useRecoilValue, waitForAny } from 'recoil'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\n\nimport { selectBoxes, selectUserBoxes, selectBoxStates, selectMyUser, selectActiveBoxes } from '../../data/selectors'\nimport { PrivilegedBoxesListing } from './PrivilegedBoxesListing'\nimport { CustomerBoxesListing } from './CustomerBoxesListing'\nimport { Fallback } from './Fallback'\nimport { withSuspense } from '../withSuspense'\n\nconst CustomerConnector = (): JSX.Element => {\n  const boxes = useRecoilValue(selectUserBoxes)\n\n  return <CustomerBoxesListing boxes={boxes} />\n}\n\nconst PrivilegedConnector = (): JSX.Element => {\n  const boxStates = useRecoilValue(selectBoxStates)\n\n  const [activeBoxesLoadable, boxesLoadable] = useRecoilValue(waitForAny([selectActiveBoxes, selectBoxes]))\n\n  const isLoading = boxesLoadable.state !== 'hasValue'\n  const boxes = isLoading ? activeBoxesLoadable.contents : boxesLoadable.contents\n\n  return <PrivilegedBoxesListing boxes={boxes} boxStates={boxStates} isLoading={isLoading} />\n}\n\nexport const BoxesListing = withSuspense((): JSX.Element => {\n  const user = useRecoilValue(selectMyUser)\n\n  if (user.hasPermission(NAMCResource.boxes, GrantAction.readAny)) return <PrivilegedConnector />\n  return <CustomerConnector />\n}, Fallback)\n","import dayjs from 'dayjs'\nimport Excel from 'exceljs'\nimport { uniq } from 'lodash'\n\nimport { downloadWorkbook } from '../excel/downloadWorkbook'\nimport { Box, BoxTaxon } from '../../types'\n\nconst TAXONOMIST_COLUMNS = { header: '', key: '' } // placeholder which is replaced with taxonomist columns\n\nconst columnConfig = [\n  { header: 'Order', key: 'order' },\n  { header: 'Family', key: 'family' },\n  { header: 'Scientific Name', key: 'name' },\n  TAXONOMIST_COLUMNS,\n  { header: 'Total Sample Count', key: 'sampleCount' },\n  { header: 'Total Split Count', key: 'totalCount' },\n]\n\nexport const downloadBoxTaxaReport = async ({\n  box,\n  boxTaxa,\n  filename,\n}: {\n  box: Box\n  boxTaxa: BoxTaxon[]\n  filename: string\n}): Promise<boolean> => {\n  // create workbook, worksheet\n  const wb = new Excel.Workbook()\n  const ws = wb.addWorksheet('Box Taxonomy Report')\n\n  // add top rows data\n  ws.getRow(1).values = [`Taxonomic list and sample counts for ${box.sampleCount} samples, Box ID ${box.id}.`]\n  ws.getRow(2).values = [`List generated on ${dayjs().format('MMMM D, YYYY')}.`]\n  ws.getRow(3).values = [`Customer: ${box.customerName}.`]\n  const tableHeaderRowNumber = 4\n\n  // get taxonomist names/columns, build updated column config\n  const taxonomistNames = boxTaxa.reduce<string[]>((acc, record) => {\n    return uniq([...acc, ...Object.keys(record.taxonomistCounts)])\n  }, [])\n  const updatedColumnConfig = [...columnConfig] // careful not to mutate the original!\n  updatedColumnConfig.splice(\n    columnConfig.findIndex((col) => col === TAXONOMIST_COLUMNS),\n    1,\n    ...taxonomistNames.map((name) => ({ header: name, key: name }))\n  )\n\n  if (boxTaxa.length === 0) {\n    ws.getRow(tableHeaderRowNumber + 1).values = ['No taxonomy found for box.']\n  } else {\n    // create row data arrays (as addTable requires), including spread taxonomist names\n    const rows = boxTaxa\n      .map((record) => ({ ...record, ...record.taxonomistCounts }))\n      .map((record) => {\n        const fields: (string | number)[] = []\n        updatedColumnConfig.forEach(({ key }) => {\n          fields.push(record[key])\n        })\n        return fields\n      })\n\n    // add data table\n    ws.addTable({\n      name: 'BoxTaxonomy',\n      ref: `A${tableHeaderRowNumber}`,\n      headerRow: true,\n      style: {\n        theme: 'TableStyleLight1',\n        showRowStripes: true,\n      },\n      columns: updatedColumnConfig.map(({ header }) => ({ name: header, filterButton: true })),\n      rows,\n    })\n\n    // autofit columns\n    ws.columns.forEach((column) => {\n      const columnValues = column.values\n      if (!columnValues) return\n      const lengths = columnValues.slice(tableHeaderRowNumber).map((value) => (value || '').toString().length)\n      const maxLength = Math.max(...lengths.filter((v) => typeof v === 'number'))\n      column.width = maxLength + 2 // add some padding for filter button\n    })\n\n    // freeze rows\n    ws.views = [{ state: 'frozen', xSplit: undefined, ySplit: tableHeaderRowNumber, activeCell: 'A1' }]\n  }\n\n  // download file\n  downloadWorkbook(wb, filename)\n\n  return true\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { TaxonomySelectField, TaxonomySelectFieldProps } from '../TaxonomyField'\n\nexport const BoxTaxonomySelectField = ({\n  skeleton,\n  ...props\n}: TaxonomySelectFieldProps & { skeleton?: boolean }): JSX.Element => {\n  if (skeleton) return <MuiSkeleton variant=\"rectangular\" height={40} />\n  return <TaxonomySelectField {...props} />\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useState } from 'react'\nimport { atom, useRecoilState, useRecoilValueLoadable } from 'recoil'\nimport MuiButton from '@mui/material/Button'\n\nimport { useApi } from '../../data/api'\nimport { selectTaxa, useInvalidate, BOX_STATE_ID } from '../../data/selectors'\nimport { BoxTaxon, Box, Taxon } from '../../types'\nimport { Title } from '../Title'\nimport { reconcileBoxTaxonomy } from '../../data/calls'\nimport { useNotifications } from '../AppNotifications'\nimport { DataGrid, DataGridRecordCount } from '../DataGrid'\nimport { makeBoxTaxonomyColumnDefs } from './columnDefs'\nimport { AccordionPanel } from '../AccordionPanel'\nimport { downloadBoxTaxaReport } from '../../lib/reports/downloadBoxTaxaReport'\nimport { uniq } from 'lodash'\nimport { BoxTaxonomySelectField } from './BoxTaxonomySelectField'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\n\nexport interface BoxTaxonomyProps {\n  box: Box\n  boxTaxa: BoxTaxon[]\n}\n\nconst isExpandedState = atom<boolean>({\n  key: 'BoxTaxonomy/isExpandedState',\n  default: false,\n})\n\nexport const BoxTaxonomy = ({ box, boxTaxa }: BoxTaxonomyProps): JSX.Element => {\n  const api = useApi()\n  const invalidate = useInvalidate()\n  const notifications = useNotifications()\n\n  const taxaLoadable = useRecoilValueLoadable(selectTaxa)\n\n  const [fromTaxonomyId, setFromTaxonomyId] = useState<number | null>(null)\n  const [toTaxonomyId, setToTaxonomyId] = useState<number | null>(null)\n  const [isWorking, setIsWorking] = useState(false)\n  const [isConfirmOpen, setIsConfirmOpen] = useState(false)\n  const [taxa, setTaxa] = useState<Taxon[]>([])\n  const hasTaxa = taxa.length > 0\n\n  useEffect(() => {\n    taxaLoadable.toPromise().then(setTaxa)\n  }, [])\n\n  const [isPanelExpanded, setIsPanelExpanded] = useRecoilState(isExpandedState)\n\n  const isSameIdError = !!fromTaxonomyId && !!toTaxonomyId && fromTaxonomyId === toTaxonomyId\n\n  const boxTaxonIds = boxTaxa.map(({ id }) => id)\n  const addedTaxonOptions = taxa\n    .filter((taxon) => boxTaxonIds.includes(taxon.id))\n    .map((taxon) => ({ ...taxon, status: 'in' as const }))\n  const availableTaxonOptions = taxa\n    .filter((taxon) => !boxTaxonIds.includes(taxon.id))\n    .map((taxon) => ({ ...taxon, status: 'notIn' as const }))\n\n  const fromBoxTaxon = boxTaxa.find(({ id }) => id === fromTaxonomyId)\n  const toTaxon = taxa.find(({ id }) => id === toTaxonomyId)\n  const toBoxTaxon = boxTaxa.find(({ id }) => id === toTaxonomyId)\n\n  const handleReconcile = async () => {\n    if (!fromTaxonomyId || !toTaxonomyId) throw new Error('Missing taxonomid IDs')\n    setIsWorking(true)\n    try {\n      await reconcileBoxTaxonomy(api, invalidate)({ boxId: box.id, fromTaxonomyId, toTaxonomyId })\n      setFromTaxonomyId(null)\n      setToTaxonomyId(null)\n      setIsWorking(false)\n    } catch (err) {\n      notifications.error(`Failed to reconcile taxonomy: ${err}`)\n    }\n  }\n\n  const taxonomistNames = boxTaxa.reduce<string[]>((acc, record) => {\n    return uniq([...acc, ...Object.keys(record.taxonomistCounts)])\n  }, [])\n  const rows = boxTaxa\n  const columnDefs = makeBoxTaxonomyColumnDefs(taxonomistNames)\n\n  const canReconcileTaxa = box.boxStateId === BOX_STATE_ID.active\n\n  return (\n    <>\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ margin: '16px', display: 'flex', alignItems: 'center' }}>\n          <Title>\n            Box {box.id} Taxonomy{' '}\n            <Title.Subtitle>\n              ({box.boxState}, {box.sampleCount} samples)\n            </Title.Subtitle>\n          </Title>\n          <div css={{ marginLeft: 'auto' }}>\n            <MuiButton\n              variant=\"outlined\"\n              onClick={async () => {\n                try {\n                  const cancelNotification = notifications.info('Still creating report...', 1000)\n                  await downloadBoxTaxaReport({\n                    box,\n                    boxTaxa,\n                    filename: `Box Taxonomy Report for Box ID ${box.id}`,\n                  })\n                  cancelNotification()\n                } catch (err) {\n                  notifications.error(`Failed to create box taxonomy report: ${err}`)\n                }\n              }}\n            >\n              Download Report\n            </MuiButton>\n          </div>\n        </div>\n        <AccordionPanel value={isPanelExpanded} onChange={setIsPanelExpanded} summary={<span>Reconcile Taxa</span>}>\n          {canReconcileTaxa ? (\n            <div\n              css={{\n                display: 'grid',\n                gap: '1em',\n                paddingTop: '1em',\n                gridTemplateColumns: '1fr 1fr',\n                gridTemplateAreas: `\n            \"fromId      toId\"\n            \"fromMessage toMessage\"\n            \".           button\"\n            `,\n              }}\n            >\n              <div css={{ gridArea: 'fromId' }}>\n                <BoxTaxonomySelectField\n                  label=\"Reconcile From\"\n                  options={addedTaxonOptions}\n                  value={fromTaxonomyId}\n                  onChange={setFromTaxonomyId}\n                  disabled={isWorking}\n                  skeleton={!hasTaxa}\n                />\n              </div>\n              <div css={{ gridArea: 'fromMessage' }}>\n                {fromBoxTaxon ? (\n                  <span>\n                    Box currently contains {fromBoxTaxon.totalCount} <em>{fromBoxTaxon.name}</em> records in{' '}\n                    {fromBoxTaxon.sampleCount} samples.\n                  </span>\n                ) : (\n                  <span>\n                    <em>select a taxon</em>\n                  </span>\n                )}\n              </div>\n              <div css={{ gridArea: 'toId' }}>\n                <BoxTaxonomySelectField\n                  label=\"Reconcile To\"\n                  options={[...addedTaxonOptions, ...availableTaxonOptions]}\n                  value={toTaxonomyId}\n                  onChange={setToTaxonomyId}\n                  disabled={isWorking}\n                  skeleton={!hasTaxa}\n                />\n              </div>\n              <div css={{ gridArea: 'toMessage' }}>\n                {(() => {\n                  if (isSameIdError) return <span css={{ color: 'red' }}>Cannot reconcile to the same taxon.</span>\n                  if (toBoxTaxon)\n                    return (\n                      <span>\n                        Box currently contains {toBoxTaxon.totalCount} <em>{toBoxTaxon.name}</em> records in{' '}\n                        {toBoxTaxon.sampleCount} samples.\n                      </span>\n                    )\n                  if (toTaxon)\n                    return (\n                      <span>\n                        Box does not yet contain any <em>{toTaxon?.name}</em> records.\n                      </span>\n                    )\n                  return (\n                    <span>\n                      <em>select a taxon</em>\n                    </span>\n                  )\n                })()}\n              </div>\n              <div css={{ gridArea: 'button', display: 'flex', justifyContent: 'end' }}>\n                <MuiButton\n                  variant=\"contained\"\n                  disabled={!fromTaxonomyId || !toTaxonomyId || isSameIdError || isWorking}\n                  onClick={() => {\n                    setIsConfirmOpen(true)\n                  }}\n                >\n                  Reconcile Taxa\n                </MuiButton>\n              </div>\n            </div>\n          ) : (\n            <div>Box must be active to perform taxa reconciliation.</div>\n          )}\n        </AccordionPanel>\n        <div css={{ minHeight: '1rem', display: 'flex' }}>\n          <DataGridRecordCount\n            css={{ marginLeft: 'auto' }}\n            total={rows.length}\n            visible={rows.length}\n            descriptor=\"taxa\"\n          />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<BoxTaxon> columnDefs={columnDefs} rows={rows} />\n        </div>\n      </div>\n      <ConfirmationDialog\n        isOpen={isConfirmOpen}\n        title=\"Confirm Taxa Reconciliation\"\n        onClose={() => setIsConfirmOpen(false)}\n        onConfirm={handleReconcile}\n        confirmLabel=\"Reconcile\"\n      >\n        Are you sure you want to reconcile the selected taxa? Records will be irreversibly changed.\n      </ConfirmationDialog>\n    </>\n  )\n}\n","// const columnConfig = [\n//   { header: 'Order', key: 'order' },\n//   { header: 'Family', key: 'family' },\n//   { header: 'Scientific Name', key: 'scientificName' },\n//   TAXONOMIST_COLUMNS,\n//   { header: 'Total Sample Count', key: 'sampleCount' },\n//   { header: 'Total Split Count', key: 'totalCount' },\n// ]\n\nimport { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const makeBoxTaxonomyColumnDefs = (taxonomistNames: string[]): ColDef[] => [\n  columnDef.textColumn({\n    field: 'order',\n    minWidth: 160,\n    flex: 1,\n  }),\n  columnDef.textColumn({\n    field: 'family',\n    minWidth: 160,\n    flex: 1,\n  }),\n  columnDef.textColumn({\n    headerName: 'Scientific Name',\n    field: 'name',\n    minWidth: 160,\n    flex: 1,\n  }),\n  ...taxonomistNames.map((name) =>\n    columnDef.numberColumn({\n      headerName: name,\n      field: `taxonomistCounts.${name}`,\n      minWidth: 160,\n      flex: 1,\n    })\n  ),\n  columnDef.numberColumn({\n    headerName: 'Total Sample Count',\n    field: 'sampleCount',\n    minWidth: 160,\n  }),\n  columnDef.numberColumn({\n    headerName: 'Total Split Count',\n    field: 'totalCount',\n    minWidth: 160,\n  }),\n]\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectBoxById, selectBoxTaxaByBoxId } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { BoxTaxonomy as Component } from './BoxTaxonomy'\nimport { Fallback } from './Fallback'\n\nexport interface BoxTaxonomyProps {\n  boxId: string | number\n}\n\nexport const BoxTaxonomy = withSuspense(({ boxId }: BoxTaxonomyProps): JSX.Element => {\n  const box = useRecoilValue(selectBoxById(Number(boxId)))\n  const boxTaxa = useRecoilValue(selectBoxTaxaByBoxId(Number(boxId)))\n\n  if (!box) return <h2>Box {boxId} not found.</h2>\n\n  return <Component box={box} boxTaxa={boxTaxa} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","import dayjs from 'dayjs'\nimport utc from 'dayjs/plugin/utc'\n\nimport { ListName } from '../schema/templateSchema'\nimport { CellProcessor } from '../types'\nimport { KnownError } from './excel'\n\ndayjs.extend(utc)\n\nexport const isRequired: CellProcessor = (cell) => {\n  if (cell.value === undefined || cell.value === null) throw new KnownError({ message: 'Cell is required' })\n}\n\nexport const isNumber: CellProcessor = (cell) => {\n  if (!cell.value) return\n  if (typeof cell.value !== 'number') throw new KnownError({ message: 'Cell must be a number' })\n}\n\nexport const isWholeNumber: CellProcessor = (cell, config) => {\n  if (!cell.value) return\n  isNumber(cell, config)\n  if (cell.value !== Math.trunc(Number(cell.value))) throw new KnownError({ message: 'Cell must be a whole number' })\n}\n\nexport const isNumberBetween =\n  (min: number, max: number): CellProcessor =>\n  (cell, config) => {\n    if (!cell.value) return\n    isNumber(cell, config)\n    if (cell.value < min || cell.value > max)\n      throw new KnownError({ message: `Cell must be a number between ${min} and ${max}` })\n  }\n\nexport const isPositiveNumber: CellProcessor = (cell, config) => {\n  if (!cell.value) return\n  isNumber(cell, config)\n  if (cell.value <= 0) throw new KnownError({ message: `Cell must be a number greater than 0` })\n}\n\nexport const isPercent: CellProcessor = (cell, config) => {\n  if (!cell.value) return\n  isNumber(cell, config)\n  if (cell.value < 0 || cell.value > 1) throw new KnownError({ message: `Cell must be a percentage` })\n}\n\nexport const isInList =\n  (listName: ListName): CellProcessor =>\n  (cell, config) => {\n    if (!cell.value) return\n    if (!config?.lists[listName]) throw new Error(`Missing lookup list \"${listName}\"`)\n    const list = config.lists[listName]\n    if (!list.values.map((v) => v.toLowerCase()).includes(String(cell.value).toLowerCase()))\n      throw new KnownError({ message: `Cell must be a valid ${list.descriptor}` })\n  }\n\nexport const isAcceptableDate: CellProcessor = (cell) => {\n  const MIN_DATE = '2000-01-01'\n  if (!cell.value) return\n  if (!(cell.value instanceof Date)) throw new KnownError({ message: 'Cell must be a date' })\n  if (dayjs(cell.value).isBefore(MIN_DATE)) throw new KnownError({ message: `Cell must be a date after ${MIN_DATE}` })\n}\n\nexport const toShortDateString: CellProcessor = (cell) => {\n  if (!cell.value) return\n  if (!(cell.value instanceof Date)) throw new KnownError({ message: 'Cell must be a date' })\n  cell.value = dayjs.utc(cell.value).format('YYYY-MM-DD')\n}\n\nexport const toString: CellProcessor = (cell) => {\n  cell.value = cell.value && String(cell.value)\n}\n\nexport const divideBy100: CellProcessor = (cell, config) => {\n  if (!cell.value) return\n  isNumber(cell, config)\n  if (typeof cell.value !== 'number') return\n  cell.value = cell.value / 100\n}\n\nexport const isReadable: CellProcessor = (cell) => {\n  if (\n    !(\n      typeof cell.value === 'string' ||\n      typeof cell.value === 'number' ||\n      typeof cell.value === 'boolean' ||\n      typeof cell.value === 'undefined' ||\n      cell.value instanceof Date ||\n      cell.value === null\n    )\n  )\n    throw new KnownError({ message: 'Cell must be a simple value (e.g. no formulas)' })\n}\n\nexport const trimIfString: CellProcessor = (cell) => {\n  if (typeof cell.value !== 'string') return\n  cell.value = cell.value.trim() || null // also force trimmed-to-empty string to become null\n}\n","import { SampleProcessor } from '../types'\nimport { fetchUsStateAtCoordinates } from '../../../data/calls'\n\nexport const setLiteralValue = (value: string | number | boolean): SampleProcessor => {\n  const processor: SampleProcessor = async ({ sample, fieldName }) => {\n    if (typeof fieldName !== 'string') return\n    sample[fieldName] = value\n  }\n  processor.isSamplePostProcessor = true as const\n  return processor\n}\n\nexport const split = (separator: string, fieldName1: string, fieldName2: string): SampleProcessor => {\n  const processor: SampleProcessor = async ({ sample, fieldName }) => {\n    if (typeof fieldName !== 'string') return\n    const fieldValue = sample[fieldName]\n    if (typeof fieldValue !== 'string') return\n\n    const [part1, part2] = fieldValue.split(separator)\n    sample[fieldName1] = part1.trim()\n    sample[fieldName2] = (part2 ?? '').trim()\n\n    delete sample[fieldName]\n  }\n  processor.isSamplePostProcessor = true as const\n  return processor\n}\n\nexport const isRequiredIf = (callback: (sample) => boolean): SampleProcessor => {\n  const processor: SampleProcessor = async ({ sample, fieldName, rowNumber, columnNumber, problems }) => {\n    const value = sample[fieldName]\n    if (callback(sample) && (value === undefined || value === null))\n      problems.push({ type: 'row', rowNumber, columnNumber, message: 'Cell is required' })\n  }\n  processor.isSamplePostProcessor = true as const\n  return processor\n}\n\nexport const isAcceptableLatitudeAndLongitude: SampleProcessor = async ({ sample, config, rowNumber, problems }) => {\n  const { latitude, longitude } = sample\n  const { api } = config\n  if (typeof latitude === 'number' && typeof longitude === 'number') {\n    const usState = await fetchUsStateAtCoordinates(api)({ latitude, longitude }) // TODO: may want API-level caching here?\n    if (!usState) {\n      problems.push({ type: 'row', rowNumber, message: 'Latitude/Longitude is outside of accepted area.' })\n    }\n  }\n}\nisAcceptableLatitudeAndLongitude.isSamplePostProcessor = true as const\n\nexport const setRowNumber: SampleProcessor = async ({ sample, fieldName, rowNumber }) => {\n  if (typeof fieldName !== 'string') return\n  sample[fieldName] = rowNumber\n}\nsetRowNumber.isSamplePostProcessor = true as const\n\nexport const setSampleNumber: SampleProcessor = async ({ sample, fieldName, sampleNumber }) => {\n  if (typeof fieldName !== 'string') return\n  sample[fieldName] = sampleNumber\n}\nsetSampleNumber.isSamplePostProcessor = true as const\n\nexport const setTemplateVersion: SampleProcessor = async ({ sample, fieldName, templateVersion }) => {\n  if (typeof fieldName !== 'string') return\n  sample[fieldName] = templateVersion\n}\nsetTemplateVersion.isSamplePostProcessor = true as const\n","import { selector } from 'recoil'\n\nimport {\n  lookupListToNames,\n  selectDesignTypes,\n  selectEcosystems,\n  selectEffortTypes,\n  selectFishDietSpecies,\n  selectHabitats,\n  selectSampleMethods,\n  selectTowTypeNames,\n  selectWaterbodyTypes,\n} from '../../../data/selectors'\nimport { CellProcessor, SampleProcessor, StringValueList } from '../types'\nimport {\n  divideBy100, // divides number by 100 (for converting whole number percentage to fractional percentage)\n  isAcceptableDate, // ensures Excel date value on/after 2000-01-01\n  isInList, // ensures string value is in list values\n  isNumber, // ensures Excel numeric value\n  isNumberBetween, // ensures Excel numeric value between min and max params\n  // isPercent, // ensures Excel numeric value between 0 and 1\n  isPositiveNumber, // ensures Excel numeric value greater than 0\n  isReadable, // ensures readable value (e.g. not link, forumla, etc.)\n  isRequired, // ensures cell has a value (other \"is\" validators ignore no value!)\n  isWholeNumber, // ensures Excel numeric value integer\n  toShortDateString, // ensures Excel date, then converts to string in 'YYYY-MM-DD' format\n  toString, // converts any cell value to string\n  trimIfString, // trims any string\n} from '../processing/cellProcessors'\n\nimport {\n  // isAcceptableLatitudeAndLongitude, // ensures latitude and longitude are in a US state (via API)\n  isRequiredIf, // ensures value is present if callback condition is met (callback is passed the sample data object)\n  setLiteralValue, // directly sets field value to string, number, or boolean parameter\n  setRowNumber, // directly sets field value to worksheet row number\n  setSampleNumber, // directly sets field value to 1-based incrementing sample number\n  // setTemplateVersion, // directly sets field value to detected Excel template version\n  split, // replaces a field value with two new fields based on a separator\n} from '../processing/sampleProcessors'\n\nexport type SheetSchema = Record<string, (CellProcessor | SampleProcessor)[]>\n\n/* \n  acceptedTemplateVersions\n  - currently-accepted template versions\n  - files uploaded with a version not in array will throw an error\n*/\nexport const acceptedTemplateVersions = [5]\n\n/* \n  lookupsWsName\n  - name of the control worksheet which must contain named ranges \"FirstDataRow\" and \"TemplateVersion\"\n*/\nexport const lookupsWsName = 'Lookups'\n\n/* \n  everyCellProcessors\n  - validations/transforms applied to every cell before those in schemasByWsName\n*/\nexport const everyCellProcessors = [isReadable, trimIfString]\n\n/*\n  schemasByWsName\n  - must contain keys matching names of every worksheet; any other worksheets found (besides Lookups) will throw as unrecognized\n  - any columns found that are not in worksheet schema will throw as unrecognized\n  - processors from cellProcessors.ts are applied left-to-right; empty array simply recognizes/allows field without any processing\n  - processors from sampleProcessors.ts are applied AFTER any from cellProcessors.ts\n  - processParsedSample is performed on sample after this schema applied, and may further validate/transform sample\n  - the \"ALL\" schema is applied to every worksheet, but will be overridden if a same-named column is in the specific worksheet schema\n*/\nexport const schemasByWsName: Record<string, SheetSchema> = {\n  ALL: {\n    sampleIndex: [setSampleNumber],\n    rowNumber: [setRowNumber],\n  },\n  Benthic: {\n    sampleType: [setLiteralValue('benthic')],\n    siteId: [isRequired, toString],\n    visitId: [toString],\n    sampleDate: [isRequired, isAcceptableDate, toShortDateString],\n    jarCount: [isRequired, isWholeNumber, isNumberBetween(1, 100)],\n    fieldSplit: [isRequired, isNumberBetween(0, 100), divideBy100],\n    latitude: [isRequired, isNumber],\n    longitude: [isRequired, isNumber],\n    waterbodyName: [isRequired],\n    ecosystemHabitat: [isRequired, isInList('ecosystemHabitats'), split(':', 'ecosystem', 'habitat')],\n    sampleDesign: [isRequired, isInList('designTypes')],\n    sampleEffortStandardization: [isRequired, isInList('effortTypes')],\n    areaTime: [\n      isPositiveNumber,\n      isRequiredIf(({ sampleEffortStandardization }) => sampleEffortStandardization === 'Not Standardized'),\n    ],\n    samplerType: [isRequired, isInList('samplerTypes')],\n    meshSize: [isPositiveNumber, isWholeNumber],\n    nhdType: [isInList('nhdTypes')],\n    nhdId: [],\n    notes: [toString],\n  },\n  'Fish Diet': {\n    sampleType: [setLiteralValue('fishDiet')],\n    siteId: [isRequired, toString],\n    visitId: [toString],\n    sampleDate: [isRequired, isAcceptableDate, toShortDateString],\n    jarCount: [isRequired, isWholeNumber, isNumberBetween(1, 100)],\n    fieldSplit: [isRequired, isNumberBetween(0, 100), divideBy100],\n    latitude: [isRequired, isNumber],\n    longitude: [isRequired, isNumber],\n    waterbodyName: [isRequired],\n    ecosystem: [isRequired, isInList('ecosystems')],\n    samplerType: [isRequired, isInList('samplerTypes')],\n    fishSpecies: [isRequired, isInList('fishDietSpecies')],\n    fishLength: [isRequired, isPositiveNumber],\n    fishMass: [isRequired, isPositiveNumber],\n    nhdType: [isInList('nhdTypes')],\n    nhdId: [],\n    notes: [toString],\n  },\n  Zooplankton: {\n    sampleType: [setLiteralValue('zooplankton')],\n    siteId: [isRequired, toString],\n    visitId: [toString],\n    sampleDate: [isRequired, isAcceptableDate, toShortDateString],\n    jarCount: [isRequired, isWholeNumber, isNumberBetween(1, 100)],\n    fieldSplit: [isRequired, isNumberBetween(0, 100), divideBy100],\n    latitude: [isRequired, isNumber],\n    longitude: [isRequired, isNumber],\n    waterbodyName: [isRequired],\n    ecosystemHabitat: [isRequired, isInList('ecosystemHabitats'), split(':', 'ecosystem', 'habitat')],\n    sampleDesign: [isRequired, isInList('designTypes')],\n    samplerType: [isRequired, isInList('samplerTypes')],\n    meshSize: [isPositiveNumber, isWholeNumber],\n    netArea: [isPositiveNumber],\n    towLength: [isPositiveNumber],\n    towType: [isInList('towTypes')],\n    nhdType: [isInList('nhdTypes')],\n    nhdId: [],\n    notes: [toString],\n  },\n  Drift: {\n    sampleType: [setLiteralValue('drift')],\n    siteId: [isRequired, toString],\n    visitId: [toString],\n    sampleDate: [isRequired, isAcceptableDate, toShortDateString],\n    jarCount: [isRequired, isWholeNumber, isNumberBetween(1, 100)],\n    fieldSplit: [isRequired, isNumberBetween(0, 100), divideBy100],\n    latitude: [isRequired, isNumber],\n    longitude: [isRequired, isNumber],\n    waterbodyName: [isRequired],\n    ecosystemHabitat: [isRequired, isInList('ecosystemHabitats'), split(':', 'ecosystem', 'habitat')],\n    samplerType: [isRequired, isInList('samplerTypes')],\n    meshSize: [isPositiveNumber, isWholeNumber],\n    netArea: [isPositiveNumber],\n    duration: [isPositiveNumber],\n    velocity: [isPositiveNumber],\n    nhdType: [isInList('nhdTypes')],\n    nhdId: [],\n    notes: [toString],\n  },\n  'Water Quality': {\n    sampleType: [setLiteralValue('waterQuality')],\n    siteId: [isRequired, toString],\n    visitId: [toString],\n    sampleDate: [isRequired, isAcceptableDate, toShortDateString],\n    jarCount: [isRequired, isWholeNumber, isNumberBetween(1, 100)],\n    samplerType: [isRequired, isInList('samplerTypes')],\n    waterbodyName: [isRequired],\n    ecosystem: [isRequired, isInList('ecosystems')],\n    latitude: [isRequired, isNumber],\n    longitude: [isRequired, isNumber],\n    nhdType: [isInList('nhdTypes')],\n    nhdId: [],\n    notes: [toString],\n  },\n}\n\n/*\n  ListName and selectLists\n  - ListName defines all available list names for isInList\n  - selectLists is a Recoil selector which produces descriptor (used in problem message) and allowed values for each list\n  - TypeScript will catch omissions, however the completeness of the value lists is the responsibility of database and below selector code\n */\nexport type ListName =\n  | 'sampleMethods'\n  | 'towTypes'\n  | 'fishDietSpecies'\n  | 'designTypes'\n  | 'effortTypes'\n  | 'samplerTypes'\n  | 'ecosystems'\n  | 'habitats'\n  | 'ecosystemHabitats'\n  | 'nhdTypes'\n\nexport const selectLists = selector<Record<ListName, StringValueList>>({\n  key: 'submissions/selectLists',\n  get: async ({ get }) => {\n    const ecosystemNames = lookupListToNames(get(selectEcosystems))\n    const habitatNames = lookupListToNames(get(selectHabitats))\n\n    return {\n      sampleMethods: {\n        descriptor: 'sample method',\n        values: lookupListToNames(get(selectSampleMethods)),\n      },\n      towTypes: {\n        descriptor: 'tow type',\n        values: get(selectTowTypeNames),\n      },\n      fishDietSpecies: {\n        descriptor: 'fish diet species',\n        values: lookupListToNames(get(selectFishDietSpecies)),\n      },\n      designTypes: {\n        descriptor: 'sample design type',\n        values: lookupListToNames(get(selectDesignTypes)),\n      },\n      effortTypes: {\n        descriptor: 'sample effort type',\n        values: lookupListToNames(get(selectEffortTypes)),\n      },\n      samplerTypes: {\n        descriptor: 'sampler type',\n        values: lookupListToNames(get(selectSampleMethods)),\n      },\n      ecosystems: {\n        descriptor: 'ecosystem',\n        values: ecosystemNames,\n      },\n      habitats: {\n        descriptor: 'habitat',\n        values: habitatNames,\n      },\n      ecosystemHabitats: {\n        descriptor: 'ecosystem/habitat',\n        values: ecosystemNames.reduce<string[]>(\n          (acc, ecosystemName) => [...acc, ...habitatNames.map((habitatName) => `${ecosystemName}: ${habitatName}`)],\n          []\n        ),\n      },\n      nhdTypes: {\n        descriptor: 'NHD type',\n        values: lookupListToNames(get(selectWaterbodyTypes)),\n      },\n    }\n  },\n})\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo, useRef } from 'react'\nimport { atom, useRecoilState, useRecoilValue, selector } from 'recoil'\nimport MuiStepper from '@mui/material/Stepper'\nimport MuiStep from '@mui/material/Step'\nimport MuiStepLabel from '@mui/material/StepLabel'\nimport MuiButton from '@mui/material/Button'\nimport MuiRadio from '@mui/material/Radio'\nimport MuiRadioGroup from '@mui/material/RadioGroup'\nimport MuiFormControlLabel from '@mui/material/FormControlLabel'\nimport MuiFormControl from '@mui/material/FormControl'\nimport MuiFormLabel from '@mui/material/FormLabel'\nimport MuiLinearProgress from '@mui/material/LinearProgress'\nimport KeyboardArrowLeftIcon from '@mui/icons-material/KeyboardArrowLeft'\nimport KeyboardArrowRightIcon from '@mui/icons-material/KeyboardArrowRight'\nimport SendIcon from '@mui/icons-material/Send'\nimport ErrorOutlineIcon from '@mui/icons-material/ErrorOutline'\nimport CheckCircleOutlineIcon from '@mui/icons-material/CheckCircleOutline'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\n\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { DataGrid } from '../DataGrid'\nimport { FileProblem, ProcessFileResult, PreparationPage, FinishedPage } from '../../lib/submissions'\nimport { problemsColumnDefs } from './columnDefs'\nimport { UploadFileBox } from './UploadFileBox'\nimport { appVersion, isStagingApi } from '../../lib/environment'\nimport { useApi } from '../../data/api'\nimport { useInvalidate } from '../../data/selectors'\nimport { useNotifications } from '../AppNotifications'\nimport { createOrganization, createSampleSubmission } from '../../data/calls'\nimport { withSuspense } from '../withSuspense'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { TextField } from '../TextField'\nimport {\n  selectDefaultOrganizationTypeId,\n  selectMyUser,\n  selectOrganizations,\n  selectUsCountryId,\n  selectUsers,\n  selectUsStates,\n} from '../../data/selectors'\nimport { Fallback } from './Fallback'\nimport { useNavigate } from '../AppRouter'\nimport { MyUser } from '../../types'\nimport { StepPage } from './StepPage'\nimport { ReadOnlyField } from '../ReadOnlyField'\n\nconst TEMPLATE_URL = `${process.env.PUBLIC_URL}/namc_sample_upload_template.xlsx` // this file must be in react/app/public\n\nexport type ProcessingStatus = 'empty' | 'uploading' | 'processing' | 'processed' | 'submitting' | 'submitted'\n\nexport interface ProblemRow extends FileProblem {\n  id: string\n}\n\nenum STEP {\n  prepare = 0,\n  upload = 1,\n  review = 2,\n  finished = 3,\n}\n\nconst stepTitles = ['Download Submission Template', 'Upload Template', 'Review', 'Finished']\n\nconst getProblemRowId = (() => {\n  const idDict = {}\n  let nextId = 1\n  return (problem: FileProblem) => {\n    const key = JSON.stringify(problem)\n    if (!idDict[key]) idDict[key] = nextId++\n    return idDict[key]\n  }\n})()\n\nconst selectOrganizationOptions = selector({\n  key: 'CustomerSubmission/selectOrganizationOptions',\n  get: async ({ get }) => {\n    const organizations = get(selectOrganizations)\n    return organizations.map(({ id: value, name: label }) => ({ value, label }))\n  },\n})\n\nconst selectUserOptions = selector({\n  key: 'CustomerSubmission/selectUserOptions',\n  get: async ({ get }) => {\n    const users = get(selectUsers)\n    return users.map(({ id: value, fullName, organizationName }) => ({\n      value,\n      label: `${fullName} (${organizationName})`,\n    }))\n  },\n})\n\nconst selectUsStateOptions = selector({\n  key: 'CustomerSubmission/selectUsStateOptions',\n  get: async ({ get }) => {\n    const usStates = get(selectUsStates)\n    return usStates.map(({ id: value, abbreviation: label }) => ({ value, label }))\n  },\n})\n\nconst expandJsonState = atom({\n  key: 'CustomerSubmission/expandJsonState',\n  default: false,\n})\n\nexport const emptyProcessResult = { samples: [], info: {}, problems: [], templateVersion: null }\n\ninterface Fields {\n  existingOrganizationId: number | null\n  submitterId: number | null\n  organizationMode: 'existing' | 'new'\n  organizationName: string\n  address1: string\n  address2: string\n  city: string\n  usStateId: number | null\n  zipCode: string\n  phone: string\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\nexport interface State {\n  // current\n  processingStatus: ProcessingStatus\n  processResult: ProcessFileResult\n  filename: string\n  processingToken: number\n  errorMessage: string\n  boxId?: number\n  createdOrganizationId?: number\n\n  // for revert\n  lastProcessingStatus: ProcessingStatus\n  lastFilename: string\n\n  // field values\n  values: Fields\n}\n\nconst getInitialState = ({ user }: { user: MyUser }): State => ({\n  processingStatus: 'empty',\n  processResult: emptyProcessResult,\n  filename: '',\n  processingToken: 0,\n  errorMessage: '',\n  lastProcessingStatus: 'empty',\n  lastFilename: '',\n  values: {\n    existingOrganizationId: user.affiliationId,\n    submitterId: user.id,\n    organizationMode: 'existing',\n    organizationName: '',\n    address1: '',\n    address2: '',\n    city: '',\n    usStateId: null,\n    zipCode: '',\n    phone: '',\n  },\n})\n\nconst MessageBlock = (props) => (\n  <div css={{ margin: '1em 0', fontWeight: 'bold', display: 'flex', alignItems: 'center' }} {...props} />\n)\n\nexport const CustomerSubmission = withSuspense(\n  (): JSX.Element => {\n    const [expandJson, setExpandJson] = useRecoilState(expandJsonState)\n    const user = useRecoilValue(selectMyUser)\n    const countryId = useRecoilValue(selectUsCountryId)\n    const organizationTypeId = useRecoilValue(selectDefaultOrganizationTypeId)\n\n    const navigate = useNavigate()\n    const api = useApi()\n    const invalidate = useInvalidate()\n    const notifications = useNotifications()\n    const downloadTemplateLinkRef = useRef<HTMLAnchorElement | null>(null)\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ user }), [])\n    const [activeStep, setActiveStep] = React.useState<STEP>(STEP.prepare)\n\n    const { processingStatus, processingToken, processResult, errorMessage, filename, boxId, values } = state\n    const errors: FieldErrors = (() => {\n      let errors: FieldErrors = {}\n      switch (values.organizationMode) {\n        case 'existing':\n          errors = {\n            existingOrganizationId: !values.existingOrganizationId,\n          }\n          break\n        case 'new': {\n          errors = {\n            organizationName: values.organizationName.trim().length < 3,\n            address1: !values.address1.trim(),\n            city: !values.city.trim(),\n            zipCode: !values.zipCode.trim().match(/^[\\d-]{5,}$/),\n            usStateId: !values.usStateId,\n            phone: !values.phone,\n          }\n          break\n        }\n        default:\n      }\n      if (!Object.values(errors).some((value) => value)) return undefined\n      return errors\n    })()\n\n    const { samples, info, problems, templateVersion } = processResult\n\n    const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n      updateState((draft) => {\n        Object.assign(draft.values, { [fieldName]: value })\n      })\n    }\n\n    const handleSubmit = async () => {\n      try {\n        updateState((draft) => {\n          draft.processingStatus = 'submitting'\n        })\n        let customerId: number | null\n        switch (values.organizationMode) {\n          case 'new': {\n            // create organization\n            if (typeof values.usStateId !== 'number') throw new Error('missing state')\n            const newOrganizationId = await createOrganization(\n              api,\n              invalidate\n            )({\n              name: values.organizationName.trim(),\n              typeId: organizationTypeId,\n              address1: values.address1.trim(),\n              address2: values.address2.trim(),\n              city: values.city.trim(),\n              phone: values.phone.trim(),\n              usStateId: values.usStateId,\n              countryId,\n              zipCode: values.zipCode.trim(),\n            })\n            updateState((draft) => {\n              draft.createdOrganizationId = newOrganizationId\n            })\n            customerId = newOrganizationId\n            break\n          }\n          case 'existing': {\n            if (!values.existingOrganizationId) throw new Error('missing customer ID')\n            customerId = values.existingOrganizationId\n            break\n          }\n        }\n        const { submitterId } = values\n        if (!submitterId) throw new Error('missing submitter ID')\n        if (!templateVersion) throw new Error('parsing did not return template version')\n        const newBoxId = await createSampleSubmission(\n          api,\n          invalidate\n        )({\n          customerId,\n          submitterId,\n          data: { appVersion: appVersion ?? 'unknown', templateVersion, samples },\n        })\n        updateState((draft) => {\n          draft.processingStatus = 'submitted'\n          draft.boxId = newBoxId\n        })\n        setActiveStep(STEP.finished)\n      } catch (err) {\n        updateState((draft) => {\n          draft.processingStatus = 'processed'\n        })\n        notifications.error(`Failed to create submission: ${err}`)\n        return\n      }\n    }\n\n    const rows = useMemo(() => {\n      return problems.map((problem) => ({ id: getProblemRowId(problem), ...problem }))\n    }, [problems])\n\n    const canSubmit = samples.length > 0 && problems.length === 0 && processingStatus === 'processed' && !errors\n\n    const hasFatalProblem = processResult.problems.some(({ type }) => type === 'fatal')\n    const hasOnlyRowProblems = !hasFatalProblem && processResult.problems.length > 0\n    const hasNoSamples = processingStatus === 'processed' && processResult.samples.length === 0\n\n    const uploadAttentionMessage = (() => {\n      if (errorMessage) return <span>Error reading file. Did you choose the correct file? ({errorMessage})</span>\n      if (hasFatalProblem)\n        return (\n          <span>Error processing file. Did you choose the correct file? ({processResult.problems[0].message})</span>\n        )\n      if (hasOnlyRowProblems)\n        return <span>Correct the following {processResult.problems.length} problems and try uploading again:</span>\n      if (hasNoSamples) return <span>File does not contain any samples.</span>\n      return null\n    })()\n\n    // PERMISSIONS\n\n    const canChangeUser = user.hasPermission(NAMCResource.individuals, GrantAction.readAny)\n    const canChangeOrganization =\n      user.hasPermission(NAMCResource.organizations, GrantAction.readAny) &&\n      user.hasPermission(NAMCResource.organizations, GrantAction.createAny)\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column', maxWidth: '70rem' }}>\n        <MuiStepper activeStep={activeStep}>\n          {stepTitles.map((stepTitle) => (\n            <MuiStep key={stepTitle}>\n              <MuiStepLabel>{stepTitle}</MuiStepLabel>\n            </MuiStep>\n          ))}\n        </MuiStepper>\n        <div css={{ display: 'flex', alignItems: 'center', margin: '2em 0' }}>\n          <div>\n            <MuiButton\n              variant=\"outlined\"\n              onClick={() => setActiveStep((s) => s - 1)}\n              disabled={\n                activeStep === STEP.prepare || activeStep === STEP.finished || processingStatus === 'submitting'\n              }\n            >\n              <KeyboardArrowLeftIcon />\n              Back\n            </MuiButton>\n          </div>\n          <div css={{ flex: 1, textAlign: 'center', fontSize: '125%' }}>\n            Step {activeStep + 1}: {stepTitles[activeStep]}\n          </div>\n          <div>\n            {activeStep < STEP.review && (\n              <MuiButton\n                variant=\"outlined\"\n                onClick={() => setActiveStep((s) => s + 1)}\n                disabled={activeStep === STEP.upload && !canSubmit}\n              >\n                Next\n                <KeyboardArrowRightIcon />\n              </MuiButton>\n            )}\n            {activeStep >= STEP.review && (\n              <MuiButton\n                variant={activeStep === STEP.finished ? 'outlined' : 'contained'}\n                onClick={handleSubmit}\n                disabled={!canSubmit || activeStep === STEP.finished}\n              >\n                Submit&nbsp;\n                <SendIcon />\n              </MuiButton>\n            )}\n          </div>\n        </div>\n        <div css={{ flex: 1, position: 'relative' }}>\n          {/* PREPARE */}\n          <StepPage active={activeStep === STEP.prepare}>\n            <a\n              ref={downloadTemplateLinkRef}\n              href={TEMPLATE_URL}\n              css={{ visibility: 'hidden', position: 'absolute' }}\n              download\n            ></a>\n            <PreparationPage\n              onDownloadTemplate={() => {\n                downloadTemplateLinkRef.current?.click()\n              }}\n            />\n          </StepPage>\n          {/* UPLOAD */}\n          <StepPage\n            active={activeStep === STEP.upload}\n            css={{\n              display: 'flex',\n              flexDirection: 'column',\n            }}\n          >\n            <UploadFileBox\n              updateState={updateState}\n              processingToken={processingToken}\n              processingStatus={processingStatus}\n              filename={filename}\n            />\n            {uploadAttentionMessage && (\n              <MessageBlock>\n                <ErrorOutlineIcon />\n                &nbsp;{uploadAttentionMessage}\n              </MessageBlock>\n            )}\n            {canSubmit && (\n              <MessageBlock>\n                <CheckCircleOutlineIcon />\n                &nbsp;Ready to review. Click Next to continue.\n              </MessageBlock>\n            )}\n            {hasOnlyRowProblems && (\n              <div css={{ flex: 1 }}>\n                <DataGrid<ProblemRow> columnDefs={problemsColumnDefs} rows={rows} />\n              </div>\n            )}\n          </StepPage>\n          {/* REVIEW */}\n          <StepPage active={activeStep === STEP.review && processingStatus !== 'submitting'}>\n            <div css={{ display: 'flex', gap: '1em' }}>\n              <div css={{ minWidth: '20em', flex: 1 }}>\n                <MuiFormControl component=\"fieldset\" css={{ width: '100%' }}>\n                  <MuiFormLabel component=\"legend\">User</MuiFormLabel>\n                  {canChangeUser ? (\n                    <AutocompleteField\n                      optionsSelector={selectUserOptions}\n                      valueLabel={user.fullName}\n                      value={values.submitterId}\n                      onChange={(value) => setFieldValue('submitterId', value)}\n                    />\n                  ) : (\n                    <ReadOnlyField value={user.fullName} />\n                  )}\n                </MuiFormControl>\n                <div css={{ paddingTop: '1em' }}>\n                  <MuiFormControl component=\"fieldset\" css={{ width: '100%' }}>\n                    <MuiFormLabel component=\"legend\">Organization</MuiFormLabel>\n                    {canChangeOrganization && (\n                      <MuiRadioGroup\n                        row\n                        value={values.organizationMode}\n                        onChange={(_, newValue) => setFieldValue('organizationMode', newValue)}\n                      >\n                        <MuiFormControlLabel value=\"existing\" control={<MuiRadio />} label=\"Existing\" />\n                        <MuiFormControlLabel value=\"new\" control={<MuiRadio />} label=\"New\" />\n                      </MuiRadioGroup>\n                    )}\n                  </MuiFormControl>\n                </div>\n                {values.organizationMode === 'existing' &&\n                  (canChangeOrganization ? (\n                    <AutocompleteField\n                      optionsSelector={selectOrganizationOptions}\n                      valueLabel={user.organizationName}\n                      value={values.existingOrganizationId}\n                      onChange={(value) => setFieldValue('existingOrganizationId', value)}\n                      error={errors?.existingOrganizationId}\n                    />\n                  ) : (\n                    <ReadOnlyField value={user.organizationName} />\n                  ))}\n                {values.organizationMode === 'new' && (\n                  <div\n                    css={{\n                      display: 'grid',\n                      gap: '0.75em',\n                      gridTemplateColumns: '1fr 1fr',\n                      gridTemplateAreas: `\n                        \"organizationName organizationName\"\n                        \"address1         address1\"\n                        \"address2         address2\"\n                        \"city             city\"\n                        \"usStateId        zipCode\"\n                        \"phone            .\"\n                      `,\n                    }}\n                  >\n                    <TextField\n                      gridArea=\"organizationName\"\n                      value={values.organizationName}\n                      onChange={(value) => setFieldValue('organizationName', value)}\n                      label=\"Organization Name\"\n                      error={errors?.organizationName}\n                    />\n                    <TextField\n                      gridArea=\"address1\"\n                      value={values.address1}\n                      onChange={(value) => setFieldValue('address1', value)}\n                      label=\"Address 1\"\n                      error={errors?.address1}\n                    />\n                    <TextField\n                      gridArea=\"address2\"\n                      value={values.address2}\n                      onChange={(value) => setFieldValue('address2', value)}\n                      label=\"Address 2\"\n                      error={errors?.address2}\n                    />\n                    <TextField\n                      gridArea=\"city\"\n                      value={values.city}\n                      onChange={(value) => setFieldValue('city', value)}\n                      label=\"City\"\n                      error={errors?.city}\n                    />\n                    <AutocompleteField\n                      gridArea=\"usStateId\"\n                      value={values.usStateId}\n                      valueLabel=\"State\"\n                      onChange={(value) => setFieldValue('usStateId', value)}\n                      optionsSelector={selectUsStateOptions}\n                      label=\"State\"\n                      error={errors?.usStateId}\n                      isClearable\n                    />\n                    <TextField\n                      gridArea=\"zipCode\"\n                      value={values.zipCode}\n                      onChange={(value) => setFieldValue('zipCode', value)}\n                      label=\"Zip\"\n                      error={errors?.zipCode}\n                    />\n                    <TextField\n                      gridArea=\"phone\"\n                      value={values.phone}\n                      onChange={(value) => setFieldValue('phone', value)}\n                      label=\"Phone\"\n                      error={errors?.phone}\n                    />\n                  </div>\n                )}\n              </div>\n              <div css={{ flex: 1 }}>\n                <MuiFormLabel component=\"legend\">Submission Summary</MuiFormLabel>\n                <table\n                  css={{\n                    borderCollapse: 'collapse',\n                    th: { fontWeight: 'normal' },\n                    td: { border: '1px solid grey' },\n                    'th,td': { padding: '0.75em' },\n                  }}\n                >\n                  <thead>\n                    <tr>\n                      <th>Sample Type</th>\n                      <th># Samples</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {Object.entries(info).map(([wsName, sampleCount]) => (\n                      <tr key={wsName}>\n                        <td>{wsName}</td>\n                        <td css={{ textAlign: 'right' }}>{sampleCount}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n            {canSubmit && (\n              <MessageBlock>\n                <CheckCircleOutlineIcon />\n                &nbsp;Ready to submit. Click Submit to finish.\n              </MessageBlock>\n            )}\n            {errors && (\n              <MessageBlock>\n                <ErrorOutlineIcon />\n                &nbsp;Correct the above address issues.\n              </MessageBlock>\n            )}\n            {isStagingApi && (\n              <div>\n                <MuiButton\n                  onClick={() => {\n                    setExpandJson((v) => !v)\n                  }}\n                >\n                  {expandJson ? 'Hide Sample Data' : 'Show Sample Data'}\n                </MuiButton>\n                {expandJson && <pre>{JSON.stringify(samples, null, 2)}</pre>}\n              </div>\n            )}\n          </StepPage>\n          <StepPage active={activeStep === STEP.review && processingStatus === 'submitting'}>\n            <MuiLinearProgress />\n          </StepPage>\n          {/* FINISHED */}\n          <StepPage active={activeStep === STEP.finished}>\n            {boxId && (\n              <FinishedPage\n                boxId={boxId}\n                onGoToBoxes={() => navigate.boxes()}\n                onGoToBoxDetail={() => navigate.boxDetail({ boxId })}\n                onGoToChainOfCustody={() => navigate.chainOfCustodyForm({ boxId })}\n              />\n            )}\n          </StepPage>\n        </div>\n      </div>\n    )\n  },\n  () => <Fallback />\n)\n","import { SubmissionSample, FileProblem, ProcessorsConfig, CellProcessor, SampleProcessor } from '../types'\nimport { SheetSchema } from '../schema/templateSchema'\n\ninterface ProcessParsedSampleParams {\n  sample: SubmissionSample\n  schema: SheetSchema\n  config: ProcessorsConfig\n  rowNumber: number\n  sampleNumber: number\n  templateVersion: number\n  columnKeys: string[]\n}\n\nconst isSamplePostProcessor = (processor: CellProcessor | SampleProcessor): processor is SampleProcessor =>\n  (processor as SampleProcessor).isSamplePostProcessor\n\nexport const processParsedSample = async ({\n  sample: sourceSample,\n  schema,\n  config,\n  rowNumber,\n  sampleNumber,\n  templateVersion,\n  columnKeys,\n}: ProcessParsedSampleParams): Promise<{ sample: SubmissionSample; problems: FileProblem[] }> => {\n  const sample = { ...sourceSample }\n  const problems: FileProblem[] = []\n\n  const allPromises: Promise<void>[] = []\n\n  // perform sample processors\n  Object.entries(schema).forEach(([fieldName, processors]) => {\n    processors.filter(isSamplePostProcessor).forEach((processor) => {\n      allPromises.push(\n        processor({\n          sample,\n          config,\n          rowNumber,\n          columnNumber: columnKeys.findIndex((columnKey) => columnKey === fieldName), // note that columnKeys are already [1] = column A\n          sampleNumber,\n          templateVersion,\n          fieldName,\n          problems,\n        })\n      )\n    })\n  })\n\n  await Promise.all(allPromises)\n\n  return { sample, problems }\n}\n","import Excel from 'exceljs'\n\nimport {\n  SubmissionSample,\n  FileProblem,\n  ProcessFileResult,\n  ProcessorsConfig,\n  CellProcessor,\n  SampleProcessor,\n} from '../types'\nimport { schemasByWsName, lookupsWsName, everyCellProcessors, acceptedTemplateVersions } from '../schema/templateSchema'\nimport { processParsedSample } from './processParsedSample'\n\nexport class KnownError extends Error {\n  problem: FileProblem\n\n  constructor(problem: FileProblem) {\n    super()\n    this.problem = problem\n  }\n}\n\nconst isCellProcessor = (processor: CellProcessor | SampleProcessor): processor is CellProcessor =>\n  !(processor as SampleProcessor).isSamplePostProcessor\n\nexport const processFile = async (wb: Excel.Workbook, config: ProcessorsConfig): Promise<ProcessFileResult> => {\n  const samples: SubmissionSample[] = []\n  const problems: FileProblem[] = []\n  const info = {}\n\n  const promises: Promise<void>[] = []\n\n  try {\n    const lookupsWs = wb.worksheets.find((ws) => ws.name === lookupsWsName)\n    if (!lookupsWs)\n      throw new KnownError({\n        type: 'fatal',\n        message: `File does not appear to be a valid template.`,\n      })\n\n    const getNamedCellValues = (): Record<string, Excel.CellValue> => {\n      const values = {}\n      wb.definedNames.model.forEach(({ name, ranges }) => {\n        const [range] = ranges\n        const value = lookupsWs.getCell(range.split('!')[1]).value\n        values[name] = value\n      })\n      return values\n    }\n\n    const { FirstDataRow: firstDataRowNumber, TemplateVersion: templateVersion } = getNamedCellValues()\n    if (typeof firstDataRowNumber !== 'number')\n      throw new KnownError({\n        type: 'fatal',\n        message: 'File does not appear to be a valid template: \"FirstDataRow\" is missing.',\n      })\n    if (typeof templateVersion !== 'number')\n      throw new KnownError({\n        type: 'fatal',\n        message: 'File does not appear to be a valid template: \"TemplateVersion\" is missing.',\n      })\n    if (!acceptedTemplateVersions.includes(templateVersion))\n      throw new KnownError({\n        type: 'fatal',\n        message: `File version of ${templateVersion} is not accepted. Accepted versions are: ${acceptedTemplateVersions\n          .map((version) => `${version}`)\n          .join(', ')}.`,\n      })\n\n    let sampleNumber = 1 // 1-based sample serial number (this is not zero-indexed for user-friendliness; also important this is non-zero where consumed later)\n\n    wb.eachSheet((ws) => {\n      const wsName = ws.name\n\n      // skip Lookups\n      if (wsName === lookupsWsName) return\n\n      const columnKeys = (ws.getRow(firstDataRowNumber - 1).values as Excel.CellValue[]).map(String) // as per file design scheme\n\n      // get worksheet schema\n      const sheetSchema = schemasByWsName[wsName]\n      if (!sheetSchema)\n        throw new KnownError({\n          wsName,\n          type: 'fatal',\n          message: `Unrecognized worksheet \"${wsName}\".`,\n        })\n      const universalSchema = schemasByWsName.ALL\n      const schema = { ...universalSchema, ...sheetSchema }\n\n      // process each worksheet row\n      ws.eachRow((row, rowNumber) => {\n        // skip top rows\n        if (rowNumber < firstDataRowNumber) return\n\n        try {\n          // begin with row (sample)\n          const sample: SubmissionSample = {}\n          const sampleProblems: FileProblem[] = []\n\n          // extract all cell values\n          row.eachCell({ includeEmpty: true }, (cell, columnNumber) => {\n            const key = columnKeys[columnNumber]\n\n            if (!key && !cell.value) return // irrelevant cell\n\n            if (!key)\n              throw new KnownError({\n                type: 'row',\n                wsName,\n                rowNumber,\n                columnNumber,\n                message: 'Unidentified cell: not in known column',\n              })\n            const processors = schema[key]\n            if (!processors)\n              throw new KnownError({\n                type: 'row',\n                wsName,\n                rowNumber,\n                columnNumber,\n                message: 'Unexpected cell: column is not in schema',\n              })\n\n            // process/validate cell\n            try {\n              everyCellProcessors.filter(isCellProcessor).forEach((processorFn) => {\n                processorFn(cell, config) // tests and/or mutates cell.value\n              })\n\n              processors.filter(isCellProcessor).forEach((processorFn) => {\n                processorFn(cell, config) // tests and/or mutates cell.value\n              })\n\n              if (\n                typeof cell.value === 'string' ||\n                typeof cell.value === 'number' ||\n                typeof cell.value === 'boolean' ||\n                typeof cell.value === 'undefined' ||\n                cell.value === null\n              ) {\n                sample[key] = cell.value\n              } else {\n                sample[key] = 'UNKNOWN' // TODO: handle this\n              }\n            } catch (err) {\n              if (!(err instanceof KnownError)) throw err\n              sampleProblems.push({ wsName, type: 'row', rowNumber, columnNumber, ...err.problem })\n            }\n          })\n\n          // process parsed sample\n          promises.push(\n            processParsedSample({ sample, schema, config, rowNumber, sampleNumber, templateVersion, columnKeys }).then(\n              (processedResult) => {\n                // finish with row (sample)\n                const finalProblems = [\n                  ...sampleProblems,\n                  ...processedResult.problems.map((problem) => ({ ...problem, wsName })),\n                ]\n                if (finalProblems.length > 0) {\n                  problems.push(...finalProblems)\n                } else {\n                  info[wsName] = (info[wsName] || 0) + 1\n                  samples.push(processedResult.sample)\n                }\n              }\n            )\n          )\n        } catch (err) {\n          if (!(err instanceof KnownError)) throw err\n          problems.push(err.problem)\n        }\n\n        sampleNumber += 1\n      })\n    })\n\n    // wait for all asyncs to return\n    await Promise.all(promises)\n\n    return { samples, info, problems, templateVersion }\n  } catch (err) {\n    if (err instanceof KnownError) return { samples: [], info: {}, problems: [err.problem], templateVersion: null }\n    return {\n      samples: [],\n      info: {},\n      problems: [{ type: 'fatal', message: `Fatal error while processing file: ${err}` }],\n      templateVersion: null,\n    }\n  }\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { css } from '@emotion/react'\nimport MuiButton from '@mui/material/Button'\n\ninterface PreparationPageProps {\n  onDownloadTemplate: () => void\n}\n\nconst styles = css`\n  .download-template-columns {\n    display: flex;\n  }\n\n  .download-template-button {\n    width: 15em;\n  }\n`\n\nexport const PreparationPage = ({ onDownloadTemplate }: PreparationPageProps): JSX.Element => {\n  return (\n    <div css={styles}>\n      <div className=\"download-template-columns\">\n        <div>\n          <p>Welcome to the NAMC online sample submission process.</p>\n          <p>\n            The first step to making a new submission is to download the latest Excel template and fill in the\n            information defining your samples. It&apos;s important that you always submit data using the latest template\n            and we recommend that you download it each time you wish to make a submission.\n          </p>\n          <p>\n            The template helps you by limiting the values that can be used in certain columns. Further information\n            describing each column is available on the{' '}\n            <a href=\"https://namc-usu.org\" target=\"_blank\" rel=\"noreferrer\">\n              NAMC web site\n            </a>\n            . Note that the template does allow you to submit different types of samples (benthic, zooplankton, drift,\n            fish diet or water quality) within a single Excel template upload.\n          </p>\n          <p>If you cut and paste information into the template, we recommend using &ldquo;paste values&rdquo;.</p>\n          <p>\n            Once you have downloaded and populated the latest version of the template with information describing your\n            samples, click next to upload your Excel file and validate the information.\n          </p>\n          <p>\n            <a href=\"https://namc-usu.org/contactus.html\" target=\"_blank\" rel=\"noreferrer\">\n              Contact the NAMC Lab Manager\n            </a>{' '}\n            if you have questions or experience problems submitting data.\n          </p>\n        </div>\n        <div>\n          <MuiButton onClick={onDownloadTemplate} variant=\"contained\" className=\"download-template-button\">\n            Download Template\n          </MuiButton>\n        </div>\n      </div>\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiButton from '@mui/material/Button'\nimport { css } from '@emotion/react'\n\ninterface FinishedPageProps {\n  boxId: number\n  onGoToBoxes: () => void\n  onGoToBoxDetail: () => void\n  onGoToChainOfCustody: () => void\n}\n\nconst styles = css`\n  button {\n    margin: 0.5em;\n  }\n`\n\nexport const FinishedPage = ({\n  boxId,\n  onGoToBoxes,\n  // onGoToBoxDetail,\n  onGoToChainOfCustody,\n}: FinishedPageProps): JSX.Element => {\n  return (\n    <div css={styles}>\n      <p>Your submission was successful. Your submission reference is {boxId}.</p>\n      <p>\n        You should now print and follow the instructions on the chain of custody form. You can track the status of your\n        submission on the customer box listing.\n      </p>\n      <MuiButton variant=\"outlined\" onClick={onGoToBoxes}>\n        Customer Submission Listing\n      </MuiButton>\n      <MuiButton variant=\"outlined\" onClick={onGoToChainOfCustody}>\n        Open Chain of Custody Form\n      </MuiButton>\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { times } from 'lodash'\nimport dayjs from 'dayjs'\nimport { SerializedStyles } from '@emotion/react'\n\nexport const Document = ({\n  children,\n  styles,\n}: {\n  children: React.ReactNode\n  styles: SerializedStyles\n}): JSX.Element => (\n  <div css={styles}>\n    {/* below padding ensures borders print */}\n    <div className=\"document\" css={{ padding: '0 2px' }}>\n      {children}\n    </div>\n  </div>\n)\n\nexport const EmptyCell = ({ qty = 1 }: { qty: number }): JSX.Element => (\n  <>\n    {times(qty).map((i) => (\n      <td key={i}></td>\n    ))}\n  </>\n)\n\nexport const Table = ({ children, borders }: { children: React.ReactNode; borders?: boolean }): JSX.Element => (\n  <table\n    css={{\n      'th,td': { minWidth: '1em', border: borders ? '1px solid black' : 'none', padding: '0.1em' },\n      borderCollapse: 'collapse',\n      width: '100%',\n    }}\n  >\n    {children}\n  </table>\n)\n\nexport const PageBreak = (): JSX.Element => (\n  <div css={{ height: '1px', pageBreakAfter: 'always', '@media screen': { borderBottom: '3px dashed green' } }} />\n)\n\nexport const Line = (): JSX.Element => <hr css={{ borderBottom: '1px solid black', margin: '0.75em 0' }} />\n\nexport const longDate = (date: string | number | boolean | null | undefined): string => {\n  if (typeof date !== 'string') return '?'\n  return dayjs(date).format('MMMM D, YYYY')\n}\n\nexport const shortDate = (date: string | number | boolean | null | undefined): string => {\n  if (typeof date !== 'string') return '?'\n  return dayjs(date).format('M/D/YY')\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { css } from '@emotion/react'\n\nimport { Document, EmptyCell, Table, PageBreak, Line, shortDate, longDate } from './helpers'\nimport { Submission } from '../../../types'\n\nexport interface ChainOfCustodyFormProps {\n  submission: Submission\n}\n\nconst styles = css`\n  .document {\n    font-family: serif;\n    font-size: 12pt;\n    line-height: 1.2;\n    color: black;\n  }\n  u {\n    text-decoration: underline;\n  }\n  i {\n    text-style: italic;\n  }\n  b {\n    font-weight: bold;\n  }\n  th {\n    text-align: center;\n  }\n  td {\n    text-align: left;\n  }\n  .indent {\n    margin-left: 3em;\n    display: inline-block;\n  }\n  .notes-box {\n    border: 1px solid black;\n    width: 100%;\n    height: 5em;\n  }\n  .float-right {\n    display: inline-block;\n    float: right;\n    padding-right: 2em;\n  }\n`\n\nexport const ChainOfCustodyForm = ({ submission }: ChainOfCustodyFormProps): JSX.Element => (\n  <Document styles={styles}>\n    <p>\n      {submission.submitterName} <br />\n      {submission.organizationName} <br />\n      {submission.submitterPhone} <br />\n      {submission.submitterEmail} <br />\n    </p>\n    <p>{longDate(submission.createdDate)}</p> <p>Dear {submission.submitterName},</p>\n    <p>\n      On {longDate(submission.createdDate)}, {submission.samples.length} samples were electronically submitted to the\n      USU/BLM National Aquatic Monitoring Center (a.k.a. BugLab). The documentation on page 2 is your Chain of Custody\n      form and should be used for sample tracking purposes. As such,{' '}\n      <u>send this documentation with the sample shipment</u> and also retain a copy for your records.\n    </p>\n    <p>\n      Samples should be sent to:\n      <br />\n      <span className=\"indent\">\n        USU/BLM National Aquatic Monitoring Center (BugLab) <br />\n        Department of Watershed Sciences <br />\n        Utah State University <br />\n        5210 Old Main Hill <br />\n        Logan, Utah 84322 5210 <br />\n      </span>\n    </p>\n    <p>\n      Samples should be preserved in ethanol (70-95%) unless you have made prior arrangements with our lab. To prepare\n      for shipping, follow the guidelines for Class 3 (Flammable Liquid) Hazardous Materials according to your chosen\n      carrier&apos;s guidelines.{' '}\n      <u>\n        If you do not have a hazardous materials permit, samples can be shipped overnight in water as long as the\n        samples were in ethanol prior to shipment. If shipping in water, you must let NAMC know before shipment.\n      </u>{' '}\n      General packaging guidelines are as follows:\n    </p>\n    <ul>\n      <li>Make sure the lids are on tightly. To be extra careful, you can wrap duct tape around the lids.</li>\n      <li>\n        Place individual samples in ziploc baggies or other secondary sealed containers lined with absorbent material\n        (such as paper towels) for support, cushion, and to absorb any leaks.\n      </li>\n      <li>\n        Place data sheets, <b>including provided chain of custody forms, and any other paper documentation</b> in a\n        separate zip-lock plastic bag.\n      </li>\n      <li>\n        As specified by your carrier, mark package as Hazardous Material and fill out a Shipping Declaration for\n        Dangerous Goods form to accompany the package (and keep a copy for your records).\n      </li>\n    </ul>\n    <p>For any clarification on these instructions or the submission process, visit www.usu.edu/buglab.</p>\n    <p>\n      For additional questions, please contact Trip Armstrong (760-709-1210; <u>trip.armstrong@usu.edu</u>), Scott\n      Miller (435-797-2612; <u>scott.miller@usu.edu</u>), or Matt Tagg (435-797-3945; <u>matt.tagg@usu.edu</u>).\n    </p>\n    <p>\n      Sincerely, <br />\n      Scott Miller <br />\n      Director <br />\n      USU/BLM National Aquatic Monitoring Center (BugLab) <br />\n      Department of Watershed Sciences <br />\n      Utah State University <br />\n      5210 Old Main Hill <br />\n      Utah State University <br />\n      Logan, Utah 84322\n    </p>\n    <PageBreak />\n    <span className=\"float-right\">\n      BoxID: {submission.boxId} <br />\n      (lab use only)\n    </span>\n    Customer: {submission.organizationName} <br />\n    Number of Samples: {submission.samples.length} <br />\n    <br />\n    <b>Chain of Custody</b>\n    <Table borders>\n      <thead>\n        <tr>\n          <th></th>\n          <th>Date</th>\n          <th>Condition</th>\n          <th>Approved by</th>\n          <th>Signature</th>\n          <th>Data</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td>\n            <b>Submitted</b>\n          </td>\n          <td>{shortDate(submission.createdDate)}</td>\n          <td></td>\n          <td>{submission.submitterName}</td>\n          <td></td>\n          <td></td>\n        </tr>\n        <tr>\n          <td>\n            <b>Shipped</b>\n          </td>\n          <EmptyCell qty={5} />\n        </tr>\n        <tr>\n          <td>\n            <b>Received in Lab</b>\n          </td>\n          <EmptyCell qty={5} />\n        </tr>\n        <tr>\n          <td>\n            <b>Lab Work Initiated</b>\n          </td>\n          <EmptyCell qty={5} />\n        </tr>\n        <tr>\n          <td>\n            <b>Lab Work Finished</b>\n          </td>\n          <EmptyCell qty={5} />\n        </tr>\n        <tr>\n          <td>\n            <b>Report Sent</b>\n          </td>\n          <EmptyCell qty={5} />\n        </tr>\n        <tr>\n          <td>\n            <b>Jars/Specimens Returned</b>\n          </td>\n          <EmptyCell qty={5} />\n        </tr>\n        <tr>\n          <td>\n            <b>Returned Jars/Specimens Received</b>\n          </td>\n          <EmptyCell qty={5} />\n        </tr>\n      </tbody>\n    </Table>\n    <br />\n    <b>Notes:</b>\n    <div className=\"notes-box\" />\n    <Line />\n    <b>Special Handling</b> (all additional services are in addition to baseline price. Prior arrangements must be made){' '}\n    <br />\n    <Table>\n      <tbody>\n        <tr>\n          <td>\n            <u>Measurements</u>\n          </td>\n          <td>\n            <u>Identification</u>\n          </td>\n          <td>\n            <u>QAQC</u>\n          </td>\n          <td>\n            <u>Cataloging</u>\n          </td>\n        </tr>\n        <tr>\n          <td>Length</td>\n          <td>Midges</td>\n          <td>Sorting ( __ %)</td>\n          <td>Reference Collection</td>\n        </tr>\n        <tr>\n          <td>Biomass</td>\n          <td>OTUs</td>\n          <td>Taxonomy ( __ %)</td>\n          <td>Return Specimens</td>\n        </tr>\n      </tbody>\n    </Table>\n    <Line />\n    <b>Sample Log</b> (lab use only) <br />\n    <Table borders>\n      <thead>\n        <tr>\n          <th>#</th>\n          <th>Jars</th>\n          <th>Station</th>\n          <th>Location</th>\n          <th>Date</th>\n          <th>Sample Type</th>\n          <th></th>\n          <th>Problems</th>\n        </tr>\n      </thead>\n      <tbody>\n        {submission.samples.map((sample) => (\n          /* see schema for field names */\n          <tr key={String(sample.sampleIndex)}>\n            <td>{sample.sampleIndex}</td>\n            <td>{sample.jarCount}</td>\n            <td>{sample.siteId}</td>\n            <td>{sample.waterbodyName}</td>\n            <td>{shortDate(sample.sampleDate)}</td>\n            <td>{sample.sampleType}</td>\n            <td></td>\n            <td></td>\n          </tr>\n        ))}\n      </tbody>\n    </Table>\n  </Document>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect } from 'react'\n\nimport { ChainOfCustodyForm } from '../../lib/submissions'\nimport { Submission } from '../../types'\n\nexport interface ChainOfCustodyProps {\n  submission: Submission\n  autoPrint?: boolean\n}\n\nexport const ChainOfCustody = ({ submission, autoPrint }: ChainOfCustodyProps): JSX.Element => {\n  useEffect(() => {\n    if (!autoPrint) return\n    window.setTimeout(() => {\n      window.print()\n    }, 500)\n  }, [])\n\n  return <ChainOfCustodyForm submission={submission} />\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectLatestSubmissionByBoxId } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { ChainOfCustody as Component } from './ChainOfCustody'\nimport { Fallback } from './Fallback'\n\ninterface ChainOfCustodyProps {\n  boxId: number\n  autoPrint?: boolean\n}\n\nexport const ChainOfCustody = withSuspense(({ boxId, autoPrint }: ChainOfCustodyProps): JSX.Element => {\n  const submission = useRecoilValue(selectLatestSubmissionByBoxId(Number(boxId)))\n\n  if (submission === null) return <h2>Submission for box {boxId} not found.</h2>\n\n  return <Component submission={submission} autoPrint={autoPrint} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <MuiSkeleton height=\"1em\" width=\"20em\" />\n    <MuiSkeleton height=\"1em\" width=\"20em\" />\n    <MuiSkeleton height=\"1em\" width=\"20em\" />\n    <MuiSkeleton height=\"1em\" width=\"20em\" />\n    <MuiSkeleton height=\"10em\" width=\"40em\" />\n  </div>\n)\n","import { ColDef } from 'ag-grid-community'\n\nimport { columnDef } from '../DataGrid'\nimport { ProblemRow } from './CustomerSubmission'\n\nconst columnNumberToLetters = (columnNumber) => {\n  let col = columnNumber - 1\n  let letters = ''\n  while (col >= 0) {\n    letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[col % 26] + letters\n    col = Math.floor(col / 26) - 1\n  }\n  return letters\n}\n\nexport const problemsColumnDefs = [\n  // columnDef.numberColumn({\n  //   field: 'id',\n  //   width: 100,\n  // }),\n  columnDef.textColumn({\n    headerName: 'Worksheet',\n    field: 'wsName',\n    width: 150,\n  }),\n  columnDef.textColumn({\n    headerName: 'Cell',\n    colId: 'cell',\n    valueGetter: ({ data }: { data: ProblemRow }): string | null => {\n      const { columnNumber, rowNumber } = data\n      if (!columnNumber || !rowNumber) return null\n      return `${columnNumberToLetters(columnNumber)}${rowNumber}`\n    },\n    width: 100,\n  }),\n  columnDef.textColumn({\n    headerName: 'Problem',\n    field: 'message',\n    flex: 1,\n    minWidth: 150,\n  }),\n  columnDef.numberColumn({\n    headerName: 'Column #',\n    field: 'columnNumber',\n    width: 100,\n  }),\n  columnDef.numberColumn({\n    headerName: 'Row #',\n    field: 'rowNumber',\n    width: 100,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport { useDropzone } from 'react-dropzone'\nimport MuiLinearProgress from '@mui/material/LinearProgress'\nimport UploadFileIcon from '@mui/icons-material/UploadFile'\nimport FilePresentIcon from '@mui/icons-material/FilePresent'\nimport MuiButton from '@mui/material/Button'\nimport Excel from 'exceljs'\n\nimport { Updater } from '../../lib/useUpdatableState'\nimport { useApi } from '../../data/api'\nimport { selectLists, processFile } from '../../lib/submissions'\nimport { ProcessingStatus, emptyProcessResult, State } from './CustomerSubmission'\n\nexport interface UploadFileBoxProps {\n  // onDrop: (files: File[]) => void\n  updateState: (updater: Updater<State>) => void\n  processingToken: number\n  processingStatus: ProcessingStatus\n  filename: string\n}\n\nexport const UploadFileBox = ({\n  updateState,\n  processingToken,\n  processingStatus,\n  filename,\n}: UploadFileBoxProps): JSX.Element => {\n  const lists = useRecoilValue(selectLists)\n\n  const api = useApi()\n\n  const onDrop = (acceptedFiles: File[]) => {\n    const handleError = (message: string) => {\n      updateState((draft) => {\n        draft.processingStatus = 'empty'\n        draft.processResult = emptyProcessResult\n        draft.filename = ''\n        draft.errorMessage = message\n      })\n    }\n\n    if (acceptedFiles.length > 1) {\n      handleError('Only a single template file is allowed.')\n      return\n    }\n\n    const file = acceptedFiles[0]\n    const reader = new FileReader()\n    const thisProcessingToken = processingToken + 1\n\n    updateState((draft) => {\n      draft.lastProcessingStatus = draft.processingStatus\n      draft.processingStatus = 'uploading'\n      draft.processingToken = thisProcessingToken\n      draft.errorMessage = ''\n    })\n\n    reader.onerror = () => {\n      handleError('Could not read template file.')\n    }\n    reader.onload = async () => {\n      updateState((draft) => {\n        draft.processingStatus = 'processing'\n        draft.lastFilename = draft.filename\n        draft.filename = file.name\n      })\n      try {\n        const buffer = reader.result\n        if (!(buffer instanceof ArrayBuffer)) throw new Error('ArrayBuffer error')\n        const wb = new Excel.Workbook()\n        await wb.xlsx.load(buffer)\n\n        const processResult = await processFile(wb, { lists, api })\n\n        updateState((draft) => {\n          if (draft.processingToken !== thisProcessingToken) return // this processing is aborted/stale\n          draft.processingStatus = 'processed'\n          draft.processResult = processResult\n        })\n      } catch (err) {\n        handleError('Could not parse template file.')\n      }\n    }\n    try {\n      reader.readAsArrayBuffer(file)\n    } catch (err) {\n      handleError('Could not read template file.')\n    }\n  }\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  })\n\n  const handleAbort = () => {\n    updateState((draft) => {\n      draft.processingStatus = draft.lastProcessingStatus\n      draft.filename = draft.lastFilename\n      draft.processingToken++\n    })\n  }\n\n  const isPerforming = processingStatus === 'uploading' || processingStatus === 'processing'\n\n  return (\n    <div\n      {...(isPerforming ? {} : getRootProps())}\n      css={{\n        border: isDragActive ? '3px dashed blue' : '3px dashed lightgrey',\n        minHeight: '6em',\n        width: '100%',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        cursor: isPerforming ? 'default' : 'pointer',\n        position: 'relative',\n      }}\n    >\n      {isPerforming ? (\n        <div css={{ width: '80%' }}>\n          <MuiLinearProgress />\n          <div css={{ textAlign: 'center' }}>\n            <MuiButton onClick={handleAbort}>Cancel</MuiButton>\n          </div>\n        </div>\n      ) : (\n        <div css={{ display: 'flex', width: '80%', minHeight: '3em' }}>\n          <div\n            css={{\n              flex: 1,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              borderRight: '1px solid grey',\n              paddingRight: '1em',\n              textAlign: 'center',\n            }}\n          >\n            {filename ? (\n              <>\n                <FilePresentIcon /> {filename}\n              </>\n            ) : (\n              <>\n                <UploadFileIcon /> No template\n              </>\n            )}\n          </div>\n          <div\n            css={{\n              flex: 1,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              paddingLeft: '1em',\n              textAlign: 'center',\n            }}\n          >\n            <span>\n              Drop here or&nbsp;<a>choose template</a>\n            </span>\n          </div>\n        </div>\n      )}\n      <input {...getInputProps()} />\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', maxWidth: '70rem', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <MuiSkeleton height=\"1em\" variant=\"rectangular\" />\n    <MuiSkeleton height=\"10em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\ninterface StepPageProps {\n  active: boolean\n  className?: string\n  children: React.ReactNode\n}\n\nexport const StepPage = ({ active, className, children, ...rest }: StepPageProps): JSX.Element => (\n  <div\n    className={className}\n    css={{\n      width: '100%',\n      height: '100%',\n      position: 'absolute',\n      visibility: active ? 'visible' : 'hidden',\n    }}\n    {...rest}\n  >\n    {children}\n  </div>\n)\n","export const trimAllStrings = <T>(record: T): T => {\n  const copy = { ...record }\n  Object.entries(copy).forEach(([key, value]) => {\n    if (typeof value === 'string') copy[key] = value.trim()\n  })\n  return copy\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport MuiButton from '@mui/material/Button'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\nimport MuiDialogTitle from '@mui/material/DialogTitle'\n\nimport { Taxon } from '../../types'\nimport { TaxonomySelectField } from '../TaxonomyField'\n\nexport interface AddTaxonDialogProps {\n  isOpen: boolean\n  taxa: Taxon[]\n  onClose: () => void\n  onAdd: (taxonId: number) => void\n}\n\nexport const AddTaxonDialog = ({ isOpen, onClose, taxa, onAdd }: AddTaxonDialogProps): JSX.Element => {\n  const [taxonId, setTaxonId] = useState<number | null>(null)\n\n  const handleClose = () => {\n    onClose()\n    setTaxonId(null)\n  }\n\n  const handleConfirm = () => {\n    if (!taxonId) return\n    onAdd(taxonId)\n    handleClose()\n  }\n\n  return (\n    <MuiDialog open={isOpen} onClose={onClose} fullWidth maxWidth=\"md\">\n      <MuiDialogTitle>Add Taxonomy Filtering</MuiDialogTitle>\n      <MuiDialogContent>\n        <div css={{ padding: '1em 0' }}>\n          <TaxonomySelectField label=\"Taxonomy\" value={taxonId} onChange={setTaxonId} options={taxa} ungrouped />\n        </div>\n      </MuiDialogContent>\n      <MuiDialogActions>\n        <MuiButton onClick={onClose}>Cancel</MuiButton>\n        <MuiButton onClick={handleConfirm} disabled={!taxonId}>\n          Add\n        </MuiButton>\n      </MuiDialogActions>\n    </MuiDialog>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo, useState } from 'react'\nimport { useRecoilValue } from 'recoil'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport MuiButton from '@mui/material/Button'\nimport MuiIconButton from '@mui/material/IconButton'\nimport AddCircleIcon from '@mui/icons-material/AddCircle'\nimport { identity } from 'lodash'\n\nimport { Metric } from '../../types'\nimport { Title } from '../Title'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport {\n  lookupListToOptions,\n  selectCalculations,\n  selectMetricGroups,\n  selectMyUser,\n  selectMetricReports,\n  useInvalidate,\n  selectAttributes,\n  selectRarefactionTypes,\n  selectTaxa,\n} from '../../data/selectors'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { TextField } from '../TextField'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { createMetric, deleteMetric, updateMetric } from '../../data/calls'\nimport { CheckboxField } from '../CheckboxField'\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport { Menu, Divider } from '../Menu'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\nimport { AutocompleteArrayField } from '../AutocompleteArrayField'\nimport { trimAllStrings } from '../../lib/trimAllStrings'\nimport { Chip } from '../Chip'\nimport { AddTaxonDialog } from './AddTaxonDialog'\n\nexport interface MetricDetailProps {\n  metric: Metric | null\n}\n\ninterface Fields {\n  name: string\n  abbreviation: string\n  groupId: number | null\n  displayText: string\n  isActive: boolean\n  description: string\n  calculationId: number | null\n  reportIds: number[]\n  rarefactionTypeId: number | null\n  taxonomyIds: number[]\n  attributeId: number | null\n  attributeValuesText: string\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'stopped' | 'started' | 'stopping' | 'deleting'\n  isDirty: boolean\n  values: Fields\n  lastValues?: Fields\n}\n\nconst getInitialState = ({ metric }: Pick<MetricDetailProps, 'metric'>): State => {\n  const {\n    name = '',\n    abbreviation = '',\n    groupId = null,\n    displayText = '',\n    isActive = false,\n    description = '',\n    calculationId = null,\n    reportIds = [],\n    rarefactionTypeId = null,\n    taxonomyIds = [],\n    attributeId = null,\n  } = metric ?? {}\n  const attributeValuesText = metric?.attributeValues?.join(', ') ?? ''\n  return {\n    editMode: metric ? 'stopped' : 'started',\n    isDirty: false,\n    values: {\n      name,\n      abbreviation,\n      groupId,\n      displayText,\n      isActive,\n      description,\n      calculationId,\n      reportIds,\n      rarefactionTypeId,\n      taxonomyIds,\n      attributeId,\n      attributeValuesText,\n    },\n  }\n}\n\nexport const MetricDetail = ({ metric }: MetricDetailProps): JSX.Element => {\n  const api = useApi()\n  const invalidate = useInvalidate()\n  const notifications = useNotifications()\n  const navigate = useNavigate()\n  const user = useRecoilValue(selectMyUser)\n\n  const isNewMetric = !metric\n\n  // OPTIONS\n\n  const metricGroupOptions = lookupListToOptions(useRecoilValue(selectMetricGroups))\n  const calculationOptions = lookupListToOptions(useRecoilValue(selectCalculations))\n  const metricReportOptions = lookupListToOptions(useRecoilValue(selectMetricReports))\n  const rarefactionTypeOptions = lookupListToOptions(useRecoilValue(selectRarefactionTypes))\n  const attributeOptions = lookupListToOptions(useRecoilValue(selectAttributes))\n  const taxa = useRecoilValue(selectTaxa)\n\n  // STATE\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ metric }), [metric])\n  const [isConfirmDeleteOpen, setIsConfirmDeleteOpen] = useState(false)\n  const [isAddTaxonOpen, setIsAddTaxonOpen] = useState(false)\n\n  const { values, editMode, isDirty } = state\n  const attributeValues = values.attributeValuesText\n    .split(',')\n    .map((attributeValue) => attributeValue.trim())\n    .filter(identity)\n\n  const errors: FieldErrors = (() => {\n    const result: FieldErrors = {\n      name: !values.name.trim(),\n      abbreviation: !values.abbreviation.trim(),\n      groupId: !values.groupId,\n      calculationId: !values.calculationId,\n      rarefactionTypeId: !values.rarefactionTypeId,\n      attributeValuesText:\n        (!!values.attributeId && attributeValues.length === 0) || (!values.attributeId && attributeValues.length > 0),\n    }\n    if (!Object.values(result).some((value) => value)) return undefined\n    return result\n  })()\n\n  const isStopped = editMode === 'stopped'\n  const isEditing = editMode === 'started'\n  const isSaving = editMode === 'stopping'\n  const isDeleting = editMode === 'deleting'\n\n  // HANDLERS\n\n  const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n    updateState((draft) => {\n      Object.assign(draft.values, { [fieldName]: value })\n      draft.isDirty = true\n    })\n  }\n  const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n  const handleEdit = () => {\n    updateState((draft) => {\n      draft.editMode = 'started'\n      draft.lastValues = draft.values\n    })\n  }\n\n  const handleCancel = () => {\n    updateState((draft) => {\n      if (!draft.lastValues) throw new Error('no values to revert to')\n      draft.editMode = 'stopped'\n      draft.values = draft.lastValues\n      draft.isDirty = false\n    })\n  }\n\n  const handleSave = async () => {\n    try {\n      updateState((draft) => {\n        draft.editMode = 'stopping'\n      })\n      const {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        attributeValuesText, // discarded\n        ...restInput\n      } = values\n      const { rarefactionTypeId, calculationId, ...restMetricInput } = trimAllStrings({ attributeValues, ...restInput })\n      if (!rarefactionTypeId || !calculationId) throw new Error('Missing Rarefaction type or Calculation.')\n      if (isNewMetric) {\n        // new metric\n        const metricId = await createMetric(api, invalidate)({ rarefactionTypeId, calculationId, ...restMetricInput })\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n        window.setTimeout(() => {\n          navigate.metricDetail({ metricId }, true) // let state update\n        })\n      } else {\n        // existing metric\n        await updateMetric(\n          api,\n          invalidate\n        )({\n          ...restMetricInput,\n          rarefactionTypeId,\n          calculationId,\n          id: metric.id,\n        })\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n      }\n    } catch (err) {\n      switch ((err as Error).message) {\n        case 'duplicate key value violates unique constraint \"metrics_metric_name_key\"':\n          notifications.error(`Failed to save: name \"${values.name}\" already in use`)\n          break\n        case 'duplicate key value violates unique constraint \"metrics_abbreviation_key\"':\n          notifications.error(`Failed to save: abbreviation \"${values.abbreviation}\" already in use`)\n          break\n        default:\n          notifications.error(`Failed to save: ${err}`)\n      }\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n  }\n\n  const handleDelete = async () => {\n    try {\n      if (!metric) throw new Error('No metric.')\n      updateState((draft) => {\n        draft.editMode = 'deleting'\n      })\n      await deleteMetric(api, invalidate)(metric)\n      notifications.info(`Deleted metric ${metric.name}`)\n      navigate.metrics()\n    } catch (err) {\n      notifications.error(`Failed to delete: ${err}`)\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n      })\n    }\n  }\n\n  const handleAddTaxonId = (addTaxonId: number) => {\n    setFieldValue('taxonomyIds', [...values.taxonomyIds, addTaxonId])\n  }\n\n  // RENDER\n\n  const availableTaxa = useMemo(\n    () => taxa.filter((taxon) => !values.taxonomyIds.includes(taxon.id)),\n    [taxa, values.taxonomyIds]\n  )\n\n  return (\n    <>\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', alignItems: 'center', minHeight: '3rem', marginBottom: '1rem', gap: '1rem' }}>\n          {!isEditing ? (\n            <Title>{values.name}</Title>\n          ) : (\n            <div css={{ flex: 1 }}>\n              <TextField\n                label=\"Metric Name\"\n                value={values.name}\n                onChange={(value) => setFieldValue('name', value)}\n                error={errors?.name}\n                InputProps={{ sx: { fontWeight: '700' } }} // roughly match <Title>\n                maxLength={255}\n                fullWidth\n              />\n            </div>\n          )}\n          <div css={{ display: 'flex', gap: '0.5em', marginLeft: 'auto' }}>\n            {(isStopped || isDeleting) && user.hasPermission(NAMCResource.metrics, GrantAction.updateAny) && (\n              <Menu\n                label=\"Actions\"\n                disabled={isDeleting}\n                items={[\n                  {\n                    key: 'edit',\n                    label: 'Edit Metric',\n                    onClick: handleEdit,\n                  },\n                  Divider,\n                  {\n                    key: 'delete',\n                    label: 'Delete Metric',\n                    onClick: () => {\n                      setIsConfirmDeleteOpen(true)\n                    },\n                    disabled: !user.hasPermission(NAMCResource.metrics, GrantAction.deleteAny),\n                  },\n                ]}\n              />\n            )}\n            {(isEditing || isSaving) && (\n              <>\n                {!isNewMetric && (\n                  <MuiButton onClick={handleCancel} variant=\"outlined\" disabled={isSaving}>\n                    Cancel\n                  </MuiButton>\n                )}\n                <MuiButton onClick={handleSave} variant=\"contained\" disabled={!isDirty || isSaving || !!errors}>\n                  Save\n                </MuiButton>\n              </>\n            )}\n          </div>\n        </div>\n        <div\n          css={{\n            display: 'grid',\n            gap: '0.75em',\n            gridTemplateColumns: 'repeat(3, 1fr)',\n            gridTemplateAreas: `\n              \"abbreviation         groupId                 id\"\n              \"rarefactionTypeId    calculationId           isActive\"\n              \"displayText          reportIds               reportIds\"\n              \"description          description             description\"\n              \"taxonomyIds          attributeId             attributeValuesText\"\n            `,\n          }}\n        >\n          <ReadOnlyField gridArea=\"id\" value={metric?.id ?? 'TBD'} label=\"Metric ID\" />\n          <TextField\n            gridArea=\"abbreviation\"\n            value={values.abbreviation}\n            onChange={makeFieldChangeHandler('abbreviation')}\n            label=\"Abbreviation\"\n            readOnly={!isEditing}\n            error={errors?.abbreviation}\n            maxLength={50}\n          />\n          <AutocompleteField<number>\n            gridArea=\"groupId\"\n            label=\"Metric Group\"\n            value={values.groupId}\n            onChange={makeFieldChangeHandler('groupId')}\n            options={metricGroupOptions}\n            readOnly={!isEditing}\n            error={errors?.groupId}\n          />\n          <AutocompleteField<number>\n            gridArea=\"rarefactionTypeId\"\n            label=\"Rarefaction\"\n            value={values.rarefactionTypeId}\n            onChange={makeFieldChangeHandler('rarefactionTypeId')}\n            options={rarefactionTypeOptions}\n            readOnly={!isEditing}\n            error={errors?.rarefactionTypeId}\n          />\n          <AutocompleteField<number>\n            gridArea=\"calculationId\"\n            label=\"Calculation\"\n            value={values.calculationId}\n            onChange={makeFieldChangeHandler('calculationId')}\n            options={calculationOptions}\n            readOnly={!isEditing}\n            error={errors?.calculationId}\n          />\n          <CheckboxField\n            gridArea=\"isActive\"\n            value={values.isActive}\n            onChange={makeFieldChangeHandler('isActive')}\n            label=\"Is Active\"\n            readOnly={!isEditing}\n          />\n          <TextField\n            gridArea=\"displayText\"\n            value={values.displayText}\n            onChange={makeFieldChangeHandler('displayText')}\n            label=\"Display Text\"\n            readOnly={!isEditing}\n            error={errors?.displayText}\n            maxLength={255}\n          />\n          <AutocompleteArrayField\n            gridArea=\"reportIds\"\n            label=\"Included In the Following Reports\"\n            value={values.reportIds}\n            onChange={makeFieldChangeHandler('reportIds')}\n            options={metricReportOptions}\n            readOnly={!isEditing}\n            error={errors?.reportIds}\n          />\n          <TextField\n            gridArea=\"description\"\n            value={values.description}\n            onChange={makeFieldChangeHandler('description')}\n            label=\"Description\"\n            readOnly={!isEditing}\n            error={errors?.description}\n            multiline\n            minRows={2}\n          />\n          <div css={{ gridArea: 'taxonomyIds' }}>\n            <ReadOnlyField\n              label=\"Taxonomy Filtering\"\n              value={\n                <div css={{ flex: 1, display: 'flex', flexWrap: 'wrap', gap: '0.4em', alignItems: 'center' }}>\n                  {values.taxonomyIds.length > 0\n                    ? values.taxonomyIds.map((taxonId) => (\n                        <Chip\n                          key={taxonId}\n                          label={taxa.find(({ id }) => id === taxonId)?.name ?? '?'}\n                          onDelete={\n                            isEditing\n                              ? () => {\n                                  setFieldValue(\n                                    'taxonomyIds',\n                                    values.taxonomyIds.filter((id) => id !== taxonId)\n                                  )\n                                }\n                              : undefined\n                          }\n                        />\n                      ))\n                    : !isEditing && '—'}\n                  {isEditing && (\n                    <MuiIconButton\n                      onClick={() => {\n                        setIsAddTaxonOpen(true)\n                      }}\n                    >\n                      <AddCircleIcon />\n                    </MuiIconButton>\n                  )}\n                </div>\n              }\n            />\n          </div>\n          <AutocompleteField<number>\n            gridArea=\"attributeId\"\n            label=\"Attribute Filter\"\n            value={values.attributeId}\n            onChange={makeFieldChangeHandler('attributeId')}\n            options={attributeOptions}\n            readOnly={!isEditing}\n            error={errors?.attributeId}\n            isClearable\n          />\n          <TextField\n            gridArea=\"attributeValuesText\"\n            value={values.attributeValuesText}\n            onChange={makeFieldChangeHandler('attributeValuesText')}\n            label=\"Attribute Values\"\n            readOnly={!isEditing}\n            error={errors?.attributeValuesText}\n            multiline\n            minRows={2}\n          />\n        </div>\n      </div>\n      <ConfirmationDialog\n        title=\"Confirm Delete Metric\"\n        isOpen={isConfirmDeleteOpen}\n        onClose={() => {\n          setIsConfirmDeleteOpen(false)\n        }}\n        onConfirm={handleDelete}\n      >\n        Are you sure you want to delete this metric?\n      </ConfirmationDialog>\n      <AddTaxonDialog\n        isOpen={isAddTaxonOpen}\n        taxa={availableTaxa}\n        onClose={() => {\n          setIsAddTaxonOpen(false)\n        }}\n        onAdd={handleAddTaxonId}\n      />\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n    </>\n  )\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectMetricById, selectNull } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { MetricDetail as Component } from './MetricDetail'\nimport { Fallback } from './Fallback'\n\nexport type MetricDetailProps =\n  | {\n      metricId: string | number\n      isNew?: never\n    }\n  | {\n      metricId?: never\n      isNew: true // unconsumed; used to positively differentiate modes\n    }\n\nexport const MetricDetail = withSuspense(({ metricId }: MetricDetailProps): JSX.Element => {\n  const metric = useRecoilValue(metricId ? selectMetricById(Number(metricId)) : selectNull)\n\n  if (metricId && !metric) return <h2>Metric {metricId} not found.</h2>\n\n  return <Component metric={metric} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <MuiSkeleton height=\"3em\" variant=\"rectangular\" width=\"100%\" />\n    <MuiSkeleton height=\"10em\" variant=\"rectangular\" width=\"100%\" />\n  </div>\n)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const metricsColumnDefs = [\n  columnDef.linkColumn({\n    headerName: 'Metric Name',\n    field: 'title',\n    flex: 1,\n    minWidth: 140,\n  }),\n  columnDef.textColumn({\n    headerName: 'Metric ID',\n    field: 'id',\n    width: 120,\n  }),\n  columnDef.textColumn({\n    field: 'abbreviation',\n    flex: 1,\n    minWidth: 140,\n  }),\n  columnDef.textColumn({\n    field: 'groupName',\n    flex: 1,\n    minWidth: 140,\n  }),\n  columnDef.textColumn({\n    field: 'codeFunction',\n    flex: 1,\n    minWidth: 140,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\n\nimport { selectMetrics, selectMyUser } from '../../data/selectors'\nimport { DataGrid, renderers, DataGridRecordCount } from '../DataGrid'\nimport { Metric } from '../../types'\nimport { withSuspense } from '../withSuspense'\nimport { metricsColumnDefs } from './columnDefs'\nimport { Filter, FilterChips } from '../Filters'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\nimport { useNavigate } from '../AppRouter'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport { Fallback } from './Fallback'\n\nexport interface MetricRow extends Metric {\n  title: {\n    label: string\n    onClick: () => void\n    disabled?: boolean\n  }\n}\n\nconst textFilterState = atom({\n  key: 'MetricsListing/textFilterState',\n  default: '',\n})\n\nexport const MetricsListing = withSuspense(\n  () => {\n    const navigate = useNavigate()\n    const user = useRecoilValue(selectMyUser)\n    const metrics = useRecoilValue(selectMetrics)\n\n    // STATE AND REFS\n\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n      useRecoilState(textFilterState)\n    )\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<Metric>[] = []\n\n      if (textFilterDebounced) {\n        result.push({\n          id: 'text',\n          label: `Name/Abbreviation contains \"${textFilterDebounced}\"`,\n          filterFn: ({ name, abbreviation }) =>\n            name.toLowerCase().includes(textFilterDebounced.toLowerCase()) ||\n            abbreviation.toLowerCase().includes(textFilterDebounced.toLowerCase()),\n          onDelete: clearTextFilter,\n        })\n      }\n\n      return result\n    }, [textFilterDebounced])\n\n    const rows = useMemo<MetricRow[]>(() => {\n      const filtered = filters.reduce<Metric[]>((acc, { filterFn }) => acc.filter(filterFn), metrics)\n      return filtered.map((metric) => ({\n        ...metric,\n        title: {\n          label: metric.name,\n          onClick: () => {\n            navigate.metricDetail({ metricId: metric.id })\n          },\n        },\n      }))\n    }, [filters])\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', gap: '0.5em' }}>\n          <TextFilterField value={textFilter} onChange={setTextFilter} label=\"Metric Name or Abbreviation\" />\n          {user.hasPermission(NAMCResource.metrics, GrantAction.createAny) && (\n            <div css={{ marginLeft: 'auto' }}>\n              <MuiButton\n                variant=\"outlined\"\n                onClick={() => {\n                  navigate.metricCreate()\n                }}\n              >\n                Create New Metric\n              </MuiButton>\n            </div>\n          )}\n        </div>\n        <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n          <FilterChips filters={filters} joinLabel=\"and\" />\n          <DataGridRecordCount total={metrics.length} visible={rows.length} descriptor=\"metric\" />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<MetricRow> rows={rows} columnDefs={metricsColumnDefs} frameworkComponents={renderers} />\n        </div>\n      </div>\n    )\n  },\n  () => <Fallback />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { selectPredictors } from '../../data/selectors'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { withSuspense } from '../withSuspense'\nimport { AutocompleteArrayField, AutocompleteArrayFieldProps } from '../AutocompleteArrayField'\n\nexport type PredictorsFieldProps = Omit<AutocompleteArrayFieldProps, 'options'>\n\nexport const PredictorsField = withSuspense<PredictorsFieldProps>(\n  (props): JSX.Element => {\n    const predictors = useRecoilValue(selectPredictors)\n    const options = predictors.map(({ id: value, abbreviation: label }) => ({ value, label }))\n\n    return <AutocompleteArrayField {...props} options={options} />\n  },\n  (props) => <ReadOnlyField {...props} value={<MuiSkeleton />} />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { selectMetrics } from '../../data/selectors'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { withSuspense } from '../withSuspense'\nimport { AutocompleteArrayField, AutocompleteArrayFieldProps } from '../AutocompleteArrayField'\n\nexport type MetricsFieldProps = Omit<AutocompleteArrayFieldProps, 'options'>\n\nexport const MetricsField = withSuspense<MetricsFieldProps>(\n  (props): JSX.Element => {\n    const metrics = useRecoilValue(selectMetrics)\n    const options = metrics.map(({ id: value, abbreviation: label }) => ({ value, label }))\n\n    return <AutocompleteArrayField {...props} options={options} />\n  },\n  (props) => <ReadOnlyField {...props} value={<MuiSkeleton />} />\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport { selector, useRecoilValue } from 'recoil'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport MuiButton from '@mui/material/Button'\n\nimport { Model } from '../../types'\nimport { Title } from '../Title'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport {\n  lookupListToOptions,\n  selectModelTypes,\n  selectMyUser,\n  selectTranslations,\n  useInvalidate,\n} from '../../data/selectors'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { TextField } from '../TextField'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { createModel, deleteModel, updateModel } from '../../data/calls'\nimport { CheckboxField } from '../CheckboxField'\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport { Menu, Divider } from '../Menu'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\nimport { NumberField } from '../NumberField'\nimport { trimAllStrings } from '../../lib/trimAllStrings'\nimport { PredictorsField } from '../PredictorsField'\nimport { MetricsField } from '../MetricsField'\n\nexport interface ModelDetailProps {\n  model: Model | null\n}\n\ninterface Fields {\n  name: string\n  abbreviation: string\n  typeId: number | null\n  translationId: number | null\n  extentDescription: string\n  codeFunction: string\n  codeFunction2: string\n  platform: string\n  referenceSites: number | null\n  groupCount: number | null\n  minimumCount: number | null\n  oeMean: number | null\n  oeStdev: number | null\n  taxonomicEffort: string\n  fixedCount: number | null\n  description: string\n  predictorIds: number[]\n  metricIds: number[]\n  isActive: boolean\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'stopped' | 'started' | 'stopping' | 'deleting'\n  isDirty: boolean\n  values: Fields\n  lastValues?: Fields\n}\n\nconst getInitialState = ({ model }: Pick<ModelDetailProps, 'model'>): State => {\n  const {\n    name = '',\n    abbreviation = '',\n    typeId = null,\n    translationId = null,\n    extentDescription = '',\n    codeFunction = '',\n    codeFunction2 = '',\n    platform = '',\n    referenceSites = null,\n    groupCount = null,\n    minimumCount = null,\n    oeMean = null,\n    oeStdev = null,\n    taxonomicEffort = '',\n    fixedCount = null,\n    description = '',\n    predictorIds = [],\n    metricIds = [],\n    isActive = false,\n  } = model ?? {}\n  return {\n    editMode: model ? 'stopped' : 'started',\n    isDirty: false,\n    values: {\n      name,\n      abbreviation,\n      typeId,\n      translationId,\n      extentDescription,\n      codeFunction,\n      codeFunction2,\n      platform,\n      referenceSites,\n      groupCount,\n      minimumCount,\n      oeMean,\n      oeStdev,\n      taxonomicEffort,\n      fixedCount,\n      description,\n      predictorIds,\n      metricIds,\n      isActive,\n    },\n  }\n}\n\nconst selectTranslationOptions = selector({\n  key: 'ModelDetail/selectTranslationOptions',\n  get: async ({ get }) => {\n    const translations = await get(selectTranslations)\n    return translations.map(({ id, name }) => ({ value: id, label: name }))\n  },\n})\n\nexport const ModelDetail = ({ model }: ModelDetailProps): JSX.Element => {\n  const api = useApi()\n  const invalidate = useInvalidate()\n  const notifications = useNotifications()\n  const navigate = useNavigate()\n  const user = useRecoilValue(selectMyUser)\n\n  const isNewModel = !model\n\n  // LOOKUP OPTIONS\n\n  const modelTypeOptions = lookupListToOptions(useRecoilValue(selectModelTypes))\n  const taxonomicEffortOptions = [\n    {\n      value: 'Standard',\n      label: 'Standard',\n    },\n    {\n      value: 'Midges',\n      label: 'Midges',\n    },\n  ]\n\n  // STATE\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ model }), [model])\n  const [isConfirmDeleteOpen, setIsConfirmDeleteOpen] = useState(false)\n\n  const { values, editMode, isDirty } = state\n\n  const errors: FieldErrors = (() => {\n    const result: FieldErrors = {\n      name: !values.name.trim(),\n      abbreviation: !values.abbreviation.trim(),\n      typeId: !values.typeId,\n    }\n    if (!Object.values(result).some((value) => value)) return undefined\n    return result\n  })()\n\n  const isStopped = editMode === 'stopped'\n  const isEditing = editMode === 'started'\n  const isSaving = editMode === 'stopping'\n  const isDeleting = editMode === 'deleting'\n\n  // HANDLERS\n\n  const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n    updateState((draft) => {\n      Object.assign(draft.values, { [fieldName]: value })\n      draft.isDirty = true\n    })\n  }\n  const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n  const handleEdit = () => {\n    updateState((draft) => {\n      draft.editMode = 'started'\n      draft.lastValues = draft.values\n    })\n  }\n\n  const handleCancel = () => {\n    updateState((draft) => {\n      if (!draft.lastValues) throw new Error('no values to revert to')\n      draft.editMode = 'stopped'\n      draft.values = draft.lastValues\n      draft.isDirty = false\n    })\n  }\n\n  const handleSave = async () => {\n    try {\n      updateState((draft) => {\n        draft.editMode = 'stopping'\n      })\n      const modelInput = trimAllStrings(values)\n      if (isNewModel) {\n        // new model\n        const modelId = await createModel(api, invalidate)(modelInput)\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n        window.setTimeout(() => {\n          navigate.modelDetail({ modelId }, true) // let state update\n        })\n      } else {\n        // existing model\n        await updateModel(\n          api,\n          invalidate\n        )({\n          ...modelInput,\n          id: model.id,\n        })\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n      }\n    } catch (err) {\n      switch ((err as Error).message) {\n        case 'duplicate key value violates unique constraint \"models_model_name_key\"':\n          notifications.error(`Failed to save: name \"${values.name}\" already in use`)\n          break\n        case 'duplicate key value violates unique constraint \"models_abbreviation_key\"':\n          notifications.error(`Failed to save: abbreviation \"${values.abbreviation}\" already in use`)\n          break\n        default:\n          notifications.error(`Failed to save: ${err}`)\n      }\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n  }\n\n  const handleDelete = async () => {\n    try {\n      if (!model) throw new Error('No model.')\n      updateState((draft) => {\n        draft.editMode = 'deleting'\n      })\n      await deleteModel(api, invalidate)(model)\n      notifications.info(`Deleted model ${model.name}`)\n      navigate.models()\n    } catch (err) {\n      notifications.error(`Failed to delete: ${err}`)\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n      })\n    }\n  }\n\n  // RENDER\n\n  return (\n    <>\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', alignItems: 'center', minHeight: '3rem', marginBottom: '1rem', gap: '1rem' }}>\n          {!isEditing ? (\n            <Title>{values.name}</Title>\n          ) : (\n            <div css={{ flex: 1 }}>\n              <TextField\n                label=\"Model Name\"\n                value={values.name}\n                onChange={(value) => setFieldValue('name', value)}\n                error={errors?.name}\n                InputProps={{ sx: { fontWeight: '700' } }} // roughly match <Title>\n                maxLength={255}\n                fullWidth\n              />\n            </div>\n          )}\n          <div css={{ display: 'flex', gap: '0.5em', marginLeft: 'auto' }}>\n            {(isStopped || isDeleting) && user.hasPermission(NAMCResource.models, GrantAction.updateAny) && (\n              <Menu\n                label=\"Actions\"\n                disabled={isDeleting}\n                items={[\n                  {\n                    key: 'edit',\n                    label: 'Edit Model',\n                    onClick: handleEdit,\n                  },\n                  Divider,\n                  {\n                    key: 'delete',\n                    label: 'Delete Model',\n                    onClick: () => {\n                      setIsConfirmDeleteOpen(true)\n                    },\n                    disabled: !user.hasPermission(NAMCResource.models, GrantAction.deleteAny),\n                  },\n                ]}\n              />\n            )}\n            {(isEditing || isSaving) && (\n              <>\n                {!isNewModel && (\n                  <MuiButton onClick={handleCancel} variant=\"outlined\" disabled={isSaving}>\n                    Cancel\n                  </MuiButton>\n                )}\n                <MuiButton onClick={handleSave} variant=\"contained\" disabled={!isDirty || isSaving || !!errors}>\n                  Save\n                </MuiButton>\n              </>\n            )}\n          </div>\n        </div>\n        <div\n          css={{\n            display: 'grid',\n            gap: '0.75em',\n            gridTemplateColumns: 'repeat(4, 1fr)',\n            gridTemplateAreas: `\n              \"abbreviation     typeId           isActive            id\"\n              \"oeMean           oeStdev          codeFunction        codeFunction2\"\n              \"referenceSites   groupCount       minimumCount        fixedCount\"\n              \"translationId    taxonomicEffort  platform            .\"\n              \"predictorIds     predictorIds     predictorIds        predictorIds\"\n              \"metricIds        metricIds        metricIds           metricIds\"\n              \"description      description      extentDescription   extentDescription\"\n            `,\n          }}\n        >\n          <ReadOnlyField gridArea=\"id\" value={model?.id ?? 'TBD'} label=\"Model ID\" />\n          <TextField\n            gridArea=\"abbreviation\"\n            value={values.abbreviation}\n            onChange={makeFieldChangeHandler('abbreviation')}\n            label=\"Abbreviation\"\n            readOnly={!isEditing}\n            error={errors?.abbreviation}\n            maxLength={50}\n          />\n          <AutocompleteField\n            gridArea=\"typeId\"\n            label=\"Type\"\n            value={values.typeId}\n            onChange={makeFieldChangeHandler('typeId')}\n            readOnly={!isEditing}\n            error={errors?.typeId}\n            options={modelTypeOptions}\n          />\n          <CheckboxField\n            gridArea=\"isActive\"\n            value={values.isActive}\n            onChange={makeFieldChangeHandler('isActive')}\n            label=\"Active\"\n            readOnly={!isEditing}\n          />\n          <NumberField\n            gridArea=\"oeMean\"\n            value={values.oeMean}\n            onChange={makeFieldChangeHandler('oeMean')}\n            label=\"O2E Mean\"\n            readOnly={!isEditing}\n            error={errors?.oeMean}\n          />\n          <NumberField\n            gridArea=\"oeStdev\"\n            value={values.oeStdev}\n            onChange={makeFieldChangeHandler('oeStdev')}\n            label=\"O2E StDev\"\n            readOnly={!isEditing}\n            error={errors?.oeStdev}\n          />\n          <TextField\n            gridArea=\"codeFunction\"\n            value={values.codeFunction}\n            onChange={makeFieldChangeHandler('codeFunction')}\n            label=\"Code Function\"\n            readOnly={!isEditing}\n            error={errors?.codeFunction}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"codeFunction2\"\n            value={values.codeFunction2}\n            onChange={makeFieldChangeHandler('codeFunction2')}\n            label=\"Code Function 2\"\n            readOnly={!isEditing}\n            error={errors?.codeFunction2}\n            maxLength={255}\n          />\n          <NumberField\n            gridArea=\"referenceSites\"\n            value={values.referenceSites}\n            onChange={makeFieldChangeHandler('referenceSites')}\n            label=\"Reference Sites\"\n            readOnly={!isEditing}\n            error={errors?.referenceSites}\n          />\n          <NumberField\n            gridArea=\"groupCount\"\n            value={values.groupCount}\n            onChange={makeFieldChangeHandler('groupCount')}\n            label=\"Group Count\"\n            readOnly={!isEditing}\n            error={errors?.groupCount}\n          />\n          <NumberField\n            gridArea=\"minimumCount\"\n            value={values.minimumCount}\n            onChange={makeFieldChangeHandler('minimumCount')}\n            label=\"Minimum Count\"\n            readOnly={!isEditing}\n            error={errors?.minimumCount}\n          />\n          <NumberField\n            gridArea=\"fixedCount\"\n            value={values.fixedCount}\n            onChange={makeFieldChangeHandler('fixedCount')}\n            label=\"Fixed Count\"\n            readOnly={!isEditing}\n            error={errors?.fixedCount}\n          />\n          <AutocompleteField<number>\n            gridArea=\"translationId\"\n            label=\"Translation\"\n            optionsSelector={selectTranslationOptions}\n            valueLabel={model?.translationName ?? ''}\n            value={values.translationId}\n            onChange={makeFieldChangeHandler('translationId')}\n            readOnly={!isEditing}\n            isClearable\n          />\n          <AutocompleteField\n            gridArea=\"taxonomicEffort\"\n            label=\"Taxonomic Effort\"\n            value={values.taxonomicEffort}\n            onChange={makeFieldChangeHandler('taxonomicEffort')}\n            readOnly={!isEditing}\n            error={errors?.taxonomicEffort}\n            options={taxonomicEffortOptions}\n            isClearable\n          />\n          <TextField\n            gridArea=\"platform\"\n            value={values.platform}\n            onChange={makeFieldChangeHandler('platform')}\n            label=\"Platform\"\n            readOnly={!isEditing}\n            error={errors?.platform}\n            maxLength={255}\n          />\n          <PredictorsField\n            gridArea=\"predictorIds\"\n            label=\"Predictors\"\n            value={values.predictorIds}\n            onChange={makeFieldChangeHandler('predictorIds')}\n            readOnly={!isEditing}\n            error={errors?.predictorIds}\n          />\n          <MetricsField\n            gridArea=\"metricIds\"\n            label=\"Metrics\"\n            value={values.metricIds}\n            onChange={makeFieldChangeHandler('metricIds')}\n            readOnly={!isEditing}\n            error={errors?.metricIds}\n          />\n          <TextField\n            gridArea=\"description\"\n            value={values.description}\n            onChange={makeFieldChangeHandler('description')}\n            label=\"Description\"\n            readOnly={!isEditing}\n            error={errors?.description}\n            multiline\n            minRows={2}\n          />\n          <TextField\n            gridArea=\"extentDescription\"\n            value={values.extentDescription}\n            onChange={makeFieldChangeHandler('extentDescription')}\n            label=\"Extent Description\"\n            readOnly={!isEditing}\n            error={errors?.extentDescription}\n            multiline\n            minRows={2}\n          />\n        </div>\n      </div>\n      <ConfirmationDialog\n        title=\"Confirm Delete Model\"\n        isOpen={isConfirmDeleteOpen}\n        onClose={() => {\n          setIsConfirmDeleteOpen(false)\n        }}\n        onConfirm={handleDelete}\n      >\n        Are you sure you want to delete this model?\n      </ConfirmationDialog>\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n    </>\n  )\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectModelById, selectNull } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { ModelDetail as Component } from './ModelDetail'\nimport { Fallback } from './Fallback'\n\nexport type ModelDetailProps =\n  | {\n      modelId: string | number\n      isNew?: never\n    }\n  | {\n      modelId?: never\n      isNew: true // unconsumed; used to positively differentiate modes\n    }\n\nexport const ModelDetail = withSuspense(({ modelId }: ModelDetailProps): JSX.Element => {\n  const model = useRecoilValue(modelId ? selectModelById(Number(modelId)) : selectNull)\n\n  if (modelId && !model) return <h2>Model {modelId} not found.</h2>\n\n  return <Component model={model} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const modelsColumnDefs = [\n  columnDef.linkColumn({\n    headerName: 'Model ID',\n    field: 'title',\n    width: 120,\n  }),\n  columnDef.textColumn({\n    field: 'abbreviation',\n    flex: 1,\n  }),\n  columnDef.textColumn({\n    field: 'name',\n    flex: 2,\n  }),\n  columnDef.textColumn({\n    headerName: 'Type',\n    field: 'typeName',\n    flex: 1,\n  }),\n  columnDef.textColumn({\n    field: 'translationName',\n    flex: 1,\n  }),\n  columnDef.numberColumn({\n    field: 'fixedCount',\n    width: 140,\n  }),\n  columnDef.booleanColumn({\n    headerName: 'Active',\n    field: 'isActive',\n    valueLabels: ['No', 'Yes'],\n    width: 100,\n  }),\n  columnDef.numberColumn({\n    field: 'predictorCount',\n    width: 140,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\n\nimport { selectModels, selectMyUser } from '../../data/selectors'\nimport { DataGrid, renderers, DataGridRecordCount } from '../DataGrid'\nimport { Model } from '../../types'\nimport { withSuspense } from '../withSuspense'\nimport { modelsColumnDefs } from './columnDefs'\nimport { Filter, FilterChips } from '../Filters'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\nimport { useNavigate } from '../AppRouter'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport { Fallback } from './Fallback'\n\nexport interface ModelRow extends Model {\n  title: {\n    label: string\n    onClick: () => void\n    disabled?: boolean\n  }\n}\n\nconst textFilterState = atom({\n  key: 'ModelsListing/textFilterState',\n  default: '',\n})\n\nexport const ModelsListing = withSuspense(\n  () => {\n    const navigate = useNavigate()\n    const user = useRecoilValue(selectMyUser)\n    const models = useRecoilValue(selectModels)\n\n    // STATE AND REFS\n\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n      useRecoilState(textFilterState)\n    )\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<Model>[] = []\n\n      if (textFilterDebounced) {\n        result.push({\n          id: 'text',\n          label: `Name/Abbreviation contains \"${textFilterDebounced}\"`,\n          filterFn: ({ name, abbreviation }) =>\n            name.toLowerCase().includes(textFilterDebounced.toLowerCase()) ||\n            abbreviation.toLowerCase().includes(textFilterDebounced.toLowerCase()),\n          onDelete: clearTextFilter,\n        })\n      }\n\n      return result\n    }, [textFilterDebounced])\n\n    const rows = useMemo<ModelRow[]>(() => {\n      const filtered = filters.reduce<Model[]>((acc, { filterFn }) => acc.filter(filterFn), models)\n      return filtered.map((model) => ({\n        ...model,\n        title: {\n          label: String(model.id),\n          onClick: () => {\n            navigate.modelDetail({ modelId: model.id })\n          },\n        },\n      }))\n    }, [filters])\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', gap: '0.5em' }}>\n          <TextFilterField value={textFilter} onChange={setTextFilter} label=\"Model Name or Abbreviation\" />\n          {user.hasPermission(NAMCResource.models, GrantAction.createAny) && (\n            <div css={{ marginLeft: 'auto' }}>\n              <MuiButton\n                variant=\"outlined\"\n                onClick={() => {\n                  navigate.modelCreate()\n                }}\n              >\n                Create New Model\n              </MuiButton>\n            </div>\n          )}\n        </div>\n        <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n          <FilterChips filters={filters} joinLabel=\"and\" />\n          <DataGridRecordCount total={models.length} visible={rows.length} descriptor=\"model\" />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<ModelRow> rows={rows} columnDefs={modelsColumnDefs} frameworkComponents={renderers} />\n        </div>\n      </div>\n    )\n  },\n  () => <Fallback />\n)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const organizationsColumnDefs = [\n  columnDef.linkColumn({\n    headerName: 'Organization Name',\n    field: 'title',\n    flex: 1,\n    minWidth: 140,\n  }),\n  columnDef.textColumn({\n    headerName: 'Organization ID',\n    field: 'id',\n    width: 140,\n  }),\n  columnDef.textColumn({\n    headerName: 'Parent Organization Name',\n    field: 'parentName',\n    flex: 1,\n    minWidth: 140,\n  }),\n  columnDef.textColumn({\n    field: 'city',\n    width: 150,\n  }),\n  columnDef.filterableTextColumn({\n    headerName: 'State',\n    field: 'filterableUsState',\n    width: 160,\n    filterTooltip: 'Filter by this state',\n  }),\n  columnDef.textColumn({\n    field: 'type',\n    width: 150,\n  }),\n  columnDef.textColumn({\n    field: 'phone',\n    width: 150,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { atom, selector, useRecoilState, useRecoilValue } from 'recoil'\n\nimport { selectOrganizations, selectUsStates } from '../../data/selectors'\nimport { DataGrid, renderers, DataGridRecordCount } from '../DataGrid'\nimport { Organization } from '../../types'\nimport { withSuspense } from '../withSuspense'\nimport { organizationsColumnDefs } from './columnDefs'\nimport { Filter, FilterChips } from '../Filters'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\nimport { noop } from 'lodash'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { Fallback } from './Fallback'\n\nexport interface OrganizationRow extends Organization {\n  title: {\n    label: string\n    onClick: () => void\n    disabled: boolean\n  }\n  parentName: string\n  filterableUsState: {\n    label: string\n    onFilter: () => void\n    disabled: boolean\n  }\n}\n\nconst ANY_US_STATE = 0\n\nconst selectUsStateOptions = selector({\n  key: 'OrganizationsListing/selectUsStateOptions',\n  get: async ({ get }) => {\n    const usStates = get(selectUsStates)\n    return [{ value: ANY_US_STATE, label: 'Any' }, ...usStates.map(({ id: value, name: label }) => ({ value, label }))]\n  },\n})\n\nconst usStateFilterIdAtom = atom<number>({\n  key: 'OrganizationsListing/usStateFilterIdAtom',\n  default: ANY_US_STATE,\n})\n\nconst textFilterAtom = atom({\n  key: 'OrganizationsListing/textFilterState',\n  default: '',\n})\n\nexport const OrganizationsListing = withSuspense(\n  () => {\n    const organizations = useRecoilValue(selectOrganizations)\n    const usStateOptions = useRecoilValue(selectUsStateOptions)\n\n    // STATE AND REFS\n\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n      useRecoilState(textFilterAtom)\n    )\n    const [usStateIdFilter, setUsStateIdFilter] = useRecoilState(usStateFilterIdAtom)\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<OrganizationRow>[] = []\n\n      if (usStateIdFilter !== ANY_US_STATE) {\n        const usStateAbbreviation = usStateOptions.find(({ value }) => value === usStateIdFilter)?.label ?? '?'\n        result.push({\n          id: 'state',\n          label: `State: ${usStateAbbreviation}`,\n          filterFn: ({ usStateId }) => usStateId === usStateIdFilter,\n          onDelete: () => {\n            setUsStateIdFilter(ANY_US_STATE)\n          },\n        })\n      }\n\n      if (textFilterDebounced) {\n        const textFilterDebouncedLowercase = textFilterDebounced.toLowerCase()\n        if (textFilterDebounced.match(/^\\d+$/)) {\n          const targetBoxId = Number(textFilterDebounced)\n          result.push({\n            id: 'text',\n            label: `Organization ${textFilterDebounced}`,\n            filterFn: (box) => box.id === targetBoxId,\n            onDelete: clearTextFilter,\n          })\n        } else {\n          result.push({\n            id: 'text',\n            label: `Organization/Parent Name or City contains \"${textFilterDebounced}\"`,\n            filterFn: ({ name, parentName, city }) =>\n              name.toLowerCase().includes(textFilterDebouncedLowercase) ||\n              parentName.toLowerCase().includes(textFilterDebouncedLowercase) ||\n              city.toLowerCase().includes(textFilterDebouncedLowercase),\n            onDelete: clearTextFilter,\n          })\n        }\n      }\n\n      return result\n    }, [usStateIdFilter, textFilterDebounced])\n\n    const unfilteredRows = useMemo<OrganizationRow[]>(() => {\n      return organizations.map((organization) => {\n        return {\n          ...organization,\n          title: {\n            label: organization.name,\n            onClick: noop,\n            disabled: true,\n          },\n          parentName: organizations.find(({ id }) => id === organization.parentId)?.name || '',\n          filterableUsState: {\n            label: organization.usState,\n            onFilter: () => {\n              setUsStateIdFilter(organization.usStateId ?? ANY_US_STATE)\n            },\n            disabled: organization.usStateId === usStateIdFilter || !organization.usStateId,\n          },\n        }\n      })\n    }, [organizations, filters])\n\n    const rows = useMemo(\n      () => filters.reduce((acc, { filterFn }) => acc.filter(filterFn), unfilteredRows),\n      [unfilteredRows, filters]\n    )\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', gap: '0.5em' }}>\n          <AutocompleteField\n            value={usStateIdFilter}\n            onChange={(value) => setUsStateIdFilter(Number(value))}\n            options={usStateOptions}\n            label=\"State\"\n            css={{ width: '10em' }}\n          />\n          <TextFilterField value={textFilter} onChange={setTextFilter} label=\"Organization/Parent Name or City\" />\n        </div>\n        <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n          <FilterChips filters={filters} joinLabel=\"and\" />\n          <DataGridRecordCount total={organizations.length} visible={rows.length} descriptor=\"organization\" />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<OrganizationRow> rows={rows} columnDefs={organizationsColumnDefs} frameworkComponents={renderers} />\n        </div>\n      </div>\n    )\n  },\n  () => <Fallback />\n)\n","import { ColDef } from 'ag-grid-community'\n\nimport { columnDef } from '../DataGrid'\n\nexport const pendingBoxColumnDefs = [\n  columnDef.numberColumn({\n    headerName: 'Sample #',\n    cellRenderer: 'SampleIndexRenderer',\n    field: 'isSelected', // to re-render on isSelected (sampleIndex is stable)\n    width: 100,\n  }),\n  columnDef.textColumn({\n    headerName: 'Customer Site Code',\n    field: 'customerSiteCode',\n    flex: 1,\n  }),\n  columnDef.textColumn({\n    headerName: 'Matched Site',\n    field: 'siteName',\n    flex: 1,\n  }),\n  {\n    colId: 'actions',\n    width: 80,\n    cellRenderer: 'ActionsRenderer',\n    sortable: false,\n    pinned: 'right',\n  },\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiIconButton from '@mui/material/IconButton'\nimport CloseIcon from '@mui/icons-material/Close'\n\nimport { PinSvg } from '../SitesMap'\nimport { ReviewableSample, SAMPLE_PIN_COLOR } from './PendingBoxReview'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { UsStateAtPointField } from '../UsStateAtPointField'\n\nexport interface SampleDetailPanelProps {\n  onClose: () => void\n  sample: ReviewableSample\n}\n\nexport const SampleDetailPanel = ({ sample, onClose }: SampleDetailPanelProps): JSX.Element => {\n  return (\n    <div css={{ padding: '0.5em' }}>\n      <div css={{ display: 'flex', alignItems: 'center', paddingLeft: '10px' }}>\n        <div\n          css={{\n            width: 20,\n            marginRight: '0.5em',\n          }}\n        >\n          <PinSvg color={SAMPLE_PIN_COLOR} largeDot />\n        </div>\n        <div css={{ fontWeight: 'bold', fontSize: '120%', flex: 1, wordWrap: 'break-word', overflow: 'hidden' }}>\n          <div>{sample.customerSiteCode}</div>\n        </div>\n        <div css={{ marginLeft: 'auto' }}>\n          <MuiIconButton onClick={onClose}>\n            <CloseIcon />\n          </MuiIconButton>\n        </div>\n      </div>\n      <div\n        css={{\n          marginTop: '1em',\n          display: 'grid',\n          gridTemplateColumns: '1fr 1fr',\n          gridTemplateRows: `\n                  auto\n                  auto\n                  1em\n                  auto\n                  auto\n                `,\n          gap: '0.5em',\n          gridTemplateAreas: `\n                  \"usState            sampleIndex\"\n                  \"latitude           longitude\"\n                  \".                  .\"\n                  \"habitat            ecosystem\"\n                  \"waterbodyName      waterbodyType\"\n                `,\n        }}\n      >\n        <UsStateAtPointField gridArea=\"usState\" label=\"US State\" point={sample} />\n        <ReadOnlyField gridArea=\"sampleIndex\" label=\"Sample #\" value={sample.sampleIndex} />\n        <ReadOnlyField gridArea=\"latitude\" label=\"Latitude\" value={sample.latitude} />\n        <ReadOnlyField gridArea=\"longitude\" label=\"Longitude\" value={sample.longitude} />\n        <ReadOnlyField gridArea=\"habitat\" label=\"Habitat\" value={sample.habitat} />\n        <ReadOnlyField gridArea=\"ecosystem\" label=\"Ecosystem\" value={sample.ecosystem} />\n        <ReadOnlyField gridArea=\"waterbodyName\" label=\"Waterbody\" value={sample.waterbodyName} />\n        <ReadOnlyField gridArea=\"waterbodyType\" label=\"Waterbody Type\" value={sample.waterbodyType} />\n      </div>\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { Layer, Source } from 'react-map-gl'\n\nimport { Point } from '../../types'\nimport { SITE_PIN_COLOR } from '../SitesMap'\n\nexport interface MatchedSiteLineProps {\n  from: Point\n  to: Point\n}\n\nexport const MatchedSiteLine = ({ from, to }: MatchedSiteLineProps): JSX.Element => {\n  return (\n    <>\n      <Source\n        id=\"MatchedSiteLine\"\n        type=\"geojson\"\n        data={{\n          type: 'Feature',\n          properties: {},\n          geometry: {\n            type: 'LineString',\n            coordinates: [\n              [from.longitude, from.latitude],\n              [to.longitude, to.latitude],\n            ],\n          },\n        }}\n      />\n      <Layer\n        type=\"line\"\n        source=\"MatchedSiteLine\"\n        layout={{\n          'line-join': 'round',\n          'line-cap': 'round',\n        }}\n        paint={{\n          'line-color': SITE_PIN_COLOR,\n          'line-width': 2,\n          'line-dasharray': [2, 2],\n        }}\n      />\n    </>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { ICellRendererParams } from 'ag-grid-community'\nimport { ReviewableSample, SAMPLE_PIN_COLOR } from './PendingBoxReview'\nimport MuiIconButton from '@mui/material/IconButton'\nimport EditIcon from '@mui/icons-material/Edit'\n\nimport { withTooltip } from '../withTooltip'\nimport { PinSvg } from '../SitesMap'\n\ninterface CellRendererParams<T> extends ICellRendererParams {\n  data: T\n}\n\nexport const SampleIndexRenderer = ({ data }: CellRendererParams<ReviewableSample>): React.ReactNode => {\n  const { sampleIndex, isSelected } = data\n  return (\n    <div css={{ display: 'flex', alignItems: 'center' }}>\n      {isSelected && (\n        <div css={{ height: 30, width: 15 }}>\n          <PinSvg color={SAMPLE_PIN_COLOR} largeDot />\n        </div>\n      )}\n      <div css={{ marginLeft: 'auto' }}>{sampleIndex}</div>\n    </div>\n  )\n}\n\nexport const ActionsRenderer = ({ data }: CellRendererParams<ReviewableSample>): React.ReactNode => {\n  const { onEdit } = data\n  return (\n    <div css={{ display: 'flex', alignItems: 'center', height: '100%' }}>\n      <MuiIconButton onClick={onEdit}>{withTooltip(<EditIcon />, 'Edit sample match')}</MuiIconButton>\n    </div>\n  )\n}\n","import { ReviewableSample } from './PendingBoxReview'\nimport { getDistance, getSortedSitesDistances } from '../../lib/map'\nimport { Site } from '../../types'\nimport { Lookup } from '@namcbugdb/common'\n\nexport const getNextNewSiteId = (newSites: Site[]): number => Math.min(0, ...newSites.map(({ id }) => id)) - 1\n\nexport const isNewSite = (site: { id: number } | undefined): boolean => !!site && site.id < 0\n\ntype MatchStatus =\n  | 'matched' // already matched\n  | 'eligible' // can be matched with single eligible site\n  | 'ambiguous' // can't be matched due to too many eligible sites\n  | 'ineligible' // can't be matched due to no available sites\n\nexport const getAutoMatchStatus = ({\n  reviewableSamples,\n  allSitesNormalized,\n}: {\n  reviewableSamples: ReviewableSample[]\n  allSitesNormalized: Site[]\n}): {\n  sampleIndex: number\n  status: MatchStatus\n\n  databaseSiteId: number | null\n  suppressed?: boolean\n}[] => {\n  return reviewableSamples.map((sample) => {\n    const { sampleIndex, suppressAutoMatch: suppressed } = sample\n    let status: MatchStatus = 'ineligible'\n    let databaseSiteId: number | null = null\n\n    if (sample.databaseSiteId) {\n      status = 'matched'\n      databaseSiteId = sample.databaseSiteId\n    } else {\n      const siteWithMatchingName = allSitesNormalized.find(({ name }) => name === sample.customerSiteCode.toLowerCase())\n      const suitableNamedSiteId =\n        siteWithMatchingName && getDistance(siteWithMatchingName, sample) < 0.01 && siteWithMatchingName.id // has one < 10m\n\n      const closeSitesWithDistances = getSortedSitesDistances(allSitesNormalized, sample, 0.01) // close sites (prefiltered for coordinate diff < 0.01 degrees)\n      const closeSiteIds = closeSitesWithDistances\n        .filter(({ distance }) => distance < 0.005)\n        .map(({ site: { id } }) => id) // < 5m\n\n      if (suitableNamedSiteId) {\n        if (closeSiteIds.length === 0 || closeSiteIds[0] === suitableNamedSiteId) {\n          status = 'eligible'\n          databaseSiteId = suitableNamedSiteId\n        } else {\n          status = 'ambiguous'\n        }\n      } else if (closeSiteIds.length === 1) {\n        status = 'eligible'\n        databaseSiteId = closeSiteIds[0]\n      } else if (closeSiteIds.length > 1) {\n        status = 'ambiguous'\n      }\n    }\n\n    return { sampleIndex, status, databaseSiteId, suppressed }\n  })\n}\n\nexport const makeSiteFromSample = ({\n  fromSample,\n  newSiteId,\n  allSitesNormalized,\n  waterbodyTypes,\n}: {\n  fromSample: ReviewableSample\n  newSiteId: number\n  allSitesNormalized: Site[]\n  waterbodyTypes: Lookup[]\n}): Site => {\n  const name = (() => {\n    let candidateName = ''\n    let copyNumber = 0\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      candidateName = `${fromSample.customerSiteCode}${copyNumber ? ` (${copyNumber})` : ''}`\n      const candidateNameLowercase = candidateName.toLowerCase()\n      if (!allSitesNormalized.find(({ name }) => name === candidateNameLowercase)) break\n      copyNumber++\n    }\n\n    return candidateName\n  })()\n\n  return {\n    id: newSiteId,\n    name,\n    latitude: fromSample.latitude,\n    longitude: fromSample.longitude,\n    waterbodyName: fromSample.waterbodyName,\n    waterbodyTypeId: (waterbodyTypes.find(({ name }) => name === fromSample.waterbodyType) ?? { id: null }).id,\n    waterbodyCode: '',\n    description: '',\n    isReference: false,\n  }\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useMemo, useState } from 'react'\nimport * as turf from '@turf/turf'\nimport MuiButton from '@mui/material/Button'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\nimport MuiDialogTitle from '@mui/material/DialogTitle'\nimport { noop, uniq } from 'lodash'\nimport { useRecoilValue } from 'recoil'\n// import log from 'loglevel'\n\nimport { Point, Site, Submission } from '../../types'\nimport { DataGrid, DataGridRecordCount } from '../DataGrid'\nimport { pendingBoxColumnDefs } from './columnDefs'\nimport {\n  allSitesAtom,\n  allSitesStatusAtom,\n  FETCH_ALL_SITES_STATUS,\n  selectWaterbodyTypes,\n  sparseSitesDetailAtom,\n  useFetchAllSitesOptimized,\n  useFetchSiteDetailBySiteIdOptimized,\n  useDeferredInvalidate,\n} from '../../data/selectors'\nimport { SitesMap, SitesMapSidePanel, useSitesMapController, PinMarker } from '../SitesMap'\nimport { TextField } from '../TextField'\nimport { useTextFilterField } from '../TextFilterField'\nimport { Filter, FilterChips } from '../Filters'\nimport { SiteDetailPanel, SITE_DETAIL_PANEL_TRANSITION_MS } from '../SiteDetailPanel'\nimport { SampleDetailPanel } from './SampleDetailPanel'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { EditSiteDialog } from '../EditSiteDialog'\nimport { MatchedSiteLine } from './MatchedSiteLine'\nimport { SelectField } from '../SelectField'\nimport { Title } from '../Title'\nimport { formatUtcDateTimeToAppDate, pluralize } from '../../lib/formats'\nimport { useNotifications } from '../AppNotifications'\nimport { finalizePendingBox, updateSampleSubmission } from '../../data/calls'\nimport { useApi } from '../../data/api'\nimport { appVersion } from '../../lib/environment'\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport * as renderers from './renderers'\nimport { CheckboxField } from '../CheckboxField'\nimport { LinearProgress } from '../LinearProgress'\nimport { getSortedSitesDistances } from '../../lib/map'\nimport { getAutoMatchStatus, getNextNewSiteId, isNewSite, makeSiteFromSample } from './util'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\n\nexport const SAMPLE_PIN_COLOR = '#0055dd'\nconst SUGGESTED_FILTER_ID = 'suggested'\n\nexport interface PendingBoxReviewProps {\n  submission: Submission\n}\n\nexport interface ReviewableSample {\n  sampleIndex: number\n  isSelected: boolean\n  customerSiteCode: string\n  latitude: number\n  longitude: number\n  onEdit: () => void\n  siteName: string\n  databaseSiteId?: number\n  suppressAutoMatch: boolean\n  habitat: string\n  ecosystem: string\n  waterbodyName: string\n  waterbodyType: string\n}\n\ninterface AndFilter<T> extends Filter<T> {\n  filterAllFn: (rows: T[]) => T[]\n}\n\nconst sampleStatusOptions = [\n  { value: 'any', label: 'Any' },\n  { value: 'unmatched', label: 'Unmatched' },\n  { value: 'matched', label: 'Matched' },\n]\n\nexport const PendingBoxReview = ({ submission: submissionProp }: PendingBoxReviewProps): JSX.Element => {\n  const api = useApi()\n  const notifications = useNotifications()\n  const deferredInvalidate = useDeferredInvalidate()\n  const navigate = useNavigate()\n\n  const allExistingSites = useRecoilValue(allSitesAtom)\n  const allExistingSitesStatus = useRecoilValue(allSitesStatusAtom)\n  const fetchSiteDetailBySiteIdOptimized = useFetchSiteDetailBySiteIdOptimized()\n  const waterbodyTypes = useRecoilValue(selectWaterbodyTypes)\n\n  // STATE\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [submission, setSubmission, updateSubmission] = useUpdatableState(\n    {\n      samples: submissionProp.samples,\n      newSites: submissionProp.newSites ?? [],\n      isDirty: false,\n    },\n    [submissionProp]\n  )\n  const { boxId, templateVersion, organizationName, createdDate } = submissionProp\n  const { samples, newSites, isDirty } = submission\n\n  const [selectedSampleIndex, setSelectedSampleIndex] = useState<number | undefined>(undefined)\n  const [textFilter, setTextFilter, textFilterDebounced, resetTextFilter] = useTextFilterField(useState(''))\n  const [suggestedSitesFilter, setSuggestedSitesFilter] = useState<AndFilter<Site> | null>(null)\n  const [selectedSiteId, setSelectedSiteId] = useState<number | undefined>(undefined)\n  const [sampleStatusFilter, setSampleStatusFilter] = useState<string>('any')\n  const [isEditingSite, setIsEditingSite] = useState<boolean>(false)\n  const [finalizing, setFinalizing] = useState<false | 'prompt' | 'finalizing'>(false)\n  const [canDragMarker, setCanDragMarker] = useState<boolean>(false)\n  const [isConfirmAutoCreateOpen, setIsConfirmAutoCreateOpen] = useState(false)\n\n  // SITES\n\n  const fetchAllExistingSitesOptimized = useFetchAllSitesOptimized()\n\n  useEffect(() => {\n    if (allExistingSitesStatus === FETCH_ALL_SITES_STATUS.unfetched) fetchAllExistingSitesOptimized()\n  }, [allExistingSitesStatus])\n\n  const allSites = useMemo(() => [...allExistingSites, ...newSites], [allExistingSites, newSites])\n\n  const isFetching = allExistingSitesStatus !== FETCH_ALL_SITES_STATUS.fetched\n  const allSitesNormalized = useMemo<Site[]>(\n    () => allSites.map(({ name, ...rest }) => ({ name: name.toLowerCase(), ...rest })),\n    [allSites]\n  )\n\n  // SAMPLES\n\n  const sampleFilters = useMemo(() => {\n    const result: Filter<ReviewableSample>[] = []\n\n    switch (sampleStatusFilter) {\n      case 'unmatched':\n        result.push({\n          id: 'matchStatus',\n          label: 'Unmatched',\n          filterFn: ({ databaseSiteId, sampleIndex }) => !databaseSiteId || sampleIndex === selectedSampleIndex,\n          onDelete: () => {\n            setSampleStatusFilter('any')\n          },\n        })\n        break\n      case 'matched':\n        result.push({\n          id: 'matchStatus',\n          label: 'Matched',\n          filterFn: ({ databaseSiteId, sampleIndex }) => !!databaseSiteId || sampleIndex === selectedSampleIndex,\n          onDelete: () => {\n            setSampleStatusFilter('any')\n          },\n        })\n    }\n\n    return result\n  }, [sampleStatusFilter, selectedSampleIndex])\n\n  const setSuggestedSitesFilterToSample = (sample: ReviewableSample) => {\n    const { sampleIndex, customerSiteCode } = sample\n    setSuggestedSitesFilter({\n      id: SUGGESTED_FILTER_ID,\n      label: `Suggested for Sample ${sampleIndex}`,\n      filterFn: () => true,\n      filterAllFn: (sites: Site[]) => {\n        const customerSiteCodeLowercase = customerSiteCode.toLowerCase()\n        const exactNameSite = sites.find(({ name }) => name.toLowerCase() === customerSiteCodeLowercase)\n        if (exactNameSite) return [exactNameSite]\n\n        const closeSitesDistances = getSortedSitesDistances(sites, sample)\n\n        const closest = closeSitesDistances[0]\n\n        const relativelyCloseDistance = Math.min(\n          Math.max(closest.distance * 3, 0.1), // greater of 3 x closest or 100m\n          5 // max-out at 5km\n        )\n\n        return closeSitesDistances.filter(({ distance }) => distance < relativelyCloseDistance).map(({ site }) => site)\n      },\n      onDelete: () => setSuggestedSitesFilter(null),\n    })\n  }\n\n  const reviewableSamples = useMemo<ReviewableSample[]>(\n    () =>\n      samples.map((submissionSample) => {\n        const {\n          sampleIndex,\n          siteId: customerSiteCode,\n          latitude,\n          longitude,\n          habitat,\n          ecosystem,\n          nhdType: waterbodyType,\n          waterbodyName,\n          databaseSiteId,\n          suppressAutoMatch,\n        } = submissionSample\n        if (typeof sampleIndex !== 'number' || sampleIndex === 0)\n          throw new Error('sampleIndex is not a number or is zero (not allowed).')\n\n        const matchedSite = databaseSiteId && allSites.find(({ id }) => id === databaseSiteId)\n\n        return {\n          isSelected: sampleIndex === selectedSampleIndex,\n          sampleIndex,\n          customerSiteCode: String(customerSiteCode),\n          latitude: Number(latitude),\n          longitude: Number(longitude),\n          databaseSiteId: databaseSiteId ? Number(databaseSiteId) : undefined,\n          suppressAutoMatch: !!suppressAutoMatch,\n          onEdit: () => {\n            setSelectedSampleIndex(sampleIndex)\n          },\n          siteName: matchedSite ? matchedSite.name : '',\n          habitat: habitat ? String(habitat) : '',\n          ecosystem: ecosystem ? String(ecosystem) : '',\n          waterbodyType: waterbodyType ? String(waterbodyType) : '',\n          waterbodyName: waterbodyName ? String(waterbodyName) : '',\n        }\n      }),\n    [allSites, samples, selectedSampleIndex]\n  )\n\n  const filteredSamples = useMemo(\n    () => sampleFilters.reduce<ReviewableSample[]>((acc, { filterFn }) => acc.filter(filterFn), reviewableSamples),\n    [sampleFilters, reviewableSamples]\n  )\n\n  // SELECTED SAMPLE\n\n  const selectedSample =\n    selectedSampleIndex && reviewableSamples.find(({ sampleIndex }) => sampleIndex === selectedSampleIndex)\n\n  useEffect(() => {\n    if (!selectedSample) {\n      setSuggestedSitesFilter(null)\n      return\n    }\n    setSelectedSiteId(selectedSample.databaseSiteId)\n    setSuggestedSitesFilterToSample(selectedSample)\n  }, [selectedSampleIndex])\n\n  // SELECTED & MATCHED SITE\n\n  const sparseSitesDetail = useRecoilValue(sparseSitesDetailAtom)\n\n  const selectedSite = useMemo(() => {\n    // get best selected site data\n    if (!selectedSiteId) return undefined\n    return sparseSitesDetail.find(({ id }) => id === selectedSiteId) || allSites.find(({ id }) => id === selectedSiteId)\n  }, [allSites, sparseSitesDetail, selectedSiteId])\n\n  const matchedSite =\n    selectedSample && selectedSample.databaseSiteId && allSites.find(({ id }) => id === selectedSample.databaseSiteId)\n\n  useEffect(() => {\n    if (!selectedSite || isNewSite(selectedSite)) return\n    fetchSiteDetailBySiteIdOptimized(selectedSiteId)\n  }, [selectedSiteId])\n\n  // SITE AUTO-MATCHING\n\n  useEffect(() => {\n    if (isFetching) return // still awaiting all sites\n\n    const autoMatchStatus = getAutoMatchStatus({ reviewableSamples, allSitesNormalized })\n    const eligibleAutoMatches = autoMatchStatus.filter(({ status, suppressed }) => status === 'eligible' && !suppressed)\n    const newMatchCount = eligibleAutoMatches.length\n\n    if (newMatchCount === 0) return\n\n    updateSubmission((draft) => {\n      eligibleAutoMatches.forEach(({ sampleIndex, databaseSiteId }) => {\n        const draftSample = draft.samples.find((sample) => sample.sampleIndex === sampleIndex)\n        if (!draftSample) throw new Error('Sample not found.')\n        draftSample.databaseSiteId = databaseSiteId\n      })\n      draft.isDirty = true\n    })\n    notifications.info(\n      `Auto-matched ${newMatchCount} ${pluralize(newMatchCount, 'sample')} with ${pluralize(newMatchCount, 'site')}`\n    )\n  }, [reviewableSamples, allSitesNormalized])\n\n  // SITES FILTERING\n\n  const siteFilters = useMemo(() => {\n    const result: AndFilter<Site>[] = []\n\n    if (suggestedSitesFilter) result.push(suggestedSitesFilter)\n\n    if (textFilterDebounced) {\n      result.push({\n        id: 'text',\n        label: `Name contains \"${textFilterDebounced}\"`,\n        filterFn: () => true,\n        filterAllFn: (sites: Site[]) =>\n          sites.filter(({ name }) => name.toLowerCase().includes(textFilterDebounced.toLowerCase())),\n        onDelete: resetTextFilter,\n      })\n    }\n\n    return result\n  }, [suggestedSitesFilter, textFilterDebounced])\n\n  const filteredSites = useMemo<Site[]>(() => {\n    if (siteFilters.length === 0) return allSites\n    const filtered = siteFilters.reduce<Site[]>((acc, filter) => uniq([...acc, ...filter.filterAllFn(allSites)]), [])\n    return matchedSite ? uniq([...filtered, matchedSite]) : filtered // ensure matched site always included\n  }, [allSites, siteFilters])\n\n  // MAP CONTROLLER, FITTING\n\n  const onSiteClick = (site: Site) => {\n    if (matchedSite && matchedSite.id !== site.id) {\n      notifications.info(\n        'Cannot select site: sample already has a confirmed match. (To match to this site, unmatch existing site first.)'\n      )\n      return\n    }\n    setSelectedSiteId(site.id)\n  }\n\n  const controller = useSitesMapController({ sites: filteredSites, onSiteClick })\n\n  useEffect(() => {\n    const { isViewportReady, centerSite, fitSites } = controller\n    if (siteFilters.length === 0) return // preserve viewed area when removing all filters\n    if (!isViewportReady) return // viewport not ready, don't fit yet (desired behaviour for all-sites initial load)\n    if (filteredSites.length === 0 && !selectedSample) return // nothing to fit\n\n    if (filteredSites.length === 0 && selectedSample) {\n      // center selected sample, zoom tighter than IDEAL_CLOSE_ZOOM\n      centerSite(selectedSample, { zoom: 14, suppressZoomOut: true })\n    } else if (filteredSites.length === 1 && !selectedSample) {\n      // center single site, don't over-zoom\n      centerSite(filteredSites[0])\n    } else {\n      const combinedPoints: Point[] = filteredSites\n      if (selectedSample) combinedPoints.push(selectedSample)\n      fitSites(combinedPoints) // fit all\n    }\n  }, [\n    siteFilters,\n    selectedSampleIndex, // do not use selectedSample so that site editing does not trigger effect\n  ])\n\n  // ACTIONS\n\n  const handleSave = async () => {\n    try {\n      await updateSampleSubmission(\n        api,\n        deferredInvalidate\n      )({\n        boxId,\n        data: {\n          templateVersion,\n          appVersion,\n          samples,\n          newSites,\n        },\n      })\n      updateSubmission((draft) => {\n        draft.isDirty = false\n      })\n    } catch (err) {\n      notifications.error(`Failed to save updated submission: ${err}`)\n    }\n  }\n\n  const handleFinalize = async () => {\n    try {\n      setFinalizing('finalizing')\n      await finalizePendingBox(api, deferredInvalidate)({ boxId })\n      navigate.boxDetail({ boxId })\n    } catch (err) {\n      setFinalizing('prompt')\n      notifications.error(`Failed to finalize box submission: ${err}`)\n    }\n  }\n\n  const handleMatch = () => {\n    updateSubmission((draft) => {\n      const draftSample = draft.samples.find(({ sampleIndex }) => sampleIndex === selectedSampleIndex)\n      if (!draftSample || !selectedSite) throw new Error('Sample or Site not found.')\n      draftSample.databaseSiteId = selectedSiteId\n      draft.isDirty = true\n    })\n  }\n\n  const handleUnmatch = () => {\n    updateSubmission((draft) => {\n      const draftSample = draft.samples.find(({ sampleIndex }) => sampleIndex === selectedSampleIndex)\n      if (!draftSample) throw new Error('Sample not found.')\n      draftSample.databaseSiteId = null\n      draftSample.suppressAutoMatch = true\n      draft.isDirty = true\n    })\n  }\n\n  const handleNewSiteCreate = () => {\n    const newSiteId = getNextNewSiteId(newSites)\n    const fromSample = reviewableSamples.find(({ sampleIndex }) => sampleIndex === selectedSampleIndex)\n\n    if (!fromSample) throw new Error('Sample not found.')\n    const newSite = makeSiteFromSample({\n      fromSample,\n      newSiteId,\n      allSitesNormalized,\n      waterbodyTypes,\n    })\n\n    updateSubmission((draft) => {\n      // update site\n      const draftSample = draft.samples.find(({ sampleIndex }) => sampleIndex === selectedSampleIndex)\n      if (!draftSample) throw new Error('Sample not found.')\n      draftSample.databaseSiteId = newSite.id\n\n      // add new site\n      draft.newSites.push(newSite)\n\n      draft.isDirty = true\n    })\n\n    setSelectedSiteId(newSiteId)\n  }\n\n  const handleAllRemainingSitesCreate = () => {\n    let newSiteId = Math.min(0, ...newSites.map(({ id }) => id)) - 1\n    const updatedAllSitesNormalized = [...allSitesNormalized]\n    let createdCount = 0\n\n    let autoMatchStatus = getAutoMatchStatus({\n      reviewableSamples,\n      allSitesNormalized,\n    })\n\n    updateSubmission((draft) => {\n      reviewableSamples.forEach((fromSample) => {\n        const { databaseSiteId, sampleIndex } = fromSample\n        if (databaseSiteId) return // already has match\n\n        const draftSample = draft.samples.find((sample) => sample.sampleIndex === sampleIndex)\n        if (!draftSample) throw new Error('Sample not found.')\n\n        draftSample.suppressAutoMatch = false // ensure sample prepared for auto-match\n\n        const sampleAutoMatchStatus = autoMatchStatus.find(\n          (autoMatchStatus) => autoMatchStatus.sampleIndex === sampleIndex\n        )\n        if (!sampleAutoMatchStatus) throw new Error('Could not determine sample auto-match status.')\n\n        if (sampleAutoMatchStatus.status !== 'ineligible') return // either already matched, will be matched, or has ambiguous matches\n\n        const newSite = makeSiteFromSample({\n          fromSample,\n          allSitesNormalized: updatedAllSitesNormalized,\n          waterbodyTypes,\n          newSiteId,\n        })\n\n        // refresh auto-match status\n        updatedAllSitesNormalized.push({ ...newSite, name: newSite.name.toLowerCase() })\n        autoMatchStatus = getAutoMatchStatus({\n          reviewableSamples,\n          allSitesNormalized: updatedAllSitesNormalized,\n        })\n\n        // decrement next site ID\n        newSiteId -= 1\n\n        // add new site\n        draft.newSites.push(newSite)\n        createdCount += 1\n      })\n\n      draft.isDirty = true\n    })\n\n    notifications.info(`Auto-created ${createdCount} ${pluralize(createdCount, 'site')}`)\n  }\n\n  const handleNewSiteEdit = () => {\n    setIsEditingSite(true)\n  }\n\n  const handleNewSiteDiscard = () => {\n    handleUnmatch()\n    updateSubmission((draft) => {\n      const index = draft.newSites.findIndex(({ id }) => id === selectedSiteId)\n      if (index === -1) throw new Error('New site not found.')\n      draft.newSites.splice(index, 1)\n      draft.isDirty = true\n    })\n  }\n\n  const handleNewSiteSave = async (updatedSite: Site) => {\n    updateSubmission((draft) => {\n      const index = draft.newSites.findIndex(({ id }) => id === updatedSite.id)\n      if (index === -1) throw new Error('New site not found.')\n      draft.newSites[index] = updatedSite\n      draft.isDirty = true\n    })\n    setIsEditingSite(false)\n  }\n\n  const handleNewSiteDragged = async ({ latitude, longitude }: Point) => {\n    updateSubmission((draft) => {\n      const site = draft.newSites.find(({ id }) => id === selectedSiteId)\n      if (!site) throw new Error('Site not found.')\n      site.latitude = latitude\n      site.longitude = longitude\n      draft.isDirty = true\n    })\n  }\n\n  useEffect(() => {\n    setCanDragMarker(false) // reset on selection change\n  }, [selectedSiteId])\n\n  // RENDER\n\n  const matchLabel = useMemo(() => {\n    if (!matchedSite) return <strong>Unmatched</strong>\n    return isNewSite(matchedSite) ? <strong>Matched New Site</strong> : <strong>Matched Site</strong>\n  }, [matchedSite])\n\n  const distanceLabel = useMemo(() => {\n    if (!selectedSample || !selectedSite) return ''\n    const distance = turf.distance(\n      turf.point([selectedSample.longitude, selectedSample.latitude]),\n      turf.point([selectedSite.longitude, selectedSite.latitude])\n    )\n    if (distance >= 1) return <strong>{distance.toFixed(1)} km</strong>\n    return <strong>{(distance * 1000).toFixed(2)} m</strong>\n  }, [selectedSample, selectedSite])\n\n  const selectedSiteAddedSamplesCount =\n    (selectedSite && reviewableSamples.filter(({ databaseSiteId }) => databaseSiteId === selectedSiteId).length) ?? 0\n\n  const canFinalize = !isDirty && samples.every((sample) => sample.databaseSiteId)\n\n  return (\n    <>\n      <div\n        css={{\n          height: '100%',\n          display: 'flex',\n          flexDirection: 'column',\n        }}\n      >\n        <div css={{ display: 'flex', gap: '3rem' }}>\n          <Title>Box {boxId} Submission Review</Title>\n          <ReadOnlyField label=\"Customer\" value={organizationName} />\n          <ReadOnlyField label=\"Received Date\" value={formatUtcDateTimeToAppDate(createdDate)} />\n          <div css={{ marginLeft: 'auto', display: 'flex', gap: '0.5rem' }}>\n            <MuiButton variant=\"outlined\" onClick={handleSave} disabled={!isDirty}>\n              Save Review Progress\n            </MuiButton>\n            <MuiButton variant=\"outlined\" onClick={() => setFinalizing('prompt')} disabled={!canFinalize}>\n              Finalize Review\n            </MuiButton>\n          </div>\n        </div>\n        <div css={{ flex: 1, display: 'flex', paddingTop: '1rem' }}>\n          <div\n            css={{\n              minWidth: 500,\n              flex: 0.4,\n              padding: '0 2rem 0 0',\n              display: 'flex',\n              flexDirection: 'column',\n            }}\n          >\n            <div css={{ display: 'flex', gap: '0.5em' }}>\n              <SelectField\n                value={sampleStatusFilter}\n                onChange={(value) => setSampleStatusFilter(String(value))}\n                options={sampleStatusOptions}\n                label=\"Match Status\"\n              />\n              <div css={{ marginLeft: 'auto' }}>\n                <MuiButton\n                  onClick={() => {\n                    setIsConfirmAutoCreateOpen(true)\n                  }}\n                  variant=\"outlined\"\n                  disabled={isFetching || reviewableSamples.every(({ databaseSiteId }) => databaseSiteId)}\n                >\n                  Create Remaining Sites\n                </MuiButton>\n              </div>\n            </div>\n            <div css={{ minHeight: '2em', margin: '0.75em 0', display: 'flex' }}>\n              <FilterChips filters={sampleFilters} joinLabel=\"or\" />\n              <DataGridRecordCount\n                total={reviewableSamples.length}\n                visible={filteredSamples.length}\n                descriptor=\"sample\"\n              />\n            </div>\n            {isFetching ? (\n              <MuiSkeleton variant=\"rectangular\" height={600} />\n            ) : (\n              <div css={{ flex: 1 }}>\n                <DataGrid\n                  rowIdProperty=\"sampleIndex\"\n                  rows={filteredSamples}\n                  columnDefs={pendingBoxColumnDefs}\n                  frameworkComponents={renderers}\n                />\n              </div>\n            )}\n          </div>\n          <div css={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\n            <div css={{ display: 'flex', gap: '0.5em' }}>\n              <MuiButton\n                onClick={() => {\n                  if (!selectedSample) return\n                  setSuggestedSitesFilterToSample(selectedSample)\n                }}\n                variant=\"outlined\"\n                disabled={!selectedSample || !!siteFilters.find(({ id }) => id === SUGGESTED_FILTER_ID)}\n              >\n                Suggested\n              </MuiButton>\n              <TextField\n                value={textFilter}\n                onChange={(value) => setTextFilter(value)}\n                label=\"Site Name\"\n                css={{ width: '20em' }}\n              />\n            </div>\n            <div css={{ minHeight: '2em', margin: '0.75em 0', display: 'flex' }}>\n              <FilterChips filters={siteFilters} joinLabel=\"or\" />\n              <DataGridRecordCount\n                total={allSites.length}\n                visible={filteredSites.length}\n                descriptor=\"site\"\n                isLoading={isFetching}\n              />\n            </div>\n            <div css={{ flex: 1, display: 'flex' }}>\n              <div css={{ flex: 1, position: 'relative' }}>\n                <SitesMap controller={controller}>\n                  {isFetching && (\n                    <LinearProgress\n                      delayMs={500}\n                      css={{ position: 'absolute', width: '100%', height: '5px', opacity: 0.75, zIndex: 100 }}\n                    />\n                  )}\n                  {selectedSample && <PinMarker site={selectedSample} color={SAMPLE_PIN_COLOR} largeDot />}\n                  {selectedSite && (\n                    <PinMarker site={selectedSite} onDragEnd={canDragMarker ? handleNewSiteDragged : undefined} />\n                  )}\n                  {matchedSite && <MatchedSiteLine from={selectedSample} to={matchedSite} />}\n                </SitesMap>\n              </div>\n              <SitesMapSidePanel\n                isOpen={!!selectedSample || !!selectedSite}\n                transitionMs={SITE_DETAIL_PANEL_TRANSITION_MS}\n                css={{\n                  display: 'flex',\n                  flexDirection: 'column',\n                  '@media (max-height: 1150px)': { fontSize: '75%' },\n                }}\n              >\n                <div css={{ display: 'flex', flexDirection: 'column', minHeight: '200px' }}>\n                  {selectedSample ? (\n                    <>\n                      <div css={{ flex: 1 }}>\n                        <SampleDetailPanel\n                          sample={selectedSample}\n                          onClose={() => {\n                            setSelectedSampleIndex(undefined)\n                            setSelectedSiteId(undefined)\n                          }}\n                        />\n                      </div>\n                      <div css={{ borderBottom: '1px solid lightgrey', height: '1px' }} />\n                      <div\n                        css={{\n                          padding: '1em 0.5em',\n                        }}\n                      >\n                        <div\n                          css={{\n                            display: 'grid',\n                            gridTemplateColumns: '1fr 1fr',\n                          }}\n                        >\n                          <ReadOnlyField label=\"Match Status\" value={matchLabel} />\n                          <ReadOnlyField label=\"Distance\" value={distanceLabel} />\n                        </div>\n                        <div css={{ display: 'grid', gap: '0.5em', gridTemplateColumns: '1fr 1fr' }}>\n                          {!selectedSite ? (\n                            <MuiButton variant=\"contained\" onClick={() => handleNewSiteCreate()}>\n                              New Site\n                            </MuiButton>\n                          ) : (\n                            <MuiButton\n                              variant=\"contained\"\n                              disabled={!selectedSite || !!selectedSample.databaseSiteId}\n                              onClick={handleMatch}\n                            >\n                              Match Site\n                            </MuiButton>\n                          )}\n                          {isNewSite(selectedSite) && selectedSiteAddedSamplesCount === 1 ? (\n                            <MuiButton\n                              variant=\"outlined\"\n                              disabled={!selectedSample.databaseSiteId}\n                              onClick={handleNewSiteDiscard}\n                            >\n                              Discard New Site\n                            </MuiButton>\n                          ) : (\n                            <MuiButton\n                              variant=\"outlined\"\n                              disabled={!selectedSample || !selectedSample.databaseSiteId}\n                              onClick={handleUnmatch}\n                            >\n                              Unmatch Site\n                            </MuiButton>\n                          )}\n                        </div>\n                      </div>\n                    </>\n                  ) : (\n                    <div css={{ padding: '1em' }}>No sample selected.</div>\n                  )}\n                </div>\n                <div css={{ borderBottom: '1px solid lightgrey', height: '1px' }} />\n                <div css={{ flex: 1 }}>\n                  {selectedSite ? (\n                    <SiteDetailPanel\n                      site={selectedSite}\n                      addSampleCount={selectedSiteAddedSamplesCount}\n                      onClose={\n                        matchedSite\n                          ? undefined\n                          : () => {\n                              setSelectedSiteId(undefined)\n                            }\n                      }\n                    >\n                      {isNewSite(selectedSite) && (\n                        <div css={{ marginLeft: '10px', display: 'flex', gap: '0.5em' }}>\n                          <MuiButton onClick={handleNewSiteEdit} variant=\"outlined\">\n                            Edit Site\n                          </MuiButton>\n                          <CheckboxField\n                            label=\"Enable draggable pin\"\n                            value={canDragMarker}\n                            onChange={setCanDragMarker}\n                          />\n                        </div>\n                      )}\n                    </SiteDetailPanel>\n                  ) : (\n                    <div css={{ padding: '1em' }}>No site selected.</div>\n                  )}\n                </div>\n              </SitesMapSidePanel>\n            </div>\n          </div>\n        </div>\n      </div>\n      {selectedSite && (\n        <EditSiteDialog\n          isOpen={isEditingSite}\n          site={selectedSite}\n          allSitesNormalized={allSitesNormalized}\n          onCancel={() => setIsEditingSite(false)}\n          onSave={handleNewSiteSave}\n        />\n      )}\n      <MuiDialog open={!!finalizing} onClose={finalizing === 'finalizing' ? noop : () => setFinalizing(false)}>\n        <MuiDialogTitle>Confirm Finalize Review</MuiDialogTitle>\n        <MuiDialogContent>\n          <ul>\n            <li>\n              {reviewableSamples.length} sample {pluralize(reviewableSamples.length, 'record')} will be created\n            </li>\n            <li>\n              {newSites.length} {pluralize(newSites.length, 'site')} will be created\n            </li>\n            <li>\n              Box will be set to <em>Waiting</em>\n            </li>\n          </ul>\n        </MuiDialogContent>\n        <MuiDialogActions>\n          <MuiButton onClick={() => setFinalizing(false)} disabled={finalizing === 'finalizing'}>\n            Cancel\n          </MuiButton>\n          <MuiButton onClick={handleFinalize} disabled={finalizing === 'finalizing'}>\n            Finalize\n          </MuiButton>\n        </MuiDialogActions>\n      </MuiDialog>\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n      {isConfirmAutoCreateOpen && (\n        <ConfirmationDialog\n          title=\"Confirm Site Auto-Creation\"\n          isOpen={isConfirmAutoCreateOpen}\n          onClose={() => setIsConfirmAutoCreateOpen(false)}\n          onConfirm={() => handleAllRemainingSitesCreate()}\n        >\n          Selecting this option will attempt to automatically generate a new official NAMC site for all sampled\n          locations in this submission without a matched site. The submitted latitude and longitudes will be used for\n          the locations. You can still interact with each submitted site location afterward and modify any of the site\n          locations or matches. Are you sure that you want to generate all remaining sites?\n        </ConfirmationDialog>\n      )}\n    </>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '50em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"30em\" variant=\"rectangular\" />\n  </div>\n)\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { BOX_STATE_ID, selectLatestSubmissionByBoxId } from '../../data/selectors'\nimport { PendingBoxReview as Component } from './PendingBoxReview'\nimport { Fallback } from './Fallback'\nimport { withSuspense } from '../withSuspense'\n\nexport interface PendingBoxReviewProps {\n  boxId: string | number\n}\n\nexport const PendingBoxReview = withSuspense(\n  ({ boxId }: PendingBoxReviewProps): JSX.Element => {\n    const submission = useRecoilValue(selectLatestSubmissionByBoxId(Number(boxId)))\n\n    if (!submission || submission.boxStateId !== BOX_STATE_ID.pending)\n      return <h2>Box {boxId} not found or it is not in Pending state.</h2>\n\n    return <Component submission={submission} />\n  },\n  () => <Fallback />\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport { useRecoilValue } from 'recoil'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport MuiButton from '@mui/material/Button'\n\nimport { MyUser, Predictor } from '../../types'\nimport { Title } from '../Title'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { lookupListToOptions, selectMyUser, selectPredictorTypes, useInvalidate } from '../../data/selectors'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { TextField } from '../TextField'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { createPredictor, deletePredictor, updatePredictor } from '../../data/calls'\nimport { CheckboxField } from '../CheckboxField'\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport { Menu, Divider } from '../Menu'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\nimport { trimAllStrings } from '../../lib/trimAllStrings'\nimport { NumberField } from '../NumberField'\n\nexport interface PredictorDetailProps {\n  predictor: Predictor | null\n}\n\ninterface Fields {\n  abbreviation: string\n  calculation: string\n  calculationScript: string\n  cellRepresents: string\n  cellSize: string\n  description: string\n  geometryFilePath: string\n  inputType: string\n  isGee: string\n  isTemporal: boolean\n  isText: string\n  maxValue: number | null\n  minValue: number | null\n  name: string\n  notes: string\n  smallShedException: string\n  source: string\n  transformation: string\n  typeId: number | null\n  units: string\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'stopped' | 'started' | 'stopping' | 'deleting'\n  isDirty: boolean\n  values: Fields\n  lastValues?: Fields\n}\n\nconst getInitialState = ({ predictor }: Pick<PredictorDetailProps, 'predictor'> & { user: MyUser }): State => {\n  const {\n    abbreviation = '',\n    calculation = '',\n    calculationScript = '',\n    cellRepresents = '',\n    cellSize = '',\n    description = '',\n    geometryFilePath = '',\n    inputType = '',\n    isGee = '',\n    isTemporal = false,\n    isText = '',\n    maxValue = null,\n    minValue = null,\n    name = '',\n    notes = '',\n    smallShedException = '',\n    source = '',\n    transformation = '',\n    typeId = null,\n    units = '',\n  } = predictor ?? {}\n  return {\n    editMode: predictor ? 'stopped' : 'started',\n    isDirty: false,\n    values: {\n      abbreviation,\n      calculation,\n      calculationScript,\n      cellRepresents,\n      cellSize,\n      description,\n      geometryFilePath,\n      inputType,\n      isGee,\n      isTemporal,\n      isText,\n      maxValue,\n      minValue,\n      name,\n      notes,\n      smallShedException,\n      source,\n      transformation,\n      typeId,\n      units,\n    },\n  }\n}\n\nexport const PredictorDetail = ({ predictor }: PredictorDetailProps): JSX.Element => {\n  const api = useApi()\n  const invalidate = useInvalidate()\n  const notifications = useNotifications()\n  const navigate = useNavigate()\n  const user = useRecoilValue(selectMyUser)\n\n  const isNewPredictor = !predictor\n\n  // LOOKUP OPTIONS\n\n  const predictorTypeOptions = lookupListToOptions(useRecoilValue(selectPredictorTypes))\n\n  // STATE\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ predictor, user }), [predictor])\n  const [isConfirmDeleteOpen, setIsConfirmDeleteOpen] = useState(false)\n\n  const { values, editMode, isDirty } = state\n\n  const errors: FieldErrors = (() => {\n    const result: FieldErrors = {\n      name: !values.name.trim(),\n      abbreviation: !values.abbreviation.trim(),\n      typeId: !values.typeId,\n    }\n    if (!Object.values(result).some((value) => value)) return undefined\n    return result\n  })()\n\n  const isStopped = editMode === 'stopped'\n  const isEditing = editMode === 'started'\n  const isSaving = editMode === 'stopping'\n  const isDeleting = editMode === 'deleting'\n\n  // HANDLERS\n\n  const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n    updateState((draft) => {\n      Object.assign(draft.values, { [fieldName]: value })\n      draft.isDirty = true\n    })\n  }\n  const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n  const handleEdit = () => {\n    updateState((draft) => {\n      draft.editMode = 'started'\n      draft.lastValues = draft.values\n    })\n  }\n\n  const handleCancel = () => {\n    updateState((draft) => {\n      if (!draft.lastValues) throw new Error('no values to revert to')\n      draft.editMode = 'stopped'\n      draft.values = draft.lastValues\n      draft.isDirty = false\n    })\n  }\n\n  const handleSave = async () => {\n    try {\n      updateState((draft) => {\n        draft.editMode = 'stopping'\n      })\n      const { typeId, ...restPredictorInput } = trimAllStrings(values)\n      if (!typeId) throw new Error('No predictor type.')\n      if (isNewPredictor) {\n        // new predictor\n        const predictorId = await createPredictor(api, invalidate)({ typeId, ...restPredictorInput })\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n        window.setTimeout(() => {\n          navigate.predictorDetail({ predictorId }, true) // let state update\n        })\n      } else {\n        // existing predictor\n        await updatePredictor(\n          api,\n          invalidate\n        )({\n          ...restPredictorInput,\n          typeId,\n          id: predictor.id,\n        })\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n      }\n    } catch (err) {\n      switch ((err as Error).message) {\n        case 'duplicate key value violates unique constraint \"predictors_predictor_name_key\"':\n          notifications.error(`Failed to save: name \"${values.name}\" already in use`)\n          break\n        case 'duplicate key value violates unique constraint \"predictors_abbreviation_key\"':\n          notifications.error(`Failed to save: abbreviation \"${values.abbreviation}\" already in use`)\n          break\n        default:\n          notifications.error(`Failed to save: ${err}`)\n      }\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n  }\n\n  const handleDelete = async () => {\n    try {\n      if (!predictor) throw new Error('No predictor.')\n      updateState((draft) => {\n        draft.editMode = 'deleting'\n      })\n      await deletePredictor(api, invalidate)(predictor)\n      notifications.info(`Deleted predictor ${predictor.name}`)\n      navigate.predictors()\n    } catch (err) {\n      notifications.error(`Failed to delete: ${err}`)\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n      })\n    }\n  }\n\n  // RENDER\n\n  return (\n    <>\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', alignItems: 'center', minHeight: '3rem', marginBottom: '1rem', gap: '1rem' }}>\n          {!isEditing ? (\n            <Title>{values.name}</Title>\n          ) : (\n            <div css={{ flex: 1 }}>\n              <TextField\n                label=\"Predictor Name\"\n                value={values.name}\n                onChange={(value) => setFieldValue('name', value)}\n                error={errors?.name}\n                InputProps={{ sx: { fontWeight: '700' } }} // roughly match <Title>\n                maxLength={255}\n                fullWidth\n              />\n            </div>\n          )}\n          <div css={{ display: 'flex', gap: '0.5em', marginLeft: 'auto' }}>\n            {(isStopped || isDeleting) && user.hasPermission(NAMCResource.models, GrantAction.updateAny) && (\n              <Menu\n                label=\"Actions\"\n                disabled={isDeleting}\n                items={[\n                  {\n                    key: 'edit',\n                    label: 'Edit Predictor',\n                    onClick: handleEdit,\n                  },\n                  Divider,\n                  {\n                    key: 'delete',\n                    label: 'Delete Predictor',\n                    onClick: () => {\n                      setIsConfirmDeleteOpen(true)\n                    },\n                    disabled: !user.hasPermission(NAMCResource.models, GrantAction.deleteAny),\n                  },\n                ]}\n              />\n            )}\n            {(isEditing || isSaving) && (\n              <>\n                {!isNewPredictor && (\n                  <MuiButton onClick={handleCancel} variant=\"outlined\" disabled={isSaving}>\n                    Cancel\n                  </MuiButton>\n                )}\n                <MuiButton onClick={handleSave} variant=\"contained\" disabled={!isDirty || isSaving || !!errors}>\n                  Save\n                </MuiButton>\n              </>\n            )}\n          </div>\n        </div>\n        <div\n          css={{\n            display: 'grid',\n            gap: '0.75em',\n            gridTemplateColumns: 'repeat(3, 1fr)',\n            gridTemplateAreas: `\n              \"abbreviation           typeId            id\"\n              \"units                  source            inputType\"\n              \"isTemporal             isText            isGee\"\n              \"cellRepresents         cellSize          smallShedException\" \n              \"transformation         minValue          maxValue\"\n              \"calculationScript      geometryFilePath  .\"\n              \"calculation            description       notes\"\n            `,\n          }}\n        >\n          <ReadOnlyField gridArea=\"id\" value={predictor?.id ?? 'TBD'} label=\"Predictor ID\" />\n          <TextField\n            gridArea=\"abbreviation\"\n            value={values.abbreviation}\n            onChange={makeFieldChangeHandler('abbreviation')}\n            label=\"Abbreviation\"\n            readOnly={!isEditing}\n            error={errors?.abbreviation}\n            maxLength={50}\n          />\n          <AutocompleteField\n            gridArea=\"typeId\"\n            label=\"Type\"\n            value={values.typeId}\n            onChange={makeFieldChangeHandler('typeId')}\n            readOnly={!isEditing}\n            error={errors?.typeId}\n            options={predictorTypeOptions}\n          />\n          <TextField\n            gridArea=\"units\"\n            value={values.units}\n            onChange={makeFieldChangeHandler('units')}\n            label=\"Units\"\n            readOnly={!isEditing}\n            error={errors?.units}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"source\"\n            value={values.source}\n            onChange={makeFieldChangeHandler('source')}\n            label=\"Source\"\n            readOnly={!isEditing}\n            error={errors?.source}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"inputType\"\n            value={values.inputType}\n            onChange={makeFieldChangeHandler('inputType')}\n            label=\"Input Type\"\n            readOnly={!isEditing}\n            error={errors?.inputType}\n            maxLength={255}\n          />\n          <CheckboxField\n            gridArea=\"isTemporal\"\n            value={values.isTemporal}\n            onChange={makeFieldChangeHandler('isTemporal')}\n            label=\"Is Temporal\"\n            readOnly={!isEditing}\n          />\n          <TextField\n            gridArea=\"isText\"\n            value={values.isText}\n            onChange={makeFieldChangeHandler('isText')}\n            label=\"Is Text\"\n            readOnly={!isEditing}\n            error={errors?.isText}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"isGee\"\n            value={values.isGee}\n            onChange={makeFieldChangeHandler('isGee')}\n            label=\"Is GEE\"\n            readOnly={!isEditing}\n            error={errors?.isGee}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"cellRepresents\"\n            value={values.cellRepresents}\n            onChange={makeFieldChangeHandler('cellRepresents')}\n            label=\"Cell Represents\"\n            readOnly={!isEditing}\n            error={errors?.cellRepresents}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"cellSize\"\n            value={values.cellSize}\n            onChange={makeFieldChangeHandler('cellSize')}\n            label=\"Cell Size\"\n            readOnly={!isEditing}\n            error={errors?.cellSize}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"smallShedException\"\n            value={values.smallShedException}\n            onChange={makeFieldChangeHandler('smallShedException')}\n            label=\"Small Watershed Exception\"\n            readOnly={!isEditing}\n            error={errors?.smallShedException}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"transformation\"\n            value={values.transformation}\n            onChange={makeFieldChangeHandler('transformation')}\n            label=\"Transformation\"\n            readOnly={!isEditing}\n            error={errors?.transformation}\n            maxLength={255}\n          />\n          <NumberField\n            gridArea=\"minValue\"\n            value={values.minValue}\n            onChange={makeFieldChangeHandler('minValue')}\n            label=\"Minimum Value\"\n            readOnly={!isEditing}\n            error={errors?.minValue}\n          />\n          <NumberField\n            gridArea=\"maxValue\"\n            value={values.maxValue}\n            onChange={makeFieldChangeHandler('maxValue')}\n            label=\"Maximum Value\"\n            readOnly={!isEditing}\n            error={errors?.maxValue}\n          />\n          <TextField\n            gridArea=\"calculationScript\"\n            value={values.calculationScript}\n            onChange={makeFieldChangeHandler('calculationScript')}\n            label=\"Calculation Script\"\n            readOnly={!isEditing}\n            error={errors?.calculationScript}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"geometryFilePath\"\n            value={values.geometryFilePath}\n            onChange={makeFieldChangeHandler('geometryFilePath')}\n            label=\"Geometry File Path\"\n            readOnly={!isEditing}\n            error={errors?.geometryFilePath}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"calculation\"\n            value={values.calculation}\n            onChange={makeFieldChangeHandler('calculation')}\n            label=\"Calculation\"\n            readOnly={!isEditing}\n            error={errors?.calculation}\n            multiline\n            minRows={2}\n          />\n          <TextField\n            gridArea=\"description\"\n            value={values.description}\n            onChange={makeFieldChangeHandler('description')}\n            label=\"Description\"\n            readOnly={!isEditing}\n            error={errors?.description}\n            multiline\n            minRows={2}\n          />\n          <TextField\n            gridArea=\"notes\"\n            value={values.notes}\n            onChange={makeFieldChangeHandler('notes')}\n            label=\"Notes\"\n            readOnly={!isEditing}\n            error={errors?.notes}\n            multiline\n            minRows={2}\n          />\n        </div>\n      </div>\n      <ConfirmationDialog\n        title=\"Confirm Delete Predictor\"\n        isOpen={isConfirmDeleteOpen}\n        onClose={() => {\n          setIsConfirmDeleteOpen(false)\n        }}\n        onConfirm={handleDelete}\n      >\n        Are you sure you want to delete this predictor?\n      </ConfirmationDialog>\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n    </>\n  )\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectPredictorById, selectNull } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { PredictorDetail as Component } from './PredictorDetail'\nimport { Fallback } from './Fallback'\n\nexport type PredictorDetailProps =\n  | {\n      predictorId: string | number\n      isNew?: never\n    }\n  | {\n      predictorId?: never\n      isNew: true // unconsumed; used to positively differentiate modes\n    }\n\nexport const PredictorDetail = withSuspense(({ predictorId }: PredictorDetailProps): JSX.Element => {\n  const predictor = useRecoilValue(predictorId ? selectPredictorById(Number(predictorId)) : selectNull)\n\n  if (predictorId && !predictor) return <h2>Predictor {predictorId} not found.</h2>\n\n  return <Component predictor={predictor} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const predictorsColumnDefs = [\n  columnDef.linkColumn({\n    headerName: 'Predictor ID',\n    field: 'title',\n    width: 120,\n  }),\n  columnDef.textColumn({\n    field: 'abbreviation',\n    flex: 1,\n  }),\n  columnDef.textColumn({\n    field: 'name',\n    flex: 3,\n  }),\n  columnDef.textColumn({\n    field: 'units',\n    width: 150,\n  }),\n  columnDef.booleanColumn({\n    field: 'isTemporal',\n    valueLabels: ['No', 'Yes'],\n    width: 120,\n  }),\n  columnDef.numberColumn({\n    field: 'modelCount',\n    width: 120,\n  }),\n  columnDef.textColumn({\n    field: 'type',\n    width: 180,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\n\nimport { selectPredictors, selectMyUser } from '../../data/selectors'\nimport { DataGrid, renderers, DataGridRecordCount } from '../DataGrid'\nimport { Predictor } from '../../types'\nimport { withSuspense } from '../withSuspense'\nimport { predictorsColumnDefs } from './columnDefs'\nimport { Filter, FilterChips } from '../Filters'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\nimport { useNavigate } from '../AppRouter'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport { Fallback } from './Fallback'\n\nexport interface PredictorRow extends Predictor {\n  title: {\n    label: string\n    onClick: () => void\n    disabled?: boolean\n  }\n}\n\nconst textFilterState = atom({\n  key: 'PredictorsListing/textFilterState',\n  default: '',\n})\n\nexport const PredictorsListing = withSuspense(\n  () => {\n    const navigate = useNavigate()\n    const user = useRecoilValue(selectMyUser)\n    const predictors = useRecoilValue(selectPredictors)\n\n    // STATE AND REFS\n\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n      useRecoilState(textFilterState)\n    )\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<Predictor>[] = []\n\n      if (textFilterDebounced) {\n        result.push({\n          id: 'text',\n          label: `Name/Abbreviation contains \"${textFilterDebounced}\"`,\n          filterFn: ({ name, abbreviation }) =>\n            name.toLowerCase().includes(textFilterDebounced.toLowerCase()) ||\n            abbreviation.toLowerCase().includes(textFilterDebounced.toLowerCase()),\n          onDelete: clearTextFilter,\n        })\n      }\n\n      return result\n    }, [textFilterDebounced])\n\n    const rows = useMemo<PredictorRow[]>(() => {\n      const filtered = filters.reduce<Predictor[]>((acc, { filterFn }) => acc.filter(filterFn), predictors)\n      return filtered.map((predictor) => ({\n        ...predictor,\n        title: {\n          label: String(predictor.id),\n          onClick: () => {\n            navigate.predictorDetail({ predictorId: predictor.id })\n          },\n        },\n      }))\n    }, [filters])\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', gap: '0.5em' }}>\n          <TextFilterField value={textFilter} onChange={setTextFilter} label=\"Predictor Name or Abbreviation\" />\n          {user.hasPermission(NAMCResource.models, GrantAction.createAny) && (\n            <div css={{ marginLeft: 'auto' }}>\n              <MuiButton\n                variant=\"outlined\"\n                onClick={() => {\n                  navigate.predictorCreate()\n                }}\n              >\n                Create New Predictor\n              </MuiButton>\n            </div>\n          )}\n        </div>\n        <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n          <FilterChips filters={filters} joinLabel=\"and\" />\n          <DataGridRecordCount total={predictors.length} visible={rows.length} descriptor=\"predictor\" />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<PredictorRow> rows={rows} columnDefs={predictorsColumnDefs} frameworkComponents={renderers} />\n        </div>\n      </div>\n    )\n  },\n  () => <Fallback />\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiButton from '@mui/material/Button'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\n\nimport { withSuspense } from '../withSuspense'\nimport { selectProjectSamplesByProjectId } from '../../data/selectors'\nimport { SamplesDataGrid, samplesDownloadColumns } from '../SamplesDataGrid'\nimport { DataGridRecordCount } from '../DataGrid'\nimport { SelectSamples } from '../SelectSamples'\nimport { createSingleTableWorkbook } from '../../lib/excel/singleTableUtil'\nimport { downloadWorkbook } from '../../lib/excel/downloadWorkbook'\nimport { SourceSample } from '../../types'\n\ninterface ProjectDetailProps {\n  projectId: number\n  projectName: string\n  canModify: boolean\n}\n\nexport const ProjectSamples = withSuspense(\n  ({ projectId, projectName, canModify }: ProjectDetailProps): JSX.Element => {\n    const samples = useRecoilValue(selectProjectSamplesByProjectId(projectId))\n    const [isOperating, setIsOperating] = useState(false)\n    const [modifyMode, setModifyMode] = useState<'add' | 'remove' | null>(null)\n\n    const handleCloseModify = () => {\n      if (isOperating) return // do not close when operating (may have been invoked by escape key)\n      setModifyMode(null)\n    }\n\n    const handleDownload = () => {\n      const wb = createSingleTableWorkbook<SourceSample>({\n        wsName: 'Samples',\n        columns: samplesDownloadColumns,\n        rows: samples,\n      })\n      downloadWorkbook(wb, `Project ${projectName} Samples.xlsx`)\n    }\n\n    return (\n      <>\n        <div css={{ minHeight: '2em', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n          <div css={{ fontWeight: '500', marginLeft: '1em', marginRight: 'auto' }}>Samples</div>\n          <MuiButton\n            css={{ width: '6em' }}\n            variant=\"outlined\"\n            disabled={!canModify}\n            onClick={() => {\n              setModifyMode('add')\n            }}\n          >\n            Add\n          </MuiButton>\n          <MuiButton\n            css={{ width: '6em' }}\n            variant=\"outlined\"\n            disabled={samples.length === 0 || !canModify}\n            onClick={() => {\n              setModifyMode('remove')\n            }}\n          >\n            Remove\n          </MuiButton>\n          <MuiButton variant=\"outlined\" disabled={samples.length === 0} onClick={handleDownload}>\n            Download\n          </MuiButton>\n          <DataGridRecordCount total={samples.length} visible={samples.length} descriptor=\"sample\" />\n        </div>\n        <div css={{ flex: 1, minHeight: '10em' }}>\n          <SamplesDataGrid\n            samples={samples}\n            sitesListingSource={{ type: 'project', id: projectId, name: projectName }}\n          />\n        </div>\n        <MuiDialog open={!!modifyMode} fullWidth maxWidth=\"lg\" onClose={handleCloseModify}>\n          <MuiDialogContent>\n            <SelectSamples\n              initialMode={modifyMode || 'add'}\n              projectId={projectId}\n              projectName={projectName}\n              samples={samples}\n              onOperatingChange={setIsOperating}\n            />\n          </MuiDialogContent>\n          <MuiDialogActions>\n            <MuiButton onClick={handleCloseModify} disabled={isOperating}>\n              Close\n            </MuiButton>\n          </MuiDialogActions>\n        </MuiDialog>\n      </>\n    )\n  },\n  () => <MuiSkeleton css={{ marginTop: '1rem' }} height=\"10rem\" variant=\"rectangular\" />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\n\nimport { selectSitesByProjectId } from '../../data/selectors'\nimport { SitesMapPreview } from '../SitesMap'\n\nexport interface ProjectSitesMapPreviewProps {\n  projectId: number\n  projectName: string\n}\n\nexport const ProjectSitesMapPreview = ({ projectId, projectName }: ProjectSitesMapPreviewProps): JSX.Element => {\n  const sitesSelector = selectSitesByProjectId(projectId)\n  return (\n    <SitesMapPreview\n      sitesSelector={sitesSelector}\n      sitesListingSource={{ type: 'project', id: projectId, name: projectName }}\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useState } from 'react'\nimport { atom, selector, useRecoilState, useRecoilValue } from 'recoil'\nimport { countBy } from 'lodash'\nimport MuiButton from '@mui/material/Button'\n\nimport { MyUser, Project } from '../../types'\nimport { AccordionPanel } from '../AccordionPanel'\nimport { Title } from '../Title'\nimport { ProjectSamples } from './ProjectSamples'\nimport { ProjectSitesMapPreview } from './ProjectSitesMapPreview'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { formatUtcDateTimeToAppDate } from '../../lib/formats'\nimport { selectMyUser, selectUsers, useInvalidate } from '../../data/selectors'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { TextField } from '../TextField'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { createProject, deleteProject, updateProject } from '../../data/calls'\nimport { CheckboxField } from '../CheckboxField'\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport { Menu, Divider } from '../Menu'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\nimport { ModelsField } from '../ModelsField'\n\nexport interface ProjectDetailProps {\n  project: Project | null\n}\n\ninterface Fields {\n  name: string\n  contactId: number\n  isPrivate: boolean\n  description: string\n  modelIds: number[]\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'stopped' | 'started' | 'stopping' | 'deleting'\n  isDirty: boolean\n  values: Fields\n  lastValues?: Fields\n}\n\nconst isExpandedState = atom<boolean>({\n  key: 'ProjectDetail/isExpandedState',\n  default: true,\n})\n\nconst selectUserOptions = selector({\n  key: 'ProjectDetail/selectUserOptions',\n  get: async ({ get }) => {\n    const users = get(selectUsers)\n\n    const userOptions = users.map(({ id: value, fullName, organizationName }) => ({\n      value,\n      label: `${fullName} (${organizationName})`,\n    }))\n\n    const labelCount = countBy(userOptions, 'label')\n\n    return userOptions.map(({ value, label }) => ({\n      value,\n      label: labelCount[label] > 1 ? `${label} [${value}]` : label,\n    }))\n  },\n})\n\nconst getInitialState = ({ project, user }: Pick<ProjectDetailProps, 'project'> & { user: MyUser }): State => ({\n  editMode: project ? 'stopped' : 'started',\n  isDirty: false,\n  values: {\n    name: project?.name ?? '',\n    contactId: project?.contactId ?? user.id,\n    isPrivate: project?.isPrivate ?? true,\n    description: project?.description ?? '',\n    modelIds: project?.modelIds ?? [],\n  },\n})\n\nexport const ProjectDetail = ({ project }: ProjectDetailProps): JSX.Element => {\n  const api = useApi()\n  const invalidate = useInvalidate()\n  const notifications = useNotifications()\n  const navigate = useNavigate()\n  const user = useRecoilValue(selectMyUser)\n\n  const isNewProject = !project\n\n  // STATE\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ project, user }), [project])\n  const [isPanelExpanded, setIsPanelExpanded] = useRecoilState(isExpandedState)\n  const [isConfirmDeleteOpen, setIsConfirmDeleteOpen] = useState(false)\n\n  const { values, editMode, isDirty } = state\n\n  const errors: FieldErrors = (() => {\n    const result: FieldErrors = {\n      name: !values.name.trim(),\n    }\n    if (!Object.values(result).some((value) => value)) return undefined\n    return result\n  })()\n\n  const isStopped = editMode === 'stopped'\n  const isEditing = editMode === 'started'\n  const isSaving = editMode === 'stopping'\n  const isDeleting = editMode === 'deleting'\n\n  // EFFECTS\n\n  useEffect(() => {\n    if (isEditing) setIsPanelExpanded(true)\n  }, [isEditing])\n\n  // HANDLERS\n\n  const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n    updateState((draft) => {\n      Object.assign(draft.values, { [fieldName]: value })\n      draft.isDirty = true\n    })\n  }\n\n  const handleEdit = () => {\n    updateState((draft) => {\n      draft.editMode = 'started'\n      draft.lastValues = draft.values\n    })\n  }\n\n  const handleCancel = () => {\n    updateState((draft) => {\n      if (!draft.lastValues) throw new Error('no values to revert to')\n      draft.editMode = 'stopped'\n      draft.values = draft.lastValues\n      draft.isDirty = false\n    })\n  }\n\n  const handleSave = async () => {\n    try {\n      updateState((draft) => {\n        draft.editMode = 'stopping'\n      })\n      const projectInput = {\n        name: values.name.trim(),\n        isPrivate: values.isPrivate,\n        description: values.description.trim(),\n        contactId: values.contactId,\n        modelIds: values.modelIds,\n      }\n      if (isNewProject) {\n        // new project\n        const projectId = await createProject(api, invalidate)(projectInput)\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n        window.setTimeout(() => {\n          navigate.projectDetail({ projectId }, true) // let state update\n        })\n      } else {\n        // existing project\n        await updateProject(\n          api,\n          invalidate\n        )({\n          ...projectInput,\n          id: project.id,\n        })\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n      }\n    } catch (err) {\n      if ((err as Error).message === 'duplicate key value violates unique constraint \"projects_project_name_key\"') {\n        notifications.error(`Failed to save: name \"${values.name}\" already in use`)\n      } else {\n        notifications.error(`Failed to save: ${err}`)\n      }\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n  }\n\n  const handleDelete = async () => {\n    try {\n      if (!project) throw new Error('No project.')\n      updateState((draft) => {\n        draft.editMode = 'deleting'\n      })\n      await deleteProject(api, invalidate)(project)\n      notifications.info(`Deleted project ${project.name}`)\n      navigate.projects()\n    } catch (err) {\n      notifications.error(`Failed to delete: ${err}`)\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n      })\n    }\n  }\n\n  // RENDER\n\n  return (\n    <>\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <AccordionPanel\n          value={isPanelExpanded}\n          onChange={setIsPanelExpanded}\n          locked={isEditing}\n          summary={\n            !isEditing ? (\n              <Title>\n                Project {values.name} <Title.Subtitle>({project?.sampleCount ?? 0} samples)</Title.Subtitle>\n              </Title>\n            ) : (\n              <div css={{ display: 'flex', alignItems: 'baseline' }}>\n                <Title>Project&nbsp;</Title>\n                <TextField\n                  value={values.name}\n                  onChange={(value) => setFieldValue('name', value)}\n                  error={errors?.name}\n                  css={{ width: '30em' }}\n                  InputProps={{ sx: { fontWeight: '700' } }} // roughly match <Title>\n                />\n              </div>\n            )\n          }\n          actions={\n            <div css={{ display: 'flex', gap: '0.5em' }}>\n              {(isStopped || isDeleting) && (\n                <Menu\n                  label=\"Actions\"\n                  disabled={isDeleting}\n                  items={[\n                    {\n                      key: 'edit',\n                      label: 'Edit Project',\n                      onClick: handleEdit,\n                    },\n                    Divider,\n                    {\n                      key: 'delete',\n                      label: 'Delete Project',\n                      onClick: () => {\n                        setIsConfirmDeleteOpen(true)\n                      },\n                    },\n                  ]}\n                ></Menu>\n              )}\n              {(isEditing || isSaving) && (\n                <>\n                  {!isNewProject && (\n                    <MuiButton onClick={handleCancel} variant=\"outlined\" disabled={isSaving}>\n                      Cancel\n                    </MuiButton>\n                  )}\n                  <MuiButton onClick={handleSave} variant=\"contained\" disabled={!isDirty || isSaving || !!errors}>\n                    Save\n                  </MuiButton>\n                </>\n              )}\n            </div>\n          }\n        >\n          <div\n            css={{\n              flex: 1,\n              display: 'grid',\n              gap: '0.75em',\n              gridTemplateColumns: 'auto 1fr auto',\n              gridTemplateAreas: `\n              \"id              contactId          map\"\n              \"createdDate     isPrivate          map\"\n              \".               modelIds           map\"\n              \".               description        map\"\n              \".               .                  map\"\n            `,\n            }}\n          >\n            <ReadOnlyField gridArea=\"id\" value={project?.id ?? ''} label=\"Project ID\" />\n            <ReadOnlyField\n              gridArea=\"createdDate\"\n              value={formatUtcDateTimeToAppDate(project?.createdDate ?? null)}\n              label=\"Created On\"\n            />\n            <AutocompleteField\n              gridArea=\"contactId\"\n              value={values.contactId}\n              onChange={(value) => setFieldValue('contactId', value)}\n              valueLabel={project?.contactName ?? ''}\n              optionsSelector={selectUserOptions}\n              label=\"Contact Name\"\n              readOnly={!isEditing}\n            />\n            <CheckboxField\n              gridArea=\"isPrivate\"\n              value={!values.isPrivate}\n              onChange={(value) => setFieldValue('isPrivate', !value)}\n              label=\"Project samples appear in the public web map\"\n              readOnly={!isEditing}\n            />\n            <ModelsField\n              gridArea=\"modelIds\"\n              value={values.modelIds}\n              onChange={(value) => setFieldValue('modelIds', value)}\n              label=\"Models\"\n              readOnly={!isEditing}\n            />\n            <TextField\n              gridArea=\"description\"\n              value={values.description}\n              onChange={(value) => setFieldValue('description', value)}\n              label=\"Description\"\n              readOnly={!isEditing}\n              multiline\n              minRows={3}\n            />\n            <div css={{ gridArea: 'map', minHeight: '300px' }}>\n              {!isEditing && project && <ProjectSitesMapPreview projectId={project.id} projectName={values.name} />}\n            </div>\n          </div>\n        </AccordionPanel>\n        {project && <ProjectSamples projectId={project.id} projectName={values.name} canModify={isStopped} />}\n      </div>\n      <ConfirmationDialog\n        title=\"Confirm Delete Project\"\n        isOpen={isConfirmDeleteOpen}\n        onClose={() => {\n          setIsConfirmDeleteOpen(false)\n        }}\n        onConfirm={handleDelete}\n      >\n        Are you sure you want to delete this project?\n      </ConfirmationDialog>\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n    </>\n  )\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectProjectById, selectNull } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { ProjectDetail as Component } from './ProjectDetail'\nimport { Fallback } from './Fallback'\n\nexport type ProjectDetailProps =\n  | {\n      projectId: string | number\n      isNew?: never\n    }\n  | {\n      projectId?: never\n      isNew: true // unconsumed; used to positively differentiate modes\n    }\n\nexport const ProjectDetail = withSuspense(({ projectId }: ProjectDetailProps): JSX.Element => {\n  const project = useRecoilValue(projectId ? selectProjectById(Number(projectId)) : selectNull)\n\n  if (projectId && !project) return <h2>Project {projectId} not found.</h2>\n\n  return <Component project={project} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const projectsColumnDefs = [\n  columnDef.linkColumn({\n    field: 'title',\n    flex: 1,\n    minWidth: 140,\n  }),\n  columnDef.textColumn({\n    headerName: 'Project ID',\n    field: 'id',\n    width: 120,\n  }),\n  columnDef.filterableTextColumn({\n    field: 'owner',\n    filterTooltip: 'Filter by this owner',\n    flex: 1,\n    minWidth: 140,\n  }),\n  columnDef.numberColumn({\n    field: 'sampleCount',\n    width: 140,\n  }),\n  columnDef.numberColumn({\n    headerName: 'Model Count',\n    colId: 'modelCount',\n    valueGetter: ({ data }) => data.modelIds.length,\n    width: 140,\n  }),\n  columnDef.dateColumn({\n    headerName: 'Created',\n    field: 'createdDate',\n    width: 140,\n  }),\n  columnDef.dateColumn({\n    headerName: 'Updated',\n    field: 'updatedDate',\n    width: 140,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiButton from '@mui/material/Button'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\n\nimport { selectMyUser, selectProjects } from '../../data/selectors'\nimport { DataGrid, renderers, DataGridRecordCount } from '../DataGrid'\nimport { Project } from '../../types'\nimport { withSuspense } from '../withSuspense'\nimport { projectsColumnDefs } from './columnDefs'\nimport { Filter, FilterChips } from '../Filters'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\nimport { useNavigate } from '../AppRouter'\n\nexport interface ProjectRow extends Project {\n  title: {\n    label: string\n    onClick: () => void\n  }\n  owner: {\n    label: string\n    onFilter: () => void\n    disabled: boolean\n  }\n}\n\nconst textFilterState = atom({\n  key: 'ProjectsListing/textFilterState',\n  default: '',\n})\n\nconst addedFiltersState = atom<Filter<Project>[]>({\n  key: 'ProjectsListing/addedFiltersState',\n  default: [],\n})\n\nexport const ProjectsListing = withSuspense(\n  () => {\n    const navigate = useNavigate()\n    const user = useRecoilValue(selectMyUser)\n    const projects = useRecoilValue(selectProjects)\n\n    // STATE AND REFS\n\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n      useRecoilState(textFilterState)\n    )\n    const [addedFilters, setAddedFilters] = useRecoilState(addedFiltersState)\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<Project>[] = []\n\n      if (textFilterDebounced) {\n        if (textFilterDebounced.match(/^\\d+$/)) {\n          const targetBoxId = Number(textFilterDebounced)\n          result.push({\n            id: 'text',\n            label: `Project ${textFilterDebounced}`,\n            filterFn: (box) => box.id === targetBoxId,\n            onDelete: clearTextFilter,\n          })\n        } else {\n          result.push({\n            id: 'text',\n            label: `Title/Owner contains \"${textFilterDebounced}\"`,\n            filterFn: ({ name, contactName }) =>\n              name.toLowerCase().includes(textFilterDebounced.toLowerCase()) ||\n              contactName.toLowerCase().includes(textFilterDebounced.toLowerCase()),\n            onDelete: clearTextFilter,\n          })\n        }\n      }\n\n      result.push(...addedFilters)\n\n      return result\n    }, [textFilterDebounced, addedFilters])\n\n    const rows = useMemo<ProjectRow[]>(() => {\n      const filtered = filters.reduce<Project[]>((acc, { filterFn }) => acc.filter(filterFn), projects)\n      return filtered.map((project) => {\n        const filterId = `filter/${String(project.contactName)}`\n        return {\n          ...project,\n          title: {\n            label: project.name,\n            onClick: () => navigate.projectDetail({ projectId: project.id }),\n          },\n          owner: {\n            label: project.contactName,\n            onFilter: () => {\n              clearTextFilter()\n              setAddedFilters([\n                {\n                  id: filterId,\n                  label: project.contactName,\n                  filterFn: ({ contactName }) => contactName === project.contactName,\n                  onDelete: () => setAddedFilters((value) => value.filter(({ id }) => id !== filterId)),\n                },\n              ])\n            },\n            disabled: !!addedFilters.find(({ id }) => id === filterId) || !project.contactName,\n          },\n        }\n      })\n    }, [projects, filters])\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', gap: '0.5em' }}>\n          <TextFilterField value={textFilter} onChange={setTextFilter} label=\"Project ID, Title, Owner\" />\n          {user.hasPermission(NAMCResource.projects, GrantAction.createAny) && (\n            <div css={{ marginLeft: 'auto' }}>\n              <MuiButton\n                variant=\"outlined\"\n                onClick={() => {\n                  navigate.projectCreate()\n                }}\n              >\n                Create New Project\n              </MuiButton>\n            </div>\n          )}\n        </div>\n        <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n          <FilterChips filters={filters} joinLabel=\"and\" />\n          <DataGridRecordCount total={projects.length} visible={rows.length} descriptor=\"project\" />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<Project> rows={rows} columnDefs={projectsColumnDefs} frameworkComponents={renderers} />\n        </div>\n      </div>\n    )\n  },\n  () => <MuiSkeleton height=\"20em\" />\n)\n","import { PaginatedRecords, pubTypes } from '@namcbugdb/common'\nimport gql from 'graphql-tag'\n\nimport { Api } from '../../../data/api'\n\nexport const fetchPublicProjectsQuery = gql`\n  query ($offset: Int!) {\n    projects(limit: 10000, offset: $offset) {\n      records {\n        projectId\n        projectName\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchPublicProjects =\n  (api: Api) =>\n  async (onRecords?: (qty: number) => void): Promise<pubTypes.PubProject[]> => {\n    const data = await api.queryAllPages<{ projects: PaginatedRecords<pubTypes.PubProject> }>(\n      fetchPublicProjectsQuery,\n      {},\n      { dataProperty: 'projects', onRecords }\n    )\n\n    return data.projects.records\n  }\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, pubTypes } from '@namcbugdb/common'\n\nimport { Api, deNull } from '../../../data/api'\nimport { Taxon } from '../../../types'\n\nexport const fetchPublicTaxaQuery = gql`\n  query ($offset: Int) {\n    taxonomies(limit: 10000, offset: $offset) {\n      records {\n        taxonomyId\n        scientificName\n        levelId\n        synonyms\n        parentTaxonomyId\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const fetchPublicTaxa =\n  (api: Api) =>\n  async (onRecords?: (qty: number) => void): Promise<Taxon[]> => {\n    const data = await api.queryAllPages<{\n      taxonomies: PaginatedRecords<pubTypes.PubTaxonomy>\n    }>(fetchPublicTaxaQuery, {}, { dataProperty: 'taxonomies', onRecords })\n    const { records } = data.taxonomies\n\n    return records.map(\n      ({ taxonomyId: id, scientificName: name, parentTaxonomyId: parentId, synonyms: synonymsJson, ...rest }) =>\n        deNull(\n          {\n            id,\n            name,\n            levelRankOrder: 0, // reassigned in selector\n            parentId,\n            synonyms: synonymsJson ? JSON.parse(synonymsJson) : [],\n            levelName: '', // in-fill for typing\n            notes: '', // in-fill for typing\n            isTargetEffort: false, // in-fill for typing\n            ...rest,\n          },\n          {}\n        )\n    )\n  }\n","import gql from 'graphql-tag'\n\nimport { Api } from '../../../data/api'\n\nexport const fetchPublicTaxaSiteIdsByTaxonIdQuery = gql`\n  query ($taxonId: Int!) {\n    taxaSites(taxonomyId: $taxonId)\n  }\n`\n\nexport const fetchPublicTaxaSiteIdsByTaxonId =\n  (api: Api) =>\n  async (taxonId: number): Promise<number[]> => {\n    const data = await api.query<{\n      taxaSites: number[]\n    }>(fetchPublicTaxaSiteIdsByTaxonIdQuery, { taxonId })\n    return data.taxaSites\n  }\n","import log from 'loglevel'\n\nlet domain = process.env.REACT_APP_DOMAIN\nif (process.env.NODE_ENV && process.env.NODE_ENV === 'development') {\n  domain = 'localhost'\n  // basename = ''\n}\nlog.debug('config: ', { domain })\n\nexport const endpoints = {\n  graphql: `${process.env.REACT_APP_GRAPHQL}` as string,\n  public_graphql: `${process.env.REACT_APP_PUBLIC_GRAPHQL}` as string,\n}\n\n/**\n * Here are the App defaults we might want to change\n */\nexport const appDefaults = {\n  apiTimeout: 20000, // ms timeout for API Queries\n}\n\nexport const redirectUrl = new URL(\n  process.env.PUBLIC_URL.endsWith('/') ? process.env.PUBLIC_URL : process.env.PUBLIC_URL + '/',\n  window.location.origin\n)\n\nlog.debug('RedirectUrl', { redirectUrl, publicUrl: process.env.PUBLIC_URL })\n","import { atom, useRecoilValue } from 'recoil'\nimport { endpoints } from '../../config'\nimport { Api, GraphApi } from '../../data/api'\n\nexport const publicApiAtom = atom({\n  key: 'publicApiAtom',\n  default: new GraphApi(endpoints.public_graphql, null, () => undefined),\n  dangerouslyAllowMutability: true,\n})\n\nexport const usePublicApi = (): Api => useRecoilValue(publicApiAtom)\n","import { Lookups } from '@namcbugdb/common'\nimport { sortBy } from 'lodash'\nimport { atom, selector, selectorFamily } from 'recoil'\n\nimport { fetchLookups } from '../../data/calls'\nimport { Taxon } from '../../types'\nimport { CriterionOption } from '../CriterionAutocomplete'\nimport { fetchPublicProjects } from './calls/fetchPublicProjects'\nimport { fetchPublicTaxa } from './calls/fetchPublicTaxa'\nimport { fetchPublicTaxaSiteIdsByTaxonId } from './calls/fetchPublicTaxaSiteIdsByTaxonId'\nimport { publicApiAtom } from './publicApi'\nimport { PublicMapSite } from './types'\n\nexport const publicSitesAtom = atom<PublicMapSite[]>({\n  key: 'publicSitesAtom',\n  default: [],\n})\n\nexport const selectPublicLookups = selector<Lookups>({\n  key: 'selectPublicLookups',\n  get: async ({ get }) => {\n    const publicApi = get(publicApiAtom)\n    return fetchLookups(publicApi)()\n  },\n})\n\nexport const selectPublicProjectOptions = selector<CriterionOption<number>[]>({\n  key: 'selectPublicProjectOptions',\n  get: async ({ get }) => {\n    const publicApi = get(publicApiAtom)\n\n    const projects = await fetchPublicProjects(publicApi)()\n    return sortBy(projects, (project) => project.projectName).map(({ projectId: id, projectName: name }) => ({\n      id,\n      optionLabel: name,\n      chipLabel: `in project ${name}`,\n    }))\n  },\n})\n\nexport const selectPublicUsStateOptions = selector<CriterionOption<number>[]>({\n  key: 'selectPublicUsStateOptions',\n  get: async ({ get }) => {\n    const lookup = get(selectPublicLookups).geo?.states\n    if (!lookup) throw new Error('Missing lookup in query')\n    return sortBy(lookup, (usState) => usState.name).map(({ id, name }) => ({\n      id,\n      optionLabel: name,\n      chipLabel: `in ${name}`,\n    }))\n  },\n})\n\nexport const selectPublicTypeOptions = selector<CriterionOption<number>[]>({\n  key: 'selectPublicTypeOptions',\n  get: async ({ get }) => {\n    const lookup = get(selectPublicLookups).sample?.sampleTypes\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup.map(({ id, name }) => ({\n      id,\n      optionLabel: name,\n      chipLabel: `type is ${name}`,\n    }))\n  },\n})\n\nexport const selectPublicMethodOptions = selector<CriterionOption<number>[]>({\n  key: 'selectPublicMethodOptions',\n  get: async ({ get }) => {\n    const lookup = get(selectPublicLookups).sample?.sampleMethods\n    if (!lookup) throw new Error('Missing lookup in query')\n    return lookup.map(({ id, name }) => ({\n      id,\n      optionLabel: name,\n      chipLabel: `method is ${name}`,\n    }))\n  },\n})\n\nexport const selectPublicTaxa = selector<Taxon[]>({\n  key: 'selectPublicTaxa',\n  get: async ({ get }) => {\n    const publicApi = get(publicApiAtom)\n    return fetchPublicTaxa(publicApi)()\n  },\n})\n\nexport const selectPublicTaxaSiteIdsByTaxonId = selectorFamily<number[], number>({\n  key: 'PublicMap/selectPublicTaxaSiteIdsByTaxonId',\n  get:\n    (id) =>\n    async ({ get }) => {\n      const publicApi = get(publicApiAtom)\n      return fetchPublicTaxaSiteIdsByTaxonId(publicApi)(id)\n    },\n})\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport { ReadOnlyField } from '../ReadOnlyField'\n\nimport { withSuspense } from '../withSuspense'\nimport { TaxonomySelectField } from '../TaxonomyField'\nimport { useRecoilValue } from 'recoil'\nimport {\n  selectPublicMethodOptions,\n  selectPublicProjectOptions,\n  selectPublicTaxa,\n  selectPublicTypeOptions,\n  selectPublicUsStateOptions,\n} from './selectors'\nimport { CriterionAutocomplete, CriterionFieldProps } from '../CriterionAutocomplete'\n\nexport const ProjectCriterionField = withSuspense(\n  (props: CriterionFieldProps<number>): JSX.Element => {\n    const options = useRecoilValue(selectPublicProjectOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"Project\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"US State\" />\n)\n\nexport const UsStateCriterionField = withSuspense(\n  (props: CriterionFieldProps<number>): JSX.Element => {\n    const options = useRecoilValue(selectPublicUsStateOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"US State\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"US State\" />\n)\n\nexport const TaxonomyCriterionField = ({ value, onChange, gridArea }: CriterionFieldProps<number>): JSX.Element => {\n  const taxa = useRecoilValue(selectPublicTaxa)\n  const handleChange = (newId: number | null) => {\n    onChange(\n      newId === null\n        ? null\n        : {\n            id: newId,\n            optionLabel: '',\n            chipLabel: `contains ${taxa.find((t) => t.id === newId)?.name}`,\n          }\n    )\n  }\n  return (\n    <TaxonomySelectField\n      label=\"Taxonomy\"\n      options={taxa}\n      value={value && value.id}\n      onChange={handleChange}\n      gridArea={gridArea}\n      ungrouped\n    />\n  )\n}\n\nexport const TypeCriterionField = withSuspense(\n  (props: CriterionFieldProps<number>): JSX.Element => {\n    const options = useRecoilValue(selectPublicTypeOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"Sample Type\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"Sample Type\" />\n)\n\nexport const MethodCriterionField = withSuspense(\n  (props: CriterionFieldProps<number>): JSX.Element => {\n    const options = useRecoilValue(selectPublicMethodOptions)\n    return <CriterionAutocomplete {...props} options={options} label=\"Sample Method\" />\n  },\n  ({ gridArea }) => <ReadOnlyField css={{ gridArea }} value={<MuiSkeleton />} label=\"Sample Method\" />\n)\n","import gql from 'graphql-tag'\nimport { PaginatedRecords, pubTypes } from '@namcbugdb/common'\n\nimport { Api } from '../../../data/api'\nimport { PublicMapSite } from '../types'\n\nexport const fetchPublicSitesQuery = gql`\n  query ($offset: Int) {\n    sites(limit: 10000, offset: $offset) {\n      records {\n        siteId\n        siteName\n        longitude\n        latitude\n        usStateId\n        methodIds\n        typeIds\n        projectIds\n        years\n      }\n      nextOffset\n    }\n  }\n`\n\nexport const transformPublicSite = ({ siteId: id, siteName: name, ...rest }: pubTypes.PubSite): PublicMapSite => ({\n  id,\n  name,\n  ...rest,\n})\n\nexport const fetchPublicSites =\n  (api: Api) =>\n  async (firstOffset: number, lastOffset: number): Promise<PublicMapSite[]> => {\n    const data = await api.queryAllPages<{ sites: PaginatedRecords<pubTypes.PubSite> }>(\n      fetchPublicSitesQuery,\n      {},\n      { dataProperty: 'sites', firstOffset, lastOffset }\n    )\n    return data.sites.records.map(transformPublicSite)\n  }\n","import gql from 'graphql-tag'\n\nimport { ReportDataRow } from '../../../types'\nimport { Api } from '../../../data/api'\n\nexport interface PublicCsvDownloadInput {\n  projectId?: number\n  usStateId?: number\n  typeId?: number\n  methodId?: number\n  taxonomyId?: number\n  siteId?: number\n  fromYear?: number\n  toYear?: number\n}\n\nexport const fetchPublicCsvDownloadQuery = gql`\n  query ($offset: Int!, $filters: CSVFiltersInput!) {\n    csvDownload(limit: 1000, offset: $offset, filters: $filters) {\n      records\n      nextOffset\n    }\n  }\n`\n\nexport const fetchPublicCsvDownload =\n  (api: Api) =>\n  async (\n    filters: PublicCsvDownloadInput,\n    offset: number\n  ): Promise<{ records: ReportDataRow[]; nextOffset: number | null }> => {\n    const data = await api.query<{ csvDownload: { records: ReportDataRow[]; nextOffset: number | null } }>(\n      fetchPublicCsvDownloadQuery,\n      {\n        filters,\n        offset,\n      }\n    )\n\n    return data.csvDownload\n  }\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useState } from 'react'\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft'\nimport MuiIconButton from '@mui/material/IconButton'\nimport MuiButton from '@mui/material/Button'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiCircularProgress from '@mui/material/CircularProgress'\nimport MenuIcon from '@mui/icons-material/Menu'\nimport dayjs from 'dayjs'\nimport produce from 'immer'\nimport { intersection, range, uniq } from 'lodash'\n// import log from 'loglevel'\n\nimport { SitesMap, useSitesMapController } from '../SitesMap'\nimport { ReportDataRow, Site } from '../../types'\nimport { PublicMapSite } from './types'\nimport { Filter, FilterChips } from '../Filters'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport {\n  MethodCriterionField,\n  ProjectCriterionField,\n  TaxonomyCriterionField,\n  TypeCriterionField,\n  UsStateCriterionField,\n} from './CriterionFields'\nimport { formatNumber, pluralize } from '../../lib/formats'\n\nimport { LinearProgress } from '../LinearProgress'\nimport { Title } from '../Title'\nimport { downloadWorkbookAsCsv } from '../../lib/excel/downloadWorkbook'\nimport { SelectField } from '../SelectField'\nimport { useRecoilCallback, useRecoilState } from 'recoil'\nimport { useNotifications } from '../AppNotifications'\nimport { usePublicApi } from './publicApi'\nimport { publicSitesAtom, selectPublicTaxaSiteIdsByTaxonId } from './selectors'\nimport { fetchPublicSites } from './calls/fetchPublicSites'\n\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { fetchPublicCsvDownload } from './calls/fetchPublicCsvDownload'\nimport { createSingleTableWorkbook } from '../../lib/excel/singleTableUtil'\nimport { CriterionOption } from '../CriterionAutocomplete'\n\ninterface CriteriaFields {\n  taxon: CriterionOption<number> | null\n  project: CriterionOption<number> | null\n  usState: CriterionOption<number> | null\n  site: CriterionOption<number> | null\n  fromYear: number\n  toYear: number\n  type: CriterionOption<number> | null\n  method: CriterionOption<number> | null\n}\n\nconst getInitialCriteriaFields = (): CriteriaFields => ({\n  taxon: null,\n  project: null,\n  usState: null,\n  site: null,\n  fromYear: 0,\n  toYear: 0,\n  type: null,\n  method: null,\n})\n\nexport const PublicMap = (): JSX.Element => {\n  const publicApi = usePublicApi()\n\n  const [displayFilters, setDisplayFilters] = useState<Filter<PublicMapSite>[]>([])\n  const [filtered, setFiltered] = useState<PublicMapSite[]>([])\n  const [isFetchingTaxonSites, setIsFetchingTaxonSites] = useState(false)\n  const [cancelDownload, setCancelDownload] = useState<(() => void) | undefined>()\n\n  const [isSidebarOpen, setIsSidebarOpen] = useState(true)\n  const notifications = useNotifications()\n\n  // SITES\n\n  const [sites, setSites] = useRecoilState(publicSitesAtom)\n  const [isFetchingSites, setIsFetchingSites] = useState(true)\n\n  useEffect(() => {\n    const accumulateSites = async (from: number, to: number) => {\n      const fetched = await fetchPublicSites(publicApi)(from, to)\n      setSites(\n        produce((draft) => {\n          draft.push(...fetched)\n        })\n      )\n    }\n\n    Promise.all([accumulateSites(0, 10000), accumulateSites(10000, 20000), accumulateSites(20000, Infinity)])\n      .then(() => {\n        setIsFetchingSites(false)\n      })\n      .catch((err) => {\n        notifications.error(`Failed to fetch sites: ${err}`)\n      })\n  }, [])\n\n  const getSiteIdsByTaxonId = useRecoilCallback<[number], Promise<number[]>>(\n    ({ snapshot }) =>\n      async (taxonId: number) =>\n        snapshot.getPromise(selectPublicTaxaSiteIdsByTaxonId(taxonId)).catch((err) => {\n          notifications.error(`Failed to retrieve taxon data: ${err}`)\n          return []\n        })\n  )\n\n  // CRITERIA STATE\n\n  const [yearState, setYearState] = useState({\n    minYear: 0,\n    maxYear: 0,\n    shortcutYears: [] as number[],\n    yearOptions: [] as { value: number; label: string }[],\n  })\n  const { minYear, maxYear, shortcutYears, yearOptions } = yearState\n\n  useEffect(() => {\n    if (isFetchingSites) return\n\n    const maxYear = dayjs().year()\n    const minYear = sites.reduce((acc, site) => Math.min(acc, ...site.years), maxYear)\n    const numberOfShortcuts = 7\n    const shortcutYears = range(maxYear - numberOfShortcuts + 1, maxYear + 1)\n    const yearOptions = range(maxYear, minYear - 1, -1).map((year) => ({\n      value: year,\n      label: String(year),\n    }))\n\n    setYearState({ minYear, maxYear, shortcutYears, yearOptions })\n    updateCriteria((draft) => {\n      draft.fromYear = minYear\n      draft.toYear = maxYear\n    })\n  }, [isFetchingSites])\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [criteria, setCriteria, updateCriteria] = useUpdatableState<CriteriaFields>(getInitialCriteriaFields(), [])\n  const makeSetFieldValue = (fieldName: keyof CriteriaFields) => (value: unknown) => {\n    updateCriteria((draft) => {\n      Object.assign(draft, { [fieldName]: value })\n    })\n  }\n  const resetField = (fieldName: keyof CriteriaFields) => {\n    updateCriteria((draft) => {\n      Object.assign(draft, { [fieldName]: getInitialCriteriaFields()[fieldName] })\n    })\n  }\n\n  // FILTERS\n\n  useEffect(() => {\n    const criteriaFilters: Filter<PublicMapSite>[] = []\n    const fetchIdsPromises: Promise<number[]>[] = []\n\n    if (criteria.project) {\n      const { project } = criteria\n      criteriaFilters.push({\n        id: 'project',\n        label: project.chipLabel,\n        filterFn: ({ projectIds }) => projectIds.includes(project.id),\n        onDelete: () => resetField('project'),\n      })\n    }\n\n    if (criteria.usState) {\n      const { usState } = criteria\n      criteriaFilters.push({\n        id: 'usState',\n        label: usState.chipLabel,\n        filterFn: ({ usStateId }) => usStateId === usState.id,\n        onDelete: () => resetField('usState'),\n      })\n    }\n\n    if (criteria.taxon) {\n      const { taxon } = criteria\n      fetchIdsPromises.push(getSiteIdsByTaxonId(taxon.id))\n      criteriaFilters.push({\n        id: 'taxon',\n        label: taxon.chipLabel,\n        filterFn: () => true, // pass all filter; filtering is handled below\n        onDelete: () => resetField('taxon'),\n      })\n    }\n\n    if (criteria.type) {\n      const { type } = criteria\n      criteriaFilters.push({\n        id: 'type',\n        label: type.chipLabel,\n        filterFn: ({ typeIds }) => typeIds.includes(type.id),\n        onDelete: () => resetField('type'),\n      })\n    }\n\n    if (criteria.method) {\n      const { method } = criteria\n      criteriaFilters.push({\n        id: 'method',\n        label: method.chipLabel,\n        filterFn: ({ methodIds }) => methodIds.includes(method.id),\n        onDelete: () => resetField('method'),\n      })\n    }\n\n    if (criteria.site) {\n      const { site } = criteria\n      criteriaFilters.push({\n        id: 'site',\n        label: site.chipLabel,\n        filterFn: ({ id }) => id === site.id,\n        onDelete: () => resetField('site'),\n      })\n    }\n\n    if (criteria.fromYear !== minYear || criteria.toYear !== maxYear) {\n      const { fromYear, toYear } = criteria\n      const common = {\n        id: 'dateCriteria',\n        onDelete: () => {\n          updateCriteria((draft) => {\n            draft.fromYear = minYear\n            draft.toYear = maxYear\n          })\n        },\n      }\n\n      if (fromYear === toYear) {\n        criteriaFilters.push({\n          ...common,\n          label: `sampled in ${fromYear}`,\n          filterFn: ({ years }) => years.includes(fromYear),\n        })\n      } else {\n        const filterYears = range(fromYear, toYear + 1)\n        criteriaFilters.push({\n          ...common,\n          label: `sampled between ${fromYear} and ${toYear}`,\n          filterFn: ({ years }) => intersection(years, filterYears).length > 0,\n        })\n      }\n    }\n\n    setDisplayFilters(criteriaFilters)\n    let cancel = false\n\n    if (criteriaFilters.length === 0) {\n      setIsFetchingTaxonSites(false)\n      setFiltered(sites)\n    } else if (fetchIdsPromises.length === 0) {\n      setIsFetchingTaxonSites(false)\n      if (isFetchingSites) return\n      setFiltered(criteriaFilters.reduce<PublicMapSite[]>((acc, { filterFn }) => acc.filter(filterFn), sites))\n    } else {\n      setIsFetchingTaxonSites(true)\n      Promise.all(fetchIdsPromises).then((fetchIdsResults) => {\n        if (cancel || isFetchingSites) return\n        const filterIds = intersection(...fetchIdsResults)\n        const initialFiltered = criteriaFilters.reduce<PublicMapSite[]>(\n          (acc, { filterFn }) => acc.filter(filterFn),\n          sites\n        )\n        setIsFetchingTaxonSites(false)\n        setFiltered(initialFiltered.filter(({ id }) => filterIds.includes(id)))\n      })\n    }\n\n    return () => {\n      cancel = true\n    }\n  }, [criteria, sites, isFetchingSites])\n\n  // MAP\n\n  const onSiteClick = (site: Site) => {\n    const { id, name } = site\n    updateCriteria((draft) => {\n      draft.site = {\n        id: id,\n        optionLabel: `${name} [${id}]`,\n        chipLabel: `from site ${name}`,\n      }\n    })\n  }\n\n  const controller = useSitesMapController({ sites: filtered, onSiteClick, showSingleSiteHoverDetail: true })\n\n  useEffect(() => {\n    controller.smartFitAll() // fit filtered sites; if no sites, smartFitAll does nothing\n  }, [filtered])\n\n  // DOWNLOADING\n\n  const handleDownload = async () => {\n    const includeYearCriteria = criteria.fromYear !== minYear || criteria.toYear !== maxYear || undefined\n    const csvRows: ReportDataRow[] = []\n\n    let cancel = false\n    setCancelDownload(() => () => {\n      // note extra function wrapper otherwise setter does not set to callback\n      cancel = true\n    })\n\n    let currentOffset: number | null = 0\n\n    while (currentOffset !== null && !cancel) {\n      const { records, nextOffset } = await fetchPublicCsvDownload(publicApi)(\n        {\n          projectId: criteria.project?.id,\n          usStateId: criteria.usState?.id,\n          taxonomyId: criteria.taxon?.id,\n          typeId: criteria.type?.id,\n          methodId: criteria.method?.id,\n          siteId: criteria.site?.id,\n          fromYear: includeYearCriteria && criteria.fromYear,\n          toYear: includeYearCriteria && criteria.toYear,\n        },\n        currentOffset\n      )\n      csvRows.push(...records)\n      currentOffset = nextOffset\n    }\n    if (cancel) return\n\n    if (csvRows.length === 0) {\n      notifications.info('No data exists for the filtered samples.')\n      setCancelDownload(undefined)\n      return\n    }\n\n    const columnNames = csvRows.reduce<string[]>((acc, reportRow) => uniq([...acc, ...Object.keys(reportRow)]), [])\n    const wb = createSingleTableWorkbook({\n      wsName: 'data', // ignored in CSV\n      columns: columnNames.map((columnName) => ({\n        key: columnName,\n        header: columnName,\n      })),\n      rows: csvRows,\n    })\n    if (!wb) return\n    downloadWorkbookAsCsv(wb, `namc_data.csv`)\n    setCancelDownload(undefined)\n  }\n\n  const handleCancelDownload = () => {\n    if (!cancelDownload) return\n    cancelDownload()\n    setCancelDownload(undefined)\n  }\n\n  // RENDER\n\n  const isFiltered = filtered.length !== sites.length\n  const isFetching = isFetchingTaxonSites || isFetchingSites\n  const isDownloadingCsv = !!cancelDownload\n\n  const makeSetYear = (year: number) => () => {\n    updateCriteria((draft) => {\n      draft.fromYear = year\n      draft.toYear = year\n    })\n  }\n\n  return (\n    <div css={{ height: '100%', display: 'flex' }}>\n      <div\n        css={{\n          width: isSidebarOpen ? '400px' : 0,\n          boxSizing: 'border-box',\n          borderRight: '1px solid grey',\n          overflow: 'hidden',\n          transition: 'width 0.5s',\n        }}\n      >\n        <div css={{ width: '395px' }}>\n          <div css={{ display: 'flex', height: '40px', alignItems: 'center', position: 'relative' }}>\n            <div css={{ fontWeight: 'bold', marginLeft: '0.7rem' }}>Sample Filters</div>\n            <MuiIconButton css={{ position: 'absolute', right: 0 }} onClick={() => setIsSidebarOpen(false)}>\n              <ChevronLeftIcon />\n            </MuiIconButton>\n          </div>\n          <div css={{ padding: '0.5em' }}>\n            <div\n              css={{\n                margin: '0.5em 0',\n                display: 'grid',\n                gap: '0.75em',\n                gridTemplateColumns: '1fr 1fr',\n                gridTemplateAreas: `\n                  \"project      project\"\n                  \"usState      usState\"\n                  \"taxon        taxon\"\n                  \"type         type\"\n                  \"method       method\"\n                  \"fromYear     toYear\"\n                  \"dates        dates\"\n            `,\n              }}\n            >\n              <ProjectCriterionField\n                gridArea=\"project\"\n                value={criteria.project}\n                onChange={makeSetFieldValue('project')}\n              />\n              <TaxonomyCriterionField gridArea=\"taxon\" value={criteria.taxon} onChange={makeSetFieldValue('taxon')} />\n              <UsStateCriterionField\n                gridArea=\"usState\"\n                value={criteria.usState}\n                onChange={makeSetFieldValue('usState')}\n              />\n              <TypeCriterionField gridArea=\"type\" value={criteria.type} onChange={makeSetFieldValue('type')} />\n              <MethodCriterionField gridArea=\"method\" value={criteria.method} onChange={makeSetFieldValue('method')} />\n              {isFetchingSites ? (\n                <ReadOnlyField gridArea=\"fromYear\" label=\"From Year\" value={<MuiSkeleton css={{ width: '8em' }} />} />\n              ) : (\n                <SelectField\n                  gridArea=\"fromYear\"\n                  value={criteria.fromYear}\n                  onChange={(newValue) => {\n                    const newYear = Number(newValue)\n                    updateCriteria((draft) => {\n                      draft.fromYear = newYear\n                      draft.toYear = Math.max(draft.toYear, newYear)\n                    })\n                  }}\n                  label=\"From Year\"\n                  options={yearOptions}\n                />\n              )}\n              {isFetchingSites ? (\n                <ReadOnlyField gridArea=\"toYear\" label=\"To Year\" value={<MuiSkeleton css={{ width: '8em' }} />} />\n              ) : (\n                <SelectField\n                  gridArea=\"toYear\"\n                  value={criteria.toYear}\n                  onChange={(newValue) => {\n                    const newYear = Number(newValue)\n                    updateCriteria((draft) => {\n                      draft.toYear = newYear\n                      draft.fromYear = Math.min(draft.fromYear, newYear)\n                    })\n                  }}\n                  label=\"To Year\"\n                  options={yearOptions}\n                />\n              )}\n              <div css={{ gridArea: 'dates', display: 'flex' }}>\n                {isFetchingSites ? (\n                  <MuiSkeleton css={{ flex: 1 }} />\n                ) : (\n                  shortcutYears.map((year) => (\n                    <a\n                      key={year}\n                      onClick={makeSetYear(year)}\n                      css={{ display: 'inline-block', flex: 1, textAlign: 'center' }}\n                    >\n                      {year}\n                    </a>\n                  ))\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div\n        css={{\n          flex: 1,\n          display: 'flex',\n          flexDirection: 'column',\n        }}\n      >\n        <div css={{ display: 'flex', height: '40px', padding: '0 0.5em' }}>\n          {!isSidebarOpen && (\n            <MuiIconButton\n              onClick={() => {\n                setIsSidebarOpen(true)\n              }}\n            >\n              <MenuIcon />\n            </MuiIconButton>\n          )}\n          <div css={{ display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>\n            <Title>\n              NAMC <Title.Subtitle>Aquatic Invertebrates Database</Title.Subtitle>\n            </Title>\n          </div>\n        </div>\n        <div css={{ padding: '0 0.5em', flex: 1, display: 'flex', flexDirection: 'column' }}>\n          <div css={{ display: 'flex', alignItems: 'center', gap: '1em', padding: '0.5em 0' }}>\n            <div css={{ flex: 1 }}>\n              <FilterChips filters={displayFilters} joinLabel=\"and\" />\n            </div>\n            <div>\n              {(() => {\n                if (isFetchingSites) return <span>Fetching sites...</span>\n                if (!isFiltered) return <span>Showing all {sites.length} sites</span>\n                if (filtered.length === 0) return <span>No samples found</span>\n                return (\n                  <span>\n                    Found samples in <strong>{formatNumber(filtered.length)}</strong>{' '}\n                    {pluralize(filtered.length, 'site')}\n                  </span>\n                )\n              })()}\n            </div>\n            {isDownloadingCsv ? (\n              <MuiButton onClick={handleCancelDownload} variant=\"outlined\">\n                Cancel Download <MuiCircularProgress size={20} sx={{ marginLeft: '1em' }} />\n              </MuiButton>\n            ) : (\n              <MuiButton\n                onClick={handleDownload}\n                variant=\"outlined\"\n                disabled={isFetching || !isFiltered || filtered.length === 0}\n              >\n                Download CSV\n              </MuiButton>\n            )}\n          </div>\n          <div css={{ height: '4px' }}>{isFetching && <LinearProgress css={{ width: '100%' }} delayMs={200} />}</div>\n          <div css={{ flex: 1, position: 'relative' }}>\n            <SitesMap controller={controller} />\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const reportsColumnDefs = [\n  columnDef.textColumn({\n    field: 'name',\n    flex: 1,\n    minWidth: 200,\n  }),\n  columnDef.textColumn({\n    field: 'description',\n    flex: 2,\n    minWidth: 200,\n  }),\n  columnDef.linkColumn({\n    headerName: 'Download XLSX',\n    field: 'downloadXlsx',\n    width: 150,\n  }),\n  columnDef.linkColumn({\n    headerName: 'Download CSV',\n    field: 'downloadCsv',\n    width: 150,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport { uniq } from 'lodash'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { selectReports } from '../../data/selectors'\nimport { DataGrid, DataGridRecordCount, renderers } from '../DataGrid'\nimport { withSuspense } from '../withSuspense'\nimport { reportsColumnDefs } from './columnDefs'\nimport { fetchReportDataByReportId } from '../../data/calls'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { createSingleTableWorkbook } from '../../lib/excel/singleTableUtil'\nimport { downloadWorkbook, downloadWorkbookAsCsv } from '../../lib/excel/downloadWorkbook'\nimport { Filter, FilterChips } from '../Filters'\nimport { Report } from '../../types'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\n\nexport interface ReportRow extends Report {\n  downloadXlsx: {\n    label: string\n    onClick: () => void\n  }\n  downloadCsv: {\n    label: string\n    onClick: () => void\n  }\n}\n\nconst textFilterState = atom({\n  key: 'ReportsListing/textFilterState',\n  default: '',\n})\n\nexport const ReportsListing = withSuspense(\n  () => {\n    const api = useApi()\n    const notifications = useNotifications()\n    const reports = useRecoilValue(selectReports)\n\n    // STATE AND REFS\n\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n      useRecoilState(textFilterState)\n    )\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<Report>[] = []\n\n      if (textFilterDebounced) {\n        result.push({\n          id: 'text',\n          label: `Name/Description contains \"${textFilterDebounced}\"`,\n          filterFn: ({ name, description }) =>\n            name.toLowerCase().includes(textFilterDebounced.toLowerCase()) ||\n            description.toLowerCase().includes(textFilterDebounced.toLowerCase()),\n          onDelete: clearTextFilter,\n        })\n      }\n\n      return result\n    }, [textFilterDebounced])\n\n    const rows = useMemo<ReportRow[]>(() => {\n      const filtered = filters.reduce<Report[]>((acc, { filterFn }) => acc.filter(filterFn), reports)\n      return filtered.map(({ id, name, description }) => {\n        const createWorkbook = async () => {\n          try {\n            const cancelNotification = notifications.info('Still creating report...', 2500)\n            const data = await fetchReportDataByReportId(api)(id)\n            cancelNotification()\n            const columnNames = data.reduce<string[]>((acc, reportRow) => uniq([...acc, ...Object.keys(reportRow)]), [])\n            return createSingleTableWorkbook({\n              wsName: name,\n              columns: columnNames.map((columnName) => ({\n                key: columnName,\n                header: columnName,\n              })),\n              rows: data,\n            })\n          } catch (err) {\n            notifications.error(`Failed to create report: ${err}`)\n          }\n        }\n\n        return {\n          id,\n          name,\n          description,\n          downloadXlsx: {\n            label: 'Download XLSX',\n            onClick: async () => {\n              const wb = await createWorkbook()\n              if (!wb) return\n              downloadWorkbook(wb, `Report ${name}.xlsx`)\n            },\n          },\n          downloadCsv: {\n            label: 'Download CSV',\n            onClick: async () => {\n              const wb = await createWorkbook()\n              if (!wb) return\n              downloadWorkbookAsCsv(wb, `Report ${name}.csv`)\n            },\n          },\n        }\n      })\n    }, [reports, filters])\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', gap: '0.5em' }}>\n          <TextFilterField value={textFilter} onChange={setTextFilter} label=\"Report Name or Description\" />\n        </div>\n        <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n          <FilterChips filters={filters} joinLabel=\"and\" />\n          <DataGridRecordCount total={reports.length} visible={rows.length} descriptor=\"report\" />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<ReportRow> rows={rows} columnDefs={reportsColumnDefs} frameworkComponents={renderers} />\n        </div>\n      </div>\n    )\n  },\n  () => <MuiSkeleton variant=\"rectangular\" height=\"20em\" />\n)\n","import { ColDef } from 'ag-grid-community'\nimport { SamplePredictorValue } from '../../types'\nimport { columnDef } from '../DataGrid'\n\nexport const samplePredictorValuesColumnDefs = [\n  columnDef.textColumn({\n    field: 'predictorName',\n    flex: 2,\n    minWidth: 150,\n  }),\n  columnDef.booleanColumn({\n    headerName: 'Type',\n    field: 'isTemporal',\n    valueLabels: ['Spatial', 'Temporal'],\n    flex: 1,\n    minWidth: 120,\n  }),\n  columnDef.textColumn({\n    field: 'predictorValue',\n    flex: 1,\n    minWidth: 150,\n  }),\n  columnDef.dateColumn({\n    headerName: 'Calculation Date',\n    field: 'updatedDate',\n    flex: 1,\n    minWidth: 150,\n  }),\n  columnDef.textColumn({\n    field: 'status',\n    valueFormatter: ({ value }: { value: SamplePredictorValue['status'] }) => {\n      switch (value) {\n        case 'current':\n          return 'Valid'\n        case 'missing':\n          return 'Missing'\n        case 'expired':\n          return 'Expired'\n      }\n    },\n    flex: 1,\n    minWidth: 120,\n  }),\n] as ColDef[]\n\nexport const sampleModelResultsColumnDefs = [\n  columnDef.textColumn({\n    field: 'modelName',\n    flex: 3,\n    minWidth: 150,\n  }),\n  columnDef.numberColumn({\n    headerName: 'Fixed Count',\n    field: 'fixedCount',\n    flex: 1,\n    minWidth: 120,\n  }),\n  columnDef.numberColumn({\n    field: 'modelResult',\n    flex: 1,\n    minWidth: 120,\n  }),\n  columnDef.textColumn({\n    field: 'condition',\n    flex: 1,\n    minWidth: 150,\n  }),\n  columnDef.textColumn({\n    field: 'notes',\n    flex: 3,\n    minWidth: 150,\n  }),\n  columnDef.dateColumn({\n    headerName: 'Calculation Date',\n    field: 'updatedDate',\n    flex: 1,\n    minWidth: 150,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { selectSamplePredictorValuesBySampleId } from '../../data/selectors'\nimport { SamplePredictorValue } from '../../types'\nimport { DataGrid, DataGridHeading, DataGridRecordCount, renderers } from '../DataGrid'\nimport { withSuspense } from '../withSuspense'\nimport { samplePredictorValuesColumnDefs } from './columnDefs'\n\nexport interface SamplePredictorValuesProps {\n  sampleId: number\n}\n\nexport const SamplePredictorValues = withSuspense(\n  ({ sampleId }: SamplePredictorValuesProps): JSX.Element => {\n    const rows = useRecoilValue(selectSamplePredictorValuesBySampleId(sampleId))\n    return (\n      <div css={{ flex: rows.length ? 1 : 0, minHeight: '10rem', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex' }}>\n          <DataGridHeading>Predictors</DataGridHeading>\n          <DataGridRecordCount\n            total={rows.length}\n            visible={rows.length}\n            descriptor=\"sample predictor value\"\n            css={{ marginLeft: 'auto' }}\n          />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<SamplePredictorValue>\n            rowIdProperty=\"predictorId\"\n            rows={rows}\n            columnDefs={samplePredictorValuesColumnDefs}\n            frameworkComponents={renderers}\n          />\n        </div>\n      </div>\n    )\n  },\n  () => (\n    <div css={{ minHeight: '10rem' }}>\n      <MuiSkeleton variant=\"rectangular\" height=\"10rem\" />\n    </div>\n  )\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { selectModelResultsBySampleId } from '../../data/selectors'\nimport { ModelResult } from '../../types'\nimport { DataGrid, DataGridHeading, DataGridRecordCount, renderers } from '../DataGrid'\nimport { withSuspense } from '../withSuspense'\nimport { sampleModelResultsColumnDefs } from './columnDefs'\n\nexport interface SampleModelResultsProps {\n  sampleId: number\n}\n\nexport const SampleModelResults = withSuspense(\n  ({ sampleId }: SampleModelResultsProps): JSX.Element => {\n    const rows = useRecoilValue(selectModelResultsBySampleId(sampleId))\n    return (\n      <div css={{ flex: rows.length ? 1 : 0, minHeight: '10rem', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex' }}>\n          <DataGridHeading>Models</DataGridHeading>\n          <DataGridRecordCount\n            total={rows.length}\n            visible={rows.length}\n            descriptor=\"model result\"\n            css={{ marginLeft: 'auto' }}\n          />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<ModelResult>\n            rowIdProperty=\"modelId\"\n            rows={rows}\n            columnDefs={sampleModelResultsColumnDefs}\n            frameworkComponents={renderers}\n          />\n        </div>\n      </div>\n    )\n  },\n  () => (\n    <div css={{ minHeight: '10rem' }}>\n      <MuiSkeleton variant=\"rectangular\" height=\"10rem\" />\n    </div>\n  )\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { selectSitesBySingleSiteId } from '../../data/selectors'\nimport { ReadOnlyField, ReadOnlyFieldProps } from '../ReadOnlyField'\nimport { withSuspense } from '../withSuspense'\n\nexport const WaterbodyNameField = withSuspense(\n  ({ siteId, ...props }: Omit<ReadOnlyFieldProps, 'value'> & { siteId: number }) => {\n    const sites = useRecoilValue(selectSitesBySingleSiteId(siteId))\n    return <ReadOnlyField {...props} value={sites[0].waterbodyName} />\n  },\n  (props) => <ReadOnlyField {...props} value={<MuiSkeleton />} />\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useCallback, useEffect, useState } from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiAutocomplete from '@mui/material/Autocomplete'\nimport MuiTextField from '@mui/material/TextField'\n\nimport {\n  allSitesAtom,\n  allSitesStatusAtom,\n  FETCH_ALL_SITES_STATUS,\n  useFetchAllSitesOptimized,\n} from '../../data/selectors'\nimport { Option } from '../AutocompleteField'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { useNavigate } from '../AppRouter'\n\ninterface SiteSelectFieldProps {\n  gridArea?: string\n  label?: string\n  onChange: (newValue: number) => void\n  readOnly?: boolean\n  value: number\n  valueLabel: string\n}\n\nexport const SiteSelectField = ({\n  gridArea,\n  label,\n  onChange,\n  readOnly,\n  value,\n  valueLabel,\n}: SiteSelectFieldProps): JSX.Element => {\n  const navigate = useNavigate()\n\n  const allSites = useRecoilValue(allSitesAtom)\n  const allSitesStatus = useRecoilValue(allSitesStatusAtom)\n  const fetchAllSitesOptimized = useFetchAllSitesOptimized()\n  const [text, setText] = useState('')\n  const [options, setOptions] = useState<Option<number>[]>([])\n\n  const getFilterSiteOptions = useCallback(\n    (value: number) =>\n      (options: Option<number>[], { inputValue }) => {\n        if (inputValue.length < 3 && value) {\n          const foundOption = options.find((option) => option.value === value)\n          if (!foundOption) return []\n          return [foundOption]\n        }\n        return options\n          .filter(({ label }) => {\n            return label.toLowerCase().includes(inputValue.toLowerCase())\n          })\n          .slice(0, 100) // 100 = max options to display\n      },\n    []\n  )\n\n  const handleTextChange = (e: React.SyntheticEvent, newValue: string) => {\n    setText(newValue)\n  }\n\n  useEffect(() => {\n    if (readOnly) return\n    switch (allSitesStatus) {\n      case FETCH_ALL_SITES_STATUS.unfetched: {\n        fetchAllSitesOptimized()\n        break\n      }\n      case FETCH_ALL_SITES_STATUS.fetched: {\n        setOptions(allSites.map(({ id, name }) => ({ value: id, label: `${name} [${id}]` })))\n      }\n    }\n  }, [allSitesStatus, readOnly])\n\n  if (readOnly)\n    return (\n      <ReadOnlyField\n        label=\"Site\"\n        gridArea={gridArea}\n        value={\n          <a\n            onClick={() => {\n              navigate.siteDetail({ siteId: value })\n            }}\n          >\n            {valueLabel}\n          </a>\n        }\n      />\n    )\n\n  if (options.length === 0) return <ReadOnlyField css={{ gridArea }} label={label} value={<MuiSkeleton />} />\n\n  const isOptionsPresented = text.length >= 3\n\n  return (\n    <MuiAutocomplete\n      inputValue={text}\n      onInputChange={handleTextChange}\n      options={isOptionsPresented ? options : []}\n      filterOptions={getFilterSiteOptions(value)}\n      noOptionsText={isOptionsPresented ? 'No sites found' : '...'}\n      getOptionLabel={(option) => option.label}\n      getOptionDisabled={(option) => !!option.disabled}\n      renderInput={(params) => <MuiTextField {...params} label={label} />}\n      onChange={(event, selected) => {\n        onChange(selected?.value)\n      }}\n      size=\"small\"\n      value={options.find((option) => option.value === value)}\n      css={{ gridArea }}\n      disableClearable\n    />\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useState } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport dayjs from 'dayjs'\n// import log from 'loglevel'\n\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport { Sample } from '../../types'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { DateField } from '../DateField'\nimport { TextField } from '../TextField'\nimport { NumberField } from '../NumberField'\nimport {\n  lookupListToOptions,\n  selectDesignTypes,\n  selectEcosystems,\n  selectEffortTypes,\n  selectHabitats,\n  selectMyUser,\n  selectSampleMethods,\n  selectSitesBySingleSiteId,\n  useInvalidate,\n} from '../../data/selectors'\nimport { SitesMapPreview } from '../SitesMap'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\nimport { useNotifications } from '../AppNotifications'\nimport { Divider, Menu } from '../Menu'\nimport { SamplePredictorValues } from './SamplePredictorValues'\nimport { SampleModelResults } from './SampleModelResults'\nimport { WaterbodyNameField } from './WaterbodyNameField'\nimport { AccordionPanel } from '../AccordionPanel'\nimport { Title } from '../Title'\nimport { formatUtcDateTimeToAppDate } from '../../lib/formats'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { deleteSample, updateSample } from '../../data/calls'\nimport { useApi } from '../../data/api'\nimport { round } from 'lodash'\nimport { SiteSelectField } from './SiteSelectField'\n\nexport interface SampleDetailProps {\n  sample: Sample\n}\n\nconst FIELD_SPLIT_PERCENT_PRECISION = 3\n\ntype Fields = Pick<\n  Sample,\n  | 'area'\n  | 'customerSiteCode'\n  | 'designTypeId'\n  | 'ecosystemId'\n  | 'effortTypeId'\n  | 'fieldNotes'\n  | 'habitatId'\n  | 'jarCount'\n  | 'labNotes'\n  | 'mesh'\n  | 'sampleDate'\n  | 'sampleLatitude'\n  | 'sampleLongitude'\n  | 'sampleMethodId'\n  | 'siteId'\n  | 'visitId'\n> & { fieldSplitPercent: number }\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'stopped' | 'started' | 'stopping' | 'deleting'\n  isDirty: boolean\n  values: Fields\n  lastValues?: Fields\n}\n\nconst getInitialState = ({ sample }: Pick<SampleDetailProps, 'sample'>): State => {\n  const {\n    area,\n    customerSiteCode,\n    designTypeId,\n    ecosystemId,\n    effortTypeId,\n    fieldNotes,\n    fieldSplit,\n    habitatId,\n    jarCount,\n    labNotes,\n    mesh,\n    sampleDate,\n    sampleLatitude,\n    sampleLongitude,\n    sampleMethodId,\n    siteId,\n    visitId,\n  } = sample\n  return {\n    editMode: 'stopped',\n    isDirty: false,\n    values: {\n      area,\n      customerSiteCode,\n      designTypeId,\n      ecosystemId,\n      effortTypeId,\n      fieldNotes,\n      fieldSplitPercent: fieldSplit && round(fieldSplit * 100, FIELD_SPLIT_PERCENT_PRECISION),\n      habitatId,\n      jarCount,\n      labNotes,\n      mesh,\n      sampleDate,\n      sampleLatitude,\n      sampleLongitude,\n      sampleMethodId,\n      siteId,\n      visitId,\n    },\n  }\n}\n\nconst isExpandedState = atom<boolean>({\n  key: 'SampleDetail/isExpandedState',\n  default: true,\n})\n\nexport const SampleDetail = ({ sample }: SampleDetailProps): JSX.Element => {\n  const navigate = useNavigate()\n  const api = useApi()\n  const invalidate = useInvalidate()\n  const notifications = useNotifications()\n  const user = useRecoilValue(selectMyUser)\n\n  // LOOKUP OPTIONS\n\n  const sampleMethodOptions = lookupListToOptions(useRecoilValue(selectSampleMethods))\n  const habitatOptions = lookupListToOptions(useRecoilValue(selectHabitats))\n  const ecosystemOptions = lookupListToOptions(useRecoilValue(selectEcosystems))\n  const effortTypeOptions = lookupListToOptions(useRecoilValue(selectEffortTypes))\n  const designTypeOptions = lookupListToOptions(useRecoilValue(selectDesignTypes))\n\n  // READ-ONLY FIELDS\n\n  const {\n    boxId, //\n    boxState,\n    customerName,\n    id,\n    measurements,\n    sampleTypeName,\n    siteName,\n    submittedByName,\n    usState,\n  } = sample\n\n  // STATE\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ sample }), [sample])\n  const [isPanelExpanded, setIsPanelExpanded] = useRecoilState(isExpandedState)\n  const [isConfirmDeleteOpen, setIsConfirmDeleteOpen] = useState(false)\n\n  const {\n    values: {\n      area,\n      customerSiteCode,\n      designTypeId,\n      ecosystemId,\n      effortTypeId,\n      fieldNotes,\n      fieldSplitPercent,\n      habitatId,\n      jarCount,\n      labNotes,\n      mesh,\n      sampleDate,\n      sampleLatitude,\n      sampleLongitude,\n      sampleMethodId,\n      siteId,\n      visitId,\n    },\n    editMode,\n    isDirty,\n  } = state\n\n  const errors: FieldErrors = (() => {\n    const result: FieldErrors = {\n      jarCount: !jarCount,\n      sampleLatitude: sampleLatitude === null && sampleLongitude !== null,\n      sampleLongitude: sampleLongitude === null && sampleLatitude !== null,\n    }\n    if (!Object.values(result).some((value) => value)) return undefined\n    return result\n  })()\n\n  const isStopped = editMode === 'stopped'\n  const isEditing = editMode === 'started'\n  const isSaving = editMode === 'stopping'\n  const isDeleting = editMode === 'deleting'\n\n  // HANDLERS\n\n  const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n    updateState((draft) => {\n      Object.assign(draft.values, { [fieldName]: value })\n      draft.isDirty = true\n    })\n  }\n  const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n  const handleEdit = () => {\n    setIsPanelExpanded(true)\n    updateState((draft) => {\n      draft.editMode = 'started'\n      draft.lastValues = draft.values\n    })\n  }\n\n  const handleCancel = () => {\n    updateState((draft) => {\n      if (!draft.lastValues) throw new Error('no values to revert to')\n      draft.editMode = 'stopped'\n      draft.values = draft.lastValues\n      draft.isDirty = false\n    })\n  }\n\n  const handleSave = async () => {\n    try {\n      updateState((draft) => {\n        draft.editMode = 'stopping'\n      })\n      const sampleInput = {\n        area,\n        customerSiteCode: customerSiteCode.trim(),\n        designTypeId,\n        ecosystemId,\n        effortTypeId,\n        fieldNotes: fieldNotes.trim(),\n        fieldSplit: fieldSplitPercent / 100,\n        habitatId,\n        jarCount,\n        labNotes: labNotes.trim(),\n        mesh,\n        sampleDate,\n        sampleLatitude,\n        sampleLongitude,\n        sampleMethodId,\n        siteId,\n        visitId: visitId.trim(),\n      }\n      await updateSample(\n        api,\n        invalidate\n      )({\n        ...sampleInput,\n        id: sample.id,\n      })\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n        draft.isDirty = false\n      })\n    } catch (err) {\n      notifications.error(`Failed to save: ${err}`)\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n  }\n\n  const handleDelete = async () => {\n    try {\n      if (!sample) throw new Error('No sample.')\n      updateState((draft) => {\n        draft.editMode = 'deleting'\n      })\n      await deleteSample(api, invalidate)(sample)\n      notifications.info(`Deleted sample ${id}`)\n      navigate.boxDetail({ boxId })\n    } catch (err) {\n      notifications.error(`Failed to delete: ${err}`)\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n      })\n    }\n  }\n\n  // RENDER\n\n  const { sortEndDate, sortStartDate, sorterName } = sample\n  const sortState = (() => {\n    if (sortEndDate) return `${sorterName} on ${formatUtcDateTimeToAppDate(sortEndDate)}`\n    if (!sortStartDate) return 'Not sorted'\n    return `Started by ${sorterName} on ${formatUtcDateTimeToAppDate(sortStartDate)}`\n  })()\n\n  const { identifierName, identificationEndDate, identificationStartDate } = sample\n  const identificationState = (() => {\n    if (identificationEndDate)\n      return `${identifierName ?? 'Unknown'} on ${formatUtcDateTimeToAppDate(identificationEndDate)}`\n    if (!identificationStartDate) return 'Not identified'\n    return `Started by ${identifierName} on ${formatUtcDateTimeToAppDate(identificationStartDate)}`\n  })()\n\n  const canUpdate = user.hasPermission(NAMCResource.samples, GrantAction.updateAny)\n  const canDelete = user.hasPermission(NAMCResource.samples, GrantAction.deleteAny)\n\n  return (\n    <>\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <AccordionPanel\n          value={isPanelExpanded}\n          onChange={setIsPanelExpanded}\n          locked={isEditing}\n          summary={\n            <Title>\n              Sample {id} <Title.Subtitle>(Box {boxId})</Title.Subtitle>\n            </Title>\n          }\n          actions={\n            <div css={{ display: 'flex', gap: '0.5em' }}>\n              {isStopped && (canUpdate || canDelete) && (\n                <Menu\n                  label=\"Actions\"\n                  disabled={isDeleting}\n                  items={[\n                    {\n                      key: 'sorting',\n                      label: 'Sorting',\n                      onClick: () => navigate.sampleSorting({ sampleId: sample.id }),\n                    },\n                    {\n                      key: 'taxonomy',\n                      label: 'Taxonomy',\n                      onClick: () => navigate.sampleTaxonomyIdentification({ sampleId: sample.id }),\n                    },\n                    Divider,\n                    {\n                      key: 'edit',\n                      label: 'Edit Sample',\n                      onClick: handleEdit,\n                      disabled: !canUpdate,\n                    },\n                    Divider,\n                    {\n                      key: 'delete',\n                      label: 'Delete Sample',\n                      onClick: () => {\n                        setIsConfirmDeleteOpen(true)\n                      },\n                      disabled: !canDelete,\n                    },\n                  ]}\n                />\n              )}\n              {(isEditing || isSaving) && (\n                <>\n                  <MuiButton onClick={handleCancel} variant=\"outlined\" disabled={isSaving}>\n                    Cancel\n                  </MuiButton>\n                  <MuiButton onClick={handleSave} variant=\"contained\" disabled={!isDirty || isSaving || !!errors}>\n                    Save\n                  </MuiButton>\n                </>\n              )}\n            </div>\n          }\n        >\n          <div\n            css={{\n              // flex: 1,\n              display: 'grid',\n              gap: '0.75em',\n              gridTemplateColumns: 'repeat(4, 1fr)',\n              gridTemplateAreas: `\n                \"boxId           customerName         customerName      map\"\n                \"boxState        submittedByName      siteId            map\"\n                \"measurements    usState              customerSiteCode  map\"\n                \"sampleMethodId  sampleDate            waterbodyName    map\"\n                \"habitatId       sampleTypeName       sampleLatitude    map\"\n                \"ecosystemId     jarCount             sampleLongitude   map\"\n                \"effortTypeId    fieldSplitPercent    area              sortState\"\n                \"designTypeId    mesh                 visitId           identificationState\"\n                \"fieldNotes      fieldNotes           labNotes          labNotes\"\n              `,\n            }}\n          >\n            <div\n              css={{\n                gridArea: 'map',\n                minHeight: '300px',\n              }}\n            >\n              <SitesMapPreview sitesListingSource={null} sitesSelector={selectSitesBySingleSiteId(siteId)} />\n            </div>\n            <ReadOnlyField\n              gridArea=\"boxId\"\n              label=\"Box ID\"\n              value={\n                <a\n                  onClick={() => {\n                    navigate.boxDetail({ boxId })\n                  }}\n                >\n                  {boxId}\n                </a>\n              }\n            />\n            <ReadOnlyField gridArea=\"customerName\" label=\"Customer\" value={customerName} />\n            <ReadOnlyField gridArea=\"boxState\" label=\"Box State\" value={boxState} />\n            <ReadOnlyField gridArea=\"submittedByName\" label=\"Submitted By\" value={submittedByName} />\n            <SiteSelectField\n              gridArea=\"siteId\"\n              label=\"Site\"\n              value={siteId}\n              onChange={makeFieldChangeHandler('siteId')}\n              valueLabel={siteName}\n              readOnly={!isEditing}\n            />\n            <ReadOnlyField gridArea=\"measurements\" label=\"Measurements\" value={measurements} />\n            <ReadOnlyField gridArea=\"usState\" label=\"US State\" value={usState} />\n            <TextField\n              gridArea=\"customerSiteCode\"\n              label=\"Customer Site Code\"\n              value={customerSiteCode}\n              onChange={makeFieldChangeHandler('customerSiteCode')}\n              readOnly={!isEditing}\n              error={errors?.customerSiteCode}\n              maxLength={100}\n            />\n            <AutocompleteField\n              gridArea=\"sampleMethodId\"\n              label=\"Sample Method\"\n              value={sampleMethodId}\n              onChange={makeFieldChangeHandler('sampleMethodId')}\n              readOnly={!isEditing}\n              error={errors?.sampleMethodId}\n              options={sampleMethodOptions}\n            />\n            <DateField\n              gridArea=\"sampleDate\"\n              label=\"Sample Date\"\n              value={sampleDate}\n              onChange={makeFieldChangeHandler('sampleDate')}\n              readOnly={!isEditing}\n              error={errors?.sampleDate}\n              max={dayjs().format('YYYY-MM-DD')}\n            />\n            <WaterbodyNameField gridArea=\"waterbodyName\" label=\"Waterbody Name\" siteId={siteId} />\n            <AutocompleteField\n              gridArea=\"habitatId\"\n              label=\"Habitat\"\n              value={habitatId}\n              onChange={makeFieldChangeHandler('habitatId')}\n              readOnly={!isEditing}\n              options={habitatOptions}\n            />\n            <ReadOnlyField gridArea=\"sampleTypeName\" label=\"Sample Type\" value={sampleTypeName} />\n            <NumberField\n              gridArea=\"sampleLatitude\"\n              label=\"Sampled Latitude\"\n              value={sampleLatitude}\n              onChange={makeFieldChangeHandler('sampleLatitude')}\n              readOnly={!isEditing}\n              error={errors?.sampleLatitude}\n              min={-90}\n              max={90}\n            />\n            <AutocompleteField\n              gridArea=\"ecosystemId\"\n              label=\"Ecosystem\"\n              value={ecosystemId}\n              onChange={makeFieldChangeHandler('ecosystemId')}\n              readOnly={!isEditing}\n              options={ecosystemOptions}\n              isClearable\n            />\n            <NumberField\n              gridArea=\"jarCount\"\n              label=\"Jar Count\"\n              value={jarCount}\n              onChange={makeFieldChangeHandler('jarCount')}\n              readOnly={!isEditing}\n              error={errors?.jarCount}\n              min={1}\n              precision={0}\n            />\n            <NumberField\n              gridArea=\"sampleLongitude\"\n              label=\"Sampled Longitude\"\n              value={sampleLongitude}\n              onChange={makeFieldChangeHandler('sampleLongitude')}\n              readOnly={!isEditing}\n              error={errors?.sampleLongitude}\n              min={-180}\n              max={180}\n            />\n            <AutocompleteField\n              gridArea=\"effortTypeId\"\n              label=\"Effort Type\"\n              value={effortTypeId}\n              onChange={makeFieldChangeHandler('effortTypeId')}\n              readOnly={!isEditing}\n              options={effortTypeOptions}\n              isClearable\n            />\n            <NumberField\n              gridArea=\"fieldSplitPercent\"\n              label=\"Field Split %\"\n              value={fieldSplitPercent}\n              onChange={makeFieldChangeHandler('fieldSplitPercent')}\n              readOnly={!isEditing}\n              error={errors?.fieldSplitPercent}\n              min={0}\n              max={100}\n              precision={FIELD_SPLIT_PERCENT_PRECISION}\n            />\n            <NumberField\n              gridArea=\"area\"\n              label=\"Area Sampled (m²)\"\n              value={area}\n              onChange={makeFieldChangeHandler('area')}\n              readOnly={!isEditing}\n              error={errors?.area}\n              min={0}\n              max={5}\n            />\n            <ReadOnlyField\n              gridArea=\"sortState\"\n              label=\"Sorting\"\n              value={\n                <a\n                  onClick={() => {\n                    navigate.sampleSorting({ sampleId: sample.id })\n                  }}\n                >\n                  {sortState}\n                </a>\n              }\n            />\n            <AutocompleteField\n              gridArea=\"designTypeId\"\n              label=\"Design Type\"\n              value={designTypeId}\n              onChange={makeFieldChangeHandler('designTypeId')}\n              readOnly={!isEditing}\n              options={designTypeOptions}\n              isClearable\n            />\n            <NumberField\n              gridArea=\"mesh\"\n              label=\"Mesh Size (μm)\"\n              value={mesh}\n              onChange={makeFieldChangeHandler('mesh')}\n              readOnly={!isEditing}\n              error={errors?.mesh}\n            />\n            <TextField\n              gridArea=\"visitId\"\n              label=\"Visit ID\"\n              value={visitId}\n              onChange={makeFieldChangeHandler('visitId')}\n              readOnly={!isEditing}\n              error={errors?.visitId}\n              maxLength={100}\n            />\n            <ReadOnlyField\n              gridArea=\"identificationState\"\n              label=\"Identification\"\n              value={\n                <a\n                  onClick={() => {\n                    navigate.sampleTaxonomyIdentification({ sampleId: sample.id })\n                  }}\n                >\n                  {identificationState}\n                </a>\n              }\n            />\n            <TextField\n              gridArea=\"fieldNotes\"\n              label=\"Field Notes\"\n              value={fieldNotes}\n              onChange={makeFieldChangeHandler('fieldNotes')}\n              readOnly={!isEditing}\n              error={errors?.fieldNotes}\n            />\n\n            <TextField\n              gridArea=\"labNotes\"\n              label=\"Lab Notes\"\n              value={labNotes}\n              onChange={makeFieldChangeHandler('labNotes')}\n              readOnly={!isEditing}\n              error={errors?.labNotes}\n            />\n          </div>\n        </AccordionPanel>\n        <SamplePredictorValues sampleId={sample.id} />\n        <div css={{ borderBottom: '1px solid lightgrey', height: '1px', margin: '1rem 0' }} />\n        <SampleModelResults sampleId={sample.id} />\n      </div>\n      <ConfirmationDialog\n        title=\"Confirm Delete Sample\"\n        isOpen={isConfirmDeleteOpen}\n        onClose={() => {\n          setIsConfirmDeleteOpen(false)\n        }}\n        onConfirm={handleDelete}\n      >\n        Are you sure you want to delete this sample?\n      </ConfirmationDialog>\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n    </>\n  )\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectSampleById } from '../../data/selectors'\nimport { SampleDetail as Component } from './SampleDetail'\nimport { Fallback } from './Fallback'\nimport { withSuspense } from '../withSuspense'\n\nexport interface SampleDetailProps {\n  sampleId: string | number\n}\n\nexport const SampleDetail = withSuspense(({ sampleId }: SampleDetailProps): JSX.Element => {\n  const sample = useRecoilValue(selectSampleById(Number(sampleId)))\n\n  if (sample === null) return <h2>Sample {sampleId} not found.</h2>\n\n  return <Component sample={sample} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { atom, useRecoilState } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nimport { Sample } from '../../types'\nimport { formatUtcDateTimeToAppDate } from '../../lib/formats'\nimport { AccordionPanel } from '../AccordionPanel'\nimport { Title } from '../Title'\nimport { SitesMapPreview } from '../SitesMap'\nimport { selectSitesBySingleSiteId } from '../../data/selectors'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { useNavigate } from '../AppRouter'\n\nconst isExpandedState = atom<boolean>({\n  key: 'SampleInfoPanel/isExpanded',\n  default: true,\n})\n\ninterface SampleInfoPanelProps {\n  sample: Sample\n  actions?: React.ReactNode\n}\n\nexport const SampleInfoPanel = ({ sample, actions = null }: SampleInfoPanelProps): JSX.Element => {\n  const navigate = useNavigate()\n  const [isExpanded, setIsExpanded] = useRecoilState(isExpandedState)\n\n  if (!sample) return <MuiSkeleton variant=\"rectangular\" />\n\n  const { id, boxId, sorterName = '', sampleDate, sortEndDate, customerName, siteName, siteId } = sample\n\n  return (\n    <AccordionPanel\n      value={isExpanded}\n      onChange={setIsExpanded}\n      summary={\n        <Title>\n          Sample {id} <Title.Subtitle>(Box {boxId})</Title.Subtitle>\n        </Title>\n      }\n      actions={actions}\n    >\n      <div\n        css={{\n          display: 'grid',\n          gap: '0.75em',\n          gridTemplateColumns: 'auto 1fr auto',\n          gridTemplateAreas: `\n            \"boxId        customerName      map\"\n            \"sampleDate   siteName          map\"\n            \"sortEndDate  sorterName        map\"\n            \".            .                 map\"\n          `,\n        }}\n      >\n        <div\n          css={{\n            gridArea: 'map',\n            minHeight: '300px',\n          }}\n        >\n          <SitesMapPreview sitesListingSource={null} sitesSelector={selectSitesBySingleSiteId(siteId)} />\n        </div>\n        <ReadOnlyField\n          gridArea=\"boxId\"\n          label=\"Box ID\"\n          value={\n            <a\n              onClick={() => {\n                navigate.boxDetail({ boxId })\n              }}\n            >\n              {boxId}\n            </a>\n          }\n        />\n        <ReadOnlyField gridArea=\"customerName\" label=\"Customer\" value={customerName} />\n        <ReadOnlyField gridArea=\"sampleDate\" label=\"Sample Date\" value={formatUtcDateTimeToAppDate(sampleDate)} />\n        <ReadOnlyField gridArea=\"sorterName\" label=\"Sorter\" value={sorterName} />\n        <ReadOnlyField gridArea=\"sortEndDate\" label=\"Sort Date\" value={formatUtcDateTimeToAppDate(sortEndDate)} />\n        <ReadOnlyField\n          gridArea=\"siteName\"\n          label=\"Site\"\n          value={\n            <a\n              onClick={() => {\n                navigate.siteDetail({ siteId })\n              }}\n            >\n              {siteName}\n            </a>\n          }\n        />\n      </div>\n    </AccordionPanel>\n  )\n}\n","import React from 'react'\nimport MuiButton from '@mui/material/Button'\nimport EditIcon from '@mui/icons-material/Edit'\nimport StopIcon from '@mui/icons-material/Stop'\n\nimport { Sample } from '../../types'\nimport { ControllerState, ControllerActions } from './componentController'\nimport { withTooltip } from '../withTooltip'\n\ninterface ToggleEditModeButtonProps {\n  userId: number\n  sample: Sample\n  editMode: ControllerState['editMode']\n  canStopOwn: boolean\n  canStopOther: boolean\n  actions: ControllerActions\n}\n\nexport const ToggleEditModeButton = ({\n  userId,\n  sample,\n  editMode,\n  canStopOwn,\n  canStopOther,\n  actions,\n}: ToggleEditModeButtonProps): JSX.Element | null => {\n  const isStartedByOther = sample.sortStartDate && !sample.sortEndDate && sample.sorterId !== userId\n\n  const error = (() => {\n    if (sample.boxState !== 'Active')\n      return 'The sorting for this sample cannot be edited because the box it is associated with is not currently active.'\n    if (isStartedByOther && !canStopOther) return 'Sorting for this sample is already underway by another user.'\n  })()\n\n  const isActive = (editMode !== 'stopped' && editMode !== 'starting') || isStartedByOther\n  const disabled =\n    !!error || editMode === 'starting' || editMode === 'stopping' || (editMode === 'started' && !canStopOwn)\n\n  return withTooltip(\n    <MuiButton\n      disabled={disabled}\n      onClick={() => {\n        if (editMode === 'started' || isStartedByOther) {\n          actions.stopSort()\n        } else {\n          actions.startSort()\n        }\n      }}\n      startIcon={isActive ? <StopIcon /> : <EditIcon />}\n      variant={isActive ? 'contained' : 'outlined'}\n    >\n      {isActive ? 'Stop Sorting' : 'Start Sorting'}\n    </MuiButton>,\n    error,\n    disabled\n  )\n}\n","import { round } from 'lodash'\n\nimport { SampleSortingProps, LAB_SPLIT_PERCENT_PRECISION } from './SampleSorting'\nimport { Sample } from '../../types'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { updateLabSort, startSort, stopSort } from '../../data/calls'\nimport { getCurrentDateTime } from '../../lib/formats'\nimport { useDeferredInvalidate } from '../../data/selectors'\n\ninterface Fields {\n  sorterId: number | ''\n  labSplitPercent: number | null\n  sorterCount: number | null\n  sortTime: number | null\n  elutriation: boolean\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\nexport type ControllerState = {\n  sample?: Sample\n  values: Fields\n  errors: FieldErrors\n  editMode: 'stopped' | 'starting' | 'started' | 'stopping'\n  persistence?: 'unsaved' | 'dirty' | 'saving' | 'saved'\n}\n\nexport interface ControllerActions {\n  reset: () => void\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  setFieldValue: (fieldName: keyof Fields, value: any) => void\n  startSort: () => void\n  stopSort: () => void\n  saveSort: () => void\n}\n\nconst initialState = {\n  values: { sorterId: '', labSplitPercent: null, sorterCount: null, sortTime: null, sortDate: '', elutriation: false },\n  editMode: 'stopped',\n  persistence: 'unsaved',\n  errors: undefined,\n} as ControllerState\n\nconst getFieldErrors = (values: Fields): FieldErrors => {\n  const errors = {\n    sorterId: !values.sorterId,\n    labSplitPercent: values.labSplitPercent === null,\n    sorterCount: values.sorterCount === null,\n    sortTime: values.sortTime === null,\n  }\n  if (!Object.values(errors).some((value) => value)) return undefined\n  return errors\n}\n\nexport const useComponentController = ({\n  sample,\n  user,\n  sorterUsers,\n}: SampleSortingProps): [ControllerState, ControllerActions] => {\n  const api = useApi()\n  const deferredInvalidate = useDeferredInvalidate()\n  const notifications = useNotifications()\n\n  const [state, setState, updateState] = useUpdatableState<ControllerState>(\n    initialState,\n    [] // reset action is called in component; normally this would be `[sample]` to ensure reset occurs when sample changes without unmount\n  )\n\n  const actions = {\n    reset: () => {\n      const { sorterId, sorterCount, sortTime, labSplit, elutriation } = sample\n      const values: Fields = {\n        sorterId: sorterId || '',\n        sorterCount,\n        sortTime,\n        labSplitPercent: labSplit && round(labSplit * 100, LAB_SPLIT_PERCENT_PRECISION),\n        elutriation: !!elutriation,\n      }\n\n      setState(() => ({\n        ...initialState,\n        sample,\n        userId: user.id,\n        values,\n        persistence: getFieldErrors(values) ? 'unsaved' : 'saved',\n        editMode: sample.sorterId === user.id && !sample.sortEndDate ? 'started' : 'stopped',\n      }))\n    },\n    setFieldValue: async (fieldName: keyof Fields, value: unknown) => {\n      if (!state.sample) throw new Error('No sample')\n      updateState((draft) => {\n        Object.assign(draft.values, { [fieldName]: value })\n        draft.persistence = 'dirty'\n      })\n    },\n    saveSort: async () => {\n      try {\n        const { sorterId, labSplitPercent, sorterCount, sortTime, elutriation } = state.values\n        if (\n          !state.sample?.id ||\n          sorterId === '' ||\n          labSplitPercent === null ||\n          sorterCount === null ||\n          sortTime === null\n        )\n          throw new Error('Missing values.')\n        const updatedSample = {\n          sampleId: state.sample.id,\n          sorterId,\n          labSplit: labSplitPercent / 100,\n          sorterCount,\n          sortTime,\n          elutriation,\n        }\n        updateState((draft) => {\n          draft.persistence = 'saving'\n        })\n        await updateLabSort(api, deferredInvalidate)(updatedSample)\n        const sorterName =\n          sorterUsers.find(({ id }) => id === updatedSample.sorterId)?.fullName ?? state.sample.sorterName\n        updateState((draft) => {\n          draft.persistence = 'saved'\n          Object.assign(draft.sample, { ...updatedSample, sorterName })\n        })\n      } catch (err) {\n        notifications.error(`Failed to update Lab Sort: ${err}`)\n        updateState((draft) => {\n          draft.persistence = 'dirty'\n        })\n      }\n    },\n    startSort: async () => {\n      if (!state.sample) throw new Error('No sample')\n      try {\n        updateState((draft) => {\n          draft.editMode = 'starting'\n        })\n        await startSort(api, deferredInvalidate)({ sampleId: state.sample.id })\n        updateState((draft) => {\n          if (!draft.sample) throw new Error('No sample.')\n          draft.editMode = 'started'\n          draft.values.sorterId = user.id\n          draft.sample.sorterId = user.id\n          draft.sample.sorterName = user.fullName\n        })\n      } catch (err) {\n        notifications.error(`Failed to start Lab Sort: ${err}`)\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n        })\n      }\n    },\n    stopSort: async () => {\n      if (!state.sample) throw new Error('No sample')\n      try {\n        updateState((draft) => {\n          draft.editMode = 'stopping'\n        })\n        await stopSort(api, deferredInvalidate)({ sampleId: state.sample.id })\n        const todayDate = getCurrentDateTime()\n        updateState((draft) => {\n          if (!draft.sample) throw new Error('No sample.')\n          draft.editMode = 'stopped'\n          draft.sample.sortEndDate = todayDate\n        })\n      } catch (err) {\n        notifications.error(`Failed to stop Lab Sort: ${err}`)\n        updateState((draft) => {\n          draft.editMode = 'started'\n        })\n      }\n    },\n  }\n\n  const errors = state.editMode === 'stopped' ? undefined : getFieldErrors(state.values)\n\n  return [{ ...state, errors }, actions]\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useMemo } from 'react'\nimport { NAMCResource, GrantAction } from '@namcbugdb/common'\nimport MuiButton from '@mui/material/Button'\n// import log from 'loglevel'\n\nimport { User, Sample, MyUser } from '../../types'\nimport { SampleInfoPanel } from '../SampleInfoPanel'\nimport { SelectField, SelectFieldProps } from '../SelectField'\nimport { NumberField } from '../NumberField'\nimport { CheckboxField } from '../CheckboxField'\nimport { ConfirmNavigateAway } from '../AppRouter'\nimport { ToggleEditModeButton } from './ToggleEditModeButton'\nimport { useComponentController } from './componentController'\n\nexport const LAB_SPLIT_PERCENT_PRECISION = 3\nexport interface SampleSortingProps {\n  sorterUsers: User[]\n  sample: Sample\n  user: MyUser\n}\n\nexport const SampleSorting = (props: SampleSortingProps): JSX.Element => {\n  const { sorterUsers: sorterUsersProp, sample, user } = props\n\n  // STATE\n\n  const sorterUsers = useMemo(() => {\n    const resultSorterUsers = [...sorterUsersProp]\n    if (!sorterUsersProp.find((sorterUser) => sorterUser.id === user.id)) resultSorterUsers.push(user)\n    return resultSorterUsers\n  }, [sorterUsersProp])\n\n  const [state, actions] = useComponentController({ sample, user, sorterUsers })\n  const {\n    values: { sorterId, labSplitPercent, sorterCount, sortTime, elutriation },\n    errors,\n    editMode,\n  } = state\n  const { setFieldValue } = actions\n  const isEditing = editMode === 'started'\n\n  // EFFECTS\n\n  useEffect(() => {\n    actions.reset()\n  }, [sample.id])\n\n  // RENDER\n\n  const sorterOptions: SelectFieldProps['options'] = sorterUsers.map((sorterUser) => ({\n    value: sorterUser.id,\n    label: sorterUser.fullName,\n  }))\n  if (sample.sorterId && !sorterUsers.find((sorterUser) => sorterUser.id === sorterId))\n    sorterOptions.push({\n      value: sorterId,\n      label: sample.sorterName,\n    })\n\n  const canSort = user.hasPermission(NAMCResource.sorting, GrantAction.updateOwn)\n  const isLabManager = user.hasPermission(NAMCResource.sorting, GrantAction.updateAny)\n  const canStopOwn = state.editMode === 'started' && state.persistence === 'saved'\n  const canStopOther = isLabManager\n  const isDirty = state.persistence === 'dirty'\n  const canSave = isDirty && !errors\n\n  return (\n    <>\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        {state.sample && (\n          <SampleInfoPanel\n            sample={state.sample}\n            actions={\n              canSort && (\n                <ToggleEditModeButton\n                  userId={user.id}\n                  sample={state.sample}\n                  actions={actions}\n                  canStopOwn={canStopOwn}\n                  canStopOther={canStopOther}\n                  editMode={state.editMode}\n                />\n              )\n            }\n          />\n        )}\n        <div css={{ display: 'grid', gridTemplateColumns: '20em', gap: '1em' }}>\n          <SelectField\n            label=\"Sorter\"\n            value={sorterId}\n            onChange={(value) => setFieldValue('sorterId', value)}\n            options={sorterOptions}\n            error={errors?.sorterId}\n            readOnly={!isEditing}\n            disabled={!isLabManager}\n          />\n          <NumberField\n            label=\"Split %\"\n            value={labSplitPercent}\n            onChange={(value) => setFieldValue('labSplitPercent', value)}\n            min={0}\n            max={100}\n            precision={LAB_SPLIT_PERCENT_PRECISION}\n            error={errors?.labSplitPercent}\n            readOnly={!isEditing}\n          />\n          <NumberField\n            label=\"Number of bugs\"\n            value={sorterCount}\n            onChange={(value) => setFieldValue('sorterCount', value)}\n            min={0}\n            max={999999}\n            error={errors?.sorterCount}\n            readOnly={!isEditing}\n          />\n          <CheckboxField\n            label=\"Elutriation\"\n            value={elutriation}\n            onChange={(value) => setFieldValue('elutriation', value)}\n            readOnly={!isEditing}\n          />\n          <NumberField\n            label=\"Sort time (hours)\"\n            value={sortTime}\n            onChange={(value) => setFieldValue('sortTime', value)}\n            min={0}\n            max={999999}\n            error={errors?.sortTime}\n            readOnly={!isEditing}\n          />\n          {(editMode === 'started' || editMode === 'stopping') && (\n            <MuiButton onClick={actions.saveSort} disabled={!canSave} variant=\"contained\">\n              Save\n            </MuiButton>\n          )}\n        </div>\n      </div>\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n    </>\n  )\n}\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectSampleById, selectSorterUsers, selectMyUser } from '../../data/selectors'\nimport { SampleSorting as Component } from './SampleSorting'\nimport { Fallback } from './Fallback'\nimport { withSuspense } from '../withSuspense'\n\nexport interface SampleSortingProps {\n  sampleId: string | number\n}\n\nexport const SampleSorting = withSuspense(({ sampleId }: SampleSortingProps): JSX.Element => {\n  const sorterUsers = useRecoilValue(selectSorterUsers)\n  const user = useRecoilValue(selectMyUser)\n  const sample = useRecoilValue(selectSampleById(Number(sampleId)))\n\n  if (sample === null) return <h2>Sample {sampleId} not found.</h2>\n\n  return <Component sorterUsers={sorterUsers} sample={sample} user={user} />\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <MuiSkeleton height=\"9em\" variant=\"rectangular\" />\n    <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n  </div>\n)\n","import { useReducer, useMemo } from 'react'\nimport produce from 'immer'\nimport { uniqueId } from 'lodash'\nimport log from 'loglevel'\n\nimport { MyUser, Organism, Sample } from '../../types'\nimport { LocalOrganism, OrganismFilter, ControllerActions, ReducerAction, ReducerState } from './types'\nimport { useApi } from '../../data/api'\nimport {\n  deleteOrganism,\n  startTaxonomyIdentification,\n  stopTaxonomyIdentification,\n  upsertOrganism,\n} from '../../data/calls'\nimport { useNotifications } from '../AppNotifications'\nimport { useDeferredInvalidate } from '../../data/selectors'\n\nconst generateRowId = () => `row/${uniqueId()}`\n\nconst initialState = {\n  sample: undefined,\n  organisms: [],\n  measurements: false,\n  organismFilters: [],\n  editMode: 'stopped',\n  scrollToRowId: null,\n} as ReducerState\n\nconst reducer = (state: ReducerState, action: ReducerAction): ReducerState => {\n  log.debug('dispatched:', action)\n\n  if (action.type === 'reset') {\n    const {\n      payload: { sample, organisms, user },\n    } = action\n    return {\n      ...initialState,\n      sample,\n      organisms: organisms.map((organism) => ({ ...organism, rowId: generateRowId(), persistence: 'saved' })),\n      editMode: sample.identifierId === user.id && !sample.identificationEndDate ? 'started' : 'stopped',\n      measurements: !!sample.measurements,\n    }\n  }\n\n  const newState = produce(state, (draft) => {\n    switch (action.type) {\n      case 'createLocalOrganism': {\n        const { payload: organism } = action\n        draft.organisms.push({\n          ...organism,\n          persistence: 'unsaved',\n        })\n        draft.scrollToRowId = organism.rowId\n        break\n      }\n      case 'updateLocalOrganism': {\n        const {\n          payload: { rowId, fields },\n        } = action\n        const organism = draft.organisms.find((organism) => organism.rowId === rowId)\n        if (!organism) return\n        Object.assign(organism, fields)\n        break\n      }\n      case 'deleteLocalOrganism': {\n        const {\n          payload: { rowId },\n        } = action\n        draft.organisms = draft.organisms.filter((organism) => organism.rowId !== rowId)\n        break\n      }\n      case 'createFilter': {\n        const {\n          payload: { taxonId },\n        } = action\n        if (state.organismFilters.find((existingFilter) => existingFilter.taxonId === taxonId)) return\n        draft.organismFilters.push({ taxonId })\n        break\n      }\n      case 'deleteFilter': {\n        const {\n          payload: { taxonId },\n        } = action\n        draft.organismFilters = draft.organismFilters.filter((organismFilter) => organismFilter.taxonId !== taxonId)\n        break\n      }\n      case 'setEditMode': {\n        const editMode = action.payload\n        draft.editMode = editMode\n        if (editMode === 'stopped')\n          draft.organisms = draft.organisms.filter((organism) => organism.persistence !== 'unsaved')\n        break\n      }\n      case 'setScrollToRowId': {\n        draft.scrollToRowId = action.payload\n      }\n    }\n  })\n  return newState\n}\n\nexport const useComponentController = (): [ReducerState, ControllerActions] => {\n  const api = useApi()\n  const deferredInvalidate = useDeferredInvalidate()\n  const notifications = useNotifications()\n\n  const upsertOrganismIfSavable = async (organism: LocalOrganism) => {\n    if (organism.lifeStageId) {\n      dispatch({ type: 'updateLocalOrganism', payload: { rowId: organism.rowId, fields: { persistence: 'saving' } } })\n      try {\n        const id = await upsertOrganism(api, deferredInvalidate)(organism)\n        dispatch({\n          type: 'updateLocalOrganism',\n          payload: { rowId: organism.rowId, fields: { id, persistence: 'saved' } },\n        })\n      } catch (err) {\n        dispatch({ type: 'updateLocalOrganism', payload: { rowId: organism.rowId, fields: { persistence: 'error' } } })\n        notifications.error(`Failed to save organism record: ${err}`)\n      }\n    }\n  }\n\n  const [state, dispatch] = useReducer(reducer, initialState)\n\n  const actions = useMemo(\n    () => ({\n      createOrganism: async ({ taxonId }: Pick<LocalOrganism, 'taxonId'>) => {\n        if (!state.sample) throw new Error('No sample')\n        const rowId = generateRowId()\n        const newOrganism: LocalOrganism = {\n          rowId,\n          taxonId,\n          sampleId: state.sample.id,\n          splitCount: 0,\n          bigRareCount: null,\n          noteTypeIds: [],\n          comments: '',\n        }\n        dispatch({ type: 'createLocalOrganism', payload: newOrganism })\n        await upsertOrganismIfSavable(newOrganism)\n      },\n      duplicateOrganism: async (organism: LocalOrganism) => {\n        if (!state.sample) throw new Error('No sample')\n        const rowId = generateRowId()\n        const newOrganism: LocalOrganism = {\n          rowId,\n          taxonId: organism.taxonId,\n          sampleId: state.sample.id,\n          splitCount: 0,\n          bigRareCount: null,\n          noteTypeIds: [],\n          comments: '',\n        }\n        dispatch({ type: 'createLocalOrganism', payload: newOrganism })\n        await upsertOrganismIfSavable(newOrganism)\n      },\n      updateOrganism: async (organism: LocalOrganism) => {\n        dispatch({ type: 'updateLocalOrganism', payload: { rowId: organism.rowId, fields: organism } })\n        await upsertOrganismIfSavable(organism)\n      },\n      deleteOrganism: async (organism: LocalOrganism) => {\n        try {\n          if (organism.persistence !== 'unsaved') {\n            dispatch({\n              type: 'updateLocalOrganism',\n              payload: { rowId: organism.rowId, fields: { persistence: 'deleting' } },\n            })\n            await deleteOrganism(api, deferredInvalidate)(organism as Organism)\n          }\n          dispatch({ type: 'deleteLocalOrganism', payload: organism })\n        } catch (err) {\n          dispatch({\n            type: 'updateLocalOrganism',\n            payload: { rowId: organism.rowId, fields: { persistence: 'error' } },\n          })\n          notifications.error(`Failed to delete organism record: ${err}`)\n        }\n      },\n      createFilter: (filter: OrganismFilter) => dispatch({ type: 'createFilter', payload: filter }),\n      deleteFilter: (filter: OrganismFilter) => dispatch({ type: 'deleteFilter', payload: filter }),\n      reset: async (payload: { sample: Sample; organisms: Organism[]; user: MyUser }) => {\n        dispatch({ type: 'reset', payload })\n      },\n      startTaxonomyIdentification: async () => {\n        try {\n          if (!state.sample) throw new Error('No sample')\n          dispatch({ type: 'setEditMode', payload: 'starting' })\n          await startTaxonomyIdentification(api, deferredInvalidate)({ sampleId: state.sample.id })\n          dispatch({ type: 'setEditMode', payload: 'started' })\n        } catch (err) {\n          dispatch({ type: 'setEditMode', payload: 'stopped' })\n          notifications.error(`Failed to start taxonomy identification: ${err}`)\n        }\n      },\n      stopTaxonomyIdentification: () => {\n        dispatch({ type: 'setEditMode', payload: 'stoppingPrompt' })\n      },\n      finishTaxonomyIdentification: async ({ time }: { time: number }) => {\n        try {\n          if (!state.sample) throw new Error('No sample')\n          dispatch({ type: 'setEditMode', payload: 'stoppingSaving' })\n          await stopTaxonomyIdentification(api, deferredInvalidate)({ sampleId: state.sample.id, time })\n          dispatch({ type: 'setEditMode', payload: 'stopped' })\n        } catch (err) {\n          dispatch({ type: 'setEditMode', payload: 'started' })\n          notifications.error(`Failed to stop taxonomy identification: ${err}`)\n        }\n      },\n      setScrollToRowId: (rowId: LocalOrganism['rowId'] | null) => {\n        dispatch({ type: 'setScrollToRowId', payload: rowId })\n      },\n    }),\n    [api, state.sample] // Note: memoizing here isn't desirable, except we don't want new grid context every time :-/\n  )\n  return [state, actions]\n}\n","import { ColDef } from 'ag-grid-community'\n\nimport { OrganismRow, OrganismValueSetterParams, OrganismCellClassParams } from './types'\n\ninterface RowNode {\n  data: OrganismRow\n}\n\nconst singleValueSetter = ({\n  colDef: { field },\n  newValue: value,\n  data,\n  context: { actions },\n}: OrganismValueSetterParams) => {\n  actions.updateOrganism({ ...data, [field]: value })\n  return false\n}\n\nconst notesAndCommentsValueSetter = ({\n  newValue: { noteTypeIds, comments },\n  data,\n  context: { actions },\n}: OrganismValueSetterParams) => {\n  actions.updateOrganism({ ...data, noteTypeIds, comments })\n  return false\n}\n\nexport const organismsColumnDefs = [\n  {\n    headerName: '',\n    field: 'persistence',\n    width: 70,\n    hide: true,\n    cellRenderer: 'PersistenceRenderer',\n  },\n  {\n    headerName: 'Taxon',\n    field: 'taxonName',\n    width: 300,\n    cellRenderer: 'TaxonRenderer',\n  },\n  {\n    field: 'levelName',\n    headerName: 'Level',\n    width: 150,\n    comparator: (valueA, valueB, nodeA: RowNode, nodeB: RowNode) =>\n      nodeA.data.levelRankOrder - nodeB.data.levelRankOrder,\n  },\n  {\n    field: 'lifeStageId',\n    headerName: 'Life Stage',\n    width: 150,\n    editable: true,\n    cellEditor: 'LifeStageEditor',\n    cellRenderer: 'LifeStageRenderer',\n    valueSetter: singleValueSetter,\n    cellClassRules: {\n      'DataGrid__cell--error': ({ value }: OrganismCellClassParams) => !value,\n    },\n    comparator: (valueA, valueB, nodeA: RowNode, nodeB: RowNode) =>\n      nodeA.data.lifeStageRankOrder - nodeB.data.lifeStageRankOrder,\n  },\n  {\n    field: 'splitCount',\n    width: 150,\n    editable: true,\n    cellEditor: 'NumberEditor',\n    cellRenderer: 'NumberRenderer',\n    type: 'numericColumn',\n    valueSetter: singleValueSetter,\n    cellClassRules: {\n      'DataGrid__cell--error': ({ data, value }: OrganismCellClassParams) => data.persistence === 'unsaved' && value,\n    },\n  },\n  {\n    field: 'bigRareCount',\n    width: 150,\n    editable: true,\n    cellEditor: 'NumberEditor',\n    cellRenderer: 'NumberRenderer',\n    type: 'numericColumn',\n    valueSetter: singleValueSetter,\n    cellClassRules: {\n      'DataGrid__cell--error': ({ data, value }: OrganismCellClassParams) => data.persistence === 'unsaved' && value,\n    },\n  },\n  {\n    field: 'bugSize',\n    headerName: 'Size',\n    width: 150,\n    editable: true,\n    cellEditor: 'NumberEditor',\n    cellEditorParams: {\n      precisionAllowed: 1,\n    },\n    cellRenderer: 'NumberRenderer',\n    type: 'numericColumn',\n    valueSetter: singleValueSetter,\n    cellClassRules: {\n      'DataGrid__cell--error': (params) => !params.value,\n    },\n  },\n  {\n    colId: 'notesAndComments',\n    headerName: 'Notes/Comments',\n    width: 150,\n    editable: true,\n    cellRenderer: 'NotesAndCommentsRenderer',\n    cellEditor: 'NotesAndCommentsEditor',\n    valueSetter: notesAndCommentsValueSetter,\n    flex: 1,\n    cellClassRules: {\n      'DataGrid__cell--error': ({ data }: OrganismCellClassParams) =>\n        data.persistence === 'unsaved' && (data.noteTypeIds.length > 0 || data.comments),\n    },\n  },\n  {\n    colId: 'actions',\n    width: 150,\n    cellRenderer: 'ActionsRenderer',\n    pinned: 'right',\n  },\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React, { useState, useRef, useEffect } from 'react'\nimport MuiButton from '@mui/material/Button'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\nimport MuiDialogTitle from '@mui/material/DialogTitle'\n\nimport { NumberField } from '../NumberField'\n\ninterface TimeEntryDialogProps {\n  isOpen: boolean\n  onConfirm: (metrics: { time: number }) => void\n}\n\nexport const TimeEntryDialog = (props: TimeEntryDialogProps): JSX.Element => {\n  const { isOpen } = props\n  return (\n    <MuiDialog open={isOpen} disableEscapeKeyDown>\n      <DialogBody {...props} />\n    </MuiDialog>\n  )\n}\n\nconst DialogBody = ({ onConfirm }: TimeEntryDialogProps): JSX.Element => {\n  const [time, setTime] = useState<number | null>(null)\n  const inputRef = useRef<HTMLInputElement | null>(null)\n\n  const hasErrors = time === null\n\n  const handleConfirm = () => {\n    if (time !== null) onConfirm({ time })\n  }\n\n  useEffect(() => {\n    inputRef.current?.focus()\n  }, [inputRef.current])\n\n  return (\n    <>\n      <MuiDialogTitle>Metrics</MuiDialogTitle>\n      <MuiDialogContent>\n        <div css={{ padding: '0.5em' }}>\n          <NumberField\n            inputRef={inputRef}\n            label=\"Hours\"\n            value={time}\n            onChange={setTime}\n            error={hasErrors}\n            min={0}\n            onKeyDown={(e) => {\n              if (e.key !== 'Enter') return\n              e.preventDefault()\n              handleConfirm()\n            }}\n          />\n        </div>\n      </MuiDialogContent>\n      <MuiDialogActions>\n        <MuiButton disabled={time === null} onClick={handleConfirm}>\n          OK\n        </MuiButton>\n      </MuiDialogActions>\n    </>\n  )\n}\n","import React from 'react'\nimport MuiButton from '@mui/material/Button'\nimport EditIcon from '@mui/icons-material/Edit'\nimport StopIcon from '@mui/icons-material/Stop'\n\nimport { Sample } from '../../types'\nimport { ControllerActions, ReducerState } from './types'\nimport { withTooltip } from '../withTooltip'\n\ninterface ToggleEditModeButtonProps {\n  userId: number\n  sample: Sample\n  editMode: ReducerState['editMode']\n  actions: ControllerActions\n  canLeave: boolean\n}\n\nexport const ToggleEditModeButton = ({\n  userId,\n  sample,\n  editMode,\n  actions,\n  canLeave,\n}: ToggleEditModeButtonProps): JSX.Element | null => {\n  const error = (() => {\n    if (sample.boxState !== 'Active')\n      return 'The taxa for this sample cannot be edited because the box it is associated with is not currently active.'\n    if (!sample.sortEndDate) return 'The taxa for this sample cannot be edited because the box has not been sorted.'\n    if (sample.identificationStartDate && !sample.identificationEndDate && sample.identifierId !== userId)\n      return 'Taxonomic identification for this sample is already underway by another user.'\n  })()\n\n  if (error)\n    return withTooltip(\n      <MuiButton disabled variant=\"outlined\" startIcon={<EditIcon />}>\n        Start Identification\n      </MuiButton>,\n      error,\n      true\n    )\n\n  const isActive = editMode !== 'stopped' && editMode !== 'starting'\n\n  return (\n    <MuiButton\n      disabled={(editMode !== 'started' && editMode !== 'stopped') || !canLeave}\n      onClick={() => {\n        if (editMode === 'started') {\n          actions.stopTaxonomyIdentification()\n        } else {\n          actions.startTaxonomyIdentification()\n        }\n      }}\n      startIcon={isActive ? <StopIcon /> : <EditIcon />}\n      variant={isActive ? 'contained' : 'outlined'}\n    >\n      {isActive ? 'Stop Identification' : 'Start Identification'}\n    </MuiButton>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useImperativeHandle, useEffect, forwardRef, useState, useRef } from 'react'\nimport { ICellRendererParams, ICellEditorParams } from 'ag-grid-community'\nimport AddIcon from '@mui/icons-material/AddCircleOutline'\nimport DeleteIcon from '@mui/icons-material/Delete'\nimport FilterAltIcon from '@mui/icons-material/FilterAlt'\nimport MuiIconButton from '@mui/material/IconButton'\nimport CheckCircleOutlinedIcon from '@mui/icons-material/CheckCircleOutlined'\nimport ChangeCircleOutlinedIcon from '@mui/icons-material/ChangeCircleOutlined'\nimport CircleOutlinedIcon from '@mui/icons-material/CircleOutlined'\nimport ErrorOutlineIcon from '@mui/icons-material/ErrorOutline'\n\nimport { Badge, TargetEffortBadge } from '../Badge'\nimport { OrganismsDataGridContext, OrganismRow } from './types'\nimport { withTooltip } from '../withTooltip'\n\ninterface CellRendererParams<T> extends ICellRendererParams {\n  context: OrganismsDataGridContext\n  data: OrganismRow\n  value: T\n}\ninterface CellEditorParams<T> extends ICellEditorParams {\n  context: OrganismsDataGridContext\n  data: OrganismRow\n  value: T\n}\n\nexport const NumberEditor = forwardRef(\n  (\n    {\n      value: oldValue,\n      data: { canEdit },\n      precisionAllowed = 0,\n      negativeAllowed = false,\n    }: CellEditorParams<number> & { precisionAllowed: number; negativeAllowed?: boolean },\n    ref\n  ) => {\n    const [value, setValue] = useState(oldValue || '')\n    const inputRef = useRef<HTMLInputElement | null>(null)\n\n    useEffect(() => {\n      setTimeout(() => inputRef.current?.focus())\n    }, [])\n\n    useImperativeHandle(ref, () => {\n      return {\n        getValue: () => value || 0,\n        isCancelBeforeStart: () => !canEdit,\n        isCancelAfterEnd: () => false,\n        isPopup: () => false,\n      }\n    })\n\n    const handleChange = ({ target: { value: newValue } }: React.ChangeEvent<HTMLInputElement>) => {\n      const newNumber = Number(newValue)\n      if (Number(newNumber.toFixed(precisionAllowed)) !== newNumber) return\n      if (!negativeAllowed && newNumber < 0) return\n      setValue(newNumber)\n    }\n\n    return (\n      <input\n        // className=\"ag-input\"\n        type=\"number\"\n        ref={inputRef}\n        value={value}\n        onChange={handleChange}\n        style={{ width: '100%', textAlign: 'right' }}\n      />\n    )\n  }\n)\nNumberEditor.displayName = 'NumberEditor'\n\nexport const LifeStageEditor = forwardRef(\n  ({ value: oldValue, data: { allowedLifeStages, canEdit } }: CellEditorParams<number>, ref) => {\n    const [value, setValue] = useState(oldValue)\n    const [done, setDone] = useState(false)\n\n    const inputRef = useRef<HTMLSelectElement | null>(null)\n\n    const handleChange = ({ target: { value: newValue } }: React.ChangeEvent<HTMLSelectElement>) => {\n      setValue(Number(newValue))\n      setDone(true)\n    }\n    useEffect(() => {\n      if (!done) return\n      // api.stopEditing();\n    }, [done])\n\n    useEffect(() => {\n      setTimeout(() => inputRef.current?.focus())\n    }, [])\n\n    useImperativeHandle(ref, () => {\n      return {\n        getValue: () => Number(value),\n        isCancelBeforeStart: () => !canEdit || value,\n        isCancelAfterEnd: () => false,\n        isPopup: () => false,\n      }\n    })\n\n    const options = allowedLifeStages.map(({ id: value, name: label }) => ({ value, label }))\n\n    if (!value) options.unshift({ value: -1, label: '' })\n\n    return (\n      <select value={value} onChange={handleChange} ref={inputRef} style={{ width: '100%' }}>\n        {options.map(({ value, label }) => (\n          <option key={value} value={value}>\n            {label}\n          </option>\n        ))}\n      </select>\n    )\n  }\n)\nLifeStageEditor.displayName = 'LifeStageEditor'\n\nexport const LifeStageRenderer = ({ context, value }: CellRendererParams<number>): React.ReactNode => {\n  return context.lifeStages.find(({ id }) => value === id)?.name || ''\n}\n\nexport const NumberRenderer = ({ value }: CellRendererParams<number>): React.ReactNode => {\n  return value || ''\n}\n\nexport const TaxonRenderer = ({ value, data: { isTargetEffort } }: CellRendererParams<string>): React.ReactNode => {\n  return (\n    <span>\n      {value}\n      {isTargetEffort && <TargetEffortBadge />}\n    </span>\n  )\n}\n\nexport const NotesAndCommentsRenderer = ({\n  data: { noteTypeIds, comments },\n  context: { noteTypes },\n}: CellRendererParams<undefined>): React.ReactNode => {\n  return (\n    <div>\n      {noteTypeIds.map((noteTypeId) => {\n        const noteType = noteTypes.find(({ id }) => id === noteTypeId)\n        return (\n          <Badge\n            badgeColor=\"#cc7000\"\n            textColor=\"white\"\n            tooltip={noteType?.name || 'Unknown'}\n            css={{ marginRight: '0.2em' }}\n            key={noteTypeId}\n            label={noteType?.abbreviation || '?'}\n          />\n        )\n      })}\n      <span>{comments}</span>\n    </div>\n  )\n}\n\nexport const NotesAndCommentsEditor = forwardRef(\n  (\n    {\n      data: { noteTypeIds: oldNoteTypeIds, comments: oldComments, canEdit },\n      context: { noteTypes },\n    }: CellEditorParams<undefined>,\n    ref\n  ) => {\n    const [noteTypeIds, setNoteTypeIds] = useState(oldNoteTypeIds)\n    const [comments, setComments] = useState(oldComments)\n\n    const inputRef = useRef<HTMLTextAreaElement | null>(null)\n\n    useEffect(() => {\n      setTimeout(() => inputRef.current?.focus())\n    }, [])\n\n    useImperativeHandle(ref, () => {\n      return {\n        getValue: () => ({\n          noteTypeIds,\n          comments,\n        }),\n        isCancelBeforeStart: () => !canEdit,\n        isCancelAfterEnd: () => false,\n        isPopup: () => true,\n      }\n    })\n\n    // TODO: limit to active note types\n\n    return (\n      <div css={{ minWidth: '20em' }}>\n        <textarea\n          ref={inputRef}\n          value={comments}\n          onChange={(event) => setComments(event.target.value)}\n          css={{ width: '95%', height: '3em', fontFamily: 'Roboto' }}\n        />\n        <div>\n          {noteTypes.map(({ id, name, abbreviation }) => (\n            <div key={id} css={{ margin: '0.2em 0' }}>\n              <input\n                type=\"checkbox\"\n                checked={noteTypeIds.includes(id)}\n                onChange={(e) => {\n                  if (e.target.checked) {\n                    setNoteTypeIds(() => [...noteTypeIds, id])\n                  } else {\n                    setNoteTypeIds(() => noteTypeIds.filter((noteTypeId) => noteTypeId !== id))\n                  }\n                }}\n              />\n              (<span css={{ fontWeight: 'bold' }}>{abbreviation}</span>) - {name}\n            </div>\n          ))}\n        </div>\n      </div>\n    )\n  }\n)\nNotesAndCommentsEditor.displayName = 'NotesAndCommentsEditor'\n\nexport const ActionsRenderer = ({\n  data: organismRow,\n  context: { actions, setDeletionCandidateOrganism },\n}: CellRendererParams<OrganismRow>): React.ReactNode => {\n  const { splitCount, bigRareCount, noteTypeIds, comments, canDuplicate, canFilter, canDelete, persistence } =\n    organismRow\n  return (\n    <div css={{ display: 'flex', alignItems: 'center', height: '100%' }}>\n      <MuiIconButton\n        disabled={!canDuplicate}\n        onClick={() => {\n          actions.duplicateOrganism(organismRow)\n        }}\n      >\n        {withTooltip(<AddIcon />, 'Create a similar organism record')}\n      </MuiIconButton>\n      <MuiIconButton\n        disabled={!canFilter}\n        onClick={() => {\n          actions.createFilter(organismRow)\n        }}\n      >\n        {withTooltip(<FilterAltIcon />, 'Filter by this taxonomy')}\n      </MuiIconButton>\n      <MuiIconButton\n        disabled={!canDelete}\n        onClick={() => {\n          if (persistence !== 'saved' && !splitCount && !bigRareCount && noteTypeIds.length === 0 && !comments) {\n            actions.deleteOrganism(organismRow)\n          } else {\n            setDeletionCandidateOrganism(organismRow)\n          }\n        }}\n      >\n        {withTooltip(<DeleteIcon />, 'Delete this organism record')}\n      </MuiIconButton>\n    </div>\n  )\n}\n\nexport const PersistenceRenderer = ({ value }: CellRendererParams<OrganismRow['persistence']>): React.ReactNode => {\n  return (\n    <div css={{ display: 'flex', alignItems: 'center', height: '100%' }}>\n      {(() => {\n        switch (value) {\n          case 'unsaved':\n            return withTooltip(<CircleOutlinedIcon />, 'Record is not ready to be saved to database.')\n          case 'saving':\n            return withTooltip(<ChangeCircleOutlinedIcon />, 'Record is saving to database...')\n          case 'saved':\n            return withTooltip(<CheckCircleOutlinedIcon />, 'Record is saved in database.')\n          case 'error':\n            return withTooltip(\n              <ErrorOutlineIcon css={{ path: { fill: 'red' } }} />,\n              'Record had an error saving or deleting.'\n            )\n        }\n        return null\n      })()}\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <MuiSkeleton height=\"9em\" variant=\"rectangular\" />\n    <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo, useRef, useState, useEffect, useCallback } from 'react'\nimport { useRecoilValue } from 'recoil'\nimport { useHotkeys } from 'react-hotkeys-hook'\nimport { sumBy, uniqBy } from 'lodash'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport AddIcon from '@mui/icons-material/AddCircleOutline'\nimport FilterAltIcon from '@mui/icons-material/FilterAlt'\n\nimport { DataGrid, DataGridApis, DataGridSummaryArea } from '../DataGrid'\nimport { TaxonomyField, TaxonomyFieldOption, TaxonomyFieldActionButton } from '../TaxonomyField'\nimport { Taxon, Sample, Organism } from '../../types'\nimport { OrganismsDataGridContext, OrganismRow } from './types'\nimport { useComponentController } from './componentController'\nimport { organismsColumnDefs } from './columnDefs'\nimport { SampleInfoPanel } from '../SampleInfoPanel'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\nimport { TimeEntryDialog } from './TimeEntryDialog'\nimport { ToggleEditModeButton } from './ToggleEditModeButton'\nimport { ConfirmNavigateAway } from '../AppRouter'\nimport * as renderers from './renderers'\nimport { selectTaxa, selectLifeStages, selectNoteTypes, selectMyUser } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { Fallback } from './Fallback'\nimport { FilterChips } from '../Filters'\nimport { pluralize } from '../../lib/formats'\n\nexport interface SampleTaxonomyIdentificationProps {\n  sample: Sample\n  sampleOrganisms: Organism[]\n}\n\nconst gridOptions = {\n  stopEditingWhenCellsLoseFocus: true,\n  suppressCellSelection: false,\n}\n\nexport const SampleTaxonomyIdentification = withSuspense(\n  ({ sample, sampleOrganisms }: SampleTaxonomyIdentificationProps): JSX.Element => {\n    const taxa = useRecoilValue(selectTaxa)\n    const lifeStages = useRecoilValue(selectLifeStages)\n    const noteTypes = useRecoilValue(selectNoteTypes)\n    const user = useRecoilValue(selectMyUser)\n\n    // STATE AND REFS\n\n    const [state, actions] = useComponentController()\n    const { organisms, organismFilters, editMode, scrollToRowId } = state\n    const { measurements } = state.sample || {}\n    const isEditing = editMode === 'started'\n\n    const [deletionCanddateOrganism, setDeletionCandidateOrganism] = useState<OrganismRow | null>(null)\n    const [gridApis, setGridApis] = useState<DataGridApis>()\n\n    const inputRef = useRef<HTMLInputElement | null>(null)\n\n    // EFFECTS\n\n    useEffect(() => {\n      actions.reset({ sample, organisms: sampleOrganisms, user })\n    }, [sample, sampleOrganisms, user])\n\n    useEffect(() => {\n      if (!gridApis) return\n      gridApis.columnApi.setColumnVisible('bugSize', !!measurements)\n    }, [gridApis, measurements])\n\n    useEffect(() => {\n      if (!gridApis) return\n      gridApis.columnApi.setColumnVisible('persistence', isEditing)\n    }, [gridApis, isEditing])\n\n    useEffect(() => {\n      if (!gridApis || !scrollToRowId) return\n      window.setTimeout(() => {\n        gridApis.api.ensureNodeVisible(({ data: { rowId } }) => rowId === scrollToRowId)\n      })\n      actions.setScrollToRowId(null)\n    }, [gridApis, scrollToRowId, actions.setScrollToRowId])\n\n    // DATA GRID CONTEXT\n\n    const context = useMemo<OrganismsDataGridContext>(\n      () => ({\n        lifeStages,\n        noteTypes,\n        actions,\n        setDeletionCandidateOrganism,\n      }),\n      [lifeStages, noteTypes, actions]\n    )\n\n    // ROWS\n\n    const getTaxonById = useCallback((taxonId: number) => taxa.find(({ id }) => id === taxonId), [taxa])\n\n    const organismFilterTaxons = useMemo<Taxon[]>(\n      () =>\n        organismFilters.reduce<Taxon[]>((acc, { taxonId }) => {\n          const taxon = getTaxonById(taxonId)\n          if (!taxon) return acc\n          return [...acc, taxon]\n        }, []),\n      [organismFilters, getTaxonById]\n    )\n\n    const filterTaxonIds = useMemo<number[] | null>(() => {\n      if (organismFilterTaxons.length === 0) return null\n      return organismFilterTaxons.reduce(\n        (acc, { id, descendantIds }) => [...acc, id, ...(descendantIds || [])],\n        [] as number[]\n      )\n    }, [organismFilterTaxons])\n\n    const rows = useMemo<OrganismRow[]>(() => {\n      const filteredOrganisms = filterTaxonIds\n        ? organisms.filter(({ taxonId }) => filterTaxonIds.includes(taxonId))\n        : organisms\n\n      const activeLifeStages = lifeStages.filter(({ isActive }) => isActive)\n\n      return filteredOrganisms\n        .filter((organism) => organism.persistence !== 'deleting')\n        .map((organism) => {\n          const taxon = getTaxonById(organism.taxonId)\n\n          // computed\n          const taxonName = taxon?.name || '?'\n          const levelName = taxon?.levelName || '?'\n          const levelRankOrder = taxon?.levelRankOrder ?? -1\n          const lifeStageRankOrder = lifeStages.find(({ id }) => id === organism.lifeStageId)?.rankOrder ?? 0\n          const isTargetEffort = taxon?.isTargetEffort ?? false\n\n          // row permissions/options\n          const canDuplicate =\n            isEditing &&\n            (sample.measurements ||\n              organisms.filter(({ taxonId }) => taxonId === organism.taxonId).length < activeLifeStages.length)\n          const canFilter = !organismFilters.find(({ taxonId }) => taxonId === organism.taxonId)\n          const canDelete = isEditing\n          const canEdit = isEditing\n          const usedLifeStageIds = organisms\n            .filter(({ id, taxonId }) => taxonId === organism.taxonId && id !== organism.id)\n            .map(({ lifeStageId }) => lifeStageId)\n          const allowedLifeStages = activeLifeStages.filter(({ id }) => !usedLifeStageIds.includes(id))\n\n          return {\n            ...organism,\n            taxonName,\n            levelName,\n            levelRankOrder,\n            lifeStageRankOrder,\n            isTargetEffort,\n            canDuplicate,\n            canFilter,\n            canDelete,\n            canEdit,\n            allowedLifeStages,\n          }\n        })\n    }, [getTaxonById, filterTaxonIds, organisms, organismFilters, lifeStages, isEditing])\n\n    // UI OPTIONS\n\n    const taxonOptions = useMemo<TaxonomyFieldOption[]>(() => {\n      const organismTaxonIds = organisms.map(({ taxonId }) => taxonId)\n      const added = taxa\n        .filter((taxon) => organismTaxonIds.includes(taxon.id))\n        .map((taxon) => ({ ...taxon, status: 'in' as const }))\n      const available = taxa\n        .filter((taxon) => !organismTaxonIds.includes(taxon.id))\n        .map((taxon) => ({ ...taxon, status: 'notIn' as const }))\n\n      const onAddOrganism = (taxon) => {\n        actions.createOrganism({\n          taxonId: taxon.id,\n        })\n        if (filterTaxonIds && !filterTaxonIds.includes(taxon.id)) actions.createFilter({ taxonId: taxon.id })\n      }\n      const onAddFilter = (taxon) => actions.createFilter({ taxonId: taxon.id })\n\n      return [...added, ...available].map((taxonOption) => {\n        const onChoose = isEditing ? () => onAddOrganism(taxonOption) : () => onAddFilter(taxonOption)\n        const optionActions = (\n          <div css={{ display: 'grid', gridGap: '0.25em', gridTemplateColumns: 'auto auto' }}>\n            <TaxonomyFieldActionButton\n              onClick={() => onAddOrganism(taxonOption)}\n              isDefault={isEditing}\n              disabled={!isEditing}\n              startIcon={<AddIcon />}\n            >\n              Add Organism\n            </TaxonomyFieldActionButton>\n            <TaxonomyFieldActionButton\n              onClick={() => onAddFilter(taxonOption)}\n              isDefault={!isEditing}\n              startIcon={<FilterAltIcon />}\n            >\n              Add Filter\n            </TaxonomyFieldActionButton>\n          </div>\n        )\n\n        return {\n          ...taxonOption,\n          actions: optionActions,\n          onChoose,\n        }\n      })\n    }, [taxa, organisms, isEditing])\n\n    // HOTKEYS\n\n    useHotkeys('/', (e) => {\n      e.preventDefault()\n      e.stopPropagation()\n      inputRef.current?.focus()\n    })\n\n    // RENDER\n\n    const canIdentify = user.hasPermission(NAMCResource.organisms, GrantAction.createAny)\n    const canLeave = rows.every(({ persistence }) => persistence === 'unsaved' || persistence === 'saved')\n\n    const filteredOrganismSum = sumBy(rows, ({ splitCount }) => splitCount)\n    const filteredTaxonCount = uniqBy(rows, ({ taxonId }) => taxonId).length\n    const filteredRowCount = rows.length\n\n    return (\n      <>\n        <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n          {state.sample && (\n            <SampleInfoPanel\n              sample={state.sample}\n              actions={\n                canIdentify && (\n                  <ToggleEditModeButton\n                    userId={user.id}\n                    sample={state.sample}\n                    actions={actions}\n                    editMode={state.editMode}\n                    canLeave={canLeave}\n                  />\n                )\n              }\n            />\n          )}\n          <div>\n            <TaxonomyField inputRef={inputRef} options={taxonOptions} />\n          </div>\n          <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n            <FilterChips\n              filters={organismFilters.map(({ taxonId }) => {\n                const taxon = getTaxonById(taxonId)\n                return {\n                  id: String(taxonId),\n                  filterFn: () => true, // this component uses a pre-standardization filter object; this is just to satisfy FilterChips\n                  label: `${taxon?.levelName}: ${taxon?.name}`,\n                  onDelete: () => actions.deleteFilter({ taxonId }),\n                }\n              })}\n              joinLabel=\"or\"\n            />\n            <DataGridSummaryArea>\n              {`${filteredOrganismSum} ${pluralize(\n                filteredOrganismSum,\n                'organism'\n              )}, across ${filteredTaxonCount} ${pluralize(\n                filteredTaxonCount,\n                'taxon'\n              )} and ${filteredRowCount} ${pluralize(filteredRowCount, 'record')}${\n                organisms.length === filteredRowCount ? '' : ' (filtered)'\n              }`}\n            </DataGridSummaryArea>\n          </div>\n          <div css={{ flex: 1 }}>\n            <DataGrid<OrganismRow>\n              rows={rows}\n              rowIdProperty=\"rowId\"\n              columnDefs={organismsColumnDefs}\n              frameworkComponents={renderers}\n              context={context}\n              gridOptions={gridOptions}\n              onGridApisReady={setGridApis}\n            />\n          </div>\n        </div>\n        <ConfirmationDialog\n          title=\"Confirm Delete Organism\"\n          isOpen={!!deletionCanddateOrganism}\n          onClose={() => setDeletionCandidateOrganism(null)}\n          onConfirm={() => {\n            if (!deletionCanddateOrganism) return\n            actions.deleteOrganism(deletionCanddateOrganism)\n          }}\n          confirmLabel=\"Delete\"\n        ></ConfirmationDialog>\n        <TimeEntryDialog\n          isOpen={editMode === 'stoppingPrompt'}\n          onConfirm={({ time }) => {\n            actions.finishTaxonomyIdentification({ time })\n          }}\n        />\n        {!canLeave && (\n          <ConfirmNavigateAway message=\"Some data hasn't finished saving or deleting. Are you sure you want to leave?\" />\n        )}\n      </>\n    )\n  },\n  Fallback\n)\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectOrganismsBySampleId, selectSampleById } from '../../data/selectors'\nimport { SampleTaxonomyIdentification as Component } from './SampleTaxonomyIdentification'\nimport { Fallback } from './Fallback'\nimport { withSuspense } from '../withSuspense'\n\nexport interface SampleTaxonomyIdentificationProps {\n  sampleId: string | number\n}\n\nexport const SampleTaxonomyIdentification = withSuspense(\n  ({ sampleId }: SampleTaxonomyIdentificationProps): JSX.Element => {\n    const sample = useRecoilValue(selectSampleById(Number(sampleId)))\n    const sampleOrganisms = useRecoilValue(selectOrganismsBySampleId(Number(sampleId)))\n\n    if (sample === null) return <h2>Sample {sampleId} not found.</h2>\n\n    return <Component sample={sample} sampleOrganisms={sampleOrganisms} />\n  },\n  Fallback\n)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const taxonColumnDefs = [\n  columnDef.textColumn({\n    headerName: 'Scientific Name',\n    field: 'hierarchy',\n    minWidth: 110,\n    width: 400,\n    cellRenderer: 'TaxonNameRenderer',\n  }),\n  columnDef.textColumn({\n    headerName: 'Taxonomic Level',\n    field: 'levelName',\n    minWidth: 110,\n    width: 200,\n  }),\n  columnDef.textColumn({\n    headerName: 'Relationship',\n    field: 'hierarchy.relationship',\n    minWidth: 110,\n    flex: 1,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { ICellRendererParams } from 'ag-grid-community'\nimport { TaxonRow } from './TaxonDetail'\nimport { TargetEffortBadge } from '../Badge'\n\ninterface CellRendererParams<T> extends ICellRendererParams {\n  data: T\n}\n\nexport const TaxonNameRenderer = ({ data }: CellRendererParams<TaxonRow>): React.ReactNode => {\n  const {\n    name,\n    hierarchy: { indent = 0, onClick, relationship },\n    isTargetEffort,\n  } = data\n  return (\n    <div css={{ display: 'flex', alignItems: 'baseline', paddingLeft: indent * 13 }}>\n      <span>\n        {relationship === 'Descendant' && '... '}\n        {onClick ? <a onClick={onClick}>{name}</a> : <span>{name}</span>}\n        {isTargetEffort && <TargetEffortBadge />}\n      </span>\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '100%' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '100%' }}>\n      <MuiSkeleton height=\"15em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '100%' }}>\n      <MuiSkeleton height=\"15em\" variant=\"rectangular\" />\n    </div>\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useMemo, useState } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\nimport { identity, uniq } from 'lodash'\n\nimport {\n  selectMyUser,\n  selectTaxa,\n  selectTaxaLevels,\n  TAXA_LEVEL_ID,\n  useInvalidate,\n  useManualInvalidate,\n} from '../../data/selectors'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { Taxon } from '../../types'\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport { Menu } from '../Menu'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { TaxonomySelectField } from '../TaxonomyField'\nimport { TextField } from '../TextField'\nimport { withSuspense } from '../withSuspense'\nimport { DataGrid, DataGridSummaryArea } from '../DataGrid'\nimport { AutocompleteField } from '../AutocompleteField'\nimport { taxonColumnDefs } from './columnDefs'\nimport * as renderers from './renderers'\nimport { CheckboxField } from '../CheckboxField'\nimport { createTaxon, updateTaxon } from '../../data/calls'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport { pluralize } from '../../lib/formats'\nimport { Title } from '../Title'\nimport { Fallback } from './Fallback'\nimport { TargetEffortBadge } from '../Badge'\n\nexport interface TaxonRow extends Taxon {\n  hierarchy: {\n    relationship: 'Ancestor' | 'Parent' | '' | 'Child' | 'Descendant'\n    indent?: number\n    onClick?: () => void\n  }\n}\n\nexport type TaxonDetailProps =\n  | {\n      taxonId?: string | number\n      isNew?: never\n    }\n  | {\n      taxonId?: never\n      isNew: true\n    }\n\ntype Fields = {\n  name: string\n  synonymsText: string\n  levelId: number | null\n  isTargetEffort: boolean\n  parentId: number | null\n  notes: string\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'stopped' | 'started' | 'stopping'\n  isDirty: boolean\n  values: Fields\n  lastValues?: Fields\n}\n\nconst getInitialState = ({ taxon, isNew }: { taxon?: Taxon; isNew?: boolean }): State => {\n  const { name = '', levelId = null, synonyms = [], isTargetEffort = false, parentId = null, notes = '' } = taxon ?? {}\n  return {\n    editMode: isNew ? 'started' : 'stopped',\n    isDirty: false,\n    values: { name, levelId, synonymsText: synonyms.join(', '), isTargetEffort, parentId, notes },\n  }\n}\n\nconst gridOptions = {\n  defaultColDef: {\n    sortable: false,\n  },\n  rowClassRules: {\n    'DataGrid__row--target': (params: { data: TaxonRow }) => params.data.hierarchy.relationship === '',\n  },\n}\n\nconst showAllDescendantsAtom = atom({\n  key: 'TaxonDetail/showAllDescendantsAtom',\n  default: false,\n})\n\nexport const TaxonDetail = withSuspense(\n  ({ taxonId: taxonIdProp, isNew }: TaxonDetailProps): JSX.Element => {\n    const api = useApi()\n    const invalidate = useInvalidate()\n    const [queueInvalidate, performInvalidate] = useManualInvalidate()\n    const navigate = useNavigate()\n    const notifications = useNotifications()\n    const user = useRecoilValue(selectMyUser)\n\n    const taxa = useRecoilValue(selectTaxa)\n    const taxaLevels = useRecoilValue(selectTaxaLevels)\n\n    // STATE\n\n    const [taxonId, setTaxonId] = useState<number | null>(null)\n    const [showAllDescendants, setShowAllDescendants] = useRecoilState(showAllDescendantsAtom)\n\n    const taxon = useMemo(() => {\n      return taxa.find(({ id }) => id === taxonId)\n    }, [taxa, taxonId])\n\n    const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ taxon, isNew }), [taxon, isNew])\n    const {\n      values: { name, levelId, synonymsText, isTargetEffort, parentId, notes },\n      editMode,\n      isDirty,\n    } = state\n\n    const isStopped = editMode === 'stopped'\n    const isEditing = editMode === 'started'\n    const isSaving = editMode === 'stopping'\n\n    const disallowNamesLowercase = useMemo(\n      () => taxa.filter(({ id }) => id !== taxon?.id).map(({ name: existingName }) => existingName.toLowerCase()),\n      [taxa, taxon]\n    )\n\n    const errors: FieldErrors = (() => {\n      const checkName = name.trim().toLowerCase()\n      const result = {\n        name: !checkName || disallowNamesLowercase.includes(checkName),\n        levelId: !levelId,\n        parentId: !parentId,\n      }\n      if (!Object.values(result).some((value) => value)) return undefined\n      return result\n    })()\n\n    // EFFECTS\n\n    useEffect(() => {\n      if (isNew) {\n        setTaxonId(null)\n        return\n      }\n\n      if (taxonIdProp) {\n        setTaxonId(Number(taxonIdProp))\n      } else {\n        const animalia = taxa.find(({ name }) => name === 'Animalia')\n        if (!animalia) throw new Error('Could not find \"Animalia\".')\n        setTaxonId(animalia.id)\n      }\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n      })\n    }, [taxonIdProp, isNew])\n\n    // HANDLERS\n\n    const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n      updateState((draft) => {\n        Object.assign(draft.values, { [fieldName]: value })\n        draft.isDirty = true\n      })\n    }\n    const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n    const handleEdit = () => {\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n\n    const handleSave = async () => {\n      updateState((draft) => {\n        draft.editMode = 'stopping'\n      })\n      try {\n        if (!levelId || !parentId) throw new Error('Missing fields.')\n        const taxonInput = {\n          name: name.trim(),\n          levelId,\n          parentId,\n          isTargetEffort,\n          synonyms: uniq(\n            synonymsText\n              .split(/[,\\n]/)\n              .map((synonym) => synonym.trim())\n              .filter(identity)\n          ),\n          notes: notes.trim(),\n        }\n        if (isNew) {\n          // new taxon\n          const newTaxonId = await createTaxon(api, queueInvalidate)(taxonInput)\n          window.setTimeout(() => {\n            // wait for component to un-dirty before performing nav and refresh\n            navigate.taxonDetail({ taxonId: newTaxonId }, true)\n            performInvalidate()\n          })\n        } else {\n          // existing taxon\n          if (!taxonId) throw new Error('No taxon ID.')\n          await updateTaxon(api, invalidate)({ ...taxonInput, id: taxonId })\n        }\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n          draft.isDirty = false\n        })\n      } catch (err) {\n        notifications.error(`Failed to save taxon: ${err}`)\n        updateState((draft) => {\n          draft.editMode = 'started'\n        })\n      }\n    }\n\n    const handleCancel = () => {\n      if (isNew) {\n        navigate.taxa()\n        return\n      }\n      setState(getInitialState({ taxon, isNew: false }))\n    }\n\n    const handleTaxonChange = (newTaxonId: number | null) => {\n      if (!newTaxonId) {\n        navigate.taxa()\n        return\n      }\n      navigate.taxonDetail({ taxonId: newTaxonId })\n    }\n\n    // ROWS, RELATIONS, OPTIONS\n\n    const rows = useMemo<TaxonRow[]>(() => {\n      if (!taxon) return []\n\n      const { childIds, descendantIds } = taxon\n      if (!childIds || !descendantIds) throw new Error('Taxon missing childIds/descendantIds.')\n\n      const result: TaxonRow[] = []\n\n      let { parentId } = taxon\n      let isDirectParent = true\n\n      while (parentId) {\n        const ancestorTaxon = taxa.find(({ id }) => id === parentId)\n        if (!ancestorTaxon) throw new Error('Missing ancestor taxon')\n        result.unshift({\n          ...ancestorTaxon,\n          hierarchy: {\n            relationship: isDirectParent ? 'Parent' : 'Ancestor',\n            onClick: isStopped ? () => navigate.taxonDetail({ taxonId: ancestorTaxon.id }) : undefined,\n          },\n        })\n        parentId = ancestorTaxon.parentId\n        isDirectParent = false\n      }\n\n      result.push({ ...taxon, hierarchy: { relationship: '' } })\n\n      const descendingIndent = result.length\n\n      const descendingIds = showAllDescendants ? descendantIds : childIds\n      result.push(\n        ...descendingIds.map((childId) => {\n          {\n            const childTaxon = taxa.find(({ id }) => id === childId)\n            if (!childTaxon) throw new Error('Missing child taxon')\n            return {\n              ...childTaxon,\n              hierarchy: {\n                relationship:\n                  !showAllDescendants || childIds.includes(childId) ? ('Child' as const) : ('Descendant' as const),\n                onClick: isStopped ? () => navigate.taxonDetail({ taxonId: childTaxon.id }) : undefined,\n              },\n            }\n          }\n        })\n      )\n\n      return result.map((r, index) => ({\n        ...r,\n        hierarchy: { ...r.hierarchy, indent: Math.min(index, descendingIndent) },\n      }))\n    }, [taxa, taxon, showAllDescendants, isStopped])\n\n    const eligibleParentTaxa = useMemo(() => {\n      const selectedLevelRankOrder = taxaLevels.find(({ id }) => id === levelId)?.rankOrder || Infinity\n      return taxa.filter(({ levelRankOrder }) => levelRankOrder < selectedLevelRankOrder)\n    }, [taxaLevels, taxa, levelId])\n\n    const taxaLevelOptions = useMemo(() => {\n      const selectedParentLevelRankOrder = taxa.find(({ id }) => id === parentId)?.levelRankOrder ?? 0\n\n      const lowestChildLevelRankOrder =\n        (taxon?.childIds &&\n          Math.min(\n            ...taxa.filter(({ id }) => taxon.childIds?.includes(id)).map(({ levelRankOrder }) => levelRankOrder)\n          )) ||\n        Infinity\n\n      const activeTaxaLevels = taxaLevels.filter(({ isActive }) => isActive)\n\n      return activeTaxaLevels.map((level) => ({\n        value: level.id,\n        label: level.name,\n        disabled: level.rankOrder <= selectedParentLevelRankOrder || level.rankOrder >= lowestChildLevelRankOrder,\n      }))\n    }, [taxaLevels, taxon, parentId])\n\n    // RENDER\n\n    const readOnlyParentName = useMemo(() => {\n      return taxa.find(({ id }) => id === parentId)?.name\n    }, [parentId])\n\n    const totalAncestorCount = rows.filter(\n      ({ hierarchy: { relationship } }) => relationship === 'Ancestor' || relationship === 'Parent'\n    ).length\n    const totalDescendantCount = rows.length - totalAncestorCount - 1\n\n    return (\n      <>\n        <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n          <div css={{ margin: '0.5em 0 2em 0', display: 'flex', gap: '0.5em' }}>\n            <TaxonomySelectField\n              label=\"Taxon\"\n              options={taxa}\n              value={taxonId}\n              onChange={handleTaxonChange}\n              disabled={!isStopped}\n              disableClearable\n              ungrouped\n              css={{ flex: 1 }}\n            />\n            {user.hasPermission(NAMCResource.taxonomy, GrantAction.createAny) && (\n              <MuiButton\n                disabled={!isStopped}\n                variant=\"outlined\"\n                onClick={() => {\n                  navigate.taxonCreate()\n                }}\n              >\n                Create New Taxon\n              </MuiButton>\n            )}\n          </div>\n          {taxon || isNew ? (\n            <>\n              <div\n                css={{\n                  display: 'grid',\n                  gap: '1em',\n                  gridTemplateColumns: '1fr 1fr 1fr auto',\n                  gridTemplateRows: 'auto auto 6em',\n                  gridTemplateAreas: `\n                    \"parentId       id            .               buttons\"\n                    \"name           levelId       isTargetEffort  .\"\n                    \"synonyms       synonyms      notes           notes\" \n                  `,\n                }}\n              >\n                {user.hasPermission(NAMCResource.taxonomy, GrantAction.updateAny) && (\n                  <div css={{ gridArea: 'buttons', display: 'flex', gap: '0.5em' }}>\n                    {isStopped ? (\n                      <Menu\n                        label=\"Actions\"\n                        items={[\n                          {\n                            key: 'edit',\n                            label: 'Edit Taxon',\n                            onClick: handleEdit,\n                            disabled: taxon?.levelId === TAXA_LEVEL_ID.kingdom,\n                          },\n                        ]}\n                      />\n                    ) : (\n                      <>\n                        <MuiButton onClick={handleCancel} variant=\"outlined\" disabled={isSaving}>\n                          Cancel\n                        </MuiButton>\n                        <MuiButton onClick={handleSave} variant=\"contained\" disabled={!isDirty || isSaving || !!errors}>\n                          Save\n                        </MuiButton>\n                      </>\n                    )}\n                  </div>\n                )}\n                <ReadOnlyField gridArea=\"id\" label=\"Taxonomy ID\" value={taxon?.id ?? 'TBD'} />\n                {isEditing ? (\n                  <TextField\n                    gridArea=\"name\"\n                    label=\"Scientific Name\"\n                    value={name}\n                    onChange={makeFieldChangeHandler('name')}\n                    error={errors?.name}\n                    InputProps={{ sx: { fontWeight: '700' } }}\n                  />\n                ) : (\n                  <ReadOnlyField\n                    gridArea=\"name\"\n                    label=\"Scientific Name\"\n                    value={\n                      <Title>\n                        {name}\n                        <span css={{ fontSize: '1rem' }}>{isTargetEffort && <TargetEffortBadge />}</span>\n                      </Title>\n                    }\n                  />\n                )}\n                <TextField\n                  gridArea=\"synonyms\"\n                  label=\"Synonyms\"\n                  value={synonymsText}\n                  onChange={makeFieldChangeHandler('synonymsText')}\n                  readOnly={!isEditing}\n                  inputProps={{ spellCheck: false }}\n                  multiline\n                  minRows={3}\n                  error={errors?.synonymsText}\n                />\n                <TextField\n                  gridArea=\"notes\"\n                  label=\"Notes\"\n                  value={notes}\n                  onChange={makeFieldChangeHandler('notes')}\n                  readOnly={!isEditing}\n                  multiline\n                  minRows={3}\n                  error={errors?.notes}\n                />\n                <AutocompleteField\n                  gridArea=\"levelId\"\n                  label=\"Taxonomic Level\"\n                  value={levelId}\n                  onChange={makeFieldChangeHandler('levelId')}\n                  readOnly={!isEditing}\n                  options={taxaLevelOptions}\n                  error={errors?.levelId}\n                />\n                <CheckboxField\n                  gridArea=\"isTargetEffort\"\n                  label=\"Is SAFIT II target effort\"\n                  value={isTargetEffort}\n                  onChange={makeFieldChangeHandler('isTargetEffort')}\n                  readOnly={!isEditing}\n                />\n                {isEditing ? (\n                  <TaxonomySelectField\n                    gridArea=\"parentId\"\n                    label=\"Parent\"\n                    options={eligibleParentTaxa}\n                    value={parentId}\n                    onChange={makeFieldChangeHandler('parentId')}\n                    error={errors?.parentId}\n                    disableClearable\n                    ungrouped\n                  />\n                ) : (\n                  <ReadOnlyField gridArea=\"parentId\" label=\"Parent\" value={readOnlyParentName} />\n                )}\n              </div>\n              {!isNew && (\n                <div css={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\n                  <div css={{ display: 'flex', alignItems: 'center' }}>\n                    <div css={{ fontWeight: '500', marginLeft: '1em', marginRight: '4em' }}>Hierarchy</div>\n                    <CheckboxField\n                      value={showAllDescendants}\n                      onChange={setShowAllDescendants}\n                      label=\"Show all descendants\"\n                    />\n                    <DataGridSummaryArea css={{ marginLeft: 'auto' }}>\n                      Showing {totalAncestorCount} {pluralize(totalAncestorCount, 'ancestor')}\n                      {parentId && ' (including parent)'}, {totalDescendantCount}{' '}\n                      {showAllDescendants\n                        ? `total ${pluralize(totalDescendantCount, 'descendant')}`\n                        : `${pluralize(totalDescendantCount, 'child')}`}\n                    </DataGridSummaryArea>\n                  </div>\n                  <div css={{ flex: 1 }}>\n                    <DataGrid\n                      columnDefs={taxonColumnDefs}\n                      rows={rows}\n                      frameworkComponents={renderers}\n                      gridOptions={gridOptions}\n                    />\n                  </div>\n                </div>\n              )}\n            </>\n          ) : (\n            <div>Select a taxon</div>\n          )}\n        </div>\n        {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n      </>\n    )\n  },\n  () => <Fallback />\n)\n","import { ColDef } from 'ag-grid-community'\n\nimport { columnDef } from '../DataGrid'\nimport { Taxon } from '../../types'\n\nexport const translationDetailColumnDefs = [\n  columnDef.textColumn({\n    headerName: 'OTU Name',\n    field: 'translationScientificName',\n    minWidth: 110,\n    width: 300,\n  }),\n  columnDef.booleanColumn({\n    headerName: 'Final',\n    field: 'isFinal',\n    width: 110,\n    valueLabels: ['', 'Final'],\n  }),\n  {\n    headerName: 'Taxa',\n    field: 'taxa',\n    minWidth: 110,\n    flex: 1,\n    cellRenderer: 'TaxaRenderer',\n    comparator: ([a]: Taxon[], [b]: Taxon[]) => a.name > b.name,\n  },\n  {\n    colId: 'actions',\n    width: 120,\n    cellRenderer: 'ActionsRenderer',\n    pinned: 'right',\n    sortable: false,\n  },\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { ICellRendererParams } from 'ag-grid-community'\nimport MuiIconButton from '@mui/material/IconButton'\nimport EditIcon from '@mui/icons-material/Edit'\nimport DeleteIcon from '@mui/icons-material/Delete'\n\nimport { TranslationGroupRow } from './TranslationDetail'\nimport { Chip } from '../Chip'\nimport { withTooltip } from '../withTooltip'\n\ninterface CellRendererParams<T> extends ICellRendererParams {\n  data: T\n}\n\nexport const TaxaRenderer = ({ data }: CellRendererParams<TranslationGroupRow>): React.ReactNode => {\n  const { taxa } = data\n  return (\n    <div css={{ display: 'flex', alignItems: 'center', height: '100%' }}>\n      {taxa.map((taxon) => (\n        <Chip\n          chipColor=\"#eee\"\n          key={taxon.id}\n          label={`${taxon.name} (${taxon.levelName})`}\n          css={{ marginRight: '0.5rem' }}\n        />\n      ))}\n    </div>\n  )\n}\n\nexport const ActionsRenderer = ({ data }: CellRendererParams<TranslationGroupRow>): React.ReactNode => {\n  const { onEdit, onDelete, canOperate } = data\n  return (\n    <div css={{ display: 'flex', alignItems: 'center', height: '100%' }}>\n      <MuiIconButton onClick={onEdit} disabled={!canOperate}>\n        {withTooltip(<EditIcon />, 'Edit OTU Name', !canOperate)}\n      </MuiIconButton>\n      <MuiIconButton onClick={onDelete} disabled={!canOperate}>\n        {withTooltip(<DeleteIcon />, 'Delete OTU Name', !canOperate)}\n      </MuiIconButton>\n    </div>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport MuiButton from '@mui/material/Button'\nimport MuiDialog from '@mui/material/Dialog'\nimport MuiDialogTitle from '@mui/material/DialogTitle'\nimport MuiDialogActions from '@mui/material/DialogActions'\nimport MuiDialogContent from '@mui/material/DialogContent'\nimport MuiFormControl from '@mui/material/FormControl'\nimport MuiInputLabel from '@mui/material/InputLabel'\nimport AddIcon from '@mui/icons-material/AddCircleOutline'\n// import log from 'loglevel'\n\nimport { Taxon, TranslationGroup } from '../../types'\nimport { withSuspense } from '../withSuspense'\nimport { TextField } from '../TextField'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { useDeferredInvalidate } from '../../data/selectors'\nimport { useNotifications } from '../AppNotifications'\nimport { TaxonomyFieldOption, TaxonomyField, TaxonomyFieldActionButton } from '../TaxonomyField'\nimport { Chip } from '../Chip'\nimport { CheckboxField } from '../CheckboxField'\nimport { createTranslationGroup, updateTranslationGroup } from '../../data/calls'\nimport { useApi } from '../../data/api'\n\nexport interface EditTranslationGroupDialogProps {\n  isOpen: boolean\n  translationId: number\n  targetGroupId?: number\n  onClose: () => void\n  onUpdate: (updatedTranslationGroup: TranslationGroup) => void\n  groups: TranslationGroup[]\n  taxa: Taxon[]\n}\n\ninterface Fields {\n  translationScientificName: string\n  isFinal: boolean\n  taxonomyIds: number[]\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'started' | 'stopping'\n  isDirty: boolean\n  values: Fields\n}\n\nconst getInitialState = ({ group }: { group?: TranslationGroup }): State => {\n  return {\n    editMode: 'started',\n    isDirty: false,\n    values: {\n      translationScientificName: group?.translationScientificName || '',\n      isFinal: group?.isFinal || true,\n      taxonomyIds: group?.taxonomyIds || [],\n    },\n  }\n}\n\nexport const EditTranslationGroupDialog = withSuspense(\n  ({\n    isOpen,\n    onClose,\n    onUpdate,\n    translationId,\n    targetGroupId,\n    groups,\n    taxa,\n  }: EditTranslationGroupDialogProps): JSX.Element => {\n    const api = useApi()\n    const notifications = useNotifications()\n    const deferredInvalidate = useDeferredInvalidate()\n\n    // STATE\n\n    const group = groups.find(({ id }) => id === targetGroupId)\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ group }), [isOpen])\n\n    const { editMode, values, isDirty } = state\n    const { translationScientificName, isFinal, taxonomyIds } = values\n    const checkName = translationScientificName.trim().toLowerCase()\n\n    const disallowNamesLowercase = useMemo(\n      () =>\n        groups\n          .filter(({ id }) => id !== group?.id)\n          .map(({ translationScientificName }) => translationScientificName.toLowerCase()),\n      [groups, checkName]\n    )\n\n    const errors: FieldErrors = (() => {\n      const result = {\n        translationScientificName:\n          !translationScientificName || !!disallowNamesLowercase.find((name) => name === checkName),\n        taxonomyIds: taxonomyIds.length === 0,\n      }\n      if (!Object.values(result).some((value) => value)) return undefined\n      return result\n    })()\n\n    const isSaving = editMode === 'stopping'\n\n    // HANLDERS\n\n    const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n      updateState((draft) => {\n        Object.assign(draft.values, { [fieldName]: value })\n        draft.isDirty = true\n      })\n    }\n    const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n    const handleSave = async () => {\n      try {\n        updateState((draft) => {\n          draft.editMode = 'stopping'\n        })\n        if (group?.id) {\n          // update\n          const input = { id: group.id, ...values }\n          await updateTranslationGroup(api, deferredInvalidate)(input)\n          onUpdate(input)\n        } else {\n          // create\n          const translationGroupId = await createTranslationGroup(api, deferredInvalidate)({ translationId, ...values })\n          onUpdate({ id: translationGroupId, ...values })\n        }\n        onClose()\n      } catch (err) {\n        notifications.error(`Failed to update OTU Name: ${err}`)\n        updateState((draft) => {\n          draft.editMode = 'started'\n        })\n      }\n    }\n\n    const handleAddTaxonomyId = (addId: number) => {\n      setFieldValue('taxonomyIds', [...taxonomyIds, addId])\n    }\n\n    const handleRemoveTaxonomyId = (removeId: number) => {\n      setFieldValue(\n        'taxonomyIds',\n        taxonomyIds.filter((id) => id !== removeId)\n      )\n    }\n\n    // RENDER\n\n    const selectedTaxa: Taxon[] = taxonomyIds.map((targetId) => {\n      const taxon = taxa.find(({ id }) => id === targetId)\n      if (!taxon) throw new Error('Taxon not found.')\n      return taxon\n    })\n\n    const taxaOptions: TaxonomyFieldOption[] = useMemo(() => {\n      const allGroupsTaxonomyIds = groups\n        .filter(({ id }) => id !== group?.id)\n        .reduce<number[]>((acc, group) => [...acc, ...group.taxonomyIds], [])\n        .concat(...taxonomyIds)\n      return taxa.map((taxon) => {\n        const canAdd = !allGroupsTaxonomyIds.includes(taxon.id)\n        const onChoose = () => {\n          if (!canAdd) return\n          handleAddTaxonomyId(taxon.id)\n        }\n        const actions = (\n          <TaxonomyFieldActionButton onClick={onChoose} isDefault disabled={!canAdd} startIcon={<AddIcon />}>\n            Add Taxon\n          </TaxonomyFieldActionButton>\n        )\n        return {\n          ...taxon,\n          status: 'in',\n          actions,\n          onChoose,\n        }\n      })\n    }, [taxa, groups, taxonomyIds])\n\n    return (\n      <MuiDialog open={isOpen} onClose={onClose} fullWidth maxWidth=\"lg\">\n        <MuiDialogTitle>{group ? 'Edit' : 'Create'} OTU Name</MuiDialogTitle>\n        <MuiDialogContent>\n          <div\n            css={{\n              marginTop: '1em',\n              display: 'grid',\n              gridTemplateColumns: '1fr auto',\n              gap: '1em',\n              gridTemplateAreas: `\n                \"translationScientificName isFinal\"\n                \"taxonomyIds taxonomyIds\"\n                \"addTaxon addTaxon\"\n            `,\n            }}\n          >\n            <TextField\n              gridArea=\"translationScientificName\"\n              label=\"OTU Name\"\n              value={translationScientificName}\n              onChange={makeFieldChangeHandler('translationScientificName')}\n              error={errors?.translationScientificName}\n              fullWidth\n              disabled={isSaving}\n            />\n            <CheckboxField\n              gridArea=\"isFinal\"\n              label=\"Final\"\n              value={isFinal}\n              onChange={makeFieldChangeHandler('isFinal')}\n              disabled={isSaving}\n            />\n            <MuiFormControl css={{ gridArea: 'taxonomyIds' }}>\n              <MuiInputLabel shrink error={errors?.taxonomyIds}>\n                Taxa\n              </MuiInputLabel>\n              <div\n                css={{\n                  display: 'flex',\n                  flexWrap: 'wrap',\n                  gap: '0.5rem',\n                  minHeight: '32px',\n                  padding: '8.5px',\n                }}\n              >\n                {errors?.taxonomyIds && <span css={{ color: '#d32f2f', margin: '7px' }}>—</span>}\n                {selectedTaxa.map((taxon) => (\n                  <Chip\n                    chipColor=\"#eee\"\n                    key={taxon.id}\n                    label={`${taxon.name} (${taxon.levelName})`}\n                    onDelete={\n                      isSaving\n                        ? undefined\n                        : () => {\n                            handleRemoveTaxonomyId(taxon.id)\n                          }\n                    }\n                  />\n                ))}\n              </div>\n            </MuiFormControl>\n            <div css={{ gridArea: 'addTaxon' }}>\n              <TaxonomyField options={taxaOptions} label=\"Add Taxa\" ungrouped />\n            </div>\n          </div>\n        </MuiDialogContent>\n        <MuiDialogActions>\n          <MuiButton onClick={onClose} disabled={isSaving}>\n            Cancel\n          </MuiButton>\n          <MuiButton onClick={handleSave} disabled={!isDirty || !!errors || isSaving}>\n            Save\n          </MuiButton>\n        </MuiDialogActions>\n      </MuiDialog>\n    )\n  },\n  () => null\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <MuiSkeleton height=\"5em\" variant=\"rectangular\" />\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nexport interface TranslationInput {\n  name: string // -> translationName\n  isActive: boolean\n  description: string\n}\n\nexport const createTranslationMutation = gql`\n  mutation ($translation: TranslationInput!) {\n    insertTranslation(translation: $translation)\n  }\n`\n\nexport const createTranslation =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (translation: TranslationInput): Promise<number> => {\n    const { name: translationName, ...restTranslation } = translation\n    const data = await api.mutation<{\n      insertTranslation: number | null // NOTE: new translation ID\n    }>(createTranslationMutation, {\n      translation: { translationName, ...restTranslation },\n    })\n\n    const id = data.insertTranslation\n    if (!id) throw new ApiError('translation did not create')\n\n    invalidate('translations')\n    return id\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { InvalidateFn } from '../selectors'\n\nimport { TranslationInput } from './createTranslation'\n\ninterface ExistingTranslationInput extends TranslationInput {\n  id: number\n}\n\nexport const updateTranslationMutation = gql`\n  mutation ($id: Int!, $translation: TranslationInput!) {\n    updateTranslation(id: $id, translation: $translation)\n  }\n`\n\nexport const updateTranslation =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (translation: ExistingTranslationInput): Promise<true> => {\n    const { id, name: translationName, ...restTranslation } = translation\n    const data = await api.mutation<{\n      updateTranslation: number // NOTE: id of translation\n    }>(updateTranslationMutation, {\n      id,\n      translation: {\n        translationName,\n        ...restTranslation,\n      },\n    })\n\n    if (!data.updateTranslation) throw new ApiError('translation did not update')\n\n    invalidate('translations')\n    return true\n  }\n","import gql from 'graphql-tag'\n\nimport { Api, ApiError } from '../api'\nimport { Translation } from '../../types'\nimport { InvalidateFn } from '../selectors'\n\nexport const deleteTranslationMutation = gql`\n  mutation ($translationId: Int!) {\n    deleteTranslation(id: $translationId)\n  }\n`\n\nexport const deleteTranslation =\n  (api: Api, invalidate: InvalidateFn) =>\n  async (translation: Translation): Promise<true> => {\n    const data = await api.mutation<{ deleteTranslation: number }>(deleteTranslationMutation, {\n      translationId: translation.id,\n    })\n\n    if (!data.deleteTranslation) throw new ApiError('translation did not delete')\n\n    invalidate('translations')\n    return true\n  }\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo, useState } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\nimport AddIcon from '@mui/icons-material/AddCircleOutline'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\n// import log from 'loglevel'\n\nimport { selectMyUser, selectTaxa, useDeferredInvalidate, useInvalidate } from '../../data/selectors'\nimport { Taxon, Translation, TranslationGroup } from '../../types'\nimport { DataGrid, DataGridRecordCount } from '../DataGrid'\nimport { Filter, FilterChips } from '../Filters'\nimport { TextField } from '../TextField'\nimport { useTextFilterField } from '../TextFilterField'\nimport { withSuspense } from '../withSuspense'\nimport { translationDetailColumnDefs } from './columnDefs'\nimport * as renderers from './renderers'\nimport { EditTranslationGroupDialog } from './EditTranslationGroupDialog'\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { ConfirmationDialog } from '../ConfirmationDialog'\nimport { useApi } from '../../data/api'\nimport { deleteTranslationGroup } from '../../data/calls'\nimport { useNotifications } from '../AppNotifications'\nimport { AccordionPanel } from '../AccordionPanel'\nimport { Divider, Menu } from '../Menu'\nimport { Title } from '../Title'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { CheckboxField } from '../CheckboxField'\nimport { Fallback } from './Fallback'\nimport { trimAllStrings } from '../../lib/trimAllStrings'\nimport { createTranslation } from '../../data/calls/createTranslation'\nimport { updateTranslation } from '../../data/calls/updateTranslation'\nimport { ConfirmNavigateAway, useNavigate } from '../AppRouter'\nimport { deleteTranslation } from '../../data/calls/deleteTranslation'\n\nexport interface TranslationDetailProps {\n  translation: Translation | null\n}\n\ninterface Fields {\n  name: string\n  isActive: boolean\n  description: string\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'stopped' | 'started' | 'stopping' | 'deleting'\n  isDirty: boolean\n  values: Fields\n  lastValues?: Fields\n}\n\nconst getInitialState = ({ translation }: Pick<TranslationDetailProps, 'translation'>): State => {\n  const { name = '', isActive = true, description = '' } = translation ?? {}\n  return {\n    editMode: translation ? 'stopped' : 'started',\n    isDirty: false,\n    values: {\n      name,\n      isActive,\n      description,\n    },\n  }\n}\n\nexport interface TranslationGroupRow extends TranslationGroup {\n  taxa: Taxon[]\n  onEdit: () => void\n  onDelete: () => void\n  canOperate: boolean\n}\n\nconst isExpandedState = atom<boolean>({\n  key: 'TranslationDetail/isExpandedState',\n  default: true,\n})\n\nexport const TranslationDetail = withSuspense(\n  ({ translation }: TranslationDetailProps): JSX.Element => {\n    const api = useApi()\n    const notifications = useNotifications()\n    const navigate = useNavigate()\n    const user = useRecoilValue(selectMyUser)\n    const invalidate = useInvalidate()\n    const deferredInvalidate = useDeferredInvalidate()\n    const allTaxa = useRecoilValue(selectTaxa)\n\n    const isNewTranslation = !translation\n\n    // STATE\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ translation }), [translation])\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const [groups, setGroups, updateGroups] = useUpdatableState(translation?.groups ?? [], [translation])\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(useState(''))\n    const [isEditOpen, setIsEditOpen] = useState(false)\n    const [isConfirmDeleteTranslationOpen, setIsConfirmDeleteTranslationOpen] = useState(false)\n    const [isConfirmDeleteGroupOpen, setIsConfirmDeleteGroupOpen] = useState(false)\n    const [targetGroupId, setTargetGroupId] = useState<number>()\n    const [isPanelExpanded, setIsPanelExpanded] = useRecoilState(isExpandedState)\n\n    const { values, editMode, isDirty } = state\n\n    const errors: FieldErrors = (() => {\n      const result: FieldErrors = {\n        name: !values.name.trim(),\n      }\n      if (!Object.values(result).some((value) => value)) return undefined\n      return result\n    })()\n\n    const isStopped = editMode === 'stopped'\n    const isEditing = editMode === 'started'\n    const isSaving = editMode === 'stopping'\n    const isDeleting = editMode === 'deleting'\n\n    // HANDLERS\n\n    const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n      updateState((draft) => {\n        Object.assign(draft.values, { [fieldName]: value })\n        draft.isDirty = true\n      })\n    }\n    const makeFieldChangeHandler = (fieldName: keyof Fields) => (value: unknown) => setFieldValue(fieldName, value)\n\n    const handleEdit = () => {\n      updateState((draft) => {\n        draft.editMode = 'started'\n        draft.lastValues = draft.values\n      })\n    }\n\n    const handleCancel = () => {\n      updateState((draft) => {\n        if (!draft.lastValues) throw new Error('no values to revert to')\n        draft.editMode = 'stopped'\n        draft.values = draft.lastValues\n        draft.isDirty = false\n      })\n    }\n\n    const handleSaveTranslation = async () => {\n      try {\n        updateState((draft) => {\n          draft.editMode = 'stopping'\n        })\n        const translationInput = trimAllStrings(values)\n        if (isNewTranslation) {\n          // new translation\n          const translationId = await createTranslation(api, invalidate)(translationInput)\n          updateState((draft) => {\n            draft.editMode = 'stopped'\n            draft.isDirty = false\n          })\n          window.setTimeout(() => {\n            navigate.translationDetail({ translationId }, true) // let state update\n          })\n        } else {\n          // existing translation\n          await updateTranslation(\n            api,\n            invalidate\n          )({\n            ...translationInput,\n            id: translation.id,\n          })\n          updateState((draft) => {\n            draft.editMode = 'stopped'\n            draft.isDirty = false\n          })\n        }\n      } catch (err) {\n        switch ((err as Error).message) {\n          case 'duplicate key value violates unique constraint \"translations_translation_name_key\"':\n            notifications.error(`Failed to save: name \"${values.name}\" already in use`)\n            break\n          default:\n            notifications.error(`Failed to save: ${err}`)\n        }\n        updateState((draft) => {\n          draft.editMode = 'started'\n        })\n      }\n    }\n\n    const handleDeleteTranslation = async () => {\n      try {\n        if (!translation) throw new Error('No translation.')\n        updateState((draft) => {\n          draft.editMode = 'deleting'\n        })\n        await deleteTranslation(api, invalidate)(translation)\n        notifications.info(`Deleted translation ${translation.name}`)\n        navigate.translations()\n      } catch (err) {\n        notifications.error(`Failed to delete: ${err}`)\n        updateState((draft) => {\n          draft.editMode = 'stopped'\n        })\n      }\n    }\n\n    const handleAddGroup = () => {\n      setIsEditOpen(true)\n      setTargetGroupId(undefined)\n    }\n\n    const handleUpdatedGroup = (updatedGroup: TranslationGroup) => {\n      updateGroups((draft) => {\n        const index = draft.findIndex(({ id }) => id === updatedGroup.id)\n        if (index === -1) {\n          // new group\n          draft.push(updatedGroup)\n        } else {\n          // updated group\n          draft[index] = updatedGroup\n        }\n      })\n    }\n\n    const handleDeleteGroup = async () => {\n      try {\n        if (!targetGroupId) throw new Error('No group.')\n        await deleteTranslationGroup(api, deferredInvalidate)({ id: targetGroupId })\n        updateGroups((draft) => {\n          const index = draft.findIndex(({ id }) => id === targetGroupId)\n          if (index === -1) return // should never occur\n          draft.splice(index, 1)\n        })\n      } catch (err) {\n        notifications.error(`Failed to delete OTU Name: ${err}`)\n      }\n    }\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<TranslationGroup>[] = []\n\n      if (textFilterDebounced) {\n        const textFilterDebouncedLowercase = textFilterDebounced.toLowerCase()\n        result.push({\n          id: 'text',\n          label: `OTU Name contains \"${textFilterDebounced}\"`,\n          filterFn: ({ translationScientificName }) =>\n            translationScientificName.toLowerCase().includes(textFilterDebouncedLowercase),\n          onDelete: clearTextFilter,\n        })\n      }\n\n      return result\n    }, [textFilterDebounced])\n\n    const rows = useMemo<TranslationGroupRow[]>(() => {\n      const filtered = filters.reduce<TranslationGroup[]>((acc, { filterFn }) => acc.filter(filterFn), groups)\n\n      return filtered.map((translationGroup) => {\n        const taxa = translationGroup.taxonomyIds.map((taxonId) => {\n          const taxon = allTaxa.find(({ id }) => id === taxonId)\n          if (!taxon) throw new Error('Taxon not found')\n          return taxon\n        })\n\n        const onEdit = () => {\n          setIsEditOpen(true)\n          setTargetGroupId(translationGroup.id)\n        }\n\n        const onDelete = () => {\n          setIsConfirmDeleteGroupOpen(true)\n          setTargetGroupId(translationGroup.id)\n        }\n\n        const canOperate = isStopped\n\n        return { ...translationGroup, taxa, onEdit, onDelete, canOperate }\n      })\n    }, [groups, allTaxa, filters, isStopped])\n\n    // RENDER\n\n    return (\n      <>\n        <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n          <AccordionPanel\n            value={isPanelExpanded}\n            onChange={setIsPanelExpanded}\n            locked={isEditing}\n            summary={\n              !isEditing ? (\n                <Title>{values.name}</Title>\n              ) : (\n                <div css={{ flex: 1 }}>\n                  <TextField\n                    label=\"Translation Name\"\n                    value={values.name}\n                    onChange={makeFieldChangeHandler('name')}\n                    error={errors?.name}\n                    InputProps={{ sx: { fontWeight: '700' } }} // roughly match <Title>\n                    css={{ width: '30em' }}\n                    maxLength={255}\n                  />\n                </div>\n              )\n            }\n            actions={\n              <div css={{ display: 'flex', gap: '0.5em' }}>\n                {(isStopped || isDeleting) && user.hasPermission(NAMCResource.translations, GrantAction.updateAny) && (\n                  <Menu\n                    label=\"Actions\"\n                    disabled={isDeleting}\n                    items={[\n                      {\n                        key: 'edit',\n                        label: 'Edit Translation',\n                        onClick: handleEdit,\n                      },\n                      Divider,\n                      {\n                        key: 'delete',\n                        label: 'Delete Translation',\n                        onClick: () => {\n                          setIsConfirmDeleteTranslationOpen(true)\n                        },\n                        disabled: !user.hasPermission(NAMCResource.translations, GrantAction.deleteAny),\n                      },\n                    ]}\n                  ></Menu>\n                )}\n                {(isEditing || isSaving) && (\n                  <>\n                    {!isNewTranslation && (\n                      <MuiButton onClick={handleCancel} variant=\"outlined\" disabled={isSaving}>\n                        Cancel\n                      </MuiButton>\n                    )}\n                    <MuiButton\n                      onClick={handleSaveTranslation}\n                      variant=\"contained\"\n                      disabled={!isDirty || isSaving || !!errors}\n                    >\n                      Save\n                    </MuiButton>\n                  </>\n                )}\n              </div>\n            }\n          >\n            <div\n              css={{\n                display: 'grid',\n                gap: '0.75em',\n                gridTemplateColumns: '1fr 1fr 4fr',\n                gridTemplateAreas: `\n                  \"id     isActive     description\"\n                  \".      .     description\"\n                `,\n              }}\n            >\n              <ReadOnlyField gridArea=\"id\" value={translation?.id ?? 'TBD'} label=\"Translation ID\" />\n              <CheckboxField\n                gridArea=\"isActive\"\n                value={!values.isActive}\n                onChange={(value) => setFieldValue('isActive', !value)}\n                label=\"Active\"\n                readOnly={!isEditing}\n              />\n              <TextField\n                gridArea=\"description\"\n                value={values.description}\n                onChange={(value) => setFieldValue('description', value)}\n                label=\"Description\"\n                readOnly={!isEditing}\n                multiline\n                minRows={3}\n              />\n            </div>\n          </AccordionPanel>\n          <div css={{ display: 'flex' }}>\n            <TextField\n              value={textFilter}\n              onChange={setTextFilter}\n              label=\"OTU Name\"\n              css={{ width: '25em' }}\n              disabled={!isStopped}\n            />\n            <div css={{ marginLeft: 'auto' }}>\n              <MuiButton onClick={handleAddGroup} variant=\"outlined\" startIcon={<AddIcon />} disabled={!isStopped}>\n                Add OTU Name\n              </MuiButton>\n            </div>\n          </div>\n          <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n            <FilterChips filters={filters} joinLabel=\"and\" />\n            <DataGridRecordCount total={groups.length} visible={rows.length} descriptor=\"OTU Name\" />\n          </div>\n          <div css={{ flex: 1 }}>\n            <DataGrid<TranslationGroupRow>\n              columnDefs={translationDetailColumnDefs}\n              rows={rows}\n              frameworkComponents={renderers}\n            />\n          </div>\n        </div>\n        {translation?.id && (\n          <EditTranslationGroupDialog\n            isOpen={isEditOpen}\n            translationId={translation.id}\n            targetGroupId={targetGroupId}\n            onClose={() => setIsEditOpen(false)}\n            onUpdate={handleUpdatedGroup}\n            groups={groups}\n            taxa={allTaxa}\n          />\n        )}\n        <ConfirmationDialog\n          title=\"Confirm Delete Translation\"\n          isOpen={isConfirmDeleteTranslationOpen}\n          onClose={() => {\n            setIsConfirmDeleteTranslationOpen(false)\n          }}\n          onConfirm={handleDeleteTranslation}\n        >\n          Are you sure you want to delete this translation?\n        </ConfirmationDialog>\n        <ConfirmationDialog\n          title=\"Confirm Delete OTU Name\"\n          isOpen={isConfirmDeleteGroupOpen}\n          onClose={() => {\n            setIsConfirmDeleteGroupOpen(false)\n          }}\n          onConfirm={handleDeleteGroup}\n        >\n          Are you sure you want to delete {groups.find(({ id }) => id === targetGroupId)?.translationScientificName}?\n        </ConfirmationDialog>\n        {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n      </>\n    )\n  },\n  () => <Fallback />\n)\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectTranslationById, selectNull } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { TranslationDetail as Component } from './TranslationDetail'\nimport { Fallback } from './Fallback'\n\nexport type TranslationDetailProps =\n  | {\n      translationId: string | number\n      isNew?: never\n    }\n  | {\n      translationId?: never\n      isNew: true // unconsumed; used to positively differentiate modes\n    }\n\nexport const TranslationDetail = withSuspense(({ translationId }: TranslationDetailProps): JSX.Element => {\n  const translation = useRecoilValue(translationId ? selectTranslationById(Number(translationId)) : selectNull)\n\n  if (translationId && !translation) return <h2>Translation {translationId} not found.</h2>\n\n  return <Component translation={translation} />\n}, Fallback)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const translationsColumnDefs = [\n  columnDef.linkColumn({\n    headerName: 'Translation Name',\n    field: 'title',\n    flex: 1,\n  }),\n  columnDef.textColumn({\n    headerName: 'Translation ID',\n    field: 'id',\n    width: 150,\n  }),\n  columnDef.booleanColumn({\n    field: 'isActive',\n    valueLabels: ['No', 'Yes'],\n    width: 120,\n  }),\n  columnDef.numberColumn({\n    headerName: '# OTU Names',\n    field: 'taxaCount',\n    width: 150,\n  }),\n  columnDef.dateColumn({\n    headerName: 'Created',\n    field: 'createdDate',\n    width: 140,\n  }),\n  columnDef.dateColumn({\n    headerName: 'Updated',\n    field: 'updatedDate',\n    width: 140,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport MuiButton from '@mui/material/Button'\n\nimport { selectMyUser, selectTranslations } from '../../data/selectors'\nimport { DataGrid, DataGridRecordCount, renderers } from '../DataGrid'\nimport { Translation } from '../../types'\nimport { withSuspense } from '../withSuspense'\nimport { translationsColumnDefs } from './columnDefs'\nimport { useNavigate } from '../AppRouter'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\nimport { Filter, FilterChips } from '../Filters'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\n\ninterface TranslationRow extends Translation {\n  title: {\n    label: string\n    onClick: () => void\n  }\n}\n\nconst textFilterState = atom({\n  key: 'TranslationsListing/textFilterState',\n  default: '',\n})\n\nexport const TranslationsListing = withSuspense(\n  () => {\n    const navigate = useNavigate()\n    const user = useRecoilValue(selectMyUser)\n    const translations = useRecoilValue(selectTranslations)\n\n    // STATE AND REFS\n\n    const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n      useRecoilState(textFilterState)\n    )\n\n    // FILTERS\n\n    const filters = useMemo(() => {\n      const result: Filter<Translation>[] = []\n\n      if (textFilterDebounced) {\n        result.push({\n          id: 'text',\n          label: `Name contains \"${textFilterDebounced}\"`,\n          filterFn: ({ name }) => name.toLowerCase().includes(textFilterDebounced.toLowerCase()),\n          onDelete: clearTextFilter,\n        })\n      }\n\n      return result\n    }, [textFilterDebounced])\n\n    const rows = useMemo<TranslationRow[]>(() => {\n      const filtered = filters.reduce<Translation[]>((acc, { filterFn }) => acc.filter(filterFn), translations)\n      return filtered.map((translation) => ({\n        ...translation,\n        title: {\n          label: translation.name,\n          onClick: () => {\n            navigate.translationDetail({ translationId: translation.id })\n          },\n        },\n      }))\n    }, [translations, filters])\n\n    // RENDER\n\n    return (\n      <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n        <div css={{ display: 'flex', gap: '0.5em' }}>\n          <TextFilterField value={textFilter} onChange={setTextFilter} label=\"Translation Name\" />\n          {user.hasPermission(NAMCResource.translations, GrantAction.createAny) && (\n            <div css={{ marginLeft: 'auto' }}>\n              <MuiButton\n                variant=\"outlined\"\n                onClick={() => {\n                  navigate.translationCreate()\n                }}\n              >\n                Create New Translation\n              </MuiButton>\n            </div>\n          )}\n        </div>\n        <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n          <FilterChips filters={filters} joinLabel=\"and\" />\n          <DataGridRecordCount total={translations.length} visible={rows.length} descriptor=\"translation\" />\n        </div>\n        <div css={{ flex: 1 }}>\n          <DataGrid<Translation> rows={rows} columnDefs={translationsColumnDefs} frameworkComponents={renderers} />\n        </div>\n      </div>\n    )\n  },\n  () => <MuiSkeleton height=\"20em\" />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { useRecoilValue } from 'recoil'\nimport MuiSkeleton from '@mui/material/Skeleton'\nimport { uniq } from 'lodash'\n\nimport { selectRoles } from '../../data/selectors'\nimport { ReadOnlyField } from '../ReadOnlyField'\nimport { withSuspense } from '../withSuspense'\nimport { AutocompleteArrayField, AutocompleteArrayFieldProps } from '../AutocompleteArrayField'\n\nexport type RolesFieldProps = Omit<AutocompleteArrayFieldProps, 'options'> & { hideRoleLevel?: number }\n\nexport const RolesField = withSuspense<RolesFieldProps>(\n  ({ value, onChange, hideRoleLevel = -1, ...restProps }): JSX.Element => {\n    const roles = useRecoilValue(selectRoles)\n\n    const hiddenIds = roles.filter(({ level }) => level <= hideRoleLevel).map(({ id }) => id)\n\n    const options = roles\n      .filter(({ id }) => !hiddenIds.includes(id))\n      .map(({ id: value, name: label }) => ({\n        value,\n        label,\n      }))\n\n    const displayValue = value.filter((id) => !hiddenIds.includes(Number(id)))\n    const hiddenValue = value.filter((id) => hiddenIds.includes(Number(id)))\n\n    const handleChange = (value) => onChange(uniq([...value, ...hiddenValue]))\n\n    return <AutocompleteArrayField value={displayValue} onChange={handleChange} {...restProps} options={options} />\n  },\n  (props) => <ReadOnlyField {...props} value={<MuiSkeleton />} />\n)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport { selector, useRecoilValue } from 'recoil'\nimport MuiButton from '@mui/material/Button'\n\nimport { useUpdatableState } from '../../lib/useUpdatableState'\nimport { TextField } from '../TextField'\nimport { CheckboxField } from '../CheckboxField'\nimport { AutocompleteField } from '../AutocompleteField'\nimport {\n  selectDefaultOrganizationTypeId,\n  selectMyUser,\n  selectOrganizations,\n  selectRoles,\n  selectSystemAdminRoleLevel,\n  selectUsCountryId,\n  selectUsStates,\n  useInvalidate,\n  useDeferredInvalidate,\n} from '../../data/selectors'\nimport { Organization, User } from '../../types'\nimport { GrantAction, NAMCResource } from '@namcbugdb/common'\nimport { RolesField } from './RolesField'\nimport {\n  createOrganizationWithUser,\n  deleteOrganization,\n  updateOrganization,\n  updateUser,\n  updateUserRoles,\n} from '../../data/calls'\nimport { useApi } from '../../data/api'\nimport { useNotifications } from '../AppNotifications'\nimport { ConfirmNavigateAway } from '../AppRouter'\nimport { Title } from '../Title'\n\nexport interface UserDetailProps {\n  user?: User\n  organization?: Organization\n  isSelf?: boolean\n}\n\ninterface Fields {\n  firstName: string\n  lastName: string\n  userPhone: string\n  affiliationId: number | null\n  deleteOldOrganization: boolean\n  roleIds: number[]\n  organizationName: string\n  address1: string\n  address2: string\n  city: string\n  usStateId: number | null\n  zipCode: string\n  organizationPhone: string\n}\n\ntype FieldErrors = Partial<Record<keyof Fields, boolean>> | undefined\n\ninterface State {\n  editMode: 'stopped' | 'started' | 'stopping'\n  isDirty: boolean\n  values: Fields\n  lastValues?: Fields\n}\n\nconst selectOrganizationOptions = selector({\n  key: 'UserDetail/selectOrganizationOptions',\n  get: async ({ get }) => {\n    const organizations = get(selectOrganizations)\n    return organizations.map(({ id: value, name: label }) => ({ value, label }))\n  },\n})\n\nconst selectUsStateOptions = selector({\n  key: 'UserDetail/selectUsStateOptions',\n  get: async ({ get }) => {\n    const usStates = get(selectUsStates)\n    return usStates.map(({ id: value, abbreviation: label }) => ({ value, label }))\n  },\n})\n\nconst getInitialState = ({ user, organization }: Pick<UserDetailProps, 'user' | 'organization'>): State => ({\n  editMode: !user && !organization ? 'started' : 'stopped',\n  isDirty: false,\n  values: {\n    firstName: user?.firstName || '',\n    lastName: user?.lastName || '',\n    userPhone: user?.phone || '',\n    affiliationId: user?.affiliationId || null,\n    deleteOldOrganization: true,\n    roleIds: user?.roleIds || [],\n    organizationName: organization?.name || '',\n    address1: organization?.address1 || '',\n    address2: organization?.address2 || '',\n    city: organization?.city || '',\n    usStateId: organization?.usStateId || null,\n    zipCode: organization?.zipCode || '',\n    organizationPhone: organization?.phone || '',\n  },\n})\n\nexport const UserDetail = ({ user, organization, isSelf }: UserDetailProps): JSX.Element => {\n  const api = useApi()\n  const invalidate = useInvalidate()\n  const deferredInvalidate = useDeferredInvalidate()\n  const notifications = useNotifications()\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [state, setState, updateState] = useUpdatableState<State>(getInitialState({ user, organization }), [\n    user,\n    organization,\n  ])\n\n  const operatorUser = useRecoilValue(selectMyUser)\n  const usCountryId = useRecoilValue(selectUsCountryId)\n  const typeId = useRecoilValue(selectDefaultOrganizationTypeId)\n  const roles = useRecoilValue(selectRoles)\n  const systemAdminRoleLevel = useRecoilValue(selectSystemAdminRoleLevel)\n\n  const { values, editMode, isDirty } = state\n\n  const canUpdateOwnUser = operatorUser.hasPermission(NAMCResource.individuals, GrantAction.updateOwn)\n  const canUpdateAnyUser = operatorUser.hasPermission(NAMCResource.individuals, GrantAction.updateAny)\n  const isNewUser = !user && !organization\n  const isOtherSystemAdmin =\n    !isSelf &&\n    (user?.roleIds || []).some((roleId) =>\n      roles.find(({ id, level }) => roleId === id && level === systemAdminRoleLevel)\n    )\n  const isEditable = editMode === 'started'\n  const isEditingUserFields = isEditable\n  const isEditingOrganizationFields = isEditable && isSelf\n  const isShowingAdminOnlyControls = !isSelf && canUpdateAnyUser\n  const isShowingDeleteOldOrganization =\n    isShowingAdminOnlyControls &&\n    isEditable &&\n    values.affiliationId !== user?.affiliationId &&\n    organization?.userCount === 1\n\n  const errors: FieldErrors = (() => {\n    const result: FieldErrors = {}\n    if (isEditingUserFields) {\n      result.firstName = !values.firstName.trim()\n      result.lastName = !values.lastName.trim()\n    }\n    if (isEditingOrganizationFields) {\n      result.organizationName = values.organizationName.trim().length < 3\n    }\n\n    if (!Object.values(result).some((value) => value)) return undefined\n    return result\n  })()\n\n  const setFieldValue = (fieldName: keyof Fields, value: unknown) => {\n    updateState((draft) => {\n      Object.assign(draft.values, { [fieldName]: value })\n      draft.isDirty = true\n    })\n  }\n\n  const onEdit = () => {\n    updateState((draft) => {\n      draft.editMode = 'started'\n      draft.lastValues = draft.values\n    })\n  }\n\n  const onCancel = () => {\n    updateState((draft) => {\n      if (!draft.lastValues) throw new Error('no values to revert to')\n      draft.editMode = 'stopped'\n      draft.values = draft.lastValues\n      draft.isDirty = false\n    })\n  }\n\n  const onSave = async () => {\n    try {\n      updateState((draft) => {\n        draft.editMode = 'stopping'\n      })\n      if (isNewUser) {\n        // new user\n        await createOrganizationWithUser(\n          api,\n          invalidate\n        )({\n          organization: {\n            name: values.organizationName,\n            typeId,\n            address1: values.address1,\n            address2: values.address2,\n            city: values.city,\n            countryId: usCountryId,\n            phone: values.organizationPhone,\n            usStateId: values.usStateId,\n            zipCode: values.zipCode,\n          },\n          user: {\n            firstName: values.firstName,\n            lastName: values.lastName,\n            phone: values.userPhone,\n          },\n        })\n        // page automatically refreshes here\n      } else {\n        // existing user\n        if (isEditingOrganizationFields) {\n          if (!organization?.id) throw new Error('no organization ID')\n          if (!organization?.countryId) throw new Error('no organization country ID')\n          if (!organization?.typeId) throw new Error('no organization type ID')\n          await updateOrganization(\n            api,\n            deferredInvalidate\n          )({\n            id: organization.id,\n            name: values.organizationName,\n            address1: values.address1,\n            address2: values.address2,\n            city: values.city,\n            zipCode: values.zipCode,\n            usStateId: values.usStateId,\n            countryId: organization.countryId,\n            phone: values.organizationPhone,\n            typeId: organization.typeId,\n          })\n        }\n        if (isEditingUserFields) {\n          if (!user?.id) throw new Error('no user ID')\n          const isAffiliationChanged = user.affiliationId !== values.affiliationId\n          await updateUser(api, isAffiliationChanged ? invalidate : deferredInvalidate)(\n            {\n              id: user.id,\n              firstName: values.firstName,\n              lastName: values.lastName,\n              affiliationId: values.affiliationId,\n              phone: values.userPhone,\n            },\n            !!isSelf\n          )\n        }\n        if (isShowingAdminOnlyControls) {\n          if (!user?.id) throw new Error('no user ID')\n          await updateUserRoles(\n            api,\n            deferredInvalidate\n          )({\n            id: user.id,\n            roleIds: values.roleIds,\n          })\n        }\n        if (isShowingDeleteOldOrganization && values.deleteOldOrganization) {\n          try {\n            await deleteOrganization(api, invalidate)(organization)\n          } catch (err) {\n            notifications.error(`Failed to delete organization: ${err}`)\n          }\n        }\n      }\n      updateState((draft) => {\n        draft.editMode = 'stopped'\n        draft.isDirty = false\n      })\n    } catch (err) {\n      notifications.error(`Failed to save: ${err}`)\n      updateState((draft) => {\n        draft.editMode = 'started'\n      })\n    }\n  }\n\n  return (\n    <>\n      <div css={{ maxWidth: '40rem' }}>\n        <div css={{ display: 'flex', gap: '0.5em', alignItems: 'center' }}>\n          <Title css={{ marginRight: 'auto' }}>\n            {isNewUser ? 'Create New User' : user?.email || <em>no email address</em>}\n          </Title>\n          {editMode !== 'stopped' && !isNewUser && (\n            <MuiButton variant=\"outlined\" onClick={onCancel} disabled={editMode === 'stopping'}>\n              Cancel\n            </MuiButton>\n          )}\n          {editMode !== 'stopped' && (\n            <MuiButton variant=\"contained\" onClick={onSave} disabled={!!errors || editMode === 'stopping' || !isDirty}>\n              Save\n            </MuiButton>\n          )}\n          {editMode === 'stopped' && ((isSelf && canUpdateOwnUser) || canUpdateAnyUser) && (\n            <MuiButton variant=\"outlined\" onClick={onEdit} disabled={isOtherSystemAdmin}>\n              Edit\n            </MuiButton>\n          )}\n        </div>\n        <h4 css={{ margin: '0.75em 0' }}>User</h4>\n        <div\n          css={{\n            display: 'grid',\n            gap: '0.75em',\n            gridTemplateColumns: '1fr 1fr',\n            gridTemplateAreas: `\n              \"firstName  lastName\"\n              \"userPhone  .\"\n          `,\n          }}\n        >\n          <TextField\n            gridArea=\"firstName\"\n            value={values.firstName}\n            onChange={(value) => setFieldValue('firstName', value)}\n            label=\"First Name\"\n            error={errors?.firstName}\n            readOnly={!isEditingUserFields}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"lastName\"\n            value={values.lastName}\n            onChange={(value) => setFieldValue('lastName', value)}\n            label=\"Last Name\"\n            error={errors?.lastName}\n            readOnly={!isEditingUserFields}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"userPhone\"\n            value={values.userPhone}\n            onChange={(value) => setFieldValue('userPhone', value)}\n            label=\"Phone\"\n            error={errors?.userPhone}\n            readOnly={!isEditingUserFields}\n            maxLength={50}\n          />\n        </div>\n        {isShowingAdminOnlyControls && (\n          <>\n            <h4 css={{ margin: '0.75em 0' }}>Roles and Affiliation</h4>\n            <div\n              css={{\n                display: 'flex',\n                flexDirection: 'column',\n                gap: '0.75em',\n              }}\n            >\n              <AutocompleteField\n                label=\"Belongs To\"\n                gridArea=\"affiliationId\"\n                optionsSelector={selectOrganizationOptions}\n                valueLabel={user?.organizationName || ''}\n                value={values.affiliationId}\n                onChange={(value) => setFieldValue('affiliationId', value)}\n                error={errors?.affiliationId}\n                readOnly={!isEditable}\n              />\n              {isShowingDeleteOldOrganization && (\n                <CheckboxField\n                  label={`Delete \"${user?.organizationName}\" organization with no remaining users and move any orphaned resources to the selected organization`}\n                  gridArea=\"deleteOldOrganization\"\n                  value={values.deleteOldOrganization}\n                  onChange={(value) => setFieldValue('deleteOldOrganization', value)}\n                />\n              )}\n              <RolesField\n                label=\"Roles\"\n                gridArea=\"roleIds\"\n                value={values.roleIds}\n                onChange={(value) => setFieldValue('roleIds', value)}\n                error={errors?.roleIds}\n                readOnly={!isEditable}\n                hideRoleLevel={isOtherSystemAdmin ? undefined : systemAdminRoleLevel}\n              />\n            </div>\n          </>\n        )}\n        <h4 css={{ margin: '0.75em 0' }}>Organization</h4>\n        <div\n          css={{\n            display: 'grid',\n            gap: '0.75em',\n            gridTemplateColumns: '1fr 1fr',\n            gridTemplateAreas: `\n                        \"organizationName   organizationName\"\n                        \"address1           address1\"\n                        \"address2           address2\"\n                        \"city               city\"\n                        \"usStateId          zipCode\"\n                        \"organizationPhone  .\"\n                      `,\n          }}\n        >\n          <TextField\n            gridArea=\"organizationName\"\n            value={values.organizationName}\n            onChange={(value) => setFieldValue('organizationName', value)}\n            label=\"Organization Name\"\n            error={errors?.organizationName}\n            readOnly={!isEditingOrganizationFields}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"address1\"\n            value={values.address1}\n            onChange={(value) => setFieldValue('address1', value)}\n            label=\"Address 1\"\n            error={errors?.address1}\n            readOnly={!isEditingOrganizationFields}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"address2\"\n            value={values.address2}\n            onChange={(value) => setFieldValue('address2', value)}\n            label=\"Address 2\"\n            error={errors?.address2}\n            readOnly={!isEditingOrganizationFields}\n            maxLength={255}\n          />\n          <TextField\n            gridArea=\"city\"\n            value={values.city}\n            onChange={(value) => setFieldValue('city', value)}\n            label=\"City\"\n            error={errors?.city}\n            readOnly={!isEditingOrganizationFields}\n            maxLength={255}\n          />\n          <AutocompleteField\n            gridArea=\"usStateId\"\n            value={values.usStateId}\n            valueLabel=\"State\"\n            onChange={(value) => setFieldValue('usStateId', value)}\n            optionsSelector={selectUsStateOptions}\n            label=\"State\"\n            error={errors?.usStateId}\n            readOnly={!isEditingOrganizationFields}\n            isClearable\n          />\n          <TextField\n            gridArea=\"zipCode\"\n            value={values.zipCode}\n            onChange={(value) => setFieldValue('zipCode', value)}\n            label=\"Zip\"\n            error={errors?.zipCode}\n            readOnly={!isEditingOrganizationFields}\n            maxLength={20}\n          />\n          <TextField\n            gridArea=\"organizationPhone\"\n            value={values.organizationPhone}\n            onChange={(value) => setFieldValue('organizationPhone', value)}\n            label=\"Phone\"\n            error={errors?.organizationPhone}\n            readOnly={!isEditingOrganizationFields}\n            maxLength={50}\n          />\n        </div>\n      </div>\n      {isDirty && <ConfirmNavigateAway message=\"Some changes are not saved. Are you sure you want to leave?\" />}\n    </>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', width: '40rem', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    <MuiSkeleton height=\"5em\" variant=\"rectangular\" />\n    <MuiSkeleton height=\"15em\" variant=\"rectangular\" />\n  </div>\n)\n","import React from 'react'\nimport { useRecoilValue } from 'recoil'\n\nimport { selectMyUser, selectOrganizationById, selectUserById } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\nimport { UserDetail as Component } from './UserDetail'\nimport { Fallback } from './Fallback'\n\nexport const UserDetail = withSuspense(({ userId }: { userId: string | number }): JSX.Element => {\n  const user = useRecoilValue(selectUserById(Number(userId)))\n  const organization = useRecoilValue(selectOrganizationById(user?.affiliationId || 0)) // TODO: do this in another layer of component?\n\n  if (!user) return <h2>User {userId} not found.</h2>\n  if (!organization) return <h2>User {userId} organization not found.</h2>\n\n  return <Component user={user} organization={organization} />\n}, Fallback)\n\nexport const MyUserDetail = withSuspense((): JSX.Element => {\n  const user = useRecoilValue(selectMyUser)\n  const organization = useRecoilValue(selectOrganizationById(user.affiliationId)) ?? undefined\n\n  return <Component user={user} organization={organization} isSelf />\n}, Fallback)\n\nexport const NewUserDetail = withSuspense((): JSX.Element => {\n  return <Component isSelf />\n}, Fallback)\n","import { ColDef } from 'ag-grid-community'\nimport { columnDef } from '../DataGrid'\n\nexport const usersColumnDefs = [\n  columnDef.linkColumn({\n    headerName: 'User ID',\n    field: 'userId',\n    width: 120,\n  }),\n  columnDef.textColumn({\n    field: 'firstName',\n    flex: 1,\n    minWidth: 120,\n  }),\n  columnDef.textColumn({\n    field: 'lastName',\n    flex: 1,\n    minWidth: 120,\n  }),\n  columnDef.textColumn({\n    headerName: 'Telephone',\n    field: 'phone',\n    flex: 1,\n    minWidth: 120,\n  }),\n  columnDef.textColumn({\n    field: 'email',\n    flex: 1,\n    minWidth: 120,\n  }),\n  columnDef.textColumn({\n    headerName: 'Affiliation',\n    field: 'organizationName',\n    flex: 1,\n    minWidth: 120,\n  }),\n  columnDef.textListColumn({\n    field: 'roles',\n    flex: 1,\n    minWidth: 120,\n  }),\n] as ColDef[]\n","/** @jsxImportSource @emotion/react */\nimport React, { useMemo } from 'react'\nimport { useRecoilState, atom, useRecoilValue } from 'recoil'\nimport { sortBy } from 'lodash'\n// import log from 'loglevel'\n\nimport { DataGrid, renderers, DataGridRecordCount } from '../DataGrid'\nimport { User } from '../../types'\nimport { usersColumnDefs } from './columnDefs'\nimport { useNavigate } from '../AppRouter'\nimport { Filter, FilterChips } from '../Filters'\nimport { withSuspense } from '../withSuspense'\nimport { Fallback } from './Fallback'\nimport { selectRoles, selectUsers } from '../../data/selectors'\nimport { TextFilterField, useTextFilterField } from '../TextFilterField'\n\nexport interface UserRow extends User {\n  userId: {\n    label: string\n    onClick: () => void\n  }\n}\n\nconst textFilterState = atom({\n  key: 'UsersListing/textFilterState',\n  default: '',\n})\n\nexport const UsersListing = withSuspense((): JSX.Element => {\n  const navigate = useNavigate()\n  const users = useRecoilValue(selectUsers)\n  const roles = useRecoilValue(selectRoles)\n\n  // STATE AND REFS\n\n  const [textFilter, setTextFilter, textFilterDebounced, clearTextFilter] = useTextFilterField(\n    useRecoilState(textFilterState)\n  )\n\n  // FILTERS\n\n  const filters = useMemo(() => {\n    const result: Filter<User>[] = []\n\n    if (textFilterDebounced) {\n      const filterText = textFilterDebounced.toLowerCase()\n      result.push({\n        id: 'text',\n        label: `Name/Affiliation contains \"${textFilterDebounced}\"`,\n        filterFn: ({ fullName, organizationName }) =>\n          fullName.toLowerCase().includes(filterText) || organizationName.toLowerCase().includes(filterText),\n        onDelete: clearTextFilter,\n      })\n    }\n\n    return result\n  }, [textFilterDebounced])\n\n  const rows = useMemo<UserRow[]>(() => {\n    const filtered = filters.reduce<User[]>((acc, { filterFn }) => acc.filter(filterFn), users)\n    return filtered.map((user) => ({\n      ...user,\n      userId: {\n        label: String(user.id),\n        onClick: () => navigate.userDetail({ userId: user.id }),\n      },\n      roles: sortBy(user.roleIds).map((roleId) => roles.find((role) => role.id === roleId)?.name || 'Unknown'),\n    }))\n  }, [users, filters])\n\n  // RENDER\n\n  return (\n    <div css={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\n      <div css={{ display: 'flex', gap: '0.5em' }}>\n        <TextFilterField value={textFilter} onChange={setTextFilter} label=\"User Name or Affiliation\" />\n      </div>\n      <div css={{ minHeight: '2em', marginTop: '0.75em', display: 'flex' }}>\n        <FilterChips filters={filters} joinLabel=\"and\" />\n        <DataGridRecordCount total={users.length} visible={rows.length} descriptor=\"users\" />\n      </div>\n      <div css={{ flex: 1 }}>\n        <DataGrid<UserRow> rows={rows} columnDefs={usersColumnDefs} frameworkComponents={renderers} />\n      </div>\n    </div>\n  )\n}, Fallback)\n","/** @jsxImportSource @emotion/react */\nimport React from 'react'\nimport MuiSkeleton from '@mui/material/Skeleton'\n\nexport const Fallback = (): JSX.Element => (\n  <div css={{ height: '100%', display: 'flex', flexDirection: 'column', gap: '1em' }}>\n    <div css={{ width: '40em' }}>\n      <MuiSkeleton height=\"3em\" variant=\"rectangular\" />\n    </div>\n    <div css={{ width: '10em' }}>\n      <MuiSkeleton height=\"2em\" variant=\"rectangular\" />\n    </div>\n    <MuiSkeleton height=\"20em\" variant=\"rectangular\" />\n  </div>\n)\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect, useState } from 'react'\nimport { Switch, Route, Redirect, useHistory } from 'react-router-dom'\nimport { atom, useSetRecoilState, useRecoilValue } from 'recoil'\nimport log from 'loglevel'\n\nimport { AppHeader } from '../AppHeader'\nimport { ErrorBoundary } from '../ErrorBoundary'\nimport { FullScreenWait } from '../FullScreenWait'\nimport { SideNavBar } from '../SideNavBar'\nimport { selectHasUser } from '../../data/selectors'\nimport { withSuspense } from '../withSuspense'\n\nimport { BoxDetail } from '../BoxDetail'\nimport { BoxesListing } from '../BoxesListing'\nimport { BoxTaxonomy } from '../BoxTaxonomy'\nimport { ChainOfCustody } from '../ChainOfCustody'\nimport { CustomerSubmission } from '../CustomerSubmission'\nimport { MetricDetail } from '../MetricDetail'\nimport { MetricsListing } from '../MetricsListing'\nimport { ModelDetail } from '../ModelDetail'\nimport { ModelsListing } from '../ModelsListing'\nimport { OrganizationsListing } from '../OrganizationsListing'\nimport { PendingBoxReview } from '../PendingBoxReview'\nimport { PredictorDetail } from '../PredictorDetail'\nimport { PredictorsListing } from '../PredictorsListing'\nimport { ProjectDetail } from '../ProjectDetail'\nimport { ProjectsListing } from '../ProjectsListing'\nimport { PublicMap } from '../PublicMap'\nimport { ReportsListing } from '../ReportsListing'\nimport { SampleDetail } from '../SampleDetail'\nimport { SampleSorting } from '../SampleSorting'\nimport { SampleTaxonomyIdentification } from '../SampleTaxonomyIdentification'\nimport { SitesListing } from '../SitesListing'\nimport { TaxonDetail } from '../TaxonDetail'\nimport { TranslationDetail } from '../TranslationDetail'\nimport { TranslationsListing } from '../TranslationsListing'\nimport { UserDetail, MyUserDetail, NewUserDetail } from '../UserDetail'\nimport { UsersListing } from '../UsersListing'\n\ninterface NavigateFn {\n  boxDetail: (params: { boxId: number }, replace?: boolean) => void\n  boxes: () => void\n  boxReview: (params: { boxId: number }) => void\n  boxSubmission: () => void\n  boxTaxonomy: (params: { boxId: number }) => void\n  chainOfCustodyForm: (params: { boxId: number }) => void\n  home: () => void\n  metricCreate: () => void\n  metricDetail: (params: { metricId: number }, replace?: boolean) => void\n  metrics: () => void\n  modelCreate: () => void\n  modelDetail: (params: { modelId: number }, replace?: boolean) => void\n  models: () => void\n  organizations: () => void\n  predictorCreate: () => void\n  predictorDetail: (params: { predictorId: number }, replace?: boolean) => void\n  predictors: () => void\n  profile: () => void\n  projectCreate: () => void\n  projectDetail: (params: { projectId: number }, replace?: boolean) => void\n  projects: () => void\n  reports: () => void\n  sampleDetail: (params: { sampleId: number }) => void\n  sampleSorting: (params: { sampleId: number }) => void\n  sampleTaxonomyIdentification: (params: { sampleId: number }) => void\n  siteCreate: () => void\n  siteDetail: (params: { siteId: number }, replace?: boolean) => void\n  sites: (params?, replace?: boolean) => void\n  taxa: () => void\n  taxonCreate: () => void\n  taxonDetail: (params: { taxonId: number }, replace?: boolean) => void\n  translationCreate: () => void\n  translationDetail: (params: { translationId: number }, replace?: boolean) => void\n  translations: () => void\n  userDetail: (params: { userId: number }) => void\n  users: () => void\n}\n\nconst makeNavigateFn = ({\n  history,\n  openNewWindowTo,\n}: {\n  history: { push: (url: string) => void; replace: (url: string) => void }\n  openNewWindowTo: (url: string) => void\n}): NavigateFn => ({\n  boxDetail: ({ boxId }, replace?) => history[replace ? 'replace' : 'push'](`/boxes/${boxId}`),\n  boxes: () => history.push('/boxes'),\n  boxReview: ({ boxId }): void => history.push(`/boxes/${boxId}/review`),\n  boxSubmission: () => history.push(`/boxes/new`),\n  boxTaxonomy: ({ boxId }) => history.push(`/boxes/${boxId}/taxonomy`),\n  chainOfCustodyForm: ({ boxId }) => openNewWindowTo(`/forms/custody/${boxId}`),\n  home: () => history.push('/'),\n  metricCreate: () => history.push(`/metrics/new`),\n  metricDetail: ({ metricId }, replace?) => history[replace ? 'replace' : 'push'](`/metrics/${metricId}`),\n  metrics: () => history.push('/metrics'),\n  modelCreate: () => history.push(`/models/new`),\n  modelDetail: ({ modelId }, replace?) => history[replace ? 'replace' : 'push'](`/models/${modelId}`),\n  models: () => history.push('/models'),\n  organizations: () => history.push('/organizations'),\n  predictorCreate: () => history.push(`/predictors/new`),\n  predictorDetail: ({ predictorId }, replace?) => history[replace ? 'replace' : 'push'](`/predictors/${predictorId}`),\n  predictors: () => history.push('/predictors'),\n  profile: () => history.push('/profile'),\n  projectCreate: () => history.push(`/projects/new`),\n  projectDetail: ({ projectId }, replace?) => history[replace ? 'replace' : 'push'](`/projects/${projectId}`),\n  projects: () => history.push('/projects'),\n  reports: () => history.push('/reports'),\n  sampleDetail: ({ sampleId }) => history.push(`/samples/${sampleId}`),\n  sampleSorting: ({ sampleId }) => history.push(`/samples/${sampleId}/sorting`),\n  sampleTaxonomyIdentification: ({ sampleId }) => history.push(`/samples/${sampleId}/taxonomy`),\n  siteCreate: () => history.push('/sites/new'),\n  siteDetail: ({ siteId }, replace?) => history[replace ? 'replace' : 'push'](`/sites/${siteId}`),\n  sites: (params?, replace?) => history[replace ? 'replace' : 'push']('/sites'),\n  taxa: () => history.push('/taxonomy'),\n  taxonCreate: () => history.push(`/taxonomy/new`),\n  taxonDetail: ({ taxonId }, replace) => history[replace ? 'replace' : 'push'](`/taxonomy/${taxonId}`),\n  translationCreate: () => history.push(`/translations/new`),\n  translationDetail: ({ translationId }, replace?) =>\n    history[replace ? 'replace' : 'push'](`/translations/${translationId}`),\n  translations: () => history.push('/translations'),\n  userDetail: ({ userId }) => history.push(`/users/${userId}`),\n  users: () => history.push('/users'),\n})\n\nexport const navigateState = atom({\n  key: 'AppRouter/navigate',\n  default: makeNavigateFn({\n    history: { push: (url) => log.debug('history.push:', url), replace: (url) => log.debug('history.replace:', url) },\n    openNewWindowTo: (url) => log.debug('new window:', url),\n  }),\n})\n\nexport const useNavigate = (): NavigateFn => useRecoilValue(navigateState)\n\nconst isFormPath = (pathname: string) => pathname.includes('/forms/')\n\nexport const AppRouter = withSuspense(\n  (): JSX.Element => {\n    const hasUser = useRecoilValue(selectHasUser)\n\n    const setNavigate = useSetRecoilState(navigateState)\n    const history = useHistory()\n\n    const [formLayout, setFormLayout] = useState(isFormPath(history.location.pathname))\n\n    useEffect(() => {\n      setNavigate(() =>\n        makeNavigateFn({\n          history,\n          openNewWindowTo: (url) => window.open(window.location.href.replace(/#.*/, `#${url}`)),\n        })\n      )\n    }, [])\n\n    useEffect(() => {\n      return history.listen(({ pathname }) => {\n        setFormLayout(isFormPath(pathname))\n      })\n    }, [])\n\n    if (formLayout)\n      return (\n        <Switch>\n          <Route\n            exact\n            path=\"/forms/custody/:boxId\"\n            render={({ match }) => <ChainOfCustody boxId={match.params.boxId} autoPrint />}\n          />\n          <Route path=\"*\">\n            <h2>Page not found.</h2>\n          </Route>\n        </Switch>\n      )\n\n    return (\n      <div css={{ height: '100vh', display: 'flex', flexDirection: 'column' }}>\n        <AppHeader />\n        <SideNavBar />\n        <div css={{ flex: 1, padding: '0.5em' }}>\n          <ErrorBoundary>\n            <Switch>\n              {!hasUser && (\n                <Route path=\"*\">\n                  <NewUserDetail />\n                </Route>\n              )}\n              <Route exact path=\"/\">\n                <Redirect to=\"/boxes\" />\n              </Route>\n              <Route exact path=\"/boxes\" render={() => <BoxesListing />} />\n              <Route exact path=\"/boxes/new\" render={() => <CustomerSubmission />} />\n              <Route exact path=\"/boxes/:boxId\" render={({ match }) => <BoxDetail boxId={match.params.boxId} />} />\n              <Route\n                exact\n                path=\"/boxes/:boxId/review\"\n                render={({ match }) => <PendingBoxReview boxId={match.params.boxId} />}\n              />\n              <Route\n                exact\n                path=\"/boxes/:boxId/taxonomy\"\n                render={({ match }) => <BoxTaxonomy boxId={match.params.boxId} />}\n              />\n              <Route exact path=\"/map\" render={() => <PublicMap />} />\n              <Route exact path=\"/metrics\" render={() => <MetricsListing />} />\n              <Route exact path=\"/metrics/new\" render={() => <MetricDetail isNew />} />\n              <Route\n                exact\n                path=\"/metrics/:metricId\"\n                render={({ match }) => <MetricDetail metricId={match.params.metricId} />}\n              />\n              <Route exact path=\"/models\" render={() => <ModelsListing />} />\n              <Route exact path=\"/models/new\" render={() => <ModelDetail isNew />} />\n              <Route\n                exact\n                path=\"/models/:modelId\"\n                render={({ match }) => <ModelDetail modelId={match.params.modelId} />}\n              />\n              <Route exact path=\"/organizations\" render={() => <OrganizationsListing />} />\n              <Route exact path=\"/predictors\" render={() => <PredictorsListing />} />\n              <Route exact path=\"/predictors/new\" render={() => <PredictorDetail isNew />} />\n              <Route\n                exact\n                path=\"/predictors/:predictorId\"\n                render={({ match }) => <PredictorDetail predictorId={match.params.predictorId} />}\n              />\n              <Route exact path=\"/profile\" render={() => <MyUserDetail />} />\n              <Route exact path=\"/projects\" render={() => <ProjectsListing />} />\n              <Route exact path=\"/projects/new\" render={() => <ProjectDetail isNew />} />\n              <Route\n                exact\n                path=\"/projects/:projectId\"\n                render={({ match }) => <ProjectDetail projectId={match.params.projectId} />}\n              />\n              <Route exact path=\"/reports\" render={() => <ReportsListing />} />\n              <Route\n                exact\n                path=\"/samples/:sampleId\"\n                render={({ match }) => <SampleDetail sampleId={match.params.sampleId} />}\n              />\n              <Route\n                exact\n                path=\"/samples/:sampleId/sorting\"\n                render={({ match }) => <SampleSorting sampleId={match.params.sampleId} />}\n              />\n              <Route\n                exact\n                path=\"/samples/:sampleId/taxonomy\"\n                render={({ match }) => <SampleTaxonomyIdentification sampleId={match.params.sampleId} />}\n              />\n              <Route\n                exact\n                path=\"/sites/:siteId?\" // can also be \"new\"\n                render={({ match }) => <SitesListing siteId={match.params.siteId} />}\n              />\n              <Route exact path=\"/taxonomy\" render={() => <TaxonDetail />} />\n              <Route exact path=\"/taxonomy/new\" render={() => <TaxonDetail isNew />} />\n              <Route\n                exact\n                path=\"/taxonomy/:taxonId\"\n                render={({ match }) => <TaxonDetail taxonId={match.params.taxonId} />}\n              />\n              <Route exact path=\"/translations\" render={() => <TranslationsListing />} />\n              <Route exact path=\"/translations/new\" render={() => <TranslationDetail isNew />} />\n              <Route\n                exact\n                path=\"/translations/:translationId\"\n                render={({ match }) => <TranslationDetail translationId={match.params.translationId} />}\n              />\n              <Route exact path=\"/users\" render={() => <UsersListing />} />\n              <Route exact path=\"/users/:userId\" render={({ match }) => <UserDetail userId={match.params.userId} />} />\n              <Route path=\"*\">\n                <h2>Page not found.</h2>\n              </Route>\n            </Switch>\n          </ErrorBoundary>\n        </div>\n      </div>\n    )\n  },\n  () => <FullScreenWait>Retrieving profile...</FullScreenWait>\n)\n","import React, { useEffect } from 'react'\nimport { Prompt, useHistory } from 'react-router-dom'\n\n// Note: Prompt is fairly janky (e.g. changes URL anyway: https://github.com/remix-run/react-router/issues/5405); use React Router v6 when this behaviour supported\n\nexport const ConfirmNavigateAway = ({ message }: { message: string }): JSX.Element | null => {\n  const history = useHistory()\n\n  useEffect(() => {\n    const listener = (e: BeforeUnloadEvent) => {\n      e.preventDefault()\n      e.returnValue = ''\n    }\n    window.addEventListener('beforeunload', listener)\n    return () => {\n      window.removeEventListener('beforeunload', listener)\n    }\n  }, [])\n\n  if (!history) return null // we are not in React Router and Prompt will fail\n\n  return <Prompt when={true} message={message} />\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useEffect } from 'react'\nimport { HashRouter as ReactRouter } from 'react-router-dom'\nimport { RecoilRoot, useRecoilState } from 'recoil'\nimport { UseHostedReturn } from '@namcbugdb/react-common'\nimport { SnackbarProvider } from 'notistack'\n\nimport { AppRouter } from './components/AppRouter'\nimport { GraphApi, apiState } from './data/api'\nimport { endpoints } from './config'\n\nimport './normalize.css'\nimport './App.css'\n\nexport interface AppProps {\n  signOut: () => void\n  auth: UseHostedReturn\n}\n\nconst Component = ({ signOut, auth }: AppProps): JSX.Element => {\n  const [api, setApi] = useRecoilState(apiState)\n\n  useEffect(() => {\n    const apiInstance = new GraphApi(endpoints.graphql, auth, signOut)\n    setApi(apiInstance)\n  }, [])\n\n  if (!(api instanceof GraphApi)) return <div /> // wait until API is set\n\n  return (\n    <ReactRouter>\n      <AppRouter />\n    </ReactRouter>\n  )\n}\n\nexport const App = (props: AppProps): JSX.Element => {\n  return (\n    <RecoilRoot>\n      <SnackbarProvider>\n        <Component {...props} />\n      </SnackbarProvider>\n    </RecoilRoot>\n  )\n}\n","/** @jsxImportSource @emotion/react */\nimport React, { useState, useEffect } from 'react'\nimport { useHostedAuth, UseHostedReturn } from '@namcbugdb/react-common'\nimport { api } from '@namcbugdb/common'\n\nimport log from 'loglevel'\n\nimport { App } from './App'\nimport { appDefaults, endpoints, redirectUrl } from './config'\nimport { FullScreenWait } from './components/FullScreenWait'\n\nconst AppAuthConnect: React.FC = () => {\n  const [authInfo, setAuthInfo] = useState<Record<string, unknown>>()\n  const [isAppPreLoading, setIsAppPreLoading] = useState(true)\n  const auth: UseHostedReturn = useHostedAuth(authInfo as Record<string, unknown>, false, false) //config.isDev\n\n  // This is the pre-auth step to retrieve all the necessary cognito endpoint data\n  useEffect(() => {\n    api\n      .authCheck(endpoints.graphql as string, '', appDefaults.apiTimeout)\n      .then((authResp) => {\n        log.debug('authResp', authResp)\n        const authVals = authResp.data?.auth\n        if (authVals && authVals.region) {\n          setAuthInfo({\n            region: authVals.region,\n            userPoolId: authVals.userPool,\n            userPoolWebClientId: authVals.clientId,\n            mandatorySignIn: true,\n            oauth: {\n              domain: authVals.domain,\n              scope: ['email', 'profile', 'openid'],\n              redirectSignIn: redirectUrl.toString(),\n              redirectSignOut: redirectUrl.toString(),\n              responseType: 'code',\n            },\n          })\n          setIsAppPreLoading(false)\n        }\n      })\n      .catch((err) => {\n        log.error('api.authCheck error', err)\n      })\n  }, [])\n\n  useEffect(() => {\n    if (!auth.isAuthenticated && auth.isAuthComplete) auth.signIn()\n  }, [auth.isAuthenticated, auth.isAuthComplete])\n\n  if (!auth.isAuthenticated) {\n    if (isAppPreLoading) return <FullScreenWait>Loading...</FullScreenWait>\n    if (!auth.isAuthComplete) return <FullScreenWait>Authenticating...</FullScreenWait>\n    return <FullScreenWait>Redirecting...</FullScreenWait>\n  }\n\n  return <App signOut={auth.signOut} auth={auth} />\n}\nexport default AppAuthConnect\n","import { ReportHandler } from 'web-vitals'\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler): void => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport AppConnect from './App.connect'\nimport reportWebVitals from './reportWebVitals'\nimport log from 'loglevel'\n\n// THIS FIX IS NECESSARY FOR PRODUCTION AND WEBPACK!!!!\n// https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2\n// https://github.com/mapbox/mapbox-gl-js/issues/10173\nimport mapboxgl from 'mapbox-gl/dist/mapbox-gl'\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nmapboxgl.workerClass = require('worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker').default\n\nconst requestedLogLevel = process.env.REACT_APP_LOGLEVEL\nswitch (requestedLogLevel) {\n  case 'trace':\n  case 'debug':\n  case 'info':\n  case 'warn':\n  case 'error':\n  case 'silent':\n    log.setLevel(requestedLogLevel)\n    break\n  default:\n    log.setLevel(process.env.NODE_ENV === 'production' ? 'warn' : 'trace')\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <AppConnect />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}